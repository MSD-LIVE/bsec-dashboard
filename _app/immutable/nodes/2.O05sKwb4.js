var p4=Object.defineProperty;var M2=e=>{throw TypeError(e)};var m4=(e,t,r)=>t in e?p4(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var dl=(e,t,r)=>m4(e,typeof t!="symbol"?t+"":t,r),L0=(e,t,r)=>t.has(e)||M2("Cannot "+r);var Zt=(e,t,r)=>(L0(e,t,"read from private field"),r?r.call(e):t.get(e)),di=(e,t,r)=>t.has(e)?M2("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),Nr=(e,t,r,o)=>(L0(e,t,"write to private field"),o?o.call(e,r):t.set(e,r),r),Yu=(e,t,r)=>(L0(e,t,"access private method"),r);import"../chunks/Bzak7iHL.js";import{a8 as r1,aB as TS,aC as g4,b as a1,h as Vr,d as Rv,y as L,A as _4,r as y4,H as v4,e as C2,g as sg,i as Cd,o as bc,ab as SS,af as b4,k as zd,m as x4,l as eh,aD as I2,j as MS,ax as w4,aE as Lv,aj as CS,aF as T_,n as IS,p as A4,aG as S_,aH as T4,aI as B0,aJ as Rd,ad as ES,aK as S4,ai as M4,aL as C4,D as o1,aa as gd,aM as PS,u as kS,aN as I4,_ as wn,aO as E4,ag as P4,ae as k4,al as E2,aP as D4,q as sp,v as M_,t as s1,W as z4,aQ as R4,aR as L4,aS as B4,a6 as F4,aT as O4,aU as N4,aV as j4,aW as U4,aX as V4,aY as G4,E as q4,aZ as Z4,a_ as H4,a$ as $4,b0 as W4,b1 as Y4,b2 as Ha,b3 as X4,b4 as Q4,Y as nr,R as ei,C as Qe,b5 as l1,c as Ti,f as Kn,a as It,$ as ir,ay as $t,b6 as DS,a0 as Bt,a1 as Et,Z as tn,a5 as P2,a3 as k2,az as Vt,b7 as D2,b8 as F0,au as C_,as as lp,B as Ui,b9 as Bv,a2 as an,s as jr,ba as zS,Q as th,aA as O0,aw as N0,bb as K4}from"../chunks/YRLZ1HxQ.js";import{a as J4,i as e6,c as t6,d as La,b as n6,n as i6,e as r6,f as a6,w as c1,l as o6,g as s6,o as u1,j as Fh,k as fr,s as xi}from"../chunks/CN1LAJ3L.js";import{r as I_,i as pn,p as Se,b as Go}from"../chunks/YjJljqNU.js";import{b as z2}from"../chunks/BBqSjIXh.js";const l6=[];function c6(e,t=!1){return lg(e,new Map,"",l6)}function lg(e,t,r,o,u=null){if(typeof e=="object"&&e!==null){var d=t.get(e);if(d!==void 0)return d;if(e instanceof Map)return new Map(e);if(e instanceof Set)return new Set(e);if(r1(e)){var p=Array(e.length);t.set(e,p),u!==null&&t.set(u,p);for(var a=0;a<e.length;a+=1){var w=e[a];a in e&&(p[a]=lg(w,t,r,o))}return p}if(TS(e)===g4){p={},t.set(e,p),u!==null&&t.set(u,p);for(var T in e)p[T]=lg(e[T],t,r,o);return p}if(e instanceof Date)return structuredClone(e);if(typeof e.toJSON=="function")return lg(e.toJSON(),t,r,o,e)}if(e instanceof EventTarget)return e;try{return structuredClone(e)}catch{return e}}let cg=null;function la(e,t){return t}function u6(e,t,r){for(var o=e.items,u=[],d=t.length,p=0;p<d;p++)S4(t[p].e,u,!0);var a=d>0&&u.length===0&&r!==null;if(a){var w=r.parentNode;M4(w),w.append(r),o.clear(),Fo(e,t[0].prev,t[d-1].next)}C4(u,()=>{for(var T=0;T<d;T++){var S=t[T];a||(o.delete(S.k),Fo(e,S.prev,S.next)),Rd(S.e,!a)}})}function Pr(e,t,r,o,u,d=null){var p=e,a={flags:t,items:new Map,first:null},w=(t&PS)!==0;if(w){var T=e;p=Vr?sg(gd(T)):T.appendChild(MS())}Vr&&Rv();var S=null,k=!1,I=new Map,P=_4(()=>{var Y=r();return r1(Y)?Y:Y==null?[]:CS(Y)}),F,G;function H(){h6(G,F,a,I,p,u,t,o,r),d!==null&&(F.length===0?S?IS(S):S=zd(()=>d(p)):S!==null&&A4(S,()=>{S=null}))}a1(()=>{G??(G=o1),F=L(P);var Y=F.length;if(k&&Y===0)return;k=Y===0;let $=!1;if(Vr){var ae=y4(p)===v4;ae!==(Y===0)&&(p=C2(),sg(p),Cd(!1),$=!0)}if(Vr){for(var ee=null,ce,re=0;re<Y;re++){if(bc.nodeType===SS&&bc.data===b4){p=bc,$=!0,Cd(!1);break}var he=F[re],be=o(he,re);ce=Fv(bc,a,ee,null,he,be,re,u,t,r),a.items.set(be,ce),ee=ce}Y>0&&sg(C2())}if(Vr)Y===0&&d&&(S=zd(()=>d(p)));else if(x4()){var ke=new Set,Ie=eh;for(re=0;re<Y;re+=1){he=F[re],be=o(he,re);var ue=a.items.get(be)??I.get(be);ue?(t&(S_|T_))!==0&&RS(ue,he,re,t):(ce=Fv(null,a,null,null,he,be,re,u,t,r,!0),I.set(be,ce)),ke.add(be)}for(const[Ve,Ze]of a.items)ke.has(Ve)||Ie.skipped_effects.add(Ze.e);Ie.add_callback(H)}else H();$&&Cd(!0),L(P)}),Vr&&(p=bc)}function h6(e,t,r,o,u,d,p,a,w){var _t,tt,Tt,ct;var T=(p&I4)!==0,S=(p&(S_|T_))!==0,k=t.length,I=r.items,P=r.first,F=P,G,H=null,Y,$=[],ae=[],ee,ce,re,he;if(T)for(he=0;he<k;he+=1)ee=t[he],ce=a(ee,he),re=I.get(ce),re!==void 0&&((_t=re.a)==null||_t.measure(),(Y??(Y=new Set)).add(re));for(he=0;he<k;he+=1){if(ee=t[he],ce=a(ee,he),re=I.get(ce),re===void 0){var be=o.get(ce);if(be!==void 0){o.delete(ce),I.set(ce,be);var ke=H?H.next:F;Fo(r,H,be),Fo(r,be,ke),j0(be,ke,u),H=be}else{var Ie=F?F.e.nodes_start:u;H=Fv(Ie,r,H,H===null?r.first:H.next,ee,ce,he,d,p,w)}I.set(ce,H),$=[],ae=[],F=H.next;continue}if(S&&RS(re,ee,he,p),(re.e.f&B0)!==0&&(IS(re.e),T&&((tt=re.a)==null||tt.unfix(),(Y??(Y=new Set)).delete(re))),re!==F){if(G!==void 0&&G.has(re)){if($.length<ae.length){var ue=ae[0],Ve;H=ue.prev;var Ze=$[0],Xe=$[$.length-1];for(Ve=0;Ve<$.length;Ve+=1)j0($[Ve],ue,u);for(Ve=0;Ve<ae.length;Ve+=1)G.delete(ae[Ve]);Fo(r,Ze.prev,Xe.next),Fo(r,H,Ze),Fo(r,Xe,ue),F=ue,H=Xe,he-=1,$=[],ae=[]}else G.delete(re),j0(re,F,u),Fo(r,re.prev,re.next),Fo(r,re,H===null?r.first:H.next),Fo(r,H,re),H=re;continue}for($=[],ae=[];F!==null&&F.k!==ce;)(F.e.f&B0)===0&&(G??(G=new Set)).add(F),ae.push(F),F=F.next;if(F===null)continue;re=F}$.push(re),H=re,F=re.next}if(F!==null||G!==void 0){for(var Re=G===void 0?[]:CS(G);F!==null;)(F.e.f&B0)===0&&Re.push(F),F=F.next;var ot=Re.length;if(ot>0){var Pt=(p&PS)!==0&&k===0?u:null;if(T){for(he=0;he<ot;he+=1)(Tt=Re[he].a)==null||Tt.measure();for(he=0;he<ot;he+=1)(ct=Re[he].a)==null||ct.fix()}u6(r,Re,Pt)}}T&&kS(()=>{var mt;if(Y!==void 0)for(re of Y)(mt=re.a)==null||mt.apply()}),e.first=r.first&&r.first.e,e.last=H&&H.e;for(var bt of o.values())Rd(bt.e);o.clear()}function RS(e,t,r,o){(o&S_)!==0&&I2(e.v,t),(o&T_)!==0?I2(e.i,r):e.i=r}function Fv(e,t,r,o,u,d,p,a,w,T,S){var k=cg,I=(w&S_)!==0,P=(w&T4)===0,F=I?P?w4(u,!1,!1):Lv(u):u,G=(w&T_)===0?p:Lv(p),H={i:G,v:F,k:d,a:null,e:null,prev:r,next:o};cg=H;try{if(e===null){var Y=document.createDocumentFragment();Y.append(e=MS())}return H.e=zd(()=>a(e,F,G,T),Vr),H.e.prev=r&&r.e,H.e.next=o&&o.e,r===null?S||(t.first=H):(r.next=H,r.e.next=H.e),o!==null&&(o.prev=H,o.e.prev=H.e),H}finally{cg=k}}function j0(e,t,r){for(var o=e.next?e.next.e.nodes_start:r,u=t?t.e.nodes_start:r,d=e.e.nodes_start;d!==null&&d!==o;){var p=ES(d);u.before(d),d=p}}function Fo(e,t,r){t===null?e.first=r:(t.next=r,t.e.next=r&&r.e),r!==null&&(r.prev=t,r.e.prev=t&&t.e)}function Ov(e,t,r=!1,o=!1,u=!1){var d=e,p="";wn(()=>{var a=o1;if(p===(p=t()??"")){Vr&&Rv();return}if(a.nodes_start!==null&&(E4(a.nodes_start,a.nodes_end),a.nodes_start=a.nodes_end=null),p!==""){if(Vr){bc.data;for(var w=Rv(),T=w;w!==null&&(w.nodeType!==SS||w.data!=="");)T=w,w=ES(w);if(w===null)throw P4(),k4;E2(bc,T),d=sg(w);return}var S=p+"";r?S=`<svg>${S}</svg>`:o&&(S=`<math>${S}</math>`);var k=D4(S);if((r||o)&&(k=gd(k)),E2(gd(k),k.lastChild),r||o)for(;gd(k);)d.before(gd(k));else d.before(k)}})}function _h(e,t,r){sp(()=>{var o=M_(()=>t(e,r==null?void 0:r())||{});if(r&&(o!=null&&o.update)){var u=!1,d={};s1(()=>{var p=r();z4(p),u&&R4(d,p)&&(d=p,o.update(p))}),u=!0}if(o!=null&&o.destroy)return()=>o.destroy()})}function f6(e,t){var r=void 0,o;a1(()=>{r!==(r=t())&&(o&&(Rd(o),o=null),r&&(o=zd(()=>{sp(()=>r(e))})))})}function LS(e){var t,r,o="";if(typeof e=="string"||typeof e=="number")o+=e;else if(typeof e=="object")if(Array.isArray(e)){var u=e.length;for(t=0;t<u;t++)e[t]&&(r=LS(e[t]))&&(o&&(o+=" "),o+=r)}else for(r in e)e[r]&&(o&&(o+=" "),o+=r);return o}function d6(){for(var e,t,r=0,o="",u=arguments.length;r<u;r++)(e=arguments[r])&&(t=LS(e))&&(o&&(o+=" "),o+=t);return o}function _l(e){return typeof e=="object"?d6(e):e??""}const R2=[...` 	
\r\fÂ \v\uFEFF`];function p6(e,t,r){var o=e==null?"":""+e;if(t&&(o=o?o+" "+t:t),r){for(var u in r)if(r[u])o=o?o+" "+u:u;else if(o.length)for(var d=u.length,p=0;(p=o.indexOf(u,p))>=0;){var a=p+d;(p===0||R2.includes(o[p-1]))&&(a===o.length||R2.includes(o[a]))?o=(p===0?"":o.substring(0,p))+o.substring(a+1):p=a}}return o===""?null:o}function L2(e,t=!1){var r=t?" !important;":";",o="";for(var u in e){var d=e[u];d!=null&&d!==""&&(o+=" "+u+": "+d+r)}return o}function U0(e){return e[0]!=="-"||e[1]!=="-"?e.toLowerCase():e}function m6(e,t){if(t){var r="",o,u;if(Array.isArray(t)?(o=t[0],u=t[1]):o=t,e){e=String(e).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var d=!1,p=0,a=!1,w=[];o&&w.push(...Object.keys(o).map(U0)),u&&w.push(...Object.keys(u).map(U0));var T=0,S=-1;const G=e.length;for(var k=0;k<G;k++){var I=e[k];if(a?I==="/"&&e[k-1]==="*"&&(a=!1):d?d===I&&(d=!1):I==="/"&&e[k+1]==="*"?a=!0:I==='"'||I==="'"?d=I:I==="("?p++:I===")"&&p--,!a&&d===!1&&p===0){if(I===":"&&S===-1)S=k;else if(I===";"||k===G-1){if(S!==-1){var P=U0(e.substring(T,S).trim());if(!w.includes(P)){I!==";"&&k++;var F=e.substring(T,k).trim();r+=" "+F+";"}}T=k+1,S=-1}}}}return o&&(r+=L2(o)),u&&(r+=L2(u,!0)),r=r.trim(),r===""?null:r}return e==null?null:String(e)}function ai(e,t,r,o,u,d){var p=e.__className;if(Vr||p!==r||p===void 0){var a=p6(r,o,d);(!Vr||a!==e.getAttribute("class"))&&(a==null?e.removeAttribute("class"):t?e.className=a:e.setAttribute("class",a)),e.__className=r}else if(d&&u!==d)for(var w in d){var T=!!d[w];(u==null||T!==!!u[w])&&e.classList.toggle(w,T)}return d}function V0(e,t={},r,o){for(var u in r){var d=r[u];t[u]!==d&&(r[u]==null?e.style.removeProperty(u):e.style.setProperty(u,d,o))}}function ca(e,t,r,o){var u=e.__style;if(Vr||u!==t){var d=m6(t,o);(!Vr||d!==e.getAttribute("style"))&&(d==null?e.removeAttribute("style"):e.style.cssText=d),e.__style=t}else o&&(Array.isArray(o)?(V0(e,r==null?void 0:r[0],o[0]),V0(e,r==null?void 0:r[1],o[1],"important")):V0(e,r,o));return o}function Nv(e,t,r=!1){if(e.multiple){if(t==null)return;if(!r1(t))return L4();for(var o of e.options)o.selected=t.includes(B2(o));return}for(o of e.options){var u=B2(o);if(B4(u,t)){o.selected=!0;return}}(!r||t!==void 0)&&(e.selectedIndex=-1)}function g6(e){var t=new MutationObserver(()=>{Nv(e,e.__value)});t.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),F4(()=>{t.disconnect()})}function B2(e){return"__value"in e?e.__value:e.value}const id=Symbol("class"),rd=Symbol("style"),BS=Symbol("is custom element"),FS=Symbol("is html");function Tg(e){if(Vr){var t=!1,r=()=>{if(!t){if(t=!0,e.hasAttribute("value")){var o=e.value;ri(e,"value",null),e.value=o}if(e.hasAttribute("checked")){var u=e.checked;ri(e,"checked",null),e.checked=u}}};e.__on_r=r,j4(r),J4()}}function jv(e,t){var r=h1(e);r.value===(r.value=t??void 0)||e.value===t&&(t!==0||e.nodeName!=="PROGRESS")||(e.value=t??"")}function _6(e,t){t?e.hasAttribute("selected")||e.setAttribute("selected",""):e.removeAttribute("selected")}function ri(e,t,r,o){var u=h1(e);Vr&&(u[t]=e.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&e.nodeName==="LINK")||u[t]!==(u[t]=r)&&(t==="loading"&&(e[O4]=r),r==null?e.removeAttribute(t):typeof r!="string"&&OS(e).includes(t)?e[t]=r:e.setAttribute(t,r))}function y6(e,t,r,o,u=!1){var d=h1(e),p=d[BS],a=!d[FS];let w=Vr&&p;w&&Cd(!1);var T=t||{},S=e.tagName==="OPTION";for(var k in t)k in r||(r[k]=null);r.class?r.class=_l(r.class):(o||r[id])&&(r.class=null),r[rd]&&(r.style??(r.style=null));var I=OS(e);for(const ae in r){let ee=r[ae];if(S&&ae==="value"&&ee==null){e.value=e.__value="",T[ae]=ee;continue}if(ae==="class"){var P=e.namespaceURI==="http://www.w3.org/1999/xhtml";ai(e,P,ee,o,t==null?void 0:t[id],r[id]),T[ae]=ee,T[id]=r[id];continue}if(ae==="style"){ca(e,ee,t==null?void 0:t[rd],r[rd]),T[ae]=ee,T[rd]=r[rd];continue}var F=T[ae];if(!(ee===F&&!(ee===void 0&&e.hasAttribute(ae)))){T[ae]=ee;var G=ae[0]+ae[1];if(G!=="$$")if(G==="on"){const ce={},re="$$"+ae;let he=ae.slice(2);var H=r6(he);if(e6(he)&&(he=he.slice(0,-7),ce.capture=!0),!H&&F){if(ee!=null)continue;e.removeEventListener(he,T[re],ce),T[re]=null}if(ee!=null)if(H)e[`__${he}`]=ee,La([he]);else{let be=function(ke){T[ae].call(this,ke)};T[re]=t6(he,e,be,ce)}else H&&(e[`__${he}`]=void 0)}else if(ae==="style")ri(e,ae,ee);else if(ae==="autofocus")n6(e,!!ee);else if(!p&&(ae==="__value"||ae==="value"&&ee!=null))e.value=e.__value=ee;else if(ae==="selected"&&S)_6(e,ee);else{var Y=ae;a||(Y=i6(Y));var $=Y==="defaultValue"||Y==="defaultChecked";if(ee==null&&!p&&!$)if(d[ae]=null,Y==="value"||Y==="checked"){let ce=e;const re=t===void 0;if(Y==="value"){let he=ce.defaultValue;ce.removeAttribute(Y),ce.defaultValue=he,ce.value=ce.__value=re?he:null}else{let he=ce.defaultChecked;ce.removeAttribute(Y),ce.defaultChecked=he,ce.checked=re?he:!1}}else e.removeAttribute(ae);else $||I.includes(Y)&&(p||typeof ee!="string")?e[Y]=ee:typeof ee!="function"&&ri(e,Y,ee)}}}return w&&Cd(!0),T}function Sg(e,t,r=[],o=[],u,d=!1){U4(r,o,p=>{var a=void 0,w={},T=e.nodeName==="SELECT",S=!1;if(a1(()=>{var I=t(...p.map(L)),P=y6(e,a,I,u,d);S&&T&&"value"in I&&Nv(e,I.value);for(let G of Object.getOwnPropertySymbols(w))I[G]||Rd(w[G]);for(let G of Object.getOwnPropertySymbols(I)){var F=I[G];G.description===V4&&(!a||F!==a[G])&&(w[G]&&Rd(w[G]),w[G]=zd(()=>f6(e,()=>F))),P[G]=F}a=P}),T){var k=e;sp(()=>{Nv(k,a.value,!0),g6(k)})}S=!0})}function h1(e){return e.__attributes??(e.__attributes={[BS]:e.nodeName.includes("-"),[FS]:e.namespaceURI===N4})}var F2=new Map;function OS(e){var t=F2.get(e.nodeName);if(t)return t;F2.set(e.nodeName,t=[]);for(var r,o=e,u=Element.prototype;u!==o;){r=G4(o);for(var d in r)r[d].set&&t.push(d);o=TS(o)}return t}const v6=()=>performance.now(),jo={tick:e=>requestAnimationFrame(e),now:()=>v6(),tasks:new Set};function NS(){const e=jo.now();jo.tasks.forEach(t=>{t.c(e)||(jo.tasks.delete(t),t.f())}),jo.tasks.size!==0&&jo.tick(NS)}function jS(e){let t;return jo.tasks.size===0&&jo.tick(NS),{promise:new Promise(r=>{jo.tasks.add(t={c:e,f:r})}),abort(){jo.tasks.delete(t)}}}function Bm(e,t){c1(()=>{e.dispatchEvent(new CustomEvent(t))})}function b6(e){if(e==="float")return"cssFloat";if(e==="offset")return"cssOffset";if(e.startsWith("--"))return e;const t=e.split("-");return t.length===1?t[0]:t[0]+t.slice(1).map(r=>r[0].toUpperCase()+r.slice(1)).join("")}function O2(e){const t={},r=e.split(";");for(const o of r){const[u,d]=o.split(":");if(!u||d===void 0)break;const p=b6(u.trim());t[p]=d.trim()}return t}const x6=e=>e;function w6(e,t,r){var o=cg,u,d,p,a=null;o.a??(o.a={element:e,measure(){u=this.element.getBoundingClientRect()},apply(){if(p==null||p.abort(),d=this.element.getBoundingClientRect(),u.left!==d.left||u.right!==d.right||u.top!==d.top||u.bottom!==d.bottom){const w=t()(this.element,{from:u,to:d},r==null?void 0:r());p=Mg(this.element,w,void 0,1,()=>{p==null||p.abort(),p=void 0})}},fix(){if(!e.getAnimations().length){var{position:w,width:T,height:S}=getComputedStyle(e);if(w!=="absolute"&&w!=="fixed"){var k=e.style;a={position:k.position,width:k.width,height:k.height,transform:k.transform},k.position="absolute",k.width=T,k.height=S;var I=e.getBoundingClientRect();if(u.left!==I.left||u.top!==I.top){var P=`translate(${u.left-I.left}px, ${u.top-I.top}px)`;k.transform=k.transform?`${k.transform} ${P}`:P}}}},unfix(){if(a){var w=e.style;w.position=a.position,w.width=a.width,w.height=a.height,w.transform=a.transform}}}),o.a.element=e}function No(e,t,r,o){var u=(e&W4)!==0,d=(e&X4)!==0,p=u&&d,a=(e&$4)!==0,w=p?"both":u?"in":"out",T,S=t.inert,k=t.style.overflow,I,P;function F(){return c1(()=>T??(T=r()(t,(o==null?void 0:o())??{},{direction:w})))}var G={is_global:a,in(){var ae;if(t.inert=S,!u){P==null||P.abort(),(ae=P==null?void 0:P.reset)==null||ae.call(P);return}d||I==null||I.abort(),Bm(t,"introstart"),I=Mg(t,F(),P,1,()=>{Bm(t,"introend"),I==null||I.abort(),I=T=void 0,t.style.overflow=k})},out(ae){if(!d){ae==null||ae(),T=void 0;return}t.inert=!0,Bm(t,"outrostart"),P=Mg(t,F(),I,0,()=>{Bm(t,"outroend"),ae==null||ae()})},stop:()=>{I==null||I.abort(),P==null||P.abort()}},H=o1;if((H.transitions??(H.transitions=[])).push(G),u&&a6){var Y=a;if(!Y){for(var $=H.parent;$&&($.f&q4)!==0;)for(;($=$.parent)&&($.f&Z4)===0;);Y=!$||($.f&H4)!==0}Y&&sp(()=>{M_(()=>G.in())})}}function Mg(e,t,r,o,u){var d=o===1;if(Y4(t)){var p,a=!1;return kS(()=>{if(!a){var H=t({direction:d?"in":"out"});p=Mg(e,H,r,o,u)}}),{abort:()=>{a=!0,p==null||p.abort()},deactivate:()=>p.deactivate(),reset:()=>p.reset(),t:()=>p.t()}}if(r==null||r.deactivate(),!(t!=null&&t.duration))return u(),{abort:Ha,deactivate:Ha,reset:Ha,t:()=>o};const{delay:w=0,css:T,tick:S,easing:k=x6}=t;var I=[];if(d&&r===void 0&&(S&&S(0,1),T)){var P=O2(T(0,1));I.push(P,P)}var F=()=>1-o,G=e.animate(I,{duration:w,fill:"forwards"});return G.onfinish=()=>{G.cancel();var H=(r==null?void 0:r.t())??1-o;r==null||r.abort();var Y=o-H,$=t.duration*Math.abs(Y),ae=[];if($>0){var ee=!1;if(T)for(var ce=Math.ceil($/16.666666666666668),re=0;re<=ce;re+=1){var he=H+Y*k(re/ce),be=O2(T(he,1-he));ae.push(be),ee||(ee=be.overflow==="hidden")}ee&&(e.style.overflow="hidden"),F=()=>{var ke=G.currentTime;return H+Y*k(ke/$)},S&&jS(()=>{if(G.playState!=="running")return!1;var ke=F();return S(ke,1-ke),!0})}G=e.animate(ae,{duration:$,fill:"forwards"}),G.onfinish=()=>{F=()=>o,S==null||S(o,1-o),u()}},{abort:()=>{G&&(G.cancel(),G.effect=null,G.onfinish=Ha)},deactivate:()=>{u=Ha},reset:()=>{o===0&&(S==null||S(1,0))},t:()=>F()}}function A6(e,t,r=t){var o=Q4(),u=new WeakSet;o6(e,"input",d=>{var p=d?e.defaultValue:e.value;if(p=G0(e)?q0(p):p,r(p),eh!==null&&u.add(eh),o&&p!==(p=t())){var a=e.selectionStart,w=e.selectionEnd;e.value=p??"",w!==null&&(e.selectionStart=a,e.selectionEnd=Math.min(w,e.value.length))}}),(Vr&&e.defaultValue!==e.value||M_(t)==null&&e.value)&&(r(G0(e)?q0(e.value):e.value),eh!==null&&u.add(eh)),s1(()=>{var d=t();e===document.activeElement&&u.has(eh)||G0(e)&&d===q0(e.value)||e.type==="date"&&!d&&!e.value||d!==e.value&&(e.value=d??"")})}function G0(e){var t=e.type;return t==="number"||t==="range"}function q0(e){return e===""?null:+e}var yl,fh,Jd,__,US;const y_=class y_{constructor(t){di(this,__);di(this,yl,new WeakMap);di(this,fh);di(this,Jd);Nr(this,Jd,t)}observe(t,r){var o=Zt(this,yl).get(t)||new Set;return o.add(r),Zt(this,yl).set(t,o),Yu(this,__,US).call(this).observe(t,Zt(this,Jd)),()=>{var u=Zt(this,yl).get(t);u.delete(r),u.size===0&&(Zt(this,yl).delete(t),Zt(this,fh).unobserve(t))}}};yl=new WeakMap,fh=new WeakMap,Jd=new WeakMap,__=new WeakSet,US=function(){return Zt(this,fh)??Nr(this,fh,new ResizeObserver(t=>{for(var r of t){y_.entries.set(r.target,r);for(var o of Zt(this,yl).get(r.target)||[])o(r)}}))},dl(y_,"entries",new WeakMap);let Uv=y_;var T6=new Uv({box:"border-box"});function S6(e,t,r){var o=T6.observe(e,()=>r(e[t]));sp(()=>(M_(()=>r(e[t])),o))}function M6(e,t){s6(window,["resize"],()=>c1(()=>t(window[e])))}const VS=/^[a-z0-9]+(-[a-z0-9]+)*$/,E_=(e,t,r,o="")=>{const u=e.split(":");if(e.slice(0,1)==="@"){if(u.length<2||u.length>3)return null;o=u.shift().slice(1)}if(u.length>3||!u.length)return null;if(u.length>1){const a=u.pop(),w=u.pop(),T={provider:u.length>0?u[0]:o,prefix:w,name:a};return t&&!ug(T)?null:T}const d=u[0],p=d.split("-");if(p.length>1){const a={provider:o,prefix:p.shift(),name:p.join("-")};return t&&!ug(a)?null:a}if(r&&o===""){const a={provider:o,prefix:"",name:d};return t&&!ug(a,r)?null:a}return null},ug=(e,t)=>e?!!((t&&e.prefix===""||e.prefix)&&e.name):!1,GS=Object.freeze({left:0,top:0,width:16,height:16}),Cg=Object.freeze({rotate:0,vFlip:!1,hFlip:!1}),P_=Object.freeze({...GS,...Cg}),Vv=Object.freeze({...P_,body:"",hidden:!1});function C6(e,t){const r={};!e.hFlip!=!t.hFlip&&(r.hFlip=!0),!e.vFlip!=!t.vFlip&&(r.vFlip=!0);const o=((e.rotate||0)+(t.rotate||0))%4;return o&&(r.rotate=o),r}function N2(e,t){const r=C6(e,t);for(const o in Vv)o in Cg?o in e&&!(o in r)&&(r[o]=Cg[o]):o in t?r[o]=t[o]:o in e&&(r[o]=e[o]);return r}function I6(e,t){const r=e.icons,o=e.aliases||Object.create(null),u=Object.create(null);function d(p){if(r[p])return u[p]=[];if(!(p in u)){u[p]=null;const a=o[p]&&o[p].parent,w=a&&d(a);w&&(u[p]=[a].concat(w))}return u[p]}return Object.keys(r).concat(Object.keys(o)).forEach(d),u}function E6(e,t,r){const o=e.icons,u=e.aliases||Object.create(null);let d={};function p(a){d=N2(o[a]||u[a],d)}return p(t),r.forEach(p),N2(e,d)}function qS(e,t){const r=[];if(typeof e!="object"||typeof e.icons!="object")return r;e.not_found instanceof Array&&e.not_found.forEach(u=>{t(u,null),r.push(u)});const o=I6(e);for(const u in o){const d=o[u];d&&(t(u,E6(e,u,d)),r.push(u))}return r}const P6={provider:"",aliases:{},not_found:{},...GS};function Z0(e,t){for(const r in t)if(r in e&&typeof e[r]!=typeof t[r])return!1;return!0}function ZS(e){if(typeof e!="object"||e===null)return null;const t=e;if(typeof t.prefix!="string"||!e.icons||typeof e.icons!="object"||!Z0(e,P6))return null;const r=t.icons;for(const u in r){const d=r[u];if(!u||typeof d.body!="string"||!Z0(d,Vv))return null}const o=t.aliases||Object.create(null);for(const u in o){const d=o[u],p=d.parent;if(!u||typeof p!="string"||!r[p]&&!o[p]||!Z0(d,Vv))return null}return t}const j2=Object.create(null);function k6(e,t){return{provider:e,prefix:t,icons:Object.create(null),missing:new Set}}function yh(e,t){const r=j2[e]||(j2[e]=Object.create(null));return r[t]||(r[t]=k6(e,t))}function HS(e,t){return ZS(t)?qS(t,(r,o)=>{o?e.icons[r]=o:e.missing.add(r)}):[]}function D6(e,t,r){try{if(typeof r.body=="string")return e.icons[t]={...r},!0}catch{}return!1}let Ld=!1;function $S(e){return typeof e=="boolean"&&(Ld=e),Ld}function z6(e){const t=typeof e=="string"?E_(e,!0,Ld):e;if(t){const r=yh(t.provider,t.prefix),o=t.name;return r.icons[o]||(r.missing.has(o)?null:void 0)}}function R6(e,t){const r=E_(e,!0,Ld);if(!r)return!1;const o=yh(r.provider,r.prefix);return t?D6(o,r.name,t):(o.missing.add(r.name),!0)}function L6(e,t){if(typeof e!="object")return!1;if(typeof t!="string"&&(t=e.provider||""),Ld&&!t&&!e.prefix){let u=!1;return ZS(e)&&(e.prefix="",qS(e,(d,p)=>{R6(d,p)&&(u=!0)})),u}const r=e.prefix;if(!ug({prefix:r,name:"a"}))return!1;const o=yh(t,r);return!!HS(o,e)}const WS=Object.freeze({width:null,height:null}),YS=Object.freeze({...WS,...Cg}),B6=/(-?[0-9.]*[0-9]+[0-9.]*)/g,F6=/^-?[0-9.]*[0-9]+[0-9.]*$/g;function U2(e,t,r){if(t===1)return e;if(r=r||100,typeof e=="number")return Math.ceil(e*t*r)/r;if(typeof e!="string")return e;const o=e.split(B6);if(o===null||!o.length)return e;const u=[];let d=o.shift(),p=F6.test(d);for(;;){if(p){const a=parseFloat(d);isNaN(a)?u.push(d):u.push(Math.ceil(a*t*r)/r)}else u.push(d);if(d=o.shift(),d===void 0)return u.join("");p=!p}}function O6(e,t="defs"){let r="";const o=e.indexOf("<"+t);for(;o>=0;){const u=e.indexOf(">",o),d=e.indexOf("</"+t);if(u===-1||d===-1)break;const p=e.indexOf(">",d);if(p===-1)break;r+=e.slice(u+1,d).trim(),e=e.slice(0,o).trim()+e.slice(p+1)}return{defs:r,content:e}}function N6(e,t){return e?"<defs>"+e+"</defs>"+t:t}function j6(e,t,r){const o=O6(e);return N6(o.defs,t+o.content+r)}const U6=e=>e==="unset"||e==="undefined"||e==="none";function V6(e,t){const r={...P_,...e},o={...YS,...t},u={left:r.left,top:r.top,width:r.width,height:r.height};let d=r.body;[r,o].forEach(G=>{const H=[],Y=G.hFlip,$=G.vFlip;let ae=G.rotate;Y?$?ae+=2:(H.push("translate("+(u.width+u.left).toString()+" "+(0-u.top).toString()+")"),H.push("scale(-1 1)"),u.top=u.left=0):$&&(H.push("translate("+(0-u.left).toString()+" "+(u.height+u.top).toString()+")"),H.push("scale(1 -1)"),u.top=u.left=0);let ee;switch(ae<0&&(ae-=Math.floor(ae/4)*4),ae=ae%4,ae){case 1:ee=u.height/2+u.top,H.unshift("rotate(90 "+ee.toString()+" "+ee.toString()+")");break;case 2:H.unshift("rotate(180 "+(u.width/2+u.left).toString()+" "+(u.height/2+u.top).toString()+")");break;case 3:ee=u.width/2+u.left,H.unshift("rotate(-90 "+ee.toString()+" "+ee.toString()+")");break}ae%2===1&&(u.left!==u.top&&(ee=u.left,u.left=u.top,u.top=ee),u.width!==u.height&&(ee=u.width,u.width=u.height,u.height=ee)),H.length&&(d=j6(d,'<g transform="'+H.join(" ")+'">',"</g>"))});const p=o.width,a=o.height,w=u.width,T=u.height;let S,k;p===null?(k=a===null?"1em":a==="auto"?T:a,S=U2(k,w/T)):(S=p==="auto"?w:p,k=a===null?U2(S,T/w):a==="auto"?T:a);const I={},P=(G,H)=>{U6(H)||(I[G]=H.toString())};P("width",S),P("height",k);const F=[u.left,u.top,w,T];return I.viewBox=F.join(" "),{attributes:I,viewBox:F,body:d}}const G6=/\sid="(\S+)"/g,q6="IconifyId"+Date.now().toString(16)+(Math.random()*16777216|0).toString(16);let Z6=0;function H6(e,t=q6){const r=[];let o;for(;o=G6.exec(e);)r.push(o[1]);if(!r.length)return e;const u="suffix"+(Math.random()*16777216|Date.now()).toString(16);return r.forEach(d=>{const p=typeof t=="function"?t(d):t+(Z6++).toString(),a=d.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");e=e.replace(new RegExp('([#;"])('+a+')([")]|\\.[a-z])',"g"),"$1"+p+u+"$3")}),e=e.replace(new RegExp(u,"g"),""),e}const Gv=Object.create(null);function $6(e,t){Gv[e]=t}function qv(e){return Gv[e]||Gv[""]}function f1(e){let t;if(typeof e.resources=="string")t=[e.resources];else if(t=e.resources,!(t instanceof Array)||!t.length)return null;return{resources:t,path:e.path||"/",maxURL:e.maxURL||500,rotate:e.rotate||750,timeout:e.timeout||5e3,random:e.random===!0,index:e.index||0,dataAfterTimeout:e.dataAfterTimeout!==!1}}const d1=Object.create(null),ad=["https://api.simplesvg.com","https://api.unisvg.com"],hg=[];for(;ad.length>0;)ad.length===1||Math.random()>.5?hg.push(ad.shift()):hg.push(ad.pop());d1[""]=f1({resources:["https://api.iconify.design"].concat(hg)});function W6(e,t){const r=f1(t);return r===null?!1:(d1[e]=r,!0)}function p1(e){return d1[e]}const Y6=()=>{let e;try{if(e=fetch,typeof e=="function")return e}catch{}};let V2=Y6();function X6(e,t){const r=p1(e);if(!r)return 0;let o;if(!r.maxURL)o=0;else{let u=0;r.resources.forEach(p=>{u=Math.max(u,p.length)});const d=t+".json?icons=";o=r.maxURL-u-r.path.length-d.length}return o}function Q6(e){return e===404}const K6=(e,t,r)=>{const o=[],u=X6(e,t),d="icons";let p={type:d,provider:e,prefix:t,icons:[]},a=0;return r.forEach((w,T)=>{a+=w.length+1,a>=u&&T>0&&(o.push(p),p={type:d,provider:e,prefix:t,icons:[]},a=w.length),p.icons.push(w)}),o.push(p),o};function J6(e){if(typeof e=="string"){const t=p1(e);if(t)return t.path}return"/"}const eD=(e,t,r)=>{if(!V2){r("abort",424);return}let o=J6(t.provider);switch(t.type){case"icons":{const d=t.prefix,a=t.icons.join(","),w=new URLSearchParams({icons:a});o+=d+".json?"+w.toString();break}case"custom":{const d=t.uri;o+=d.slice(0,1)==="/"?d.slice(1):d;break}default:r("abort",400);return}let u=503;V2(e+o).then(d=>{const p=d.status;if(p!==200){setTimeout(()=>{r(Q6(p)?"abort":"next",p)});return}return u=501,d.json()}).then(d=>{if(typeof d!="object"||d===null){setTimeout(()=>{d===404?r("abort",d):r("next",u)});return}setTimeout(()=>{r("success",d)})}).catch(()=>{r("next",u)})},tD={prepare:K6,send:eD};function nD(e){const t={loaded:[],missing:[],pending:[]},r=Object.create(null);e.sort((u,d)=>u.provider!==d.provider?u.provider.localeCompare(d.provider):u.prefix!==d.prefix?u.prefix.localeCompare(d.prefix):u.name.localeCompare(d.name));let o={provider:"",prefix:"",name:""};return e.forEach(u=>{if(o.name===u.name&&o.prefix===u.prefix&&o.provider===u.provider)return;o=u;const d=u.provider,p=u.prefix,a=u.name,w=r[d]||(r[d]=Object.create(null)),T=w[p]||(w[p]=yh(d,p));let S;a in T.icons?S=t.loaded:p===""||T.missing.has(a)?S=t.missing:S=t.pending;const k={provider:d,prefix:p,name:a};S.push(k)}),t}function XS(e,t){e.forEach(r=>{const o=r.loaderCallbacks;o&&(r.loaderCallbacks=o.filter(u=>u.id!==t))})}function iD(e){e.pendingCallbacksFlag||(e.pendingCallbacksFlag=!0,setTimeout(()=>{e.pendingCallbacksFlag=!1;const t=e.loaderCallbacks?e.loaderCallbacks.slice(0):[];if(!t.length)return;let r=!1;const o=e.provider,u=e.prefix;t.forEach(d=>{const p=d.icons,a=p.pending.length;p.pending=p.pending.filter(w=>{if(w.prefix!==u)return!0;const T=w.name;if(e.icons[T])p.loaded.push({provider:o,prefix:u,name:T});else if(e.missing.has(T))p.missing.push({provider:o,prefix:u,name:T});else return r=!0,!0;return!1}),p.pending.length!==a&&(r||XS([e],d.id),d.callback(p.loaded.slice(0),p.missing.slice(0),p.pending.slice(0),d.abort))})}))}let rD=0;function aD(e,t,r){const o=rD++,u=XS.bind(null,r,o);if(!t.pending.length)return u;const d={id:o,icons:t,callback:e,abort:u};return r.forEach(p=>{(p.loaderCallbacks||(p.loaderCallbacks=[])).push(d)}),u}function oD(e,t=!0,r=!1){const o=[];return e.forEach(u=>{const d=typeof u=="string"?E_(u,t,r):u;d&&o.push(d)}),o}var sD={resources:[],index:0,timeout:2e3,rotate:750,random:!1,dataAfterTimeout:!1};function lD(e,t,r,o){const u=e.resources.length,d=e.random?Math.floor(Math.random()*u):e.index;let p;if(e.random){let re=e.resources.slice(0);for(p=[];re.length>1;){const he=Math.floor(Math.random()*re.length);p.push(re[he]),re=re.slice(0,he).concat(re.slice(he+1))}p=p.concat(re)}else p=e.resources.slice(d).concat(e.resources.slice(0,d));const a=Date.now();let w="pending",T=0,S,k=null,I=[],P=[];typeof o=="function"&&P.push(o);function F(){k&&(clearTimeout(k),k=null)}function G(){w==="pending"&&(w="aborted"),F(),I.forEach(re=>{re.status==="pending"&&(re.status="aborted")}),I=[]}function H(re,he){he&&(P=[]),typeof re=="function"&&P.push(re)}function Y(){return{startTime:a,payload:t,status:w,queriesSent:T,queriesPending:I.length,subscribe:H,abort:G}}function $(){w="failed",P.forEach(re=>{re(void 0,S)})}function ae(){I.forEach(re=>{re.status==="pending"&&(re.status="aborted")}),I=[]}function ee(re,he,be){const ke=he!=="success";switch(I=I.filter(Ie=>Ie!==re),w){case"pending":break;case"failed":if(ke||!e.dataAfterTimeout)return;break;default:return}if(he==="abort"){S=be,$();return}if(ke){S=be,I.length||(p.length?ce():$());return}if(F(),ae(),!e.random){const Ie=e.resources.indexOf(re.resource);Ie!==-1&&Ie!==e.index&&(e.index=Ie)}w="completed",P.forEach(Ie=>{Ie(be)})}function ce(){if(w!=="pending")return;F();const re=p.shift();if(re===void 0){if(I.length){k=setTimeout(()=>{F(),w==="pending"&&(ae(),$())},e.timeout);return}$();return}const he={status:"pending",resource:re,callback:(be,ke)=>{ee(he,be,ke)}};I.push(he),T++,k=setTimeout(ce,e.rotate),r(re,t,he.callback)}return setTimeout(ce),Y}function QS(e){const t={...sD,...e};let r=[];function o(){r=r.filter(a=>a().status==="pending")}function u(a,w,T){const S=lD(t,a,w,(k,I)=>{o(),T&&T(k,I)});return r.push(S),S}function d(a){return r.find(w=>a(w))||null}return{query:u,find:d,setIndex:a=>{t.index=a},getIndex:()=>t.index,cleanup:o}}function G2(){}const H0=Object.create(null);function cD(e){if(!H0[e]){const t=p1(e);if(!t)return;const r=QS(t),o={config:t,redundancy:r};H0[e]=o}return H0[e]}function uD(e,t,r){let o,u;if(typeof e=="string"){const d=qv(e);if(!d)return r(void 0,424),G2;u=d.send;const p=cD(e);p&&(o=p.redundancy)}else{const d=f1(e);if(d){o=QS(d);const p=e.resources?e.resources[0]:"",a=qv(p);a&&(u=a.send)}}return!o||!u?(r(void 0,424),G2):o.query(t,u,r)().abort}function q2(){}function hD(e){e.iconsLoaderFlag||(e.iconsLoaderFlag=!0,setTimeout(()=>{e.iconsLoaderFlag=!1,iD(e)}))}function fD(e){const t=[],r=[];return e.forEach(o=>{(o.match(VS)?t:r).push(o)}),{valid:t,invalid:r}}function od(e,t,r){function o(){const u=e.pendingIcons;t.forEach(d=>{u&&u.delete(d),e.icons[d]||e.missing.add(d)})}if(r&&typeof r=="object")try{if(!HS(e,r).length){o();return}}catch(u){console.error(u)}o(),hD(e)}function Z2(e,t){e instanceof Promise?e.then(r=>{t(r)}).catch(()=>{t(null)}):t(e)}function dD(e,t){e.iconsToLoad?e.iconsToLoad=e.iconsToLoad.concat(t).sort():e.iconsToLoad=t,e.iconsQueueFlag||(e.iconsQueueFlag=!0,setTimeout(()=>{e.iconsQueueFlag=!1;const{provider:r,prefix:o}=e,u=e.iconsToLoad;if(delete e.iconsToLoad,!u||!u.length)return;const d=e.loadIcon;if(e.loadIcons&&(u.length>1||!d)){Z2(e.loadIcons(u,o,r),S=>{od(e,u,S)});return}if(d){u.forEach(S=>{const k=d(S,o,r);Z2(k,I=>{const P=I?{prefix:o,icons:{[S]:I}}:null;od(e,[S],P)})});return}const{valid:p,invalid:a}=fD(u);if(a.length&&od(e,a,null),!p.length)return;const w=o.match(VS)?qv(r):null;if(!w){od(e,p,null);return}w.prepare(r,o,p).forEach(S=>{uD(r,S,k=>{od(e,S.icons,k)})})}))}const pD=(e,t)=>{const r=oD(e,!0,$S()),o=nD(r);if(!o.pending.length){let w=!0;return t&&setTimeout(()=>{w&&t(o.loaded,o.missing,o.pending,q2)}),()=>{w=!1}}const u=Object.create(null),d=[];let p,a;return o.pending.forEach(w=>{const{provider:T,prefix:S}=w;if(S===a&&T===p)return;p=T,a=S,d.push(yh(T,S));const k=u[T]||(u[T]=Object.create(null));k[S]||(k[S]=[])}),o.pending.forEach(w=>{const{provider:T,prefix:S,name:k}=w,I=yh(T,S),P=I.pendingIcons||(I.pendingIcons=new Set);P.has(k)||(P.add(k),u[T][S].push(k))}),d.forEach(w=>{const T=u[w.provider][w.prefix];T.length&&dD(w,T)}),t?aD(t,o,d):q2};function mD(e,t){const r={...e};for(const o in t){const u=t[o],d=typeof u;o in WS?(u===null||u&&(d==="string"||d==="number"))&&(r[o]=u):d===typeof r[o]&&(r[o]=o==="rotate"?u%4:u)}return r}const gD=/[\s,]+/;function _D(e,t){t.split(gD).forEach(r=>{switch(r.trim()){case"horizontal":e.hFlip=!0;break;case"vertical":e.vFlip=!0;break}})}function yD(e,t=0){const r=e.replace(/^-?[0-9.]*/,"");function o(u){for(;u<0;)u+=4;return u%4}if(r===""){const u=parseInt(e);return isNaN(u)?0:o(u)}else if(r!==e){let u=0;switch(r){case"%":u=25;break;case"deg":u=90}if(u){let d=parseFloat(e.slice(0,e.length-r.length));return isNaN(d)?0:(d=d/u,d%1===0?o(d):0)}}return t}function vD(e,t){let r=e.indexOf("xlink:")===-1?"":' xmlns:xlink="http://www.w3.org/1999/xlink"';for(const o in t)r+=" "+o+'="'+t[o]+'"';return'<svg xmlns="http://www.w3.org/2000/svg"'+r+">"+e+"</svg>"}function bD(e){return e.replace(/"/g,"'").replace(/%/g,"%25").replace(/#/g,"%23").replace(/</g,"%3C").replace(/>/g,"%3E").replace(/\s+/g," ")}function xD(e){return"data:image/svg+xml,"+bD(e)}function wD(e){return'url("'+xD(e)+'")'}const H2={...YS,inline:!1},AD={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink","aria-hidden":!0,role:"img"},TD={display:"inline-block"},Zv={"background-color":"currentColor"},KS={"background-color":"transparent"},$2={image:"var(--svg)",repeat:"no-repeat",size:"100% 100%"},W2={"-webkit-mask":Zv,mask:Zv,background:KS};for(const e in W2){const t=W2[e];for(const r in $2)t[e+"-"+r]=$2[r]}function SD(e){return e+(e.match(/^[-0-9.]+$/)?"px":"")}function MD(e,t){const r=mD(H2,t),o=t.mode||"svg",u=o==="svg"?{...AD}:{};e.body.indexOf("xlink:")===-1&&delete u["xmlns:xlink"];let d=typeof t.style=="string"?t.style:"";for(let Y in t){const $=t[Y];if($!==void 0)switch(Y){case"icon":case"style":case"onLoad":case"mode":case"ssr":break;case"inline":case"hFlip":case"vFlip":r[Y]=$===!0||$==="true"||$===1;break;case"flip":typeof $=="string"&&_D(r,$);break;case"color":d=d+(d.length>0&&d.trim().slice(-1)!==";"?";":"")+"color: "+$+"; ";break;case"rotate":typeof $=="string"?r[Y]=yD($):typeof $=="number"&&(r[Y]=$);break;case"ariaHidden":case"aria-hidden":$!==!0&&$!=="true"&&delete u["aria-hidden"];break;default:if(Y.slice(0,3)==="on:")break;H2[Y]===void 0&&(u[Y]=$)}}const p=V6(e,r),a=p.attributes;if(r.inline&&(d="vertical-align: -0.125em; "+d),o==="svg"){Object.assign(u,a),d!==""&&(u.style=d);let Y=0,$=t.id;return typeof $=="string"&&($=$.replace(/-/g,"_")),{svg:!0,attributes:u,body:H6(p.body,$?()=>$+"ID"+Y++:"iconifySvelte")}}const{body:w,width:T,height:S}=e,k=o==="mask"||(o==="bg"?!1:w.indexOf("currentColor")!==-1),I=vD(w,{...a,width:T+"",height:S+""}),F={"--svg":wD(I)},G=Y=>{const $=a[Y];$&&(F[Y]=SD($))};G("width"),G("height"),Object.assign(F,TD,k?Zv:KS);let H="";for(const Y in F)H+=Y+": "+F[Y]+";";return u.style=H+d,{svg:!1,attributes:u}}$S(!0);$6("",tD);if(typeof document<"u"&&typeof window<"u"){const e=window;if(e.IconifyPreload!==void 0){const t=e.IconifyPreload,r="Invalid IconifyPreload syntax.";typeof t=="object"&&t!==null&&(t instanceof Array?t:[t]).forEach(o=>{try{(typeof o!="object"||o===null||o instanceof Array||typeof o.icons!="object"||typeof o.prefix!="string"||!L6(o))&&console.error(r)}catch{console.error(r)}})}if(e.IconifyProviders!==void 0){const t=e.IconifyProviders;if(typeof t=="object"&&t!==null)for(let r in t){const o="IconifyProviders["+r+"] is invalid.";try{const u=t[r];if(typeof u!="object"||!u||u.resources===void 0)continue;W6(r,u)||console.error(o)}catch{console.error(o)}}}}function CD(e,t,r,o,u){function d(){t.loading&&(t.loading.abort(),t.loading=null)}if(typeof e=="object"&&e!==null&&typeof e.body=="string")return t.name="",d(),{data:{...P_,...e}};let p;if(typeof e!="string"||(p=E_(e,!1,!0))===null)return d(),null;const a=z6(p);if(!a)return r&&(!t.loading||t.loading.name!==e)&&(d(),t.name="",t.loading={name:e,abort:pD([p],o)}),null;d(),t.name!==e&&(t.name=e,u&&!t.destroyed&&u(e));const w=["iconify"];return p.prefix!==""&&w.push("iconify--"+p.prefix),p.provider!==""&&w.push("iconify--"+p.provider),{data:a,classes:w}}function ID(e,t){return e?MD({...P_,...e},t):null}var ED=DS("<svg><!></svg>"),PD=tn("<span></span>");function Ig(e,t){nr(t,!0);const r={name:"",loading:null,destroyed:!1},o=I_(t,["$$slots","$$events","$$legacy"]);let u=$t(!1),d=$t(0),p=$t(null);ei(()=>{L(d);const k=!!t.ssr||L(u),I=CD(t.icon,r,k,a,t.onload),P=I?ID(I.data,o):null;P&&I.classes&&(P.attributes.class=(typeof o.class=="string"?o.class+" ":"")+I.classes.join(" ")),Qe(p,P,!0)});function a(){l1(d)}u1(()=>{Qe(u,!0)}),Fh(()=>{r.destroyed=!0,r.loading&&(r.loading.abort(),r.loading=null)});var w=Ti(),T=Kn(w);{var S=k=>{var I=Ti(),P=Kn(I);{var F=H=>{var Y=ED();Sg(Y,()=>({...L(p).attributes}));var $=Bt(Y);Ov($,()=>L(p).body,!0),Et(Y),It(H,Y)},G=H=>{var Y=PD();Sg(Y,()=>({...L(p).attributes})),It(H,Y)};pn(P,H=>{L(p).svg?H(F):H(G,!1)})}It(k,I)};pn(T,k=>{L(p)&&k(S)})}It(e,w),ir()}var Y2=!1,dh,ep,v_,b_,JS;const Ox=class Ox extends Date{constructor(...r){super(...r);di(this,b_);di(this,dh,$t(super.getTime()));di(this,ep,new Map);di(this,v_,P2);Y2||Yu(this,b_,JS).call(this)}};dh=new WeakMap,ep=new WeakMap,v_=new WeakMap,b_=new WeakSet,JS=function(){Y2=!0;var r=Ox.prototype,o=Date.prototype,u=Object.getOwnPropertyNames(o);for(const d of u)(d.startsWith("get")||d.startsWith("to")||d==="valueOf")&&(r[d]=function(...p){if(p.length>0)return L(Zt(this,dh)),o[d].apply(this,p);var a=Zt(this,ep).get(d);if(a===void 0){const w=P2;k2(Zt(this,v_)),a=Vt(()=>(L(Zt(this,dh)),o[d].apply(this,p))),Zt(this,ep).set(d,a),k2(w)}return L(a)}),d.startsWith("set")&&(r[d]=function(...p){var a=o[d].apply(this,p);return Qe(Zt(this,dh),o.getTime.call(this)),a})};let dr=Ox;var kD=["forEach","isDisjointFrom","isSubsetOf","isSupersetOf"],DD=["difference","intersection","symmetricDifference","union"],X2=!1,ph,po,vl,x_,Bh,eM,tM;const w_=class w_ extends Set{constructor(r){super();di(this,Bh);di(this,ph,new Map);di(this,po,$t(0));di(this,vl,$t(0));di(this,x_,D2||-1);if(r){for(var o of r)super.add(o);Zt(this,vl).v=super.size}X2||Yu(this,Bh,tM).call(this)}has(r){var o=super.has(r),u=Zt(this,ph),d=u.get(r);if(d===void 0){if(!o)return L(Zt(this,po)),!1;d=Yu(this,Bh,eM).call(this,!0),u.set(r,d)}return L(d),o}add(r){return super.has(r)||(super.add(r),Qe(Zt(this,vl),super.size),F0(Zt(this,po))),this}delete(r){var o=super.delete(r),u=Zt(this,ph),d=u.get(r);return d!==void 0&&(u.delete(r),Qe(d,!1)),o&&(Qe(Zt(this,vl),super.size),F0(Zt(this,po))),o}clear(){if(super.size!==0){super.clear();var r=Zt(this,ph);for(var o of r.values())Qe(o,!1);r.clear(),Qe(Zt(this,vl),0),F0(Zt(this,po))}}keys(){return this.values()}values(){return L(Zt(this,po)),super.values()}entries(){return L(Zt(this,po)),super.entries()}[Symbol.iterator](){return this.keys()}get size(){return L(Zt(this,vl))}};ph=new WeakMap,po=new WeakMap,vl=new WeakMap,x_=new WeakMap,Bh=new WeakSet,eM=function(r){return D2===Zt(this,x_)?$t(r):Lv(r)},tM=function(){X2=!0;var r=w_.prototype,o=Set.prototype;for(const u of kD)r[u]=function(...d){return L(Zt(this,po)),o[u].apply(this,d)};for(const u of DD)r[u]=function(...d){L(Zt(this,po));var p=o[u].apply(this,d);return new w_(p)}};let Hv=w_;var tp;class Eg{constructor(t){di(this,tp,$t());this.value=t}get value(){return L(Zt(this,tp))}set value(t){Qe(Zt(this,tp),t,!0)}}tp=new WeakMap;var np,ip,rp,ap;class zD{constructor(){di(this,np,$t());di(this,ip,$t(!1));dl(this,"loadedImages",new Hv);di(this,rp,$t(0));di(this,ap,$t(24));dl(this,"layerInfo",new Map);dl(this,"eventTracker",new WeakMap);dl(this,"eventTopMost");dl(this,"markerClickManager",new qD);this.eventTopMost=this._eventTopMost.bind(this)}get map(){return L(Zt(this,np))}set map(t){Qe(Zt(this,np),t,!0)}get loaded(){return L(Zt(this,ip))}set loaded(t){Qe(Zt(this,ip),t,!0)}get minzoom(){return L(Zt(this,rp))}set minzoom(t){Qe(Zt(this,rp),t,!0)}get maxzoom(){return L(Zt(this,ap))}set maxzoom(t){Qe(Zt(this,ap),t,!0)}_eventTopMost(t){var d;let r=this.eventTracker.get(t.originalEvent);if(r!==void 0)return r;let u=(d=t.target.queryRenderedFeatures(t.point).find(p=>{var a;return(a=this.layerInfo.get(p.layer.id))==null?void 0:a.interactive}))==null?void 0:d.layer.id;return this.eventTracker.set(t.originalEvent,u),u}}np=new WeakMap,ip=new WeakMap,rp=new WeakMap,ap=new WeakMap;function RD(){return lp(jD)}function LD(e){C_(rM,e)}function BD(){return lp(rM)}function FD(){return lp(aM)}function nM(e){C_(aM,e)}function OD(e){C_(oM,e)}function ND(){return lp(oM)}const iM=Symbol.for("svelte-maplibre"),rM=Symbol.for("svelte-maplibre.popup-target"),jD=Symbol.for("svelte-maplibre.layer"),aM=Symbol.for("svelte-maplibre.layer-event"),oM=Symbol.for("svelte-maplibre.lng-lat");function Oh(){return lp(iM)}function UD(){return C_(iM,new zD)}function VD(){const e=new Eg(void 0),t=new Eg(void 0);return LD(e),nM(t),{marker:e,layerEvent:t}}function GD(e){return"layerType"in e&&e.layerType==="deckgl"}class qD{constructor(){dl(this,"_handlers",new Set)}add(t){this._handlers.add(t)}remove(t){this._handlers.delete(t)}handleClick(t){for(const r of this._handlers)r(t)}}function ZD(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var fg={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.6.1/LICENSE.txt
 */var HD=fg.exports,Q2;function $D(){return Q2||(Q2=1,function(e,t){(function(r,o){e.exports=o()})(HD,function(){var r={},o={};function u(p,a,w){if(o[p]=w,p==="index"){var T="var sharedModule = {}; ("+o.shared+")(sharedModule); ("+o.worker+")(sharedModule);",S={};return o.shared(S),o.index(r,S),typeof window<"u"&&r.setWorkerUrl(window.URL.createObjectURL(new Blob([T],{type:"text/javascript"}))),r}}u("shared",["exports"],function(p){function a(c,i,l,h){return new(l||(l=Promise))(function(g,v){function b(D){try{C(h.next(D))}catch(R){v(R)}}function A(D){try{C(h.throw(D))}catch(R){v(R)}}function C(D){var R;D.done?g(D.value):(R=D.value,R instanceof l?R:new l(function(O){O(R)})).then(b,A)}C((h=h.apply(c,i||[])).next())})}function w(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var T,S;function k(){if(S)return T;function c(i,l){this.x=i,this.y=l}return S=1,T=c,c.prototype={clone:function(){return new c(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,l){return this.clone()._rotateAround(i,l)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var l=i.x-this.x,h=i.y-this.y;return l*l+h*h},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,l){return Math.atan2(this.x*l-this.y*i,this.x*i+this.y*l)},_matMult:function(i){var l=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=l,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var l=Math.cos(i),h=Math.sin(i),g=h*this.x+l*this.y;return this.x=l*this.x-h*this.y,this.y=g,this},_rotateAround:function(i,l){var h=Math.cos(i),g=Math.sin(i),v=l.y+g*(this.x-l.x)+h*(this.y-l.y);return this.x=l.x+h*(this.x-l.x)-g*(this.y-l.y),this.y=v,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},c.convert=function(i){return i instanceof c?i:Array.isArray(i)?new c(i[0],i[1]):i},T}typeof SuppressedError=="function"&&SuppressedError;var I,P,F=w(k()),G=function(){if(P)return I;function c(i,l,h,g){this.cx=3*i,this.bx=3*(h-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(g-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=l,this.p2x=h,this.p2y=g}return P=1,I=c,c.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,l){if(l===void 0&&(l=1e-6),i<0)return 0;if(i>1)return 1;for(var h=i,g=0;g<8;g++){var v=this.sampleCurveX(h)-i;if(Math.abs(v)<l)return h;var b=this.sampleCurveDerivativeX(h);if(Math.abs(b)<1e-6)break;h-=v/b}var A=0,C=1;for(h=i,g=0;g<20&&(v=this.sampleCurveX(h),!(Math.abs(v-i)<l));g++)i>v?A=h:C=h,h=.5*(C-A)+A;return h},solve:function(i,l){return this.sampleCurveY(this.solveCurveX(i,l))}},I}(),H=w(G);let Y,$;function ae(){return Y==null&&(Y=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Y}function ee(){if($==null&&($=!1,ae())){const i=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(i){for(let h=0;h<25;h++){const g=4*h;i.fillStyle=`rgb(${g},${g+1},${g+2})`,i.fillRect(h%5,Math.floor(h/5),1,1)}const l=i.getImageData(0,0,5,5).data;for(let h=0;h<100;h++)if(h%4!=3&&l[h]!==h){$=!0;break}}}return $||!1}var ce=1e-6,re=typeof Float32Array<"u"?Float32Array:Array;function he(){var c=new re(9);return re!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[5]=0,c[6]=0,c[7]=0),c[0]=1,c[4]=1,c[8]=1,c}function be(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function ke(){var c=new re(3);return re!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0),c}function Ie(c){return Math.hypot(c[0],c[1],c[2])}function ue(c,i,l){var h=new re(3);return h[0]=c,h[1]=i,h[2]=l,h}function Ve(c,i,l){return c[0]=i[0]+l[0],c[1]=i[1]+l[1],c[2]=i[2]+l[2],c}function Ze(c,i,l){return c[0]=i[0]*l,c[1]=i[1]*l,c[2]=i[2]*l,c}function Xe(c,i,l){var h=i[0],g=i[1],v=i[2],b=l[0],A=l[1],C=l[2];return c[0]=g*C-v*A,c[1]=v*b-h*C,c[2]=h*A-g*b,c}Math.hypot||(Math.hypot=function(){for(var c=0,i=arguments.length;i--;)c+=arguments[i]*arguments[i];return Math.sqrt(c)});var Re,ot=Ie;function Pt(c,i,l){var h=i[0],g=i[1],v=i[2],b=i[3];return c[0]=l[0]*h+l[4]*g+l[8]*v+l[12]*b,c[1]=l[1]*h+l[5]*g+l[9]*v+l[13]*b,c[2]=l[2]*h+l[6]*g+l[10]*v+l[14]*b,c[3]=l[3]*h+l[7]*g+l[11]*v+l[15]*b,c}function bt(){var c=new re(4);return re!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0),c[3]=1,c}function _t(c,i,l,h){var g=.5*Math.PI/180;i*=g,l*=g,h*=g;var v=Math.sin(i),b=Math.cos(i),A=Math.sin(l),C=Math.cos(l),D=Math.sin(h),R=Math.cos(h);return c[0]=v*C*R-b*A*D,c[1]=b*A*R+v*C*D,c[2]=b*C*D-v*A*R,c[3]=b*C*R+v*A*D,c}function tt(){var c=new re(2);return re!=Float32Array&&(c[0]=0,c[1]=0),c}function Tt(c,i){var l=new re(2);return l[0]=c,l[1]=i,l}ke(),Re=new re(4),re!=Float32Array&&(Re[0]=0,Re[1]=0,Re[2]=0,Re[3]=0),ke(),ue(1,0,0),ue(0,1,0),bt(),bt(),he(),tt();const ct=8192;function mt(c,i,l){return i*(ct/(c.tileSize*Math.pow(2,l-c.tileID.overscaledZ)))}function Xt(c,i){return(c%i+i)%i}function Ut(c,i,l){return c*(1-l)+i*l}function St(c){if(c<=0)return 0;if(c>=1)return 1;const i=c*c,l=i*c;return 4*(c<.5?l:3*(c-i)+l-.75)}function pt(c,i,l,h){const g=new H(c,i,l,h);return v=>g.solve(v)}const Ft=pt(.25,.1,.25,1);function nt(c,i,l){return Math.min(l,Math.max(i,c))}function De(c,i,l){const h=l-i,g=((c-i)%h+h)%h+i;return g===i?l:g}function Ke(c,...i){for(const l of i)for(const h in l)c[h]=l[h];return c}let Be=1;function wt(c,i,l){const h={};for(const g in c)h[g]=i.call(this,c[g],g,c);return h}function gt(c,i,l){const h={};for(const g in c)i.call(this,c[g],g,c)&&(h[g]=c[g]);return h}function Rt(c){return Array.isArray(c)?c.map(Rt):typeof c=="object"&&c?wt(c,Rt):c}const st={};function ht(c){st[c]||(typeof console<"u"&&console.warn(c),st[c]=!0)}function qe(c,i,l){return(l.y-c.y)*(i.x-c.x)>(i.y-c.y)*(l.x-c.x)}function Mt(c){return typeof WorkerGlobalScope<"u"&&c!==void 0&&c instanceof WorkerGlobalScope}let Ht=null;function _n(c){return typeof ImageBitmap<"u"&&c instanceof ImageBitmap}const In="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function yt(c,i,l,h,g){return a(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const v=new VideoFrame(c,{timestamp:0});try{const b=v==null?void 0:v.format;if(!b||!b.startsWith("BGR")&&!b.startsWith("RGB"))throw new Error(`Unrecognized format ${b}`);const A=b.startsWith("BGR"),C=new Uint8ClampedArray(h*g*4);if(yield v.copyTo(C,function(D,R,O,U,Z){const W=4*Math.max(-R,0),J=(Math.max(0,O)-O)*U*4+W,ie=4*U,fe=Math.max(0,R),Me=Math.max(0,O);return{rect:{x:fe,y:Me,width:Math.min(D.width,R+U)-fe,height:Math.min(D.height,O+Z)-Me},layout:[{offset:J,stride:ie}]}}(c,i,l,h,g)),A)for(let D=0;D<C.length;D+=4){const R=C[D];C[D]=C[D+2],C[D+2]=R}return C}finally{v.close()}})}let qt,Nt;function fn(c,i,l,h){return c.addEventListener(i,l,h),{unsubscribe:()=>{c.removeEventListener(i,l,h)}}}function yn(c){return c*Math.PI/180}function On(c){return c/Math.PI*180}const Mi={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},$n={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},wi="AbortError";function Ce(){return new Error(wi)}const X={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function K(c){return X.REGISTERED_PROTOCOLS[c.substring(0,c.indexOf("://"))]}const te="global-dispatcher";class pe extends Error{constructor(i,l,h,g){super(`AJAXError: ${l} (${i}): ${h}`),this.status=i,this.statusText=l,this.url=h,this.body=g}}const we=()=>Mt(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Ee=function(c,i){if(/:\/\//.test(c.url)&&!/^https?:|^file:/.test(c.url)){const h=K(c.url);if(h)return h(c,i);if(Mt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:c,targetMapId:te},i)}if(!(/^file:/.test(l=c.url)||/^file:/.test(we())&&!/^\w+:/.test(l))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(h,g){return a(this,void 0,void 0,function*(){const v=new Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,cache:h.cache,referrer:we(),signal:g.signal});let b,A;h.type!=="json"||v.headers.has("Accept")||v.headers.set("Accept","application/json");try{b=yield fetch(v)}catch(D){throw new pe(0,D.message,h.url,new Blob)}if(!b.ok){const D=yield b.blob();throw new pe(b.status,b.statusText,h.url,D)}A=h.type==="arrayBuffer"||h.type==="image"?b.arrayBuffer():h.type==="json"?b.json():b.text();const C=yield A;if(g.signal.aborted)throw Ce();return{data:C,cacheControl:b.headers.get("Cache-Control"),expires:b.headers.get("Expires")}})}(c,i);if(Mt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:c,mustQueue:!0,targetMapId:te},i)}var l;return function(h,g){return new Promise((v,b)=>{var A;const C=new XMLHttpRequest;C.open(h.method||"GET",h.url,!0),h.type!=="arrayBuffer"&&h.type!=="image"||(C.responseType="arraybuffer");for(const D in h.headers)C.setRequestHeader(D,h.headers[D]);h.type==="json"&&(C.responseType="text",!((A=h.headers)===null||A===void 0)&&A.Accept||C.setRequestHeader("Accept","application/json")),C.withCredentials=h.credentials==="include",C.onerror=()=>{b(new Error(C.statusText))},C.onload=()=>{if(!g.signal.aborted)if((C.status>=200&&C.status<300||C.status===0)&&C.response!==null){let D=C.response;if(h.type==="json")try{D=JSON.parse(C.response)}catch(R){return void b(R)}v({data:D,cacheControl:C.getResponseHeader("Cache-Control"),expires:C.getResponseHeader("Expires")})}else{const D=new Blob([C.response],{type:C.getResponseHeader("Content-Type")});b(new pe(C.status,C.statusText,h.url,D))}},g.signal.addEventListener("abort",()=>{C.abort(),b(Ce())}),C.send(h.body)})}(c,i)};function Fe(c){if(!c||c.indexOf("://")<=0||c.indexOf("data:image/")===0||c.indexOf("blob:")===0)return!0;const i=new URL(c),l=window.location;return i.protocol===l.protocol&&i.host===l.host}function Pe(c,i,l){l[c]&&l[c].indexOf(i)!==-1||(l[c]=l[c]||[],l[c].push(i))}function He(c,i,l){if(l&&l[c]){const h=l[c].indexOf(i);h!==-1&&l[c].splice(h,1)}}class Ge{constructor(i,l={}){Ke(this,l),this.type=i}}class Le extends Ge{constructor(i,l={}){super("error",Ke({error:i},l))}}class Je{on(i,l){return this._listeners=this._listeners||{},Pe(i,l,this._listeners),{unsubscribe:()=>{this.off(i,l)}}}off(i,l){return He(i,l,this._listeners),He(i,l,this._oneTimeListeners),this}once(i,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},Pe(i,l,this._oneTimeListeners),this):new Promise(h=>this.once(i,h))}fire(i,l){typeof i=="string"&&(i=new Ge(i,l||{}));const h=i.type;if(this.listens(h)){i.target=this;const g=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const A of g)A.call(this,i);const v=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const A of v)He(h,A,this._oneTimeListeners),A.call(this,i);const b=this._eventedParent;b&&(Ke(i,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),b.fire(i))}else i instanceof Le&&console.error(i.error);return this}listens(i){return this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i)}setEventedParent(i,l){return this._eventedParent=i,this._eventedParentData=l,this}}var Ae={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Lt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function nn(c,i){const l={};for(const h in c)h!=="ref"&&(l[h]=c[h]);return Lt.forEach(h=>{h in i&&(l[h]=i[h])}),l}function jt(c,i){if(Array.isArray(c)){if(!Array.isArray(i)||c.length!==i.length)return!1;for(let l=0;l<c.length;l++)if(!jt(c[l],i[l]))return!1;return!0}if(typeof c=="object"&&c!==null&&i!==null){if(typeof i!="object"||Object.keys(c).length!==Object.keys(i).length)return!1;for(const l in c)if(!jt(c[l],i[l]))return!1;return!0}return c===i}function Kt(c,i){c.push(i)}function en(c,i,l){Kt(l,{command:"addSource",args:[c,i[c]]})}function ti(c,i,l){Kt(i,{command:"removeSource",args:[c]}),l[c]=!0}function Pn(c,i,l,h){ti(c,l,h),en(c,i,l)}function Nn(c,i,l){let h;for(h in c[l])if(Object.prototype.hasOwnProperty.call(c[l],h)&&h!=="data"&&!jt(c[l][h],i[l][h]))return!1;for(h in i[l])if(Object.prototype.hasOwnProperty.call(i[l],h)&&h!=="data"&&!jt(c[l][h],i[l][h]))return!1;return!0}function ln(c,i,l,h,g,v){c=c||{},i=i||{};for(const b in c)Object.prototype.hasOwnProperty.call(c,b)&&(jt(c[b],i[b])||l.push({command:v,args:[h,b,i[b],g]}));for(const b in i)Object.prototype.hasOwnProperty.call(i,b)&&!Object.prototype.hasOwnProperty.call(c,b)&&(jt(c[b],i[b])||l.push({command:v,args:[h,b,i[b],g]}))}function En(c){return c.id}function li(c,i){return c[i.id]=i,c}class xt{constructor(i,l,h,g){this.message=(i?`${i}: `:"")+h,g&&(this.identifier=g),l!=null&&l.__line__&&(this.line=l.__line__)}}function mi(c,...i){for(const l of i)for(const h in l)c[h]=l[h];return c}class ci extends Error{constructor(i,l){super(l),this.message=l,this.key=i}}class ha{constructor(i,l=[]){this.parent=i,this.bindings={};for(const[h,g]of l)this.bindings[h]=g}concat(i){return new ha(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}const fa={kind:"null"},kt={kind:"number"},vn={kind:"string"},rt={kind:"boolean"},Dt={kind:"color"},Ci={kind:"projectionDefinition"},gi={kind:"object"},on={kind:"value"},Oe={kind:"collator"},lt={kind:"formatted"},Ot={kind:"padding"},cn={kind:"colorArray"},gn={kind:"numberArray"},mn={kind:"resolvedImage"},bn={kind:"variableAnchorOffsetCollection"};function hn(c,i){return{kind:"array",itemType:c,N:i}}function An(c){if(c.kind==="array"){const i=An(c.itemType);return typeof c.N=="number"?`array<${i}, ${c.N}>`:c.itemType.kind==="value"?"array":`array<${i}>`}return c.kind}const Qi=[fa,kt,vn,rt,Dt,Ci,lt,gi,hn(on),Ot,gn,cn,mn,bn];function kn(c,i){if(i.kind==="error")return null;if(c.kind==="array"){if(i.kind==="array"&&(i.N===0&&i.itemType.kind==="value"||!kn(c.itemType,i.itemType))&&(typeof c.N!="number"||c.N===i.N))return null}else{if(c.kind===i.kind)return null;if(c.kind==="value"){for(const l of Qi)if(!kn(l,i))return null}}return`Expected ${An(c)} but found ${An(i)} instead.`}function jn(c,i){return i.some(l=>l.kind===c.kind)}function Qn(c,i){return i.some(l=>l==="null"?c===null:l==="array"?Array.isArray(c):l==="object"?c&&!Array.isArray(c)&&typeof c=="object":l===typeof c)}function Ai(c,i){return c.kind==="array"&&i.kind==="array"?c.itemType.kind===i.itemType.kind&&typeof c.N=="number":c.kind===i.kind}const Jn=.96422,Un=.82521,Dn=4/29,ui=6/29,oi=3*ui*ui,_i=ui*ui*ui,Vn=Math.PI/180,Gi=180/Math.PI;function Di(c){return(c%=360)<0&&(c+=360),c}function Cn([c,i,l,h]){let g,v;const b=Ki((.2225045*(c=yi(c))+.7168786*(i=yi(i))+.0606169*(l=yi(l)))/1);c===i&&i===l?g=v=b:(g=Ki((.4360747*c+.3850649*i+.1430804*l)/Jn),v=Ki((.0139322*c+.0971045*i+.7141733*l)/Un));const A=116*b-16;return[A<0?0:A,500*(g-b),200*(b-v),h]}function yi(c){return c<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)}function Ki(c){return c>_i?Math.pow(c,1/3):c/oi+Dn}function Gr([c,i,l,h]){let g=(c+16)/116,v=isNaN(i)?g:g+i/500,b=isNaN(l)?g:g-l/200;return g=1*ba(g),v=Jn*ba(v),b=Un*ba(b),[Bs(3.1338561*v-1.6168667*g-.4906146*b),Bs(-.9787684*v+1.9161415*g+.033454*b),Bs(.0719453*v-.2289914*g+1.4052427*b),h]}function Bs(c){return(c=c<=.00304?12.92*c:1.055*Math.pow(c,1/2.4)-.055)<0?0:c>1?1:c}function ba(c){return c>ui?c*c*c:oi*(c-Dn)}const Tr=Object.hasOwn||function(c,i){return Object.prototype.hasOwnProperty.call(c,i)};function Tn(c,i){return Tr(c,i)?c[i]:void 0}function to(c){return parseInt(c.padEnd(2,c),16)/255}function no(c,i){return ts(i?c/100:c,0,1)}function ts(c,i,l){return Math.min(Math.max(i,c),l)}function $h(c){return!c.some(Number.isNaN)}const Wh={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function da(c,i,l){return c+l*(i-c)}function io(c,i,l){return c.map((h,g)=>da(h,i[g],l))}class zn{constructor(i,l,h,g=1,v=!0){this.r=i,this.g=l,this.b=h,this.a=g,v||(this.r*=g,this.g*=g,this.b*=g,g||this.overwriteGetter("rgb",[i,l,h,g]))}static parse(i){if(i instanceof zn)return i;if(typeof i!="string")return;const l=function(h){if((h=h.toLowerCase().trim())==="transparent")return[0,0,0,0];const g=Tn(Wh,h);if(g){const[b,A,C]=g;return[b/255,A/255,C/255,1]}if(h.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(h)){const b=h.length<6?1:2;let A=1;return[to(h.slice(A,A+=b)),to(h.slice(A,A+=b)),to(h.slice(A,A+=b)),to(h.slice(A,A+b)||"ff")]}if(h.startsWith("rgb")){const b=h.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(b){const[A,C,D,R,O,U,Z,W,J,ie,fe,Me]=b,ye=[R||" ",Z||" ",ie].join("");if(ye==="  "||ye==="  /"||ye===",,"||ye===",,,"){const q=[D,U,J].join(""),ne=q==="%%%"?100:q===""?255:0;if(ne){const ve=[ts(+C/ne,0,1),ts(+O/ne,0,1),ts(+W/ne,0,1),fe?no(+fe,Me):1];if($h(ve))return ve}}return}}const v=h.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(v){const[b,A,C,D,R,O,U,Z,W]=v,J=[C||" ",R||" ",U].join("");if(J==="  "||J==="  /"||J===",,"||J===",,,"){const ie=[+A,ts(+D,0,100),ts(+O,0,100),Z?no(+Z,W):1];if($h(ie))return function([fe,Me,ye,q]){function ne(ve){const Ue=(ve+fe/30)%12,ut=Me*Math.min(ye,1-ye);return ye-ut*Math.max(-1,Math.min(Ue-3,9-Ue,1))}return fe=Di(fe),Me/=100,ye/=100,[ne(0),ne(8),ne(4),q]}(ie)}}}(i);return l?new zn(...l,!1):void 0}get rgb(){const{r:i,g:l,b:h,a:g}=this,v=g||1/0;return this.overwriteGetter("rgb",[i/v,l/v,h/v,g])}get hcl(){return this.overwriteGetter("hcl",function(i){const[l,h,g,v]=Cn(i),b=Math.sqrt(h*h+g*g);return[Math.round(1e4*b)?Di(Math.atan2(g,h)*Gi):NaN,b,l,v]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Cn(this.rgb))}overwriteGetter(i,l){return Object.defineProperty(this,i,{value:l}),l}toString(){const[i,l,h,g]=this.rgb;return`rgba(${[i,l,h].map(v=>Math.round(255*v)).join(",")},${g})`}static interpolate(i,l,h,g="rgb"){switch(g){case"rgb":{const[v,b,A,C]=io(i.rgb,l.rgb,h);return new zn(v,b,A,C,!1)}case"hcl":{const[v,b,A,C]=i.hcl,[D,R,O,U]=l.hcl;let Z,W;if(isNaN(v)||isNaN(D))isNaN(v)?isNaN(D)?Z=NaN:(Z=D,A!==1&&A!==0||(W=R)):(Z=v,O!==1&&O!==0||(W=b));else{let ye=D-v;D>v&&ye>180?ye-=360:D<v&&v-D>180&&(ye+=360),Z=v+h*ye}const[J,ie,fe,Me]=function([ye,q,ne,ve]){return ye=isNaN(ye)?0:ye*Vn,Gr([ne,Math.cos(ye)*q,Math.sin(ye)*q,ve])}([Z,W??da(b,R,h),da(A,O,h),da(C,U,h)]);return new zn(J,ie,fe,Me,!1)}case"lab":{const[v,b,A,C]=Gr(io(i.lab,l.lab,h));return new zn(v,b,A,C,!1)}}}}zn.black=new zn(0,0,0,1),zn.white=new zn(1,1,1,1),zn.transparent=new zn(0,0,0,0),zn.red=new zn(1,0,0,1);class Rl{constructor(i,l,h){this.sensitivity=i?l?"variant":"case":l?"accent":"base",this.locale=h,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,l){return this.collator.compare(i,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const iu=["bottom","center","top"];class Yh{constructor(i,l,h,g,v,b){this.text=i,this.image=l,this.scale=h,this.fontStack=g,this.textColor=v,this.verticalAlign=b}}class Sr{constructor(i){this.sections=i}static fromString(i){return new Sr([new Yh(i,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(i=>i.text.length!==0||i.image&&i.image.name.length!==0)}static factory(i){return i instanceof Sr?i:Sr.fromString(i)}toString(){return this.sections.length===0?"":this.sections.map(i=>i.text).join("")}}class Zi{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof Zi)return i;if(typeof i=="number")return new Zi([i,i,i,i]);if(Array.isArray(i)&&!(i.length<1||i.length>4)){for(const l of i)if(typeof l!="number")return;switch(i.length){case 1:i=[i[0],i[0],i[0],i[0]];break;case 2:i=[i[0],i[1],i[0],i[1]];break;case 3:i=[i[0],i[1],i[2],i[1]]}return new Zi(i)}}toString(){return JSON.stringify(this.values)}static interpolate(i,l,h){return new Zi(io(i.values,l.values,h))}}class Mr{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof Mr)return i;if(typeof i=="number")return new Mr([i]);if(Array.isArray(i)){for(const l of i)if(typeof l!="number")return;return new Mr(i)}}toString(){return JSON.stringify(this.values)}static interpolate(i,l,h){return new Mr(io(i.values,l.values,h))}}class rr{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof rr)return i;if(typeof i=="string"){const h=zn.parse(i);return h?new rr([h]):void 0}if(!Array.isArray(i))return;const l=[];for(const h of i){if(typeof h!="string")return;const g=zn.parse(h);if(!g)return;l.push(g)}return new rr(l)}toString(){return JSON.stringify(this.values)}static interpolate(i,l,h,g="rgb"){const v=[];if(i.values.length!=l.values.length)throw new Error(`colorArray: Arrays have mismatched length (${i.values.length} vs. ${l.values.length}), cannot interpolate.`);for(let b=0;b<i.values.length;b++)v.push(zn.interpolate(i.values[b],l.values[b],h,g));return new rr(v)}}class zi extends Error{constructor(i){super(i),this.name="RuntimeError"}toJSON(){return this.message}}const ru=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Hn{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof Hn)return i;if(Array.isArray(i)&&!(i.length<1)&&i.length%2==0){for(let l=0;l<i.length;l+=2){const h=i[l],g=i[l+1];if(typeof h!="string"||!ru.has(h)||!Array.isArray(g)||g.length!==2||typeof g[0]!="number"||typeof g[1]!="number")return}return new Hn(i)}}toString(){return JSON.stringify(this.values)}static interpolate(i,l,h){const g=i.values,v=l.values;if(g.length!==v.length)throw new zi(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${l.toString()}`);const b=[];for(let A=0;A<g.length;A+=2){if(g[A]!==v[A])throw new zi(`Cannot interpolate values containing mismatched anchors. from[${A}]: ${g[A]}, to[${A}]: ${v[A]}`);b.push(g[A]);const[C,D]=g[A+1],[R,O]=v[A+1];b.push([da(C,R,h),da(D,O,h)])}return new Hn(b)}}class qr{constructor(i){this.name=i.name,this.available=i.available}toString(){return this.name}static fromString(i){return i?new qr({name:i,available:!1}):null}}class xn{constructor(i,l,h){this.from=i,this.to=l,this.transition=h}static interpolate(i,l,h){return new xn(i,l,h)}static parse(i){return i instanceof xn?i:Array.isArray(i)&&i.length===3&&typeof i[0]=="string"&&typeof i[1]=="string"&&typeof i[2]=="number"?new xn(i[0],i[1],i[2]):typeof i=="object"&&typeof i.from=="string"&&typeof i.to=="string"&&typeof i.transition=="number"?new xn(i.from,i.to,i.transition):typeof i=="string"?new xn(i,i,1):void 0}}function Sn(c,i,l,h){return typeof c=="number"&&c>=0&&c<=255&&typeof i=="number"&&i>=0&&i<=255&&typeof l=="number"&&l>=0&&l<=255?h===void 0||typeof h=="number"&&h>=0&&h<=1?null:`Invalid rgba value [${[c,i,l,h].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof h=="number"?[c,i,l,h]:[c,i,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ns(c){if(c===null||typeof c=="string"||typeof c=="boolean"||typeof c=="number"||c instanceof xn||c instanceof zn||c instanceof Rl||c instanceof Sr||c instanceof Zi||c instanceof Mr||c instanceof rr||c instanceof Hn||c instanceof qr)return!0;if(Array.isArray(c)){for(const i of c)if(!ns(i))return!1;return!0}if(typeof c=="object"){for(const i in c)if(!ns(c[i]))return!1;return!0}return!1}function dn(c){if(c===null)return fa;if(typeof c=="string")return vn;if(typeof c=="boolean")return rt;if(typeof c=="number")return kt;if(c instanceof zn)return Dt;if(c instanceof xn)return Ci;if(c instanceof Rl)return Oe;if(c instanceof Sr)return lt;if(c instanceof Zi)return Ot;if(c instanceof Mr)return gn;if(c instanceof rr)return cn;if(c instanceof Hn)return bn;if(c instanceof qr)return mn;if(Array.isArray(c)){const i=c.length;let l;for(const h of c){const g=dn(h);if(l){if(l===g)continue;l=on;break}l=g}return hn(l||on,i)}return gi}function is(c){const i=typeof c;return c===null?"":i==="string"||i==="number"||i==="boolean"?String(c):c instanceof zn||c instanceof xn||c instanceof Sr||c instanceof Zi||c instanceof Mr||c instanceof rr||c instanceof Hn||c instanceof qr?c.toString():JSON.stringify(c)}class zr{constructor(i,l){this.type=i,this.value=l}static parse(i,l){if(i.length!==2)return l.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!ns(i[1]))return l.error("invalid value");const h=i[1];let g=dn(h);const v=l.expectedType;return g.kind!=="array"||g.N!==0||!v||v.kind!=="array"||typeof v.N=="number"&&v.N!==0||(g=v),new zr(g,h)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Fs={string:vn,number:kt,boolean:rt,object:gi};class Zr{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");let h,g=1;const v=i[0];if(v==="array"){let A,C;if(i.length>2){const D=i[1];if(typeof D!="string"||!(D in Fs)||D==="object")return l.error('The item type argument of "array" must be one of string, number, boolean',1);A=Fs[D],g++}else A=on;if(i.length>3){if(i[2]!==null&&(typeof i[2]!="number"||i[2]<0||i[2]!==Math.floor(i[2])))return l.error('The length argument to "array" must be a positive integer literal',2);C=i[2],g++}h=hn(A,C)}else{if(!Fs[v])throw new Error(`Types doesn't contain name = ${v}`);h=Fs[v]}const b=[];for(;g<i.length;g++){const A=l.parse(i[g],g,on);if(!A)return null;b.push(A)}return new Zr(h,b)}evaluate(i){for(let l=0;l<this.args.length;l++){const h=this.args[l].evaluate(i);if(!kn(this.type,dn(h)))return h;if(l===this.args.length-1)throw new zi(`Expected value to be of type ${An(this.type)}, but found ${An(dn(h))} instead.`)}throw new Error}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}const Xh={"to-boolean":rt,"to-color":Dt,"to-number":kt,"to-string":vn};class Fa{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");const h=i[0];if(!Xh[h])throw new Error(`Can't parse ${h} as it is not part of the known types`);if((h==="to-boolean"||h==="to-string")&&i.length!==2)return l.error("Expected one argument.");const g=Xh[h],v=[];for(let b=1;b<i.length;b++){const A=l.parse(i[b],b,on);if(!A)return null;v.push(A)}return new Fa(g,v)}evaluate(i){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(i);case"color":{let l,h;for(const g of this.args){if(l=g.evaluate(i),h=null,l instanceof zn)return l;if(typeof l=="string"){const v=i.parseColor(l);if(v)return v}else if(Array.isArray(l)&&(h=l.length<3||l.length>4?`Invalid rgba value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:Sn(l[0],l[1],l[2],l[3]),!h))return new zn(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new zi(h||`Could not parse color from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"padding":{let l;for(const h of this.args){l=h.evaluate(i);const g=Zi.parse(l);if(g)return g}throw new zi(`Could not parse padding from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"numberArray":{let l;for(const h of this.args){l=h.evaluate(i);const g=Mr.parse(l);if(g)return g}throw new zi(`Could not parse numberArray from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"colorArray":{let l;for(const h of this.args){l=h.evaluate(i);const g=rr.parse(l);if(g)return g}throw new zi(`Could not parse colorArray from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"variableAnchorOffsetCollection":{let l;for(const h of this.args){l=h.evaluate(i);const g=Hn.parse(l);if(g)return g}throw new zi(`Could not parse variableAnchorOffsetCollection from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"number":{let l=null;for(const h of this.args){if(l=h.evaluate(i),l===null)return 0;const g=Number(l);if(!isNaN(g))return g}throw new zi(`Could not convert ${JSON.stringify(l)} to number.`)}case"formatted":return Sr.fromString(is(this.args[0].evaluate(i)));case"resolvedImage":return qr.fromString(is(this.args[0].evaluate(i)));case"projectionDefinition":return this.args[0].evaluate(i);default:return is(this.args[0].evaluate(i))}}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}const zp=["Unknown","Point","LineString","Polygon"];class Rp{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?zp[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(i){let l=this._parseColorCache.get(i);return l||(l=zn.parse(i),this._parseColorCache.set(i,l)),l}}class Ll{constructor(i,l,h=[],g,v=new ha,b=[]){this.registry=i,this.path=h,this.key=h.map(A=>`[${A}]`).join(""),this.scope=v,this.errors=b,this.expectedType=g,this._isConstant=l}parse(i,l,h,g,v={}){return l?this.concat(l,h,g)._parse(i,v):this._parse(i,v)}_parse(i,l){function h(g,v,b){return b==="assert"?new Zr(v,[g]):b==="coerce"?new Fa(v,[g]):g}if(i!==null&&typeof i!="string"&&typeof i!="boolean"&&typeof i!="number"||(i=["literal",i]),Array.isArray(i)){if(i.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const g=i[0];if(typeof g!="string")return this.error(`Expression name must be a string, but found ${typeof g} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const v=this.registry[g];if(v){let b=v.parse(i,this);if(!b)return null;if(this.expectedType){const A=this.expectedType,C=b.type;if(A.kind!=="string"&&A.kind!=="number"&&A.kind!=="boolean"&&A.kind!=="object"&&A.kind!=="array"||C.kind!=="value"){if(A.kind==="projectionDefinition"&&["string","array"].includes(C.kind)||["color","formatted","resolvedImage"].includes(A.kind)&&["value","string"].includes(C.kind)||["padding","numberArray"].includes(A.kind)&&["value","number","array"].includes(C.kind)||A.kind==="colorArray"&&["value","string","array"].includes(C.kind)||A.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(C.kind))b=h(b,A,l.typeAnnotation||"coerce");else if(this.checkSubtype(A,C))return null}else b=h(b,A,l.typeAnnotation||"assert")}if(!(b instanceof zr)&&b.type.kind!=="resolvedImage"&&this._isConstant(b)){const A=new Rp;try{b=new zr(b.type,b.evaluate(A))}catch(C){return this.error(C.message),null}}return b}return this.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(i===void 0?"'undefined' value invalid. Use null instead.":typeof i=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,l,h){const g=typeof i=="number"?this.path.concat(i):this.path,v=h?this.scope.concat(h):this.scope;return new Ll(this.registry,this._isConstant,g,l||null,v,this.errors)}error(i,...l){const h=`${this.key}${l.map(g=>`[${g}]`).join("")}`;this.errors.push(new ci(h,i))}checkSubtype(i,l){const h=kn(i,l);return h&&this.error(h),h}}class Bl{constructor(i,l){this.type=l.type,this.bindings=[].concat(i),this.result=l}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const l of this.bindings)i(l[1]);i(this.result)}static parse(i,l){if(i.length<4)return l.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const h=[];for(let v=1;v<i.length-1;v+=2){const b=i[v];if(typeof b!="string")return l.error(`Expected string, but found ${typeof b} instead.`,v);if(/[^a-zA-Z0-9_]/.test(b))return l.error("Variable names must contain only alphanumeric characters or '_'.",v);const A=l.parse(i[v+1],v+1);if(!A)return null;h.push([b,A])}const g=l.parse(i[i.length-1],i.length-1,l.expectedType,h);return g?new Bl(h,g):null}outputDefined(){return this.result.outputDefined()}}class xa{constructor(i,l){this.type=l.type,this.name=i,this.boundExpression=l}static parse(i,l){if(i.length!==2||typeof i[1]!="string")return l.error("'var' expression requires exactly one string literal argument.");const h=i[1];return l.scope.has(h)?new xa(h,l.scope.get(h)):l.error(`Unknown variable "${h}". Make sure "${h}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}}class ar{constructor(i,l,h){this.type=i,this.index=l,this.input=h}static parse(i,l){if(i.length!==3)return l.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const h=l.parse(i[1],1,kt),g=l.parse(i[2],2,hn(l.expectedType||on));return h&&g?new ar(g.type.itemType,h,g):null}evaluate(i){const l=this.index.evaluate(i),h=this.input.evaluate(i);if(l<0)throw new zi(`Array index out of bounds: ${l} < 0.`);if(l>=h.length)throw new zi(`Array index out of bounds: ${l} > ${h.length-1}.`);if(l!==Math.floor(l))throw new zi(`Array index must be an integer, but found ${l} instead.`);return h[l]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}}class Os{constructor(i,l){this.type=rt,this.needle=i,this.haystack=l}static parse(i,l){if(i.length!==3)return l.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const h=l.parse(i[1],1,on),g=l.parse(i[2],2,on);return h&&g?jn(h.type,[rt,vn,kt,fa,on])?new Os(h,g):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${An(h.type)} instead`):null}evaluate(i){const l=this.needle.evaluate(i),h=this.haystack.evaluate(i);if(!h)return!1;if(!Qn(l,["boolean","string","number","null"]))throw new zi(`Expected first argument to be of type boolean, string, number or null, but found ${An(dn(l))} instead.`);if(!Qn(h,["string","array"]))throw new zi(`Expected second argument to be of type array or string, but found ${An(dn(h))} instead.`);return h.indexOf(l)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}}class Fl{constructor(i,l,h){this.type=kt,this.needle=i,this.haystack=l,this.fromIndex=h}static parse(i,l){if(i.length<=2||i.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const h=l.parse(i[1],1,on),g=l.parse(i[2],2,on);if(!h||!g)return null;if(!jn(h.type,[rt,vn,kt,fa,on]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${An(h.type)} instead`);if(i.length===4){const v=l.parse(i[3],3,kt);return v?new Fl(h,g,v):null}return new Fl(h,g)}evaluate(i){const l=this.needle.evaluate(i),h=this.haystack.evaluate(i);if(!Qn(l,["boolean","string","number","null"]))throw new zi(`Expected first argument to be of type boolean, string, number or null, but found ${An(dn(l))} instead.`);let g;if(this.fromIndex&&(g=this.fromIndex.evaluate(i)),Qn(h,["string"])){const v=h.indexOf(l,g);return v===-1?-1:[...h.slice(0,v)].length}if(Qn(h,["array"]))return h.indexOf(l,g);throw new zi(`Expected second argument to be of type array or string, but found ${An(dn(h))} instead.`)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}}class Ns{constructor(i,l,h,g,v,b){this.inputType=i,this.type=l,this.input=h,this.cases=g,this.outputs=v,this.otherwise=b}static parse(i,l){if(i.length<5)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return l.error("Expected an even number of arguments.");let h,g;l.expectedType&&l.expectedType.kind!=="value"&&(g=l.expectedType);const v={},b=[];for(let D=2;D<i.length-1;D+=2){let R=i[D];const O=i[D+1];Array.isArray(R)||(R=[R]);const U=l.concat(D);if(R.length===0)return U.error("Expected at least one branch label.");for(const W of R){if(typeof W!="number"&&typeof W!="string")return U.error("Branch labels must be numbers or strings.");if(typeof W=="number"&&Math.abs(W)>Number.MAX_SAFE_INTEGER)return U.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof W=="number"&&Math.floor(W)!==W)return U.error("Numeric branch labels must be integer values.");if(h){if(U.checkSubtype(h,dn(W)))return null}else h=dn(W);if(v[String(W)]!==void 0)return U.error("Branch labels must be unique.");v[String(W)]=b.length}const Z=l.parse(O,D,g);if(!Z)return null;g=g||Z.type,b.push(Z)}const A=l.parse(i[1],1,on);if(!A)return null;const C=l.parse(i[i.length-1],i.length-1,g);return C?A.type.kind!=="value"&&l.concat(1).checkSubtype(h,A.type)?null:new Ns(h,g,A,v,b,C):null}evaluate(i){const l=this.input.evaluate(i);return(dn(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}}class Hi{constructor(i,l,h){this.type=i,this.branches=l,this.otherwise=h}static parse(i,l){if(i.length<4)return l.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return l.error("Expected an odd number of arguments.");let h;l.expectedType&&l.expectedType.kind!=="value"&&(h=l.expectedType);const g=[];for(let b=1;b<i.length-1;b+=2){const A=l.parse(i[b],b,rt);if(!A)return null;const C=l.parse(i[b+1],b+1,h);if(!C)return null;g.push([A,C]),h=h||C.type}const v=l.parse(i[i.length-1],i.length-1,h);if(!v)return null;if(!h)throw new Error("Can't infer output type");return new Hi(h,g,v)}evaluate(i){for(const[l,h]of this.branches)if(l.evaluate(i))return h.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[l,h]of this.branches)i(l),i(h);i(this.otherwise)}outputDefined(){return this.branches.every(([i,l])=>l.outputDefined())&&this.otherwise.outputDefined()}}class Ol{constructor(i,l,h,g){this.type=i,this.input=l,this.beginIndex=h,this.endIndex=g}static parse(i,l){if(i.length<=2||i.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const h=l.parse(i[1],1,on),g=l.parse(i[2],2,kt);if(!h||!g)return null;if(!jn(h.type,[hn(on),vn,on]))return l.error(`Expected first argument to be of type array or string, but found ${An(h.type)} instead`);if(i.length===4){const v=l.parse(i[3],3,kt);return v?new Ol(h.type,h,g,v):null}return new Ol(h.type,h,g)}evaluate(i){const l=this.input.evaluate(i),h=this.beginIndex.evaluate(i);let g;if(this.endIndex&&(g=this.endIndex.evaluate(i)),Qn(l,["string"]))return[...l].slice(h,g).join("");if(Qn(l,["array"]))return l.slice(h,g);throw new zi(`Expected first argument to be of type array or string, but found ${An(dn(l))} instead.`)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}}function js(c,i){const l=c.length-1;let h,g,v=0,b=l,A=0;for(;v<=b;)if(A=Math.floor((v+b)/2),h=c[A],g=c[A+1],h<=i){if(A===l||i<g)return A;v=A+1}else{if(!(h>i))throw new zi("Input is not a number.");b=A-1}return 0}class Us{constructor(i,l,h){this.type=i,this.input=l,this.labels=[],this.outputs=[];for(const[g,v]of h)this.labels.push(g),this.outputs.push(v)}static parse(i,l){if(i.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return l.error("Expected an even number of arguments.");const h=l.parse(i[1],1,kt);if(!h)return null;const g=[];let v=null;l.expectedType&&l.expectedType.kind!=="value"&&(v=l.expectedType);for(let b=1;b<i.length;b+=2){const A=b===1?-1/0:i[b],C=i[b+1],D=b,R=b+1;if(typeof A!="number")return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(g.length&&g[g.length-1][0]>=A)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);const O=l.parse(C,R,v);if(!O)return null;v=v||O.type,g.push([A,O])}return new Us(v,h,g)}evaluate(i){const l=this.labels,h=this.outputs;if(l.length===1)return h[0].evaluate(i);const g=this.input.evaluate(i);if(g<=l[0])return h[0].evaluate(i);const v=l.length;return g>=l[v-1]?h[v-1].evaluate(i):h[js(l,g)].evaluate(i)}eachChild(i){i(this.input);for(const l of this.outputs)i(l)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}}function by(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var So,Nl,Qh=function(){if(Nl)return So;function c(i,l,h,g){this.cx=3*i,this.bx=3*(h-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(g-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=l,this.p2x=h,this.p2y=g}return Nl=1,So=c,c.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,l){if(l===void 0&&(l=1e-6),i<0)return 0;if(i>1)return 1;for(var h=i,g=0;g<8;g++){var v=this.sampleCurveX(h)-i;if(Math.abs(v)<l)return h;var b=this.sampleCurveDerivativeX(h);if(Math.abs(b)<1e-6)break;h-=v/b}var A=0,C=1;for(h=i,g=0;g<20&&(v=this.sampleCurveX(h),!(Math.abs(v-i)<l));g++)i>v?A=h:C=h,h=.5*(C-A)+A;return h},solve:function(i,l){return this.sampleCurveY(this.solveCurveX(i,l))}},So}(),xy=by(Qh);class Rr{constructor(i,l,h,g,v){this.type=i,this.operator=l,this.interpolation=h,this.input=g,this.labels=[],this.outputs=[];for(const[b,A]of v)this.labels.push(b),this.outputs.push(A)}static interpolationFactor(i,l,h,g){let v=0;if(i.name==="exponential")v=Vs(l,i.base,h,g);else if(i.name==="linear")v=Vs(l,1,h,g);else if(i.name==="cubic-bezier"){const b=i.controlPoints;v=new xy(b[0],b[1],b[2],b[3]).solve(Vs(l,1,h,g))}return v}static parse(i,l){let[h,g,v,...b]=i;if(!Array.isArray(g)||g.length===0)return l.error("Expected an interpolation type expression.",1);if(g[0]==="linear")g={name:"linear"};else if(g[0]==="exponential"){const D=g[1];if(typeof D!="number")return l.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:D}}else{if(g[0]!=="cubic-bezier")return l.error(`Unknown interpolation type ${String(g[0])}`,1,0);{const D=g.slice(1);if(D.length!==4||D.some(R=>typeof R!="number"||R<0||R>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:D}}}if(i.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(v=l.parse(v,2,kt),!v)return null;const A=[];let C=null;h!=="interpolate-hcl"&&h!=="interpolate-lab"||l.expectedType==cn?l.expectedType&&l.expectedType.kind!=="value"&&(C=l.expectedType):C=Dt;for(let D=0;D<b.length;D+=2){const R=b[D],O=b[D+1],U=D+3,Z=D+4;if(typeof R!="number")return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',U);if(A.length&&A[A.length-1][0]>=R)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',U);const W=l.parse(O,Z,C);if(!W)return null;C=C||W.type,A.push([R,W])}return Ai(C,kt)||Ai(C,Ci)||Ai(C,Dt)||Ai(C,Ot)||Ai(C,gn)||Ai(C,cn)||Ai(C,bn)||Ai(C,hn(kt))?new Rr(C,h,g,v,A):l.error(`Type ${An(C)} is not interpolatable.`)}evaluate(i){const l=this.labels,h=this.outputs;if(l.length===1)return h[0].evaluate(i);const g=this.input.evaluate(i);if(g<=l[0])return h[0].evaluate(i);const v=l.length;if(g>=l[v-1])return h[v-1].evaluate(i);const b=js(l,g),A=Rr.interpolationFactor(this.interpolation,g,l[b],l[b+1]),C=h[b].evaluate(i),D=h[b+1].evaluate(i);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return da(C,D,A);case"color":return zn.interpolate(C,D,A);case"padding":return Zi.interpolate(C,D,A);case"colorArray":return rr.interpolate(C,D,A);case"numberArray":return Mr.interpolate(C,D,A);case"variableAnchorOffsetCollection":return Hn.interpolate(C,D,A);case"array":return io(C,D,A);case"projectionDefinition":return xn.interpolate(C,D,A)}case"interpolate-hcl":switch(this.type.kind){case"color":return zn.interpolate(C,D,A,"hcl");case"colorArray":return rr.interpolate(C,D,A,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return zn.interpolate(C,D,A,"lab");case"colorArray":return rr.interpolate(C,D,A,"lab")}}}eachChild(i){i(this.input);for(const l of this.outputs)i(l)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}}function Vs(c,i,l,h){const g=h-l,v=c-l;return g===0?0:i===1?v/g:(Math.pow(i,v)-1)/(Math.pow(i,g)-1)}const ia={color:zn.interpolate,number:da,padding:Zi.interpolate,numberArray:Mr.interpolate,colorArray:rr.interpolate,variableAnchorOffsetCollection:Hn.interpolate,array:io};class Hr{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");let h=null;const g=l.expectedType;g&&g.kind!=="value"&&(h=g);const v=[];for(const A of i.slice(1)){const C=l.parse(A,1+v.length,h,void 0,{typeAnnotation:"omit"});if(!C)return null;h=h||C.type,v.push(C)}if(!h)throw new Error("No output type");const b=g&&v.some(A=>kn(g,A.type));return new Hr(b?on:h,v)}evaluate(i){let l,h=null,g=0;for(const v of this.args)if(g++,h=v.evaluate(i),h&&h instanceof qr&&!h.available&&(l||(l=h.name),h=null,g===this.args.length&&(h=l)),h!==null)break;return h}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}function Kh(c,i){return c==="=="||c==="!="?i.kind==="boolean"||i.kind==="string"||i.kind==="number"||i.kind==="null"||i.kind==="value":i.kind==="string"||i.kind==="number"||i.kind==="value"}function jl(c,i,l,h){return h.compare(i,l)===0}function Gs(c,i,l){const h=c!=="=="&&c!=="!=";return class sM{constructor(v,b,A){this.type=rt,this.lhs=v,this.rhs=b,this.collator=A,this.hasUntypedArgument=v.type.kind==="value"||b.type.kind==="value"}static parse(v,b){if(v.length!==3&&v.length!==4)return b.error("Expected two or three arguments.");const A=v[0];let C=b.parse(v[1],1,on);if(!C)return null;if(!Kh(A,C.type))return b.concat(1).error(`"${A}" comparisons are not supported for type '${An(C.type)}'.`);let D=b.parse(v[2],2,on);if(!D)return null;if(!Kh(A,D.type))return b.concat(2).error(`"${A}" comparisons are not supported for type '${An(D.type)}'.`);if(C.type.kind!==D.type.kind&&C.type.kind!=="value"&&D.type.kind!=="value")return b.error(`Cannot compare types '${An(C.type)}' and '${An(D.type)}'.`);h&&(C.type.kind==="value"&&D.type.kind!=="value"?C=new Zr(D.type,[C]):C.type.kind!=="value"&&D.type.kind==="value"&&(D=new Zr(C.type,[D])));let R=null;if(v.length===4){if(C.type.kind!=="string"&&D.type.kind!=="string"&&C.type.kind!=="value"&&D.type.kind!=="value")return b.error("Cannot use collator to compare non-string types.");if(R=b.parse(v[3],3,Oe),!R)return null}return new sM(C,D,R)}evaluate(v){const b=this.lhs.evaluate(v),A=this.rhs.evaluate(v);if(h&&this.hasUntypedArgument){const C=dn(b),D=dn(A);if(C.kind!==D.kind||C.kind!=="string"&&C.kind!=="number")throw new zi(`Expected arguments for "${c}" to be (string, string) or (number, number), but found (${C.kind}, ${D.kind}) instead.`)}if(this.collator&&!h&&this.hasUntypedArgument){const C=dn(b),D=dn(A);if(C.kind!=="string"||D.kind!=="string")return i(v,b,A)}return this.collator?l(v,b,A,this.collator.evaluate(v)):i(v,b,A)}eachChild(v){v(this.lhs),v(this.rhs),this.collator&&v(this.collator)}outputDefined(){return!0}}}const Jh=Gs("==",function(c,i,l){return i===l},jl),wy=Gs("!=",function(c,i,l){return i!==l},function(c,i,l,h){return!jl(0,i,l,h)}),Ay=Gs("<",function(c,i,l){return i<l},function(c,i,l,h){return h.compare(i,l)<0}),Ty=Gs(">",function(c,i,l){return i>l},function(c,i,l,h){return h.compare(i,l)>0}),Sy=Gs("<=",function(c,i,l){return i<=l},function(c,i,l,h){return h.compare(i,l)<=0}),au=Gs(">=",function(c,i,l){return i>=l},function(c,i,l,h){return h.compare(i,l)>=0});class ou{constructor(i,l,h){this.type=Oe,this.locale=h,this.caseSensitive=i,this.diacriticSensitive=l}static parse(i,l){if(i.length!==2)return l.error("Expected one argument.");const h=i[1];if(typeof h!="object"||Array.isArray(h))return l.error("Collator options argument must be an object.");const g=l.parse(h["case-sensitive"]!==void 0&&h["case-sensitive"],1,rt);if(!g)return null;const v=l.parse(h["diacritic-sensitive"]!==void 0&&h["diacritic-sensitive"],1,rt);if(!v)return null;let b=null;return h.locale&&(b=l.parse(h.locale,1,vn),!b)?null:new ou(g,v,b)}evaluate(i){return new Rl(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}}class su{constructor(i,l,h,g,v){this.type=vn,this.number=i,this.locale=l,this.currency=h,this.minFractionDigits=g,this.maxFractionDigits=v}static parse(i,l){if(i.length!==3)return l.error("Expected two arguments.");const h=l.parse(i[1],1,kt);if(!h)return null;const g=i[2];if(typeof g!="object"||Array.isArray(g))return l.error("NumberFormat options argument must be an object.");let v=null;if(g.locale&&(v=l.parse(g.locale,1,vn),!v))return null;let b=null;if(g.currency&&(b=l.parse(g.currency,1,vn),!b))return null;let A=null;if(g["min-fraction-digits"]&&(A=l.parse(g["min-fraction-digits"],1,kt),!A))return null;let C=null;return g["max-fraction-digits"]&&(C=l.parse(g["max-fraction-digits"],1,kt),!C)?null:new su(h,v,b,A,C)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}}class Ul{constructor(i){this.type=lt,this.sections=i}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");const h=i[1];if(!Array.isArray(h)&&typeof h=="object")return l.error("First argument must be an image or text section.");const g=[];let v=!1;for(let b=1;b<=i.length-1;++b){const A=i[b];if(v&&typeof A=="object"&&!Array.isArray(A)){v=!1;let C=null;if(A["font-scale"]&&(C=l.parse(A["font-scale"],1,kt),!C))return null;let D=null;if(A["text-font"]&&(D=l.parse(A["text-font"],1,hn(vn)),!D))return null;let R=null;if(A["text-color"]&&(R=l.parse(A["text-color"],1,Dt),!R))return null;let O=null;if(A["vertical-align"]){if(typeof A["vertical-align"]=="string"&&!iu.includes(A["vertical-align"]))return l.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${A["vertical-align"]}' instead.`);if(O=l.parse(A["vertical-align"],1,vn),!O)return null}const U=g[g.length-1];U.scale=C,U.font=D,U.textColor=R,U.verticalAlign=O}else{const C=l.parse(i[b],1,on);if(!C)return null;const D=C.type.kind;if(D!=="string"&&D!=="value"&&D!=="null"&&D!=="resolvedImage")return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");v=!0,g.push({content:C,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Ul(g)}evaluate(i){return new Sr(this.sections.map(l=>{const h=l.content.evaluate(i);return dn(h)===mn?new Yh("",h,null,null,null,l.verticalAlign?l.verticalAlign.evaluate(i):null):new Yh(is(h),null,l.scale?l.scale.evaluate(i):null,l.font?l.font.evaluate(i).join(","):null,l.textColor?l.textColor.evaluate(i):null,l.verticalAlign?l.verticalAlign.evaluate(i):null)}))}eachChild(i){for(const l of this.sections)i(l.content),l.scale&&i(l.scale),l.font&&i(l.font),l.textColor&&i(l.textColor),l.verticalAlign&&i(l.verticalAlign)}outputDefined(){return!1}}class ef{constructor(i){this.type=mn,this.input=i}static parse(i,l){if(i.length!==2)return l.error("Expected two arguments.");const h=l.parse(i[1],1,vn);return h?new ef(h):l.error("No image name provided.")}evaluate(i){const l=this.input.evaluate(i),h=qr.fromString(l);return h&&i.availableImages&&(h.available=i.availableImages.indexOf(l)>-1),h}eachChild(i){i(this.input)}outputDefined(){return!1}}class lu{constructor(i){this.type=kt,this.input=i}static parse(i,l){if(i.length!==2)return l.error(`Expected 1 argument, but found ${i.length-1} instead.`);const h=l.parse(i[1],1);return h?h.type.kind!=="array"&&h.type.kind!=="string"&&h.type.kind!=="value"?l.error(`Expected argument of type string or array, but found ${An(h.type)} instead.`):new lu(h):null}evaluate(i){const l=this.input.evaluate(i);if(typeof l=="string")return[...l].length;if(Array.isArray(l))return l.length;throw new zi(`Expected value to be of type string or array, but found ${An(dn(l))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}}const Oa=8192;function My(c,i){const l=(180+c[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c[1]*Math.PI/360)))/360,g=Math.pow(2,i.z);return[Math.round(l*g*Oa),Math.round(h*g*Oa)]}function tf(c,i){const l=Math.pow(2,i.z);return[(g=(c[0]/Oa+i.x)/l,360*g-180),(h=(c[1]/Oa+i.y)/l,360/Math.PI*Math.atan(Math.exp((180-360*h)*Math.PI/180))-90)];var h,g}function Vl(c,i){c[0]=Math.min(c[0],i[0]),c[1]=Math.min(c[1],i[1]),c[2]=Math.max(c[2],i[0]),c[3]=Math.max(c[3],i[1])}function Gl(c,i){return!(c[0]<=i[0]||c[2]>=i[2]||c[1]<=i[1]||c[3]>=i[3])}function Lp(c,i,l){const h=c[0]-i[0],g=c[1]-i[1],v=c[0]-l[0],b=c[1]-l[1];return h*b-v*g==0&&h*v<=0&&g*b<=0}function ql(c,i,l,h){return(g=[h[0]-l[0],h[1]-l[1]])[0]*(v=[i[0]-c[0],i[1]-c[1]])[1]-g[1]*v[0]!=0&&!(!cu(c,i,l,h)||!cu(l,h,c,i));var g,v}function Bp(c,i,l){for(const h of l)for(let g=0;g<h.length-1;++g)if(ql(c,i,h[g],h[g+1]))return!0;return!1}function qs(c,i,l=!1){let h=!1;for(const A of i)for(let C=0;C<A.length-1;C++){if(Lp(c,A[C],A[C+1]))return l;(v=A[C])[1]>(g=c)[1]!=(b=A[C+1])[1]>g[1]&&g[0]<(b[0]-v[0])*(g[1]-v[1])/(b[1]-v[1])+v[0]&&(h=!h)}var g,v,b;return h}function Cy(c,i){for(const l of i)if(qs(c,l))return!0;return!1}function Fp(c,i){for(const l of c)if(!qs(l,i))return!1;for(let l=0;l<c.length-1;++l)if(Bp(c[l],c[l+1],i))return!1;return!0}function Iy(c,i){for(const l of i)if(Fp(c,l))return!0;return!1}function cu(c,i,l,h){const g=h[0]-l[0],v=h[1]-l[1],b=(c[0]-l[0])*v-g*(c[1]-l[1]),A=(i[0]-l[0])*v-g*(i[1]-l[1]);return b>0&&A<0||b<0&&A>0}function nf(c,i,l){const h=[];for(let g=0;g<c.length;g++){const v=[];for(let b=0;b<c[g].length;b++){const A=My(c[g][b],l);Vl(i,A),v.push(A)}h.push(v)}return h}function Op(c,i,l){const h=[];for(let g=0;g<c.length;g++){const v=nf(c[g],i,l);h.push(v)}return h}function Np(c,i,l,h){if(c[0]<l[0]||c[0]>l[2]){const g=.5*h;let v=c[0]-l[0]>g?-h:l[0]-c[0]>g?h:0;v===0&&(v=c[0]-l[2]>g?-h:l[2]-c[0]>g?h:0),c[0]+=v}Vl(i,c)}function rf(c,i,l,h){const g=Math.pow(2,h.z)*Oa,v=[h.x*Oa,h.y*Oa],b=[];for(const A of c)for(const C of A){const D=[C.x+v[0],C.y+v[1]];Np(D,i,l,g),b.push(D)}return b}function af(c,i,l,h){const g=Math.pow(2,h.z)*Oa,v=[h.x*Oa,h.y*Oa],b=[];for(const C of c){const D=[];for(const R of C){const O=[R.x+v[0],R.y+v[1]];Vl(i,O),D.push(O)}b.push(D)}if(i[2]-i[0]<=g/2){(A=i)[0]=A[1]=1/0,A[2]=A[3]=-1/0;for(const C of b)for(const D of C)Np(D,i,l,g)}var A;return b}class rs{constructor(i,l){this.type=rt,this.geojson=i,this.geometries=l}static parse(i,l){if(i.length!==2)return l.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(ns(i[1])){const h=i[1];if(h.type==="FeatureCollection"){const g=[];for(const v of h.features){const{type:b,coordinates:A}=v.geometry;b==="Polygon"&&g.push(A),b==="MultiPolygon"&&g.push(...A)}if(g.length)return new rs(h,{type:"MultiPolygon",coordinates:g})}else if(h.type==="Feature"){const g=h.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new rs(h,h.geometry)}else if(h.type==="Polygon"||h.type==="MultiPolygon")return new rs(h,h)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return function(l,h){const g=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],b=l.canonicalID();if(h.type==="Polygon"){const A=nf(h.coordinates,v,b),C=rf(l.geometry(),g,v,b);if(!Gl(g,v))return!1;for(const D of C)if(!qs(D,A))return!1}if(h.type==="MultiPolygon"){const A=Op(h.coordinates,v,b),C=rf(l.geometry(),g,v,b);if(!Gl(g,v))return!1;for(const D of C)if(!Cy(D,A))return!1}return!0}(i,this.geometries);if(i.geometryType()==="LineString")return function(l,h){const g=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],b=l.canonicalID();if(h.type==="Polygon"){const A=nf(h.coordinates,v,b),C=af(l.geometry(),g,v,b);if(!Gl(g,v))return!1;for(const D of C)if(!Fp(D,A))return!1}if(h.type==="MultiPolygon"){const A=Op(h.coordinates,v,b),C=af(l.geometry(),g,v,b);if(!Gl(g,v))return!1;for(const D of C)if(!Iy(D,A))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let jp=class{constructor(c=[],i=(l,h)=>l<h?-1:l>h?1:0){if(this.data=c,this.length=this.data.length,this.compare=i,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(c){this.data.push(c),this._up(this.length++)}pop(){if(this.length===0)return;const c=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),c}peek(){return this.data[0]}_up(c){const{data:i,compare:l}=this,h=i[c];for(;c>0;){const g=c-1>>1,v=i[g];if(l(h,v)>=0)break;i[c]=v,c=g}i[c]=h}_down(c){const{data:i,compare:l}=this,h=this.length>>1,g=i[c];for(;c<h;){let v=1+(c<<1);const b=v+1;if(b<this.length&&l(i[b],i[v])<0&&(v=b),l(i[v],g)>=0)break;i[c]=i[v],c=v}i[c]=g}};function of(c,i,l=0,h=c.length-1,g=Ey){for(;h>l;){if(h-l>600){const C=h-l+1,D=i-l+1,R=Math.log(C),O=.5*Math.exp(2*R/3),U=.5*Math.sqrt(R*O*(C-O)/C)*(D-C/2<0?-1:1);of(c,i,Math.max(l,Math.floor(i-D*O/C+U)),Math.min(h,Math.floor(i+(C-D)*O/C+U)),g)}const v=c[i];let b=l,A=h;for(Zs(c,l,i),g(c[h],v)>0&&Zs(c,l,h);b<A;){for(Zs(c,b,A),b++,A--;g(c[b],v)<0;)b++;for(;g(c[A],v)>0;)A--}g(c[l],v)===0?Zs(c,l,A):(A++,Zs(c,A,h)),A<=i&&(l=A+1),i<=A&&(h=A-1)}}function Zs(c,i,l){const h=c[i];c[i]=c[l],c[l]=h}function Ey(c,i){return c<i?-1:c>i?1:0}function uu(c,i){if(c.length<=1)return[c];const l=[];let h,g;for(const v of c){const b=Up(v);b!==0&&(v.area=Math.abs(b),g===void 0&&(g=b<0),g===b<0?(h&&l.push(h),h=[v]):h.push(v))}if(h&&l.push(h),i>1)for(let v=0;v<l.length;v++)l[v].length<=i||(of(l[v],i,1,l[v].length-1,Py),l[v]=l[v].slice(0,i));return l}function Py(c,i){return i.area-c.area}function Up(c){let i=0;for(let l,h,g=0,v=c.length,b=v-1;g<v;b=g++)l=c[g],h=c[b],i+=(h.x-l.x)*(l.y+h.y);return i}const Vp=1/298.257223563,Gp=Vp*(2-Vp),qp=Math.PI/180;class sf{constructor(i){const l=6378.137*qp*1e3,h=Math.cos(i*qp),g=1/(1-Gp*(1-h*h)),v=Math.sqrt(g);this.kx=l*v*h,this.ky=l*v*g*(1-Gp)}distance(i,l){const h=this.wrap(i[0]-l[0])*this.kx,g=(i[1]-l[1])*this.ky;return Math.sqrt(h*h+g*g)}pointOnLine(i,l){let h,g,v,b,A=1/0;for(let C=0;C<i.length-1;C++){let D=i[C][0],R=i[C][1],O=this.wrap(i[C+1][0]-D)*this.kx,U=(i[C+1][1]-R)*this.ky,Z=0;O===0&&U===0||(Z=(this.wrap(l[0]-D)*this.kx*O+(l[1]-R)*this.ky*U)/(O*O+U*U),Z>1?(D=i[C+1][0],R=i[C+1][1]):Z>0&&(D+=O/this.kx*Z,R+=U/this.ky*Z)),O=this.wrap(l[0]-D)*this.kx,U=(l[1]-R)*this.ky;const W=O*O+U*U;W<A&&(A=W,h=D,g=R,v=C,b=Z)}return{point:[h,g],index:v,t:Math.max(0,Math.min(1,b))}}wrap(i){for(;i<-180;)i+=360;for(;i>180;)i-=360;return i}}function ni(c,i){return i[0]-c[0]}function hu(c){return c[1]-c[0]+1}function ro(c,i){return c[1]>=c[0]&&c[1]<i}function lf(c,i){if(c[0]>c[1])return[null,null];const l=hu(c);if(i){if(l===2)return[c,null];const g=Math.floor(l/2);return[[c[0],c[0]+g],[c[0]+g,c[1]]]}if(l===1)return[c,null];const h=Math.floor(l/2)-1;return[[c[0],c[0]+h],[c[0]+h+1,c[1]]]}function cf(c,i){if(!ro(i,c.length))return[1/0,1/0,-1/0,-1/0];const l=[1/0,1/0,-1/0,-1/0];for(let h=i[0];h<=i[1];++h)Vl(l,c[h]);return l}function uf(c){const i=[1/0,1/0,-1/0,-1/0];for(const l of c)for(const h of l)Vl(i,h);return i}function Zp(c){return c[0]!==-1/0&&c[1]!==-1/0&&c[2]!==1/0&&c[3]!==1/0}function hf(c,i,l){if(!Zp(c)||!Zp(i))return NaN;let h=0,g=0;return c[2]<i[0]&&(h=i[0]-c[2]),c[0]>i[2]&&(h=c[0]-i[2]),c[1]>i[3]&&(g=c[1]-i[3]),c[3]<i[1]&&(g=i[1]-c[3]),l.distance([0,0],[h,g])}function as(c,i,l){const h=l.pointOnLine(i,c);return l.distance(c,h.point)}function ff(c,i,l,h,g){const v=Math.min(as(c,[l,h],g),as(i,[l,h],g)),b=Math.min(as(l,[c,i],g),as(h,[c,i],g));return Math.min(v,b)}function ky(c,i,l,h,g){if(!ro(i,c.length)||!ro(h,l.length))return 1/0;let v=1/0;for(let b=i[0];b<i[1];++b){const A=c[b],C=c[b+1];for(let D=h[0];D<h[1];++D){const R=l[D],O=l[D+1];if(ql(A,C,R,O))return 0;v=Math.min(v,ff(A,C,R,O,g))}}return v}function Dy(c,i,l,h,g){if(!ro(i,c.length)||!ro(h,l.length))return NaN;let v=1/0;for(let b=i[0];b<=i[1];++b)for(let A=h[0];A<=h[1];++A)if(v=Math.min(v,g.distance(c[b],l[A])),v===0)return v;return v}function zy(c,i,l){if(qs(c,i,!0))return 0;let h=1/0;for(const g of i){const v=g[0],b=g[g.length-1];if(v!==b&&(h=Math.min(h,as(c,[b,v],l)),h===0))return h;const A=l.pointOnLine(g,c);if(h=Math.min(h,l.distance(c,A.point)),h===0)return h}return h}function Ry(c,i,l,h){if(!ro(i,c.length))return NaN;for(let v=i[0];v<=i[1];++v)if(qs(c[v],l,!0))return 0;let g=1/0;for(let v=i[0];v<i[1];++v){const b=c[v],A=c[v+1];for(const C of l)for(let D=0,R=C.length,O=R-1;D<R;O=D++){const U=C[O],Z=C[D];if(ql(b,A,U,Z))return 0;g=Math.min(g,ff(b,A,U,Z,h))}}return g}function Hp(c,i){for(const l of c)for(const h of l)if(qs(h,i,!0))return!0;return!1}function Ly(c,i,l,h=1/0){const g=uf(c),v=uf(i);if(h!==1/0&&hf(g,v,l)>=h)return h;if(Gl(g,v)){if(Hp(c,i))return 0}else if(Hp(i,c))return 0;let b=1/0;for(const A of c)for(let C=0,D=A.length,R=D-1;C<D;R=C++){const O=A[R],U=A[C];for(const Z of i)for(let W=0,J=Z.length,ie=J-1;W<J;ie=W++){const fe=Z[ie],Me=Z[W];if(ql(O,U,fe,Me))return 0;b=Math.min(b,ff(O,U,fe,Me,l))}}return b}function $p(c,i,l,h,g,v){if(!v)return;const b=hf(cf(h,v),g,l);b<i&&c.push([b,v,[0,0]])}function fu(c,i,l,h,g,v,b){if(!v||!b)return;const A=hf(cf(h,v),cf(g,b),l);A<i&&c.push([A,v,b])}function du(c,i,l,h,g=1/0){let v=Math.min(h.distance(c[0],l[0][0]),g);if(v===0)return v;const b=new jp([[0,[0,c.length-1],[0,0]]],ni),A=uf(l);for(;b.length>0;){const C=b.pop();if(C[0]>=v)continue;const D=C[1],R=i?50:100;if(hu(D)<=R){if(!ro(D,c.length))return NaN;if(i){const O=Ry(c,D,l,h);if(isNaN(O)||O===0)return O;v=Math.min(v,O)}else for(let O=D[0];O<=D[1];++O){const U=zy(c[O],l,h);if(v=Math.min(v,U),v===0)return 0}}else{const O=lf(D,i);$p(b,v,h,c,A,O[0]),$p(b,v,h,c,A,O[1])}}return v}function pu(c,i,l,h,g,v=1/0){let b=Math.min(v,g.distance(c[0],l[0]));if(b===0)return b;const A=new jp([[0,[0,c.length-1],[0,l.length-1]]],ni);for(;A.length>0;){const C=A.pop();if(C[0]>=b)continue;const D=C[1],R=C[2],O=i?50:100,U=h?50:100;if(hu(D)<=O&&hu(R)<=U){if(!ro(D,c.length)&&ro(R,l.length))return NaN;let Z;if(i&&h)Z=ky(c,D,l,R,g),b=Math.min(b,Z);else if(i&&!h){const W=c.slice(D[0],D[1]+1);for(let J=R[0];J<=R[1];++J)if(Z=as(l[J],W,g),b=Math.min(b,Z),b===0)return b}else if(!i&&h){const W=l.slice(R[0],R[1]+1);for(let J=D[0];J<=D[1];++J)if(Z=as(c[J],W,g),b=Math.min(b,Z),b===0)return b}else Z=Dy(c,D,l,R,g),b=Math.min(b,Z)}else{const Z=lf(D,i),W=lf(R,h);fu(A,b,g,c,l,Z[0],W[0]),fu(A,b,g,c,l,Z[0],W[1]),fu(A,b,g,c,l,Z[1],W[0]),fu(A,b,g,c,l,Z[1],W[1])}}return b}function df(c){return c.type==="MultiPolygon"?c.coordinates.map(i=>({type:"Polygon",coordinates:i})):c.type==="MultiLineString"?c.coordinates.map(i=>({type:"LineString",coordinates:i})):c.type==="MultiPoint"?c.coordinates.map(i=>({type:"Point",coordinates:i})):[c]}class os{constructor(i,l){this.type=kt,this.geojson=i,this.geometries=l}static parse(i,l){if(i.length!==2)return l.error(`'distance' expression requires exactly one argument, but found ${i.length-1} instead.`);if(ns(i[1])){const h=i[1];if(h.type==="FeatureCollection")return new os(h,h.features.map(g=>df(g.geometry)).flat());if(h.type==="Feature")return new os(h,df(h.geometry));if("type"in h&&"coordinates"in h)return new os(h,df(h))}return l.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return function(l,h){const g=l.geometry(),v=g.flat().map(C=>tf([C.x,C.y],l.canonical));if(g.length===0)return NaN;const b=new sf(v[0][1]);let A=1/0;for(const C of h){switch(C.type){case"Point":A=Math.min(A,pu(v,!1,[C.coordinates],!1,b,A));break;case"LineString":A=Math.min(A,pu(v,!1,C.coordinates,!0,b,A));break;case"Polygon":A=Math.min(A,du(v,!1,C.coordinates,b,A))}if(A===0)return A}return A}(i,this.geometries);if(i.geometryType()==="LineString")return function(l,h){const g=l.geometry(),v=g.flat().map(C=>tf([C.x,C.y],l.canonical));if(g.length===0)return NaN;const b=new sf(v[0][1]);let A=1/0;for(const C of h){switch(C.type){case"Point":A=Math.min(A,pu(v,!0,[C.coordinates],!1,b,A));break;case"LineString":A=Math.min(A,pu(v,!0,C.coordinates,!0,b,A));break;case"Polygon":A=Math.min(A,du(v,!0,C.coordinates,b,A))}if(A===0)return A}return A}(i,this.geometries);if(i.geometryType()==="Polygon")return function(l,h){const g=l.geometry();if(g.length===0||g[0].length===0)return NaN;const v=uu(g,0).map(C=>C.map(D=>D.map(R=>tf([R.x,R.y],l.canonical)))),b=new sf(v[0][0][0][1]);let A=1/0;for(const C of h)for(const D of v){switch(C.type){case"Point":A=Math.min(A,du([C.coordinates],!1,D,b,A));break;case"LineString":A=Math.min(A,du(C.coordinates,!0,D,b,A));break;case"Polygon":A=Math.min(A,Ly(D,C.coordinates,b,A))}if(A===0)return A}return A}(i,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Zl{constructor(i){this.type=on,this.key=i}static parse(i,l){if(i.length!==2)return l.error(`Expected 1 argument, but found ${i.length-1} instead.`);const h=i[1];return h==null?l.error("Global state property must be defined."):typeof h!="string"?l.error(`Global state property must be string, but found ${typeof i[1]} instead.`):new Zl(h)}evaluate(i){var l;const h=(l=i.globals)===null||l===void 0?void 0:l.globalState;return h&&Object.keys(h).length!==0?Tn(h,this.key):null}eachChild(){}outputDefined(){return!1}}const Hs={"==":Jh,"!=":wy,">":Ty,"<":Ay,">=":au,"<=":Sy,array:Zr,at:ar,boolean:Zr,case:Hi,coalesce:Hr,collator:ou,format:Ul,image:ef,in:Os,"index-of":Fl,interpolate:Rr,"interpolate-hcl":Rr,"interpolate-lab":Rr,length:lu,let:Bl,literal:zr,match:Ns,number:Zr,"number-format":su,object:Zr,slice:Ol,step:Us,string:Zr,"to-boolean":Fa,"to-color":Fa,"to-number":Fa,"to-string":Fa,var:xa,within:rs,distance:os,"global-state":Zl};class pa{constructor(i,l,h,g){this.name=i,this.type=l,this._evaluate=h,this.args=g}evaluate(i){return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}static parse(i,l){const h=i[0],g=pa.definitions[h];if(!g)return l.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0);const v=Array.isArray(g)?g[0]:g.type,b=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,A=b.filter(([D])=>!Array.isArray(D)||D.length===i.length-1);let C=null;for(const[D,R]of A){C=new Ll(l.registry,mu,l.path,null,l.scope);const O=[];let U=!1;for(let Z=1;Z<i.length;Z++){const W=i[Z],J=Array.isArray(D)?D[Z-1]:D.type,ie=C.parse(W,1+O.length,J);if(!ie){U=!0;break}O.push(ie)}if(!U)if(Array.isArray(D)&&D.length!==O.length)C.error(`Expected ${D.length} arguments, but found ${O.length} instead.`);else{for(let Z=0;Z<O.length;Z++){const W=Array.isArray(D)?D[Z]:D.type,J=O[Z];C.concat(Z+1).checkSubtype(W,J.type)}if(C.errors.length===0)return new pa(h,v,R,O)}}if(A.length===1)l.errors.push(...C.errors);else{const D=(A.length?A:b).map(([O])=>{return U=O,Array.isArray(U)?`(${U.map(An).join(", ")})`:`(${An(U.type)}...)`;var U}).join(" | "),R=[];for(let O=1;O<i.length;O++){const U=l.parse(i[O],1+R.length);if(!U)return null;R.push(An(U.type))}l.error(`Expected arguments of type ${D}, but found (${R.join(", ")}) instead.`)}return null}static register(i,l){pa.definitions=l;for(const h in l)i[h]=pa}}function Wp(c,[i,l,h,g]){i=i.evaluate(c),l=l.evaluate(c),h=h.evaluate(c);const v=g?g.evaluate(c):1,b=Sn(i,l,h,v);if(b)throw new zi(b);return new zn(i/255,l/255,h/255,v,!1)}function Yp(c,i){return c in i}function pf(c,i){const l=i[c];return l===void 0?null:l}function ss(c){return{type:c}}function mu(c){if(c instanceof xa)return mu(c.boundExpression);if(c instanceof pa&&c.name==="error"||c instanceof ou||c instanceof rs||c instanceof os||c instanceof Zl)return!1;const i=c instanceof Fa||c instanceof Zr;let l=!0;return c.eachChild(h=>{l=i?l&&mu(h):l&&h instanceof zr}),!!l&&gu(c)&&$s(c,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function gu(c){if(c instanceof pa&&(c.name==="get"&&c.args.length===1||c.name==="feature-state"||c.name==="has"&&c.args.length===1||c.name==="properties"||c.name==="geometry-type"||c.name==="id"||/^filter-/.test(c.name))||c instanceof rs||c instanceof os)return!1;let i=!0;return c.eachChild(l=>{i&&!gu(l)&&(i=!1)}),i}function Hl(c){if(c instanceof pa&&c.name==="feature-state")return!1;let i=!0;return c.eachChild(l=>{i&&!Hl(l)&&(i=!1)}),i}function $s(c,i){if(c instanceof pa&&i.indexOf(c.name)>=0)return!1;let l=!0;return c.eachChild(h=>{l&&!$s(h,i)&&(l=!1)}),l}function Xp(c){return{result:"success",value:c}}function Ws(c){return{result:"error",value:c}}function Ys(c){return c["property-type"]==="data-driven"||c["property-type"]==="cross-faded-data-driven"}function mf(c){return!!c.expression&&c.expression.parameters.indexOf("zoom")>-1}function gf(c){return!!c.expression&&c.expression.interpolated}function Rn(c){return c instanceof Number?"number":c instanceof String?"string":c instanceof Boolean?"boolean":Array.isArray(c)?"array":c===null?"null":typeof c}function ls(c){return typeof c=="object"&&c!==null&&!Array.isArray(c)&&dn(c)===gi}function Qp(c){return c}function Kp(c,i){const l=c.stops&&typeof c.stops[0][0]=="object",h=l||!(l||c.property!==void 0),g=c.type||(gf(i)?"exponential":"interval"),v=function(R){switch(R.type){case"color":return zn.parse;case"padding":return Zi.parse;case"numberArray":return Mr.parse;case"colorArray":return rr.parse;default:return null}}(i);if(v&&((c=mi({},c)).stops&&(c.stops=c.stops.map(R=>[R[0],v(R[1])])),c.default=v(c.default?c.default:i.default)),c.colorSpace&&(b=c.colorSpace)!=="rgb"&&b!=="hcl"&&b!=="lab")throw new Error(`Unknown color space: "${c.colorSpace}"`);var b;const A=function(R){switch(R){case"exponential":return Jp;case"interval":return Fy;case"categorical":return By;case"identity":return em;default:throw new Error(`Unknown function type "${R}"`)}}(g);let C,D;if(g==="categorical"){C=Object.create(null);for(const R of c.stops)C[R[0]]=R[1];D=typeof c.stops[0][0]}if(l){const R={},O=[];for(let W=0;W<c.stops.length;W++){const J=c.stops[W],ie=J[0].zoom;R[ie]===void 0&&(R[ie]={zoom:ie,type:c.type,property:c.property,default:c.default,stops:[]},O.push(ie)),R[ie].stops.push([J[0].value,J[1]])}const U=[];for(const W of O)U.push([R[W].zoom,Kp(R[W],i)]);const Z={name:"linear"};return{kind:"composite",interpolationType:Z,interpolationFactor:Rr.interpolationFactor.bind(void 0,Z),zoomStops:U.map(W=>W[0]),evaluate:({zoom:W},J)=>Jp({stops:U,base:c.base},i,W).evaluate(W,J)}}if(h){const R=g==="exponential"?{name:"exponential",base:c.base!==void 0?c.base:1}:null;return{kind:"camera",interpolationType:R,interpolationFactor:Rr.interpolationFactor.bind(void 0,R),zoomStops:c.stops.map(O=>O[0]),evaluate:({zoom:O})=>A(c,i,O,C,D)}}return{kind:"source",evaluate(R,O){const U=O&&O.properties?O.properties[c.property]:void 0;return U===void 0?$l(c.default,i.default):A(c,i,U,C,D)}}}function $l(c,i,l){return c!==void 0?c:i!==void 0?i:l!==void 0?l:void 0}function By(c,i,l,h,g){return $l(typeof l===g?h[l]:void 0,c.default,i.default)}function Fy(c,i,l){if(Rn(l)!=="number")return $l(c.default,i.default);const h=c.stops.length;if(h===1||l<=c.stops[0][0])return c.stops[0][1];if(l>=c.stops[h-1][0])return c.stops[h-1][1];const g=js(c.stops.map(v=>v[0]),l);return c.stops[g][1]}function Jp(c,i,l){const h=c.base!==void 0?c.base:1;if(Rn(l)!=="number")return $l(c.default,i.default);const g=c.stops.length;if(g===1||l<=c.stops[0][0])return c.stops[0][1];if(l>=c.stops[g-1][0])return c.stops[g-1][1];const v=js(c.stops.map(R=>R[0]),l),b=function(R,O,U,Z){const W=Z-U,J=R-U;return W===0?0:O===1?J/W:(Math.pow(O,J)-1)/(Math.pow(O,W)-1)}(l,h,c.stops[v][0],c.stops[v+1][0]),A=c.stops[v][1],C=c.stops[v+1][1],D=ia[i.type]||Qp;return typeof A.evaluate=="function"?{evaluate(...R){const O=A.evaluate.apply(void 0,R),U=C.evaluate.apply(void 0,R);if(O!==void 0&&U!==void 0)return D(O,U,b,c.colorSpace)}}:D(A,C,b,c.colorSpace)}function em(c,i,l){switch(i.type){case"color":l=zn.parse(l);break;case"formatted":l=Sr.fromString(l.toString());break;case"resolvedImage":l=qr.fromString(l.toString());break;case"padding":l=Zi.parse(l);break;case"colorArray":l=rr.parse(l);break;case"numberArray":l=Mr.parse(l);break;default:Rn(l)===i.type||i.type==="enum"&&i.values[l]||(l=void 0)}return $l(l,c.default,i.default)}pa.register(Hs,{error:[{kind:"error"},[vn],(c,[i])=>{throw new zi(i.evaluate(c))}],typeof:[vn,[on],(c,[i])=>An(dn(i.evaluate(c)))],"to-rgba":[hn(kt,4),[Dt],(c,[i])=>{const[l,h,g,v]=i.evaluate(c).rgb;return[255*l,255*h,255*g,v]}],rgb:[Dt,[kt,kt,kt],Wp],rgba:[Dt,[kt,kt,kt,kt],Wp],has:{type:rt,overloads:[[[vn],(c,[i])=>Yp(i.evaluate(c),c.properties())],[[vn,gi],(c,[i,l])=>Yp(i.evaluate(c),l.evaluate(c))]]},get:{type:on,overloads:[[[vn],(c,[i])=>pf(i.evaluate(c),c.properties())],[[vn,gi],(c,[i,l])=>pf(i.evaluate(c),l.evaluate(c))]]},"feature-state":[on,[vn],(c,[i])=>pf(i.evaluate(c),c.featureState||{})],properties:[gi,[],c=>c.properties()],"geometry-type":[vn,[],c=>c.geometryType()],id:[on,[],c=>c.id()],zoom:[kt,[],c=>c.globals.zoom],"heatmap-density":[kt,[],c=>c.globals.heatmapDensity||0],elevation:[kt,[],c=>c.globals.elevation||0],"line-progress":[kt,[],c=>c.globals.lineProgress||0],accumulated:[on,[],c=>c.globals.accumulated===void 0?null:c.globals.accumulated],"+":[kt,ss(kt),(c,i)=>{let l=0;for(const h of i)l+=h.evaluate(c);return l}],"*":[kt,ss(kt),(c,i)=>{let l=1;for(const h of i)l*=h.evaluate(c);return l}],"-":{type:kt,overloads:[[[kt,kt],(c,[i,l])=>i.evaluate(c)-l.evaluate(c)],[[kt],(c,[i])=>-i.evaluate(c)]]},"/":[kt,[kt,kt],(c,[i,l])=>i.evaluate(c)/l.evaluate(c)],"%":[kt,[kt,kt],(c,[i,l])=>i.evaluate(c)%l.evaluate(c)],ln2:[kt,[],()=>Math.LN2],pi:[kt,[],()=>Math.PI],e:[kt,[],()=>Math.E],"^":[kt,[kt,kt],(c,[i,l])=>Math.pow(i.evaluate(c),l.evaluate(c))],sqrt:[kt,[kt],(c,[i])=>Math.sqrt(i.evaluate(c))],log10:[kt,[kt],(c,[i])=>Math.log(i.evaluate(c))/Math.LN10],ln:[kt,[kt],(c,[i])=>Math.log(i.evaluate(c))],log2:[kt,[kt],(c,[i])=>Math.log(i.evaluate(c))/Math.LN2],sin:[kt,[kt],(c,[i])=>Math.sin(i.evaluate(c))],cos:[kt,[kt],(c,[i])=>Math.cos(i.evaluate(c))],tan:[kt,[kt],(c,[i])=>Math.tan(i.evaluate(c))],asin:[kt,[kt],(c,[i])=>Math.asin(i.evaluate(c))],acos:[kt,[kt],(c,[i])=>Math.acos(i.evaluate(c))],atan:[kt,[kt],(c,[i])=>Math.atan(i.evaluate(c))],min:[kt,ss(kt),(c,i)=>Math.min(...i.map(l=>l.evaluate(c)))],max:[kt,ss(kt),(c,i)=>Math.max(...i.map(l=>l.evaluate(c)))],abs:[kt,[kt],(c,[i])=>Math.abs(i.evaluate(c))],round:[kt,[kt],(c,[i])=>{const l=i.evaluate(c);return l<0?-Math.round(-l):Math.round(l)}],floor:[kt,[kt],(c,[i])=>Math.floor(i.evaluate(c))],ceil:[kt,[kt],(c,[i])=>Math.ceil(i.evaluate(c))],"filter-==":[rt,[vn,on],(c,[i,l])=>c.properties()[i.value]===l.value],"filter-id-==":[rt,[on],(c,[i])=>c.id()===i.value],"filter-type-==":[rt,[vn],(c,[i])=>c.geometryType()===i.value],"filter-<":[rt,[vn,on],(c,[i,l])=>{const h=c.properties()[i.value],g=l.value;return typeof h==typeof g&&h<g}],"filter-id-<":[rt,[on],(c,[i])=>{const l=c.id(),h=i.value;return typeof l==typeof h&&l<h}],"filter->":[rt,[vn,on],(c,[i,l])=>{const h=c.properties()[i.value],g=l.value;return typeof h==typeof g&&h>g}],"filter-id->":[rt,[on],(c,[i])=>{const l=c.id(),h=i.value;return typeof l==typeof h&&l>h}],"filter-<=":[rt,[vn,on],(c,[i,l])=>{const h=c.properties()[i.value],g=l.value;return typeof h==typeof g&&h<=g}],"filter-id-<=":[rt,[on],(c,[i])=>{const l=c.id(),h=i.value;return typeof l==typeof h&&l<=h}],"filter->=":[rt,[vn,on],(c,[i,l])=>{const h=c.properties()[i.value],g=l.value;return typeof h==typeof g&&h>=g}],"filter-id->=":[rt,[on],(c,[i])=>{const l=c.id(),h=i.value;return typeof l==typeof h&&l>=h}],"filter-has":[rt,[on],(c,[i])=>i.value in c.properties()],"filter-has-id":[rt,[],c=>c.id()!==null&&c.id()!==void 0],"filter-type-in":[rt,[hn(vn)],(c,[i])=>i.value.indexOf(c.geometryType())>=0],"filter-id-in":[rt,[hn(on)],(c,[i])=>i.value.indexOf(c.id())>=0],"filter-in-small":[rt,[vn,hn(on)],(c,[i,l])=>l.value.indexOf(c.properties()[i.value])>=0],"filter-in-large":[rt,[vn,hn(on)],(c,[i,l])=>function(h,g,v,b){for(;v<=b;){const A=v+b>>1;if(g[A]===h)return!0;g[A]>h?b=A-1:v=A+1}return!1}(c.properties()[i.value],l.value,0,l.value.length-1)],all:{type:rt,overloads:[[[rt,rt],(c,[i,l])=>i.evaluate(c)&&l.evaluate(c)],[ss(rt),(c,i)=>{for(const l of i)if(!l.evaluate(c))return!1;return!0}]]},any:{type:rt,overloads:[[[rt,rt],(c,[i,l])=>i.evaluate(c)||l.evaluate(c)],[ss(rt),(c,i)=>{for(const l of i)if(l.evaluate(c))return!0;return!1}]]},"!":[rt,[rt],(c,[i])=>!i.evaluate(c)],"is-supported-script":[rt,[vn],(c,[i])=>{const l=c.globals&&c.globals.isSupportedScript;return!l||l(i.evaluate(c))}],upcase:[vn,[vn],(c,[i])=>i.evaluate(c).toUpperCase()],downcase:[vn,[vn],(c,[i])=>i.evaluate(c).toLowerCase()],concat:[vn,ss(on),(c,i)=>i.map(l=>is(l.evaluate(c))).join("")],"resolved-locale":[vn,[Oe],(c,[i])=>i.evaluate(c).resolvedLocale()]});class _u{constructor(i,l){this.expression=i,this._warningHistory={},this._evaluator=new Rp,this._defaultValue=l?function(h){if(h.type==="color"&&ls(h.default))return new zn(0,0,0,0);switch(h.type){case"color":return zn.parse(h.default)||null;case"padding":return Zi.parse(h.default)||null;case"numberArray":return Mr.parse(h.default)||null;case"colorArray":return rr.parse(h.default)||null;case"variableAnchorOffsetCollection":return Hn.parse(h.default)||null;case"projectionDefinition":return xn.parse(h.default)||null;default:return h.default===void 0?null:h.default}}(l):null,this._enumValues=l&&l.type==="enum"?l.values:null}evaluateWithoutErrorHandling(i,l,h,g,v,b){return this._evaluator.globals=i,this._evaluator.feature=l,this._evaluator.featureState=h,this._evaluator.canonical=g,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=b,this.expression.evaluate(this._evaluator)}evaluate(i,l,h,g,v,b){this._evaluator.globals=i,this._evaluator.feature=l||null,this._evaluator.featureState=h||null,this._evaluator.canonical=g,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=b||null;try{const A=this.expression.evaluate(this._evaluator);if(A==null||typeof A=="number"&&A!=A)return this._defaultValue;if(this._enumValues&&!(A in this._enumValues))throw new zi(`Expected value to be one of ${Object.keys(this._enumValues).map(C=>JSON.stringify(C)).join(", ")}, but found ${JSON.stringify(A)} instead.`);return A}catch(A){return this._warningHistory[A.message]||(this._warningHistory[A.message]=!0,typeof console<"u"&&console.warn(A.message)),this._defaultValue}}}function yu(c){return Array.isArray(c)&&c.length>0&&typeof c[0]=="string"&&c[0]in Hs}function vu(c,i){const l=new Ll(Hs,mu,[],i?function(g){const v={color:Dt,string:vn,number:kt,enum:vn,boolean:rt,formatted:lt,padding:Ot,numberArray:gn,colorArray:cn,projectionDefinition:Ci,resolvedImage:mn,variableAnchorOffsetCollection:bn};return g.type==="array"?hn(v[g.value]||on,g.length):v[g.type]}(i):void 0),h=l.parse(c,void 0,void 0,void 0,i&&i.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?Xp(new _u(h,i)):Ws(l.errors)}class Wl{constructor(i,l){this.kind=i,this._styleExpression=l,this.isStateDependent=i!=="constant"&&!Hl(l.expression),this.globalStateRefs=Qs(l.expression)}evaluateWithoutErrorHandling(i,l,h,g,v,b){return this._styleExpression.evaluateWithoutErrorHandling(i,l,h,g,v,b)}evaluate(i,l,h,g,v,b){return this._styleExpression.evaluate(i,l,h,g,v,b)}}class bu{constructor(i,l,h,g){this.kind=i,this.zoomStops=h,this._styleExpression=l,this.isStateDependent=i!=="camera"&&!Hl(l.expression),this.globalStateRefs=Qs(l.expression),this.interpolationType=g}evaluateWithoutErrorHandling(i,l,h,g,v,b){return this._styleExpression.evaluateWithoutErrorHandling(i,l,h,g,v,b)}evaluate(i,l,h,g,v,b){return this._styleExpression.evaluate(i,l,h,g,v,b)}interpolationFactor(i,l,h){return this.interpolationType?Rr.interpolationFactor(this.interpolationType,i,l,h):0}}function _f(c,i){const l=vu(c,i);if(l.result==="error")return l;const h=l.value.expression,g=gu(h);if(!g&&!Ys(i))return Ws([new ci("","data expressions not supported")]);const v=$s(h,["zoom"]);if(!v&&!mf(i))return Ws([new ci("","zoom expressions not supported")]);const b=Xs(h);return b||v?b instanceof ci?Ws([b]):b instanceof Rr&&!gf(i)?Ws([new ci("",'"interpolate" expressions cannot be used with this property')]):Xp(b?new bu(g?"camera":"composite",l.value,b.labels,b instanceof Rr?b.interpolation:void 0):new Wl(g?"constant":"source",l.value)):Ws([new ci("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Yl{constructor(i,l){this._parameters=i,this._specification=l,mi(this,Kp(this._parameters,this._specification))}static deserialize(i){return new Yl(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function Xs(c){let i=null;if(c instanceof Bl)i=Xs(c.result);else if(c instanceof Hr){for(const l of c.args)if(i=Xs(l),i)break}else(c instanceof Us||c instanceof Rr)&&c.input instanceof pa&&c.input.name==="zoom"&&(i=c);return i instanceof ci||c.eachChild(l=>{const h=Xs(l);h instanceof ci?i=h:!i&&h?i=new ci("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&h&&i!==h&&(i=new ci("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}function Qs(c,i=new Set){return c instanceof Zl&&i.add(c.key),c.eachChild(l=>{Qs(l,i)}),i}function Xl(c){if(c===!0||c===!1)return!0;if(!Array.isArray(c)||c.length===0)return!1;switch(c[0]){case"has":return c.length>=2&&c[1]!=="$id"&&c[1]!=="$type";case"in":return c.length>=3&&(typeof c[1]!="string"||Array.isArray(c[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return c.length!==3||Array.isArray(c[1])||Array.isArray(c[2]);case"any":case"all":for(const i of c.slice(1))if(!Xl(i)&&typeof i!="boolean")return!1;return!0;default:return!0}}const yf={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Mo(c){if(c==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};Xl(c)||(c=xu(c));const i=vu(c,yf);if(i.result==="error")throw new Error(i.value.map(l=>`${l.key}: ${l.message}`).join(", "));return{filter:(l,h,g)=>i.value.evaluate(l,h,{},g),needGeometry:tm(c),getGlobalStateRefs:()=>Qs(i.value.expression)}}function Oy(c,i){return c<i?-1:c>i?1:0}function tm(c){if(!Array.isArray(c))return!1;if(c[0]==="within"||c[0]==="distance")return!0;for(let i=1;i<c.length;i++)if(tm(c[i]))return!0;return!1}function xu(c){if(!c)return!0;const i=c[0];return c.length<=1?i!=="any":i==="=="?vf(c[1],c[2],"=="):i==="!="?Ql(vf(c[1],c[2],"==")):i==="<"||i===">"||i==="<="||i===">="?vf(c[1],c[2],i):i==="any"?(l=c.slice(1),["any"].concat(l.map(xu))):i==="all"?["all"].concat(c.slice(1).map(xu)):i==="none"?["all"].concat(c.slice(1).map(xu).map(Ql)):i==="in"?nm(c[1],c.slice(2)):i==="!in"?Ql(nm(c[1],c.slice(2))):i==="has"?im(c[1]):i!=="!has"||Ql(im(c[1]));var l}function vf(c,i,l){switch(c){case"$type":return[`filter-type-${l}`,i];case"$id":return[`filter-id-${l}`,i];default:return[`filter-${l}`,c,i]}}function nm(c,i){if(i.length===0)return!1;switch(c){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(l=>typeof l!=typeof i[0])?["filter-in-large",c,["literal",i.sort(Oy)]]:["filter-in-small",c,["literal",i]]}}function im(c){switch(c){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",c]}}function Ql(c){return["!",c]}function wu(c){const i=typeof c;if(i==="number"||i==="boolean"||i==="string"||c==null)return JSON.stringify(c);if(Array.isArray(c)){let g="[";for(const v of c)g+=`${wu(v)},`;return`${g}]`}const l=Object.keys(c).sort();let h="{";for(let g=0;g<l.length;g++)h+=`${JSON.stringify(l[g])}:${wu(c[l[g]])},`;return`${h}}`}function Au(c){let i="";for(const l of Lt)i+=`/${wu(c[l])}`;return i}function rm(c){const i=c.value;return i?[new xt(c.key,i,"constants have been deprecated as of v8")]:[]}function Oi(c){return c instanceof Number||c instanceof String||c instanceof Boolean?c.valueOf():c}function Co(c){if(Array.isArray(c))return c.map(Co);if(c instanceof Object&&!(c instanceof Number||c instanceof String||c instanceof Boolean)){const i={};for(const l in c)i[l]=Co(c[l]);return i}return Oi(c)}function ma(c){const i=c.key,l=c.value,h=c.valueSpec||{},g=c.objectElementValidators||{},v=c.style,b=c.styleSpec,A=c.validateSpec;let C=[];const D=Rn(l);if(D!=="object")return[new xt(i,l,`object expected, ${D} found`)];for(const R in l){const O=R.split(".")[0],U=Tn(h,O)||h["*"];let Z;if(Tn(g,O))Z=g[O];else if(Tn(h,O))Z=A;else if(g["*"])Z=g["*"];else{if(!h["*"]){C.push(new xt(i,l[R],`unknown property "${R}"`));continue}Z=A}C=C.concat(Z({key:(i&&`${i}.`)+R,value:l[R],valueSpec:U,style:v,styleSpec:b,object:l,objectKey:R,validateSpec:A},l))}for(const R in h)g[R]||h[R].required&&h[R].default===void 0&&l[R]===void 0&&C.push(new xt(i,l,`missing required property "${R}"`));return C}function Tu(c){const i=c.value,l=c.valueSpec,h=c.style,g=c.styleSpec,v=c.key,b=c.arrayElementValidator||c.validateSpec;if(Rn(i)!=="array")return[new xt(v,i,`array expected, ${Rn(i)} found`)];if(l.length&&i.length!==l.length)return[new xt(v,i,`array length ${l.length} expected, length ${i.length} found`)];if(l["min-length"]&&i.length<l["min-length"])return[new xt(v,i,`array length at least ${l["min-length"]} expected, length ${i.length} found`)];let A={type:l.value,values:l.values};g.$version<7&&(A.function=l.function),Rn(l.value)==="object"&&(A=l.value);let C=[];for(let D=0;D<i.length;D++)C=C.concat(b({array:i,arrayIndex:D,value:i[D],valueSpec:A,validateSpec:c.validateSpec,style:h,styleSpec:g,key:`${v}[${D}]`}));return C}function Kl(c){const i=c.key,l=c.value,h=c.valueSpec;let g=Rn(l);return g==="number"&&l!=l&&(g="NaN"),g!=="number"?[new xt(i,l,`number expected, ${g} found`)]:"minimum"in h&&l<h.minimum?[new xt(i,l,`${l} is less than the minimum value ${h.minimum}`)]:"maximum"in h&&l>h.maximum?[new xt(i,l,`${l} is greater than the maximum value ${h.maximum}`)]:[]}function Ks(c){const i=c.valueSpec,l=Oi(c.value.type);let h,g,v,b={};const A=l!=="categorical"&&c.value.property===void 0,C=!A,D=Rn(c.value.stops)==="array"&&Rn(c.value.stops[0])==="array"&&Rn(c.value.stops[0][0])==="object",R=ma({key:c.key,value:c.value,valueSpec:c.styleSpec.function,validateSpec:c.validateSpec,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{stops:function(Z){if(l==="identity")return[new xt(Z.key,Z.value,'identity function may not have a "stops" property')];let W=[];const J=Z.value;return W=W.concat(Tu({key:Z.key,value:J,valueSpec:Z.valueSpec,validateSpec:Z.validateSpec,style:Z.style,styleSpec:Z.styleSpec,arrayElementValidator:O})),Rn(J)==="array"&&J.length===0&&W.push(new xt(Z.key,J,"array must have at least one stop")),W},default:function(Z){return Z.validateSpec({key:Z.key,value:Z.value,valueSpec:i,validateSpec:Z.validateSpec,style:Z.style,styleSpec:Z.styleSpec})}}});return l==="identity"&&A&&R.push(new xt(c.key,c.value,'missing required property "property"')),l==="identity"||c.value.stops||R.push(new xt(c.key,c.value,'missing required property "stops"')),l==="exponential"&&c.valueSpec.expression&&!gf(c.valueSpec)&&R.push(new xt(c.key,c.value,"exponential functions not supported")),c.styleSpec.$version>=8&&(C&&!Ys(c.valueSpec)?R.push(new xt(c.key,c.value,"property functions not supported")):A&&!mf(c.valueSpec)&&R.push(new xt(c.key,c.value,"zoom functions not supported"))),l!=="categorical"&&!D||c.value.property!==void 0||R.push(new xt(c.key,c.value,'"property" property is required')),R;function O(Z){let W=[];const J=Z.value,ie=Z.key;if(Rn(J)!=="array")return[new xt(ie,J,`array expected, ${Rn(J)} found`)];if(J.length!==2)return[new xt(ie,J,`array length 2 expected, length ${J.length} found`)];if(D){if(Rn(J[0])!=="object")return[new xt(ie,J,`object expected, ${Rn(J[0])} found`)];if(J[0].zoom===void 0)return[new xt(ie,J,"object stop key must have zoom")];if(J[0].value===void 0)return[new xt(ie,J,"object stop key must have value")];if(v&&v>Oi(J[0].zoom))return[new xt(ie,J[0].zoom,"stop zoom values must appear in ascending order")];Oi(J[0].zoom)!==v&&(v=Oi(J[0].zoom),g=void 0,b={}),W=W.concat(ma({key:`${ie}[0]`,value:J[0],valueSpec:{zoom:{}},validateSpec:Z.validateSpec,style:Z.style,styleSpec:Z.styleSpec,objectElementValidators:{zoom:Kl,value:U}}))}else W=W.concat(U({key:`${ie}[0]`,value:J[0],validateSpec:Z.validateSpec,style:Z.style,styleSpec:Z.styleSpec},J));return yu(Co(J[1]))?W.concat([new xt(`${ie}[1]`,J[1],"expressions are not allowed in function stops.")]):W.concat(Z.validateSpec({key:`${ie}[1]`,value:J[1],valueSpec:i,validateSpec:Z.validateSpec,style:Z.style,styleSpec:Z.styleSpec}))}function U(Z,W){const J=Rn(Z.value),ie=Oi(Z.value),fe=Z.value!==null?Z.value:W;if(h){if(J!==h)return[new xt(Z.key,fe,`${J} stop domain type must match previous stop domain type ${h}`)]}else h=J;if(J!=="number"&&J!=="string"&&J!=="boolean")return[new xt(Z.key,fe,"stop domain value must be a number, string, or boolean")];if(J!=="number"&&l!=="categorical"){let Me=`number expected, ${J} found`;return Ys(i)&&l===void 0&&(Me+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new xt(Z.key,fe,Me)]}return l!=="categorical"||J!=="number"||isFinite(ie)&&Math.floor(ie)===ie?l!=="categorical"&&J==="number"&&g!==void 0&&ie<g?[new xt(Z.key,fe,"stop domain values must appear in ascending order")]:(g=ie,l==="categorical"&&ie in b?[new xt(Z.key,fe,"stop domain values must be unique")]:(b[ie]=!0,[])):[new xt(Z.key,fe,`integer expected, found ${ie}`)]}}function Js(c){const i=(c.expressionContext==="property"?_f:vu)(Co(c.value),c.valueSpec);if(i.result==="error")return i.value.map(h=>new xt(`${c.key}${h.key}`,c.value,h.message));const l=i.value.expression||i.value._styleExpression.expression;if(c.expressionContext==="property"&&c.propertyKey==="text-font"&&!l.outputDefined())return[new xt(c.key,c.value,`Invalid data expression for "${c.propertyKey}". Output values must be contained as literals within the expression.`)];if(c.expressionContext==="property"&&c.propertyType==="layout"&&!Hl(l))return[new xt(c.key,c.value,'"feature-state" data expressions are not supported with layout properties.')];if(c.expressionContext==="filter"&&!Hl(l))return[new xt(c.key,c.value,'"feature-state" data expressions are not supported with filters.')];if(c.expressionContext&&c.expressionContext.indexOf("cluster")===0){if(!$s(l,["zoom","feature-state"]))return[new xt(c.key,c.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(c.expressionContext==="cluster-initial"&&!gu(l))return[new xt(c.key,c.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function bf(c){const i=c.key,l=c.value,h=Rn(l);return h!=="string"?[new xt(i,l,`color expected, ${h} found`)]:zn.parse(String(l))?[]:[new xt(i,l,`color expected, "${l}" found`)]}function Jl(c){const i=c.key,l=c.value,h=c.valueSpec,g=[];return Array.isArray(h.values)?h.values.indexOf(Oi(l))===-1&&g.push(new xt(i,l,`expected one of [${h.values.join(", ")}], ${JSON.stringify(l)} found`)):Object.keys(h.values).indexOf(Oi(l))===-1&&g.push(new xt(i,l,`expected one of [${Object.keys(h.values).join(", ")}], ${JSON.stringify(l)} found`)),g}function xf(c){return Xl(Co(c.value))?Js(mi({},c,{expressionContext:"filter",valueSpec:{value:"boolean"}})):am(c)}function am(c){const i=c.value,l=c.key;if(Rn(i)!=="array")return[new xt(l,i,`array expected, ${Rn(i)} found`)];const h=c.styleSpec;let g,v=[];if(i.length<1)return[new xt(l,i,"filter array must have at least 1 element")];switch(v=v.concat(Jl({key:`${l}[0]`,value:i[0],valueSpec:h.filter_operator,style:c.style,styleSpec:c.styleSpec})),Oi(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&Oi(i[1])==="$type"&&v.push(new xt(l,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":i.length!==3&&v.push(new xt(l,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(g=Rn(i[1]),g!=="string"&&v.push(new xt(`${l}[1]`,i[1],`string expected, ${g} found`)));for(let b=2;b<i.length;b++)g=Rn(i[b]),Oi(i[1])==="$type"?v=v.concat(Jl({key:`${l}[${b}]`,value:i[b],valueSpec:h.geometry_type,style:c.style,styleSpec:c.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&v.push(new xt(`${l}[${b}]`,i[b],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let b=1;b<i.length;b++)v=v.concat(am({key:`${l}[${b}]`,value:i[b],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":g=Rn(i[1]),i.length!==2?v.push(new xt(l,i,`filter array for "${i[0]}" operator must have 2 elements`)):g!=="string"&&v.push(new xt(`${l}[1]`,i[1],`string expected, ${g} found`))}return v}function om(c,i){const l=c.key,h=c.validateSpec,g=c.style,v=c.styleSpec,b=c.value,A=c.objectKey,C=v[`${i}_${c.layerType}`];if(!C)return[];const D=A.match(/^(.*)-transition$/);if(i==="paint"&&D&&C[D[1]]&&C[D[1]].transition)return h({key:l,value:b,valueSpec:v.transition,style:g,styleSpec:v});const R=c.valueSpec||C[A];if(!R)return[new xt(l,b,`unknown property "${A}"`)];let O;if(Rn(b)==="string"&&Ys(R)&&!R.tokens&&(O=/^{([^}]+)}$/.exec(b)))return[new xt(l,b,`"${A}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(O[1])} }\`.`)];const U=[];return c.layerType==="symbol"&&(A==="text-field"&&g&&!g.glyphs&&U.push(new xt(l,b,'use of "text-field" requires a style "glyphs" property')),A==="text-font"&&ls(Co(b))&&Oi(b.type)==="identity"&&U.push(new xt(l,b,'"text-font" does not support identity functions'))),U.concat(h({key:c.key,value:b,valueSpec:R,style:g,styleSpec:v,expressionContext:"property",propertyType:i,propertyKey:A}))}function el(c){return om(c,"paint")}function tl(c){return om(c,"layout")}function $r(c){let i=[];const l=c.value,h=c.key,g=c.style,v=c.styleSpec;if(Rn(l)!=="object")return[new xt(h,l,`object expected, ${Rn(l)} found`)];l.type||l.ref||i.push(new xt(h,l,'either "type" or "ref" is required'));let b=Oi(l.type);const A=Oi(l.ref);if(l.id){const C=Oi(l.id);for(let D=0;D<c.arrayIndex;D++){const R=g.layers[D];Oi(R.id)===C&&i.push(new xt(h,l.id,`duplicate layer id "${l.id}", previously used at line ${R.id.__line__}`))}}if("ref"in l){let C;["type","source","source-layer","filter","layout"].forEach(D=>{D in l&&i.push(new xt(h,l[D],`"${D}" is prohibited for ref layers`))}),g.layers.forEach(D=>{Oi(D.id)===A&&(C=D)}),C?C.ref?i.push(new xt(h,l.ref,"ref cannot reference another ref layer")):b=Oi(C.type):i.push(new xt(h,l.ref,`ref layer "${A}" not found`))}else if(b!=="background")if(l.source){const C=g.sources&&g.sources[l.source],D=C&&Oi(C.type);C?D==="vector"&&b==="raster"?i.push(new xt(h,l.source,`layer "${l.id}" requires a raster source`)):D!=="raster-dem"&&b==="hillshade"||D!=="raster-dem"&&b==="color-relief"?i.push(new xt(h,l.source,`layer "${l.id}" requires a raster-dem source`)):D==="raster"&&b!=="raster"?i.push(new xt(h,l.source,`layer "${l.id}" requires a vector source`)):D!=="vector"||l["source-layer"]?D==="raster-dem"&&b!=="hillshade"&&b!=="color-relief"?i.push(new xt(h,l.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):b!=="line"||!l.paint||!l.paint["line-gradient"]||D==="geojson"&&C.lineMetrics||i.push(new xt(h,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new xt(h,l,`layer "${l.id}" must specify a "source-layer"`)):i.push(new xt(h,l.source,`source "${l.source}" not found`))}else i.push(new xt(h,l,'missing required property "source"'));return i=i.concat(ma({key:h,value:l,valueSpec:v.layer,style:c.style,styleSpec:c.styleSpec,validateSpec:c.validateSpec,objectElementValidators:{"*":()=>[],type:()=>c.validateSpec({key:`${h}.type`,value:l.type,valueSpec:v.layer.type,style:c.style,styleSpec:c.styleSpec,validateSpec:c.validateSpec,object:l,objectKey:"type"}),filter:xf,layout:C=>ma({layer:l,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,validateSpec:C.validateSpec,objectElementValidators:{"*":D=>tl(mi({layerType:b},D))}}),paint:C=>ma({layer:l,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,validateSpec:C.validateSpec,objectElementValidators:{"*":D=>el(mi({layerType:b},D))}})}})),i}function wa(c){const i=c.value,l=c.key,h=Rn(i);return h!=="string"?[new xt(l,i,`string expected, ${h} found`)]:[]}const wf={promoteId:function({key:c,value:i}){if(Rn(i)==="string")return wa({key:c,value:i});{const l=[];for(const h in i)l.push(...wa({key:`${c}.${h}`,value:i[h]}));return l}}};function sm(c){const i=c.value,l=c.key,h=c.styleSpec,g=c.style,v=c.validateSpec;if(!i.type)return[new xt(l,i,'"type" is required')];const b=Oi(i.type);let A;switch(b){case"vector":case"raster":return A=ma({key:l,value:i,valueSpec:h[`source_${b.replace("-","_")}`],style:c.style,styleSpec:h,objectElementValidators:wf,validateSpec:v}),A;case"raster-dem":return A=function(C){var D;const R=(D=C.sourceName)!==null&&D!==void 0?D:"",O=C.value,U=C.styleSpec,Z=U.source_raster_dem,W=C.style;let J=[];const ie=Rn(O);if(O===void 0)return J;if(ie!=="object")return J.push(new xt("source_raster_dem",O,`object expected, ${ie} found`)),J;const fe=Oi(O.encoding)==="custom",Me=["redFactor","greenFactor","blueFactor","baseShift"],ye=C.value.encoding?`"${C.value.encoding}"`:"Default";for(const q in O)!fe&&Me.includes(q)?J.push(new xt(q,O[q],`In "${R}": "${q}" is only valid when "encoding" is set to "custom". ${ye} encoding found`)):Z[q]?J=J.concat(C.validateSpec({key:q,value:O[q],valueSpec:Z[q],validateSpec:C.validateSpec,style:W,styleSpec:U})):J.push(new xt(q,O[q],`unknown property "${q}"`));return J}({sourceName:l,value:i,style:c.style,styleSpec:h,validateSpec:v}),A;case"geojson":if(A=ma({key:l,value:i,valueSpec:h.source_geojson,style:g,styleSpec:h,validateSpec:v,objectElementValidators:wf}),i.cluster)for(const C in i.clusterProperties){const[D,R]=i.clusterProperties[C],O=typeof D=="string"?[D,["accumulated"],["get",C]]:D;A.push(...Js({key:`${l}.${C}.map`,value:R,expressionContext:"cluster-map"})),A.push(...Js({key:`${l}.${C}.reduce`,value:O,expressionContext:"cluster-reduce"}))}return A;case"video":return ma({key:l,value:i,valueSpec:h.source_video,style:g,validateSpec:v,styleSpec:h});case"image":return ma({key:l,value:i,valueSpec:h.source_image,style:g,validateSpec:v,styleSpec:h});case"canvas":return[new xt(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Jl({key:`${l}.type`,value:i.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function lm(c){const i=c.value,l=c.styleSpec,h=l.light,g=c.style;let v=[];const b=Rn(i);if(i===void 0)return v;if(b!=="object")return v=v.concat([new xt("light",i,`object expected, ${b} found`)]),v;for(const A in i){const C=A.match(/^(.*)-transition$/);v=v.concat(C&&h[C[1]]&&h[C[1]].transition?c.validateSpec({key:A,value:i[A],valueSpec:l.transition,validateSpec:c.validateSpec,style:g,styleSpec:l}):h[A]?c.validateSpec({key:A,value:i[A],valueSpec:h[A],validateSpec:c.validateSpec,style:g,styleSpec:l}):[new xt(A,i[A],`unknown property "${A}"`)])}return v}function nl(c){const i=c.value,l=c.styleSpec,h=l.sky,g=c.style,v=Rn(i);if(i===void 0)return[];if(v!=="object")return[new xt("sky",i,`object expected, ${v} found`)];let b=[];for(const A in i)b=b.concat(h[A]?c.validateSpec({key:A,value:i[A],valueSpec:h[A],style:g,styleSpec:l}):[new xt(A,i[A],`unknown property "${A}"`)]);return b}function Af(c){const i=c.value,l=c.styleSpec,h=l.terrain,g=c.style;let v=[];const b=Rn(i);if(i===void 0)return v;if(b!=="object")return v=v.concat([new xt("terrain",i,`object expected, ${b} found`)]),v;for(const A in i)v=v.concat(h[A]?c.validateSpec({key:A,value:i[A],valueSpec:h[A],validateSpec:c.validateSpec,style:g,styleSpec:l}):[new xt(A,i[A],`unknown property "${A}"`)]);return v}function Su(c){let i=[];const l=c.value,h=c.key;if(Array.isArray(l)){const g=[],v=[];for(const b in l)l[b].id&&g.includes(l[b].id)&&i.push(new xt(h,l,`all the sprites' ids must be unique, but ${l[b].id} is duplicated`)),g.push(l[b].id),l[b].url&&v.includes(l[b].url)&&i.push(new xt(h,l,`all the sprites' URLs must be unique, but ${l[b].url} is duplicated`)),v.push(l[b].url),i=i.concat(ma({key:`${h}[${b}]`,value:l[b],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:c.validateSpec}));return i}return wa({key:h,value:l})}function cm(c){return i=c.value,i&&i.constructor===Object?[]:[new xt(c.key,c.value,`object expected, ${Rn(c.value)} found`)];var i}const Mu={"*":()=>[],array:Tu,boolean:function(c){const i=c.value,l=c.key,h=Rn(i);return h!=="boolean"?[new xt(l,i,`boolean expected, ${h} found`)]:[]},number:Kl,color:bf,constants:rm,enum:Jl,filter:xf,function:Ks,layer:$r,object:ma,source:sm,light:lm,sky:nl,terrain:Af,projection:function(c){const i=c.value,l=c.styleSpec,h=l.projection,g=c.style,v=Rn(i);if(i===void 0)return[];if(v!=="object")return[new xt("projection",i,`object expected, ${v} found`)];let b=[];for(const A in i)b=b.concat(h[A]?c.validateSpec({key:A,value:i[A],valueSpec:h[A],style:g,styleSpec:l}):[new xt(A,i[A],`unknown property "${A}"`)]);return b},projectionDefinition:function(c){const i=c.key;let l=c.value;l=l instanceof String?l.valueOf():l;const h=Rn(l);return h!=="array"||function(g){return Array.isArray(g)&&g.length===3&&typeof g[0]=="string"&&typeof g[1]=="string"&&typeof g[2]=="number"}(l)||function(g){return!!["interpolate","step","literal"].includes(g[0])}(l)?["array","string"].includes(h)?[]:[new xt(i,l,`projection expected, invalid type "${h}" found`)]:[new xt(i,l,`projection expected, invalid array ${JSON.stringify(l)} found`)]},string:wa,formatted:function(c){return wa(c).length===0?[]:Js(c)},resolvedImage:function(c){return wa(c).length===0?[]:Js(c)},padding:function(c){const i=c.key,l=c.value;if(Rn(l)==="array"){if(l.length<1||l.length>4)return[new xt(i,l,`padding requires 1 to 4 values; ${l.length} values found`)];const h={type:"number"};let g=[];for(let v=0;v<l.length;v++)g=g.concat(c.validateSpec({key:`${i}[${v}]`,value:l[v],validateSpec:c.validateSpec,valueSpec:h}));return g}return Kl({key:i,value:l,valueSpec:{}})},numberArray:function(c){const i=c.key,l=c.value;if(Rn(l)==="array"){const h={type:"number"};if(l.length<1)return[new xt(i,l,"array length at least 1 expected, length 0 found")];let g=[];for(let v=0;v<l.length;v++)g=g.concat(c.validateSpec({key:`${i}[${v}]`,value:l[v],validateSpec:c.validateSpec,valueSpec:h}));return g}return Kl({key:i,value:l,valueSpec:{}})},colorArray:function(c){const i=c.key,l=c.value;if(Rn(l)==="array"){if(l.length<1)return[new xt(i,l,"array length at least 1 expected, length 0 found")];let h=[];for(let g=0;g<l.length;g++)h=h.concat(bf({key:`${i}[${g}]`,value:l[g]}));return h}return bf({key:i,value:l})},variableAnchorOffsetCollection:function(c){const i=c.key,l=c.value,h=Rn(l),g=c.styleSpec;if(h!=="array"||l.length<1||l.length%2!=0)return[new xt(i,l,"variableAnchorOffsetCollection requires a non-empty array of even length")];let v=[];for(let b=0;b<l.length;b+=2)v=v.concat(Jl({key:`${i}[${b}]`,value:l[b],valueSpec:g.layout_symbol["text-anchor"]})),v=v.concat(Tu({key:`${i}[${b+1}]`,value:l[b+1],valueSpec:{length:2,value:"number"},validateSpec:c.validateSpec,style:c.style,styleSpec:g}));return v},sprite:Su,state:cm};function Cu(c){const i=c.value,l=c.valueSpec,h=c.styleSpec;return c.validateSpec=Cu,l.expression&&ls(Oi(i))?Ks(c):l.expression&&yu(Co(i))?Js(c):l.type&&Mu[l.type]?Mu[l.type](c):ma(mi({},c,{valueSpec:l.type?h[l.type]:l}))}function il(c){const i=c.value,l=c.key,h=wa(c);return h.length||(i.indexOf("{fontstack}")===-1&&h.push(new xt(l,i,'"glyphs" url must include a "{fontstack}" token')),i.indexOf("{range}")===-1&&h.push(new xt(l,i,'"glyphs" url must include a "{range}" token'))),h}function ga(c,i=Ae){let l=[];return l=l.concat(Cu({key:"",value:c,valueSpec:i.$root,styleSpec:i,style:c,validateSpec:Cu,objectElementValidators:{glyphs:il,"*":()=>[]}})),c.constants&&(l=l.concat(rm({key:"constants",value:c.constants}))),um(l)}function Aa(c){return function(i){return c({...i,validateSpec:Cu})}}function um(c){return[].concat(c).sort((i,l)=>i.line-l.line)}function Lr(c){return function(...i){return um(c.apply(this,i))}}ga.source=Lr(Aa(sm)),ga.sprite=Lr(Aa(Su)),ga.glyphs=Lr(Aa(il)),ga.light=Lr(Aa(lm)),ga.sky=Lr(Aa(nl)),ga.terrain=Lr(Aa(Af)),ga.state=Lr(Aa(cm)),ga.layer=Lr(Aa($r)),ga.filter=Lr(Aa(xf)),ga.paintProperty=Lr(Aa(el)),ga.layoutProperty=Lr(Aa(tl));const rl=ga,Ny=rl.light,Iu=rl.sky,jy=rl.paintProperty,Tf=rl.layoutProperty;function ec(c,i){let l=!1;if(i&&i.length)for(const h of i)c.fire(new Le(new Error(h.message))),l=!0;return l}class al{constructor(i,l,h){const g=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;const b=new Int32Array(this.arrayBuffer);i=b[0],this.d=(l=b[1])+2*(h=b[2]);for(let C=0;C<this.d*this.d;C++){const D=b[3+C],R=b[3+C+1];g.push(D===R?null:b.subarray(D,R))}const A=b[3+g.length+1];this.keys=b.subarray(b[3+g.length],A),this.bboxes=b.subarray(A),this.insert=this._insertReadonly}else{this.d=l+2*h;for(let b=0;b<this.d*this.d;b++)g.push([]);this.keys=[],this.bboxes=[]}this.n=l,this.extent=i,this.padding=h,this.scale=l/i,this.uid=0;const v=h/l*i;this.min=-v,this.max=i+v}insert(i,l,h,g,v){this._forEachCell(l,h,g,v,this._insertCell,this.uid++,void 0,void 0),this.keys.push(i),this.bboxes.push(l),this.bboxes.push(h),this.bboxes.push(g),this.bboxes.push(v)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(i,l,h,g,v,b){this.cells[v].push(b)}query(i,l,h,g,v){const b=this.min,A=this.max;if(i<=b&&l<=b&&A<=h&&A<=g&&!v)return Array.prototype.slice.call(this.keys);{const C=[];return this._forEachCell(i,l,h,g,this._queryCell,C,{},v),C}}_queryCell(i,l,h,g,v,b,A,C){const D=this.cells[v];if(D!==null){const R=this.keys,O=this.bboxes;for(let U=0;U<D.length;U++){const Z=D[U];if(A[Z]===void 0){const W=4*Z;(C?C(O[W+0],O[W+1],O[W+2],O[W+3]):i<=O[W+2]&&l<=O[W+3]&&h>=O[W+0]&&g>=O[W+1])?(A[Z]=!0,b.push(R[Z])):A[Z]=!1}}}}_forEachCell(i,l,h,g,v,b,A,C){const D=this._convertToCellCoord(i),R=this._convertToCellCoord(l),O=this._convertToCellCoord(h),U=this._convertToCellCoord(g);for(let Z=D;Z<=O;Z++)for(let W=R;W<=U;W++){const J=this.d*W+Z;if((!C||C(this._convertFromCellCoord(Z),this._convertFromCellCoord(W),this._convertFromCellCoord(Z+1),this._convertFromCellCoord(W+1)))&&v.call(this,i,l,h,g,J,b,A,C))return}}_convertFromCellCoord(i){return(i-this.padding)/this.scale}_convertToCellCoord(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const i=this.cells,l=3+this.cells.length+1+1;let h=0;for(let b=0;b<this.cells.length;b++)h+=this.cells[b].length;const g=new Int32Array(l+h+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;let v=l;for(let b=0;b<i.length;b++){const A=i[b];g[3+b]=v,g.set(A,v),v+=A.length}return g[3+i.length]=v,g.set(this.keys,v),v+=this.keys.length,g[3+i.length+1]=v,g.set(this.bboxes,v),v+=this.bboxes.length,g.buffer}static serialize(i,l){const h=i.toArrayBuffer();return l&&l.push(h),{buffer:h}}static deserialize(i){return new al(i.buffer)}}const Na={};function Gt(c,i,l={}){if(Na[c])throw new Error(`${c} is already registered.`);Object.defineProperty(i,"_classRegistryKey",{value:c,writeable:!1}),Na[c]={klass:i,omit:l.omit||[],shallow:l.shallow||[]}}Gt("Object",Object),Gt("Set",Set),Gt("TransferableGridIndex",al),Gt("Color",zn),Gt("Error",Error),Gt("AJAXError",pe),Gt("ResolvedImage",qr),Gt("StylePropertyFunction",Yl),Gt("StyleExpression",_u,{omit:["_evaluator"]}),Gt("ZoomDependentExpression",bu),Gt("ZoomConstantExpression",Wl),Gt("CompoundExpression",pa,{omit:["_evaluate"]});for(const c in Hs)Hs[c]._classRegistryKey||Gt(`Expression_${c}`,Hs[c]);function Sf(c){return c&&typeof ArrayBuffer<"u"&&(c instanceof ArrayBuffer||c.constructor&&c.constructor.name==="ArrayBuffer")}function tc(c){return c.$name||c.constructor._classRegistryKey}function Mf(c){return!function(i){if(i===null||typeof i!="object")return!1;const l=tc(i);return!(!l||l==="Object")}(c)&&(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||c instanceof Blob||c instanceof Error||Sf(c)||_n(c)||ArrayBuffer.isView(c)||c instanceof ImageData)}function nc(c,i){if(Mf(c))return(Sf(c)||_n(c))&&i&&i.push(c),ArrayBuffer.isView(c)&&i&&i.push(c.buffer),c instanceof ImageData&&i&&i.push(c.data.buffer),c;if(Array.isArray(c)){const v=[];for(const b of c)v.push(nc(b,i));return v}if(typeof c!="object")throw new Error("can't serialize object of type "+typeof c);const l=tc(c);if(!l)throw new Error(`can't serialize object of unregistered class ${c.constructor.name}`);if(!Na[l])throw new Error(`${l} is not registered.`);const{klass:h}=Na[l],g=h.serialize?h.serialize(c,i):{};if(h.serialize){if(i&&g===i[i.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const v in c){if(!c.hasOwnProperty(v)||Na[l].omit.indexOf(v)>=0)continue;const b=c[v];g[v]=Na[l].shallow.indexOf(v)>=0?b:nc(b,i)}c instanceof Error&&(g.message=c.message)}if(g.$name)throw new Error("$name property is reserved for worker serialization logic.");return l!=="Object"&&(g.$name=l),g}function ol(c){if(Mf(c))return c;if(Array.isArray(c))return c.map(ol);if(typeof c!="object")throw new Error("can't deserialize object of type "+typeof c);const i=tc(c)||"Object";if(!Na[i])throw new Error(`can't deserialize unregistered class ${i}`);const{klass:l}=Na[i];if(!l)throw new Error(`can't deserialize unregistered class ${i}`);if(l.deserialize)return l.deserialize(c);const h=Object.create(l.prototype);for(const g of Object.keys(c)){if(g==="$name")continue;const v=c[g];h[g]=Na[i].shallow.indexOf(g)>=0?v:ol(v)}return h}class Cf{constructor(){this.first=!0}update(i,l){const h=Math.floor(i);return this.first?(this.first=!1,this.lastIntegerZoom=h,this.lastIntegerZoomTime=0,this.lastZoom=i,this.lastFloorZoom=h,!0):(this.lastFloorZoom>h?(this.lastIntegerZoom=h+1,this.lastIntegerZoomTime=l):this.lastFloorZoom<h&&(this.lastIntegerZoom=h,this.lastIntegerZoomTime=l),i!==this.lastZoom&&(this.lastZoom=i,this.lastFloorZoom=h,!0))}}const Ln={"Latin-1 Supplement":c=>c>=128&&c<=255,"Hangul Jamo":c=>c>=4352&&c<=4607,Khmer:c=>c>=6016&&c<=6143,"General Punctuation":c=>c>=8192&&c<=8303,"Letterlike Symbols":c=>c>=8448&&c<=8527,"Number Forms":c=>c>=8528&&c<=8591,"Miscellaneous Technical":c=>c>=8960&&c<=9215,"Control Pictures":c=>c>=9216&&c<=9279,"Optical Character Recognition":c=>c>=9280&&c<=9311,"Enclosed Alphanumerics":c=>c>=9312&&c<=9471,"Geometric Shapes":c=>c>=9632&&c<=9727,"Miscellaneous Symbols":c=>c>=9728&&c<=9983,"Miscellaneous Symbols and Arrows":c=>c>=11008&&c<=11263,"Ideographic Description Characters":c=>c>=12272&&c<=12287,"CJK Symbols and Punctuation":c=>c>=12288&&c<=12351,Hiragana:c=>c>=12352&&c<=12447,Katakana:c=>c>=12448&&c<=12543,Kanbun:c=>c>=12688&&c<=12703,"CJK Strokes":c=>c>=12736&&c<=12783,"Enclosed CJK Letters and Months":c=>c>=12800&&c<=13055,"CJK Compatibility":c=>c>=13056&&c<=13311,"Yijing Hexagram Symbols":c=>c>=19904&&c<=19967,"CJK Unified Ideographs":c=>c>=19968&&c<=40959,"Hangul Syllables":c=>c>=44032&&c<=55215,"Private Use Area":c=>c>=57344&&c<=63743,"Vertical Forms":c=>c>=65040&&c<=65055,"CJK Compatibility Forms":c=>c>=65072&&c<=65103,"Small Form Variants":c=>c>=65104&&c<=65135,"Halfwidth and Fullwidth Forms":c=>c>=65280&&c<=65519};function If(c){for(const i of c)if(Pu(i.charCodeAt(0)))return!0;return!1}function hm(c){for(const i of c)if(!Vy(i.charCodeAt(0)))return!1;return!0}function Eu(c){const i=c.map(l=>{try{return new RegExp(`\\p{sc=${l}}`,"u").source}catch{return null}}).filter(l=>l);return new RegExp(i.join("|"),"u")}const Uy=Eu(["Arab","Dupl","Mong","Ougr","Syrc"]);function Vy(c){return!Uy.test(String.fromCodePoint(c))}const Ef=Eu(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Pu(c){return!(c!==746&&c!==747&&(c<4352||!(Ln["CJK Compatibility Forms"](c)&&!(c>=65097&&c<=65103)||Ln["CJK Compatibility"](c)||Ln["CJK Strokes"](c)||!(!Ln["CJK Symbols and Punctuation"](c)||c>=12296&&c<=12305||c>=12308&&c<=12319||c===12336)||Ln["Enclosed CJK Letters and Months"](c)||Ln["Ideographic Description Characters"](c)||Ln.Kanbun(c)||Ln.Katakana(c)&&c!==12540||!(!Ln["Halfwidth and Fullwidth Forms"](c)||c===65288||c===65289||c===65293||c>=65306&&c<=65310||c===65339||c===65341||c===65343||c>=65371&&c<=65503||c===65507||c>=65512&&c<=65519)||!(!Ln["Small Form Variants"](c)||c>=65112&&c<=65118||c>=65123&&c<=65126)||Ln["Vertical Forms"](c)||Ln["Yijing Hexagram Symbols"](c)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(c))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(c))||Ef.test(String.fromCodePoint(c)))))}function Pf(c){return!(Pu(c)||function(i){return!!(Ln["Latin-1 Supplement"](i)&&(i===167||i===169||i===174||i===177||i===188||i===189||i===190||i===215||i===247)||Ln["General Punctuation"](i)&&(i===8214||i===8224||i===8225||i===8240||i===8241||i===8251||i===8252||i===8258||i===8263||i===8264||i===8265||i===8273)||Ln["Letterlike Symbols"](i)||Ln["Number Forms"](i)||Ln["Miscellaneous Technical"](i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||i===9003||i>=9085&&i<=9114||i>=9150&&i<=9165||i===9167||i>=9169&&i<=9179||i>=9186&&i<=9215)||Ln["Control Pictures"](i)&&i!==9251||Ln["Optical Character Recognition"](i)||Ln["Enclosed Alphanumerics"](i)||Ln["Geometric Shapes"](i)||Ln["Miscellaneous Symbols"](i)&&!(i>=9754&&i<=9759)||Ln["Miscellaneous Symbols and Arrows"](i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||Ln["CJK Symbols and Punctuation"](i)||Ln.Katakana(i)||Ln["Private Use Area"](i)||Ln["CJK Compatibility Forms"](i)||Ln["Small Form Variants"](i)||Ln["Halfwidth and Fullwidth Forms"](i)||i===8734||i===8756||i===8757||i>=9984&&i<=10087||i>=10102&&i<=10131||i===65532||i===65533)}(c))}const fm=Eu(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function ic(c){return fm.test(String.fromCodePoint(c))}function Gy(c,i){return!(!i&&ic(c)||c>=2304&&c<=3583||c>=3840&&c<=4255||Ln.Khmer(c))}function kf(c){for(const i of c)if(ic(i.charCodeAt(0)))return!0;return!1}const Io=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(c){this.pluginStatus=c.pluginStatus,this.pluginURL=c.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(c){if(Io.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=c.applyArabicShaping,this.processBidirectionalText=c.processBidirectionalText,this.processStyledBidirectionalText=c.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(c,i){return a(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(c.pluginStatus!=="loading")return this.setState(c),c;const l=c.pluginURL,h=new Promise(v=>{this.loadScriptResolve=v});i(l);const g=new Promise(v=>setTimeout(()=>v(),this.TIMEOUT));if(yield Promise.race([h,g]),this.isParsed()){const v={pluginStatus:"loaded",pluginURL:l};return this.setState(v),v}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${l}`)})}};class Pi{constructor(i,l){this.zoom=i,l?(this.now=l.now||0,this.fadeDuration=l.fadeDuration||0,this.zoomHistory=l.zoomHistory||new Cf,this.transition=l.transition||{},this.globalState=l.globalState||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Cf,this.transition={},this.globalState={})}isSupportedScript(i){return function(l,h){for(const g of l)if(!Gy(g.charCodeAt(0),h))return!1;return!0}(i,Io.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const i=this.zoom,l=i-Math.floor(i),h=this.crossFadingFactor();return i>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:l+(1-l)*h}:{fromScale:.5,toScale:1,t:1-(1-h)*l}}}class rc{constructor(i,l){this.property=i,this.value=l,this.expression=function(h,g){if(ls(h))return new Yl(h,g);if(yu(h)){const v=_f(h,g);if(v.result==="error")throw new Error(v.value.map(b=>`${b.key}: ${b.message}`).join(", "));return v.value}{let v=h;return g.type==="color"&&typeof h=="string"?v=zn.parse(h):g.type!=="padding"||typeof h!="number"&&!Array.isArray(h)?g.type!=="numberArray"||typeof h!="number"&&!Array.isArray(h)?g.type!=="colorArray"||typeof h!="string"&&!Array.isArray(h)?g.type==="variableAnchorOffsetCollection"&&Array.isArray(h)?v=Hn.parse(h):g.type==="projectionDefinition"&&typeof h=="string"&&(v=xn.parse(h)):v=rr.parse(h):v=Mr.parse(h):v=Zi.parse(h),{globalStateRefs:new Set,kind:"constant",evaluate:()=>v}}}(l===void 0?i.specification.default:l,i.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(i,l,h){return this.property.possiblyEvaluate(this,i,l,h)}}class ku{constructor(i){this.property=i,this.value=new rc(i,void 0)}transitioned(i,l){return new dm(this.property,this.value,l,Ke({},i.transition,this.transition),i.now)}untransitioned(){return new dm(this.property,this.value,null,{},0)}}class Df{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues)}getValue(i){return Rt(this._values[i].value.value)}setValue(i,l){Object.prototype.hasOwnProperty.call(this._values,i)||(this._values[i]=new ku(this._values[i].property)),this._values[i].value=new rc(this._values[i].property,l===null?void 0:Rt(l))}getTransition(i){return Rt(this._values[i].transition)}setTransition(i,l){Object.prototype.hasOwnProperty.call(this._values,i)||(this._values[i]=new ku(this._values[i].property)),this._values[i].transition=Rt(l)||void 0}serialize(){const i={};for(const l of Object.keys(this._values)){const h=this.getValue(l);h!==void 0&&(i[l]=h);const g=this.getTransition(l);g!==void 0&&(i[`${l}-transition`]=g)}return i}transitioned(i,l){const h=new pm(this._properties);for(const g of Object.keys(this._values))h._values[g]=this._values[g].transitioned(i,l._values[g]);return h}untransitioned(){const i=new pm(this._properties);for(const l of Object.keys(this._values))i._values[l]=this._values[l].untransitioned();return i}}class dm{constructor(i,l,h,g,v){this.property=i,this.value=l,this.begin=v+g.delay||0,this.end=this.begin+g.duration||0,i.specification.transition&&(g.delay||g.duration)&&(this.prior=h)}possiblyEvaluate(i,l,h){const g=i.now||0,v=this.value.possiblyEvaluate(i,l,h),b=this.prior;if(b){if(g>this.end)return this.prior=null,v;if(this.value.isDataDriven())return this.prior=null,v;if(g<this.begin)return b.possiblyEvaluate(i,l,h);{const A=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(i,l,h),v,St(A))}}return v}}class pm{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,l,h){const g=new Du(this._properties);for(const v of Object.keys(this._values))g._values[v]=this._values[v].possiblyEvaluate(i,l,h);return g}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class qy{constructor(i){this._properties=i,this._values=Object.create(i.defaultPropertyValues)}hasValue(i){return this._values[i].value!==void 0}getValue(i){return Rt(this._values[i].value)}setValue(i,l){this._values[i]=new rc(this._values[i].property,l===null?void 0:Rt(l))}serialize(){const i={};for(const l of Object.keys(this._values)){const h=this.getValue(l);h!==void 0&&(i[l]=h)}return i}possiblyEvaluate(i,l,h){const g=new Du(this._properties);for(const v of Object.keys(this._values))g._values[v]=this._values[v].possiblyEvaluate(i,l,h);return g}}class ja{constructor(i,l,h){this.property=i,this.value=l,this.parameters=h}isConstant(){return this.value.kind==="constant"}constantOr(i){return this.value.kind==="constant"?this.value.value:i}evaluate(i,l,h,g){return this.property.evaluate(this.value,this.parameters,i,l,h,g)}}class Du{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class Qt{constructor(i){this.specification=i}possiblyEvaluate(i,l){if(i.isDataDriven())throw new Error("Value should not be data driven");return i.expression.evaluate(l)}interpolate(i,l,h){const g=ia[this.specification.type];return g?g(i,l,h):i}}class un{constructor(i,l){this.specification=i,this.overrides=l}possiblyEvaluate(i,l,h,g){return new ja(this,i.expression.kind==="constant"||i.expression.kind==="camera"?{kind:"constant",value:i.expression.evaluate(l,null,{},h,g)}:i.expression,l)}interpolate(i,l,h){if(i.value.kind!=="constant"||l.value.kind!=="constant")return i;if(i.value.value===void 0||l.value.value===void 0)return new ja(this,{kind:"constant",value:void 0},i.parameters);const g=ia[this.specification.type];if(g){const v=g(i.value.value,l.value.value,h);return new ja(this,{kind:"constant",value:v},i.parameters)}return i}evaluate(i,l,h,g,v,b){return i.kind==="constant"?i.value:i.evaluate(l,h,g,v,b)}}class zu extends un{possiblyEvaluate(i,l,h,g){if(i.value===void 0)return new ja(this,{kind:"constant",value:void 0},l);if(i.expression.kind==="constant"){const v=i.expression.evaluate(l,null,{},h,g),b=i.property.specification.type==="resolvedImage"&&typeof v!="string"?v.name:v,A=this._calculate(b,b,b,l);return new ja(this,{kind:"constant",value:A},l)}if(i.expression.kind==="camera"){const v=this._calculate(i.expression.evaluate({zoom:l.zoom-1}),i.expression.evaluate({zoom:l.zoom}),i.expression.evaluate({zoom:l.zoom+1}),l);return new ja(this,{kind:"constant",value:v},l)}return new ja(this,i.expression,l)}evaluate(i,l,h,g,v,b){if(i.kind==="source"){const A=i.evaluate(l,h,g,v,b);return this._calculate(A,A,A,l)}return i.kind==="composite"?this._calculate(i.evaluate({zoom:Math.floor(l.zoom)-1},h,g),i.evaluate({zoom:Math.floor(l.zoom)},h,g),i.evaluate({zoom:Math.floor(l.zoom)+1},h,g),l):i.value}_calculate(i,l,h,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:i,to:l}:{from:h,to:l}}interpolate(i){return i}}class zf{constructor(i){this.specification=i}possiblyEvaluate(i,l,h,g){if(i.value!==void 0){if(i.expression.kind==="constant"){const v=i.expression.evaluate(l,null,{},h,g);return this._calculate(v,v,v,l)}return this._calculate(i.expression.evaluate(new Pi(Math.floor(l.zoom-1),l)),i.expression.evaluate(new Pi(Math.floor(l.zoom),l)),i.expression.evaluate(new Pi(Math.floor(l.zoom+1),l)),l)}}_calculate(i,l,h,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:i,to:l}:{from:h,to:l}}interpolate(i){return i}}class ac{constructor(i){this.specification=i}possiblyEvaluate(i,l,h,g){return!!i.expression.evaluate(l,null,{},h,g)}interpolate(){return!1}}class Br{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const l in i){const h=i[l];h.specification.overridable&&this.overridableProperties.push(l);const g=this.defaultPropertyValues[l]=new rc(h,void 0),v=this.defaultTransitionablePropertyValues[l]=new ku(h);this.defaultTransitioningPropertyValues[l]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=g.possiblyEvaluate({})}}}Gt("DataDrivenProperty",un),Gt("DataConstantProperty",Qt),Gt("CrossFadedDataDrivenProperty",zu),Gt("CrossFadedProperty",zf),Gt("ColorRampProperty",ac);const mm="-transition";class mr extends Je{constructor(i,l){if(super(),this.id=i.id,this.type=i.type,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},i.type!=="custom"&&(this.metadata=i.metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,i.type!=="background"&&(this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter,this._featureFilter=Mo(i.filter)),l.layout&&(this._unevaluatedLayout=new qy(l.layout)),l.paint)){this._transitionablePaint=new Df(l.paint);for(const h in i.paint)this.setPaintProperty(h,i.paint[h],{validate:!1});for(const h in i.layout)this.setLayoutProperty(h,i.layout[h],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Du(l.paint)}}setFilter(i){this.filter=i,this._featureFilter=Mo(i)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(i){return i==="visibility"?this.visibility:this._unevaluatedLayout.getValue(i)}getLayoutAffectingGlobalStateRefs(){const i=new Set;if(this._unevaluatedLayout)for(const l in this._unevaluatedLayout._values){const h=this._unevaluatedLayout._values[l];for(const g of h.getGlobalStateRefs())i.add(g)}for(const l of this._featureFilter.getGlobalStateRefs())i.add(l);return i}setLayoutProperty(i,l,h={}){l!=null&&this._validate(Tf,`layers.${this.id}.layout.${i}`,i,l,h)||(i!=="visibility"?this._unevaluatedLayout.setValue(i,l):this.visibility=l)}getPaintProperty(i){return i.endsWith(mm)?this._transitionablePaint.getTransition(i.slice(0,-11)):this._transitionablePaint.getValue(i)}setPaintProperty(i,l,h={}){if(l!=null&&this._validate(jy,`layers.${this.id}.paint.${i}`,i,l,h))return!1;if(i.endsWith(mm))return this._transitionablePaint.setTransition(i.slice(0,-11),l||void 0),!1;{const g=this._transitionablePaint._values[i],v=g.property.specification["property-type"]==="cross-faded-data-driven",b=g.value.isDataDriven(),A=g.value;this._transitionablePaint.setValue(i,l),this._handleSpecialPaintPropertyUpdate(i);const C=this._transitionablePaint._values[i].value;return C.isDataDriven()||b||v||this._handleOverridablePaintPropertyUpdate(i,A,C)}}_handleSpecialPaintPropertyUpdate(i){}_handleOverridablePaintPropertyUpdate(i,l,h){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||this.visibility==="none"}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,l){i.getCrossfadeParameters&&(this._crossfadeParameters=i.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,l)}serialize(){const i={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(i.layout=i.layout||{},i.layout.visibility=this.visibility),gt(i,(l,h)=>!(l===void 0||h==="layout"&&!Object.keys(l).length||h==="paint"&&!Object.keys(l).length))}_validate(i,l,h,g,v={}){return(!v||v.validate!==!1)&&ec(this,i.call(rl,{key:l,layerType:this.type,objectKey:h,value:g,styleSpec:Ae,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const i in this.paint._values){const l=this.paint.get(i);if(l instanceof ja&&Ys(l.property.specification)&&(l.value.kind==="source"||l.value.kind==="composite")&&l.value.isStateDependent)return!0}return!1}}const gm={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class cs{constructor(i,l){this._structArray=i,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ri{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(i,l){return i._trim(),l&&(i.isTransferred=!0,l.push(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const l=Object.create(this.prototype);return l.arrayBuffer=i.arrayBuffer,l.length=i.length,l.capacity=i.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Ni(c,i=1){let l=0,h=0;return{members:c.map(g=>{const v=gm[g.type].BYTES_PER_ELEMENT,b=l=_m(l,Math.max(i,v)),A=g.components||1;return h=Math.max(h,v),l+=v*A,{name:g.name,type:g.type,components:A,offset:b}}),size:_m(l,Math.max(h,i)),alignment:i}}function _m(c,i){return Math.ceil(c/i)*i}class Eo extends Ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l){const h=this.length;return this.resize(h+1),this.emplace(h,i,l)}emplace(i,l,h){const g=2*i;return this.int16[g+0]=l,this.int16[g+1]=h,i}}Eo.prototype.bytesPerElement=4,Gt("StructArrayLayout2i4",Eo);class Po extends Ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,h){const g=this.length;return this.resize(g+1),this.emplace(g,i,l,h)}emplace(i,l,h,g){const v=3*i;return this.int16[v+0]=l,this.int16[v+1]=h,this.int16[v+2]=g,i}}Po.prototype.bytesPerElement=6,Gt("StructArrayLayout3i6",Po);class Rf extends Ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,h,g){const v=this.length;return this.resize(v+1),this.emplace(v,i,l,h,g)}emplace(i,l,h,g,v){const b=4*i;return this.int16[b+0]=l,this.int16[b+1]=h,this.int16[b+2]=g,this.int16[b+3]=v,i}}Rf.prototype.bytesPerElement=8,Gt("StructArrayLayout4i8",Rf);class Ru extends Ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,h,g,v,b){const A=this.length;return this.resize(A+1),this.emplace(A,i,l,h,g,v,b)}emplace(i,l,h,g,v,b,A){const C=6*i;return this.int16[C+0]=l,this.int16[C+1]=h,this.int16[C+2]=g,this.int16[C+3]=v,this.int16[C+4]=b,this.int16[C+5]=A,i}}Ru.prototype.bytesPerElement=12,Gt("StructArrayLayout2i4i12",Ru);class us extends Ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,h,g,v,b){const A=this.length;return this.resize(A+1),this.emplace(A,i,l,h,g,v,b)}emplace(i,l,h,g,v,b,A){const C=4*i,D=8*i;return this.int16[C+0]=l,this.int16[C+1]=h,this.uint8[D+4]=g,this.uint8[D+5]=v,this.uint8[D+6]=b,this.uint8[D+7]=A,i}}us.prototype.bytesPerElement=8,Gt("StructArrayLayout2i4ub8",us);class oc extends Ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l){const h=this.length;return this.resize(h+1),this.emplace(h,i,l)}emplace(i,l,h){const g=2*i;return this.float32[g+0]=l,this.float32[g+1]=h,i}}oc.prototype.bytesPerElement=8,Gt("StructArrayLayout2f8",oc);class Lf extends Ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,h,g,v,b,A,C,D,R){const O=this.length;return this.resize(O+1),this.emplace(O,i,l,h,g,v,b,A,C,D,R)}emplace(i,l,h,g,v,b,A,C,D,R,O){const U=10*i;return this.uint16[U+0]=l,this.uint16[U+1]=h,this.uint16[U+2]=g,this.uint16[U+3]=v,this.uint16[U+4]=b,this.uint16[U+5]=A,this.uint16[U+6]=C,this.uint16[U+7]=D,this.uint16[U+8]=R,this.uint16[U+9]=O,i}}Lf.prototype.bytesPerElement=20,Gt("StructArrayLayout10ui20",Lf);class Lu extends Ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,h,g,v,b,A,C,D,R,O,U){const Z=this.length;return this.resize(Z+1),this.emplace(Z,i,l,h,g,v,b,A,C,D,R,O,U)}emplace(i,l,h,g,v,b,A,C,D,R,O,U,Z){const W=12*i;return this.int16[W+0]=l,this.int16[W+1]=h,this.int16[W+2]=g,this.int16[W+3]=v,this.uint16[W+4]=b,this.uint16[W+5]=A,this.uint16[W+6]=C,this.uint16[W+7]=D,this.int16[W+8]=R,this.int16[W+9]=O,this.int16[W+10]=U,this.int16[W+11]=Z,i}}Lu.prototype.bytesPerElement=24,Gt("StructArrayLayout4i4ui4i24",Lu);class Bf extends Ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h){const g=this.length;return this.resize(g+1),this.emplace(g,i,l,h)}emplace(i,l,h,g){const v=3*i;return this.float32[v+0]=l,this.float32[v+1]=h,this.float32[v+2]=g,i}}Bf.prototype.bytesPerElement=12,Gt("StructArrayLayout3f12",Bf);class _ extends Ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.uint32[1*i+0]=l,i}}_.prototype.bytesPerElement=4,Gt("StructArrayLayout1ul4",_);class n extends Ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,h,g,v,b,A,C,D){const R=this.length;return this.resize(R+1),this.emplace(R,i,l,h,g,v,b,A,C,D)}emplace(i,l,h,g,v,b,A,C,D,R){const O=10*i,U=5*i;return this.int16[O+0]=l,this.int16[O+1]=h,this.int16[O+2]=g,this.int16[O+3]=v,this.int16[O+4]=b,this.int16[O+5]=A,this.uint32[U+3]=C,this.uint16[O+8]=D,this.uint16[O+9]=R,i}}n.prototype.bytesPerElement=20,Gt("StructArrayLayout6i1ul2ui20",n);class s extends Ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,h,g,v,b){const A=this.length;return this.resize(A+1),this.emplace(A,i,l,h,g,v,b)}emplace(i,l,h,g,v,b,A){const C=6*i;return this.int16[C+0]=l,this.int16[C+1]=h,this.int16[C+2]=g,this.int16[C+3]=v,this.int16[C+4]=b,this.int16[C+5]=A,i}}s.prototype.bytesPerElement=12,Gt("StructArrayLayout2i2i2i12",s);class f extends Ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,h,g,v){const b=this.length;return this.resize(b+1),this.emplace(b,i,l,h,g,v)}emplace(i,l,h,g,v,b){const A=4*i,C=8*i;return this.float32[A+0]=l,this.float32[A+1]=h,this.float32[A+2]=g,this.int16[C+6]=v,this.int16[C+7]=b,i}}f.prototype.bytesPerElement=16,Gt("StructArrayLayout2f1f2i16",f);class m extends Ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,h,g,v,b){const A=this.length;return this.resize(A+1),this.emplace(A,i,l,h,g,v,b)}emplace(i,l,h,g,v,b,A){const C=16*i,D=4*i,R=8*i;return this.uint8[C+0]=l,this.uint8[C+1]=h,this.float32[D+1]=g,this.float32[D+2]=v,this.int16[R+6]=b,this.int16[R+7]=A,i}}m.prototype.bytesPerElement=16,Gt("StructArrayLayout2ub2f2i16",m);class y extends Ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,h){const g=this.length;return this.resize(g+1),this.emplace(g,i,l,h)}emplace(i,l,h,g){const v=3*i;return this.uint16[v+0]=l,this.uint16[v+1]=h,this.uint16[v+2]=g,i}}y.prototype.bytesPerElement=6,Gt("StructArrayLayout3ui6",y);class x extends Ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h,g,v,b,A,C,D,R,O,U,Z,W,J,ie,fe){const Me=this.length;return this.resize(Me+1),this.emplace(Me,i,l,h,g,v,b,A,C,D,R,O,U,Z,W,J,ie,fe)}emplace(i,l,h,g,v,b,A,C,D,R,O,U,Z,W,J,ie,fe,Me){const ye=24*i,q=12*i,ne=48*i;return this.int16[ye+0]=l,this.int16[ye+1]=h,this.uint16[ye+2]=g,this.uint16[ye+3]=v,this.uint32[q+2]=b,this.uint32[q+3]=A,this.uint32[q+4]=C,this.uint16[ye+10]=D,this.uint16[ye+11]=R,this.uint16[ye+12]=O,this.float32[q+7]=U,this.float32[q+8]=Z,this.uint8[ne+36]=W,this.uint8[ne+37]=J,this.uint8[ne+38]=ie,this.uint32[q+10]=fe,this.int16[ye+22]=Me,i}}x.prototype.bytesPerElement=48,Gt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",x);class M extends Ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h,g,v,b,A,C,D,R,O,U,Z,W,J,ie,fe,Me,ye,q,ne,ve,Ue,ut,Ye,et,vt,dt){const At=this.length;return this.resize(At+1),this.emplace(At,i,l,h,g,v,b,A,C,D,R,O,U,Z,W,J,ie,fe,Me,ye,q,ne,ve,Ue,ut,Ye,et,vt,dt)}emplace(i,l,h,g,v,b,A,C,D,R,O,U,Z,W,J,ie,fe,Me,ye,q,ne,ve,Ue,ut,Ye,et,vt,dt,At){const at=32*i,Yt=16*i;return this.int16[at+0]=l,this.int16[at+1]=h,this.int16[at+2]=g,this.int16[at+3]=v,this.int16[at+4]=b,this.int16[at+5]=A,this.int16[at+6]=C,this.int16[at+7]=D,this.uint16[at+8]=R,this.uint16[at+9]=O,this.uint16[at+10]=U,this.uint16[at+11]=Z,this.uint16[at+12]=W,this.uint16[at+13]=J,this.uint16[at+14]=ie,this.uint16[at+15]=fe,this.uint16[at+16]=Me,this.uint16[at+17]=ye,this.uint16[at+18]=q,this.uint16[at+19]=ne,this.uint16[at+20]=ve,this.uint16[at+21]=Ue,this.uint16[at+22]=ut,this.uint32[Yt+12]=Ye,this.float32[Yt+13]=et,this.float32[Yt+14]=vt,this.uint16[at+30]=dt,this.uint16[at+31]=At,i}}M.prototype.bytesPerElement=64,Gt("StructArrayLayout8i15ui1ul2f2ui64",M);class E extends Ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.float32[1*i+0]=l,i}}E.prototype.bytesPerElement=4,Gt("StructArrayLayout1f4",E);class z extends Ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h){const g=this.length;return this.resize(g+1),this.emplace(g,i,l,h)}emplace(i,l,h,g){const v=3*i;return this.uint16[6*i+0]=l,this.float32[v+1]=h,this.float32[v+2]=g,i}}z.prototype.bytesPerElement=12,Gt("StructArrayLayout1ui2f12",z);class B extends Ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,h){const g=this.length;return this.resize(g+1),this.emplace(g,i,l,h)}emplace(i,l,h,g){const v=4*i;return this.uint32[2*i+0]=l,this.uint16[v+2]=h,this.uint16[v+3]=g,i}}B.prototype.bytesPerElement=8,Gt("StructArrayLayout1ul2ui8",B);class j extends Ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l){const h=this.length;return this.resize(h+1),this.emplace(h,i,l)}emplace(i,l,h){const g=2*i;return this.uint16[g+0]=l,this.uint16[g+1]=h,i}}j.prototype.bytesPerElement=4,Gt("StructArrayLayout2ui4",j);class N extends Ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.uint16[1*i+0]=l,i}}N.prototype.bytesPerElement=2,Gt("StructArrayLayout1ui2",N);class V extends Ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h,g){const v=this.length;return this.resize(v+1),this.emplace(v,i,l,h,g)}emplace(i,l,h,g,v){const b=4*i;return this.float32[b+0]=l,this.float32[b+1]=h,this.float32[b+2]=g,this.float32[b+3]=v,i}}V.prototype.bytesPerElement=16,Gt("StructArrayLayout4f16",V);class Q extends cs{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new F(this.anchorPointX,this.anchorPointY)}}Q.prototype.size=20;class se extends n{get(i){return new Q(this,i)}}Gt("CollisionBoxArray",se);class oe extends cs{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(i){this._structArray.uint8[this._pos1+37]=i}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(i){this._structArray.uint8[this._pos1+38]=i}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(i){this._structArray.uint32[this._pos4+10]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}oe.prototype.size=48;class le extends x{get(i){return new oe(this,i)}}Gt("PlacedSymbolArray",le);class de extends cs{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(i){this._structArray.uint32[this._pos4+12]=i}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}de.prototype.size=64;class _e extends M{get(i){return new de(this,i)}}Gt("SymbolInstanceArray",_e);class me extends E{getoffsetX(i){return this.float32[1*i+0]}}Gt("GlyphOffsetArray",me);class xe extends Po{getx(i){return this.int16[3*i+0]}gety(i){return this.int16[3*i+1]}gettileUnitDistanceFromAnchor(i){return this.int16[3*i+2]}}Gt("SymbolLineVertexArray",xe);class Te extends cs{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Te.prototype.size=12;class ge extends z{get(i){return new Te(this,i)}}Gt("TextAnchorOffsetArray",ge);class ze extends cs{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}ze.prototype.size=8;class $e extends B{get(i){return new ze(this,i)}}Gt("FeatureIndexArray",$e);class Ne extends Eo{}class je extends Eo{}class We extends Eo{}class zt extends Ru{}class Ct extends us{}class ft extends oc{}class Wt extends Lf{}class Mn extends Lu{}class ii extends Bf{}class Li extends _{}class hi extends s{}class Bi extends m{}class vi extends y{}class fi extends j{}const bi=Ni([{name:"a_pos",components:2,type:"Int16"}],4),{members:gr}=bi;class Wn{constructor(i=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=i}prepareSegment(i,l,h,g){const v=this.segments[this.segments.length-1];return i>Wn.MAX_VERTEX_ARRAY_LENGTH&&ht(`Max vertices per segment is ${Wn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${Wn.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!v||v.vertexLength+i>Wn.MAX_VERTEX_ARRAY_LENGTH||v.sortKey!==g?this.createNewSegment(l,h,g):v}createNewSegment(i,l,h){const g={vertexOffset:i.length,primitiveOffset:l.length,vertexLength:0,primitiveLength:0,vaos:{}};return h!==void 0&&(g.sortKey=h),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(g),g}getOrCreateLatestSegment(i,l,h){return this.prepareSegment(0,i,l,h)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const i of this.segments)for(const l in i.vaos)i.vaos[l].destroy()}static simpleSegment(i,l,h,g){return new Wn([{vertexOffset:i,primitiveOffset:l,vertexLength:h,primitiveLength:g,vaos:{},sortKey:0}])}}function or(c,i){return 256*(c=nt(Math.floor(c),0,255))+nt(Math.floor(i),0,255)}Wn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Gt("SegmentVector",Wn);const _r=Ni([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var ko,Do,zo,Ua={exports:{}},sc={exports:{}},lc={exports:{}},sl=function(){if(zo)return Ua.exports;zo=1;var c=(ko||(ko=1,sc.exports=function(l,h){var g,v,b,A,C,D,R,O;for(v=l.length-(g=3&l.length),b=h,C=3432918353,D=461845907,O=0;O<v;)R=255&l.charCodeAt(O)|(255&l.charCodeAt(++O))<<8|(255&l.charCodeAt(++O))<<16|(255&l.charCodeAt(++O))<<24,++O,b=27492+(65535&(A=5*(65535&(b=(b^=R=(65535&(R=(R=(65535&R)*C+(((R>>>16)*C&65535)<<16)&4294967295)<<15|R>>>17))*D+(((R>>>16)*D&65535)<<16)&4294967295)<<13|b>>>19))+((5*(b>>>16)&65535)<<16)&4294967295))+((58964+(A>>>16)&65535)<<16);switch(R=0,g){case 3:R^=(255&l.charCodeAt(O+2))<<16;case 2:R^=(255&l.charCodeAt(O+1))<<8;case 1:b^=R=(65535&(R=(R=(65535&(R^=255&l.charCodeAt(O)))*C+(((R>>>16)*C&65535)<<16)&4294967295)<<15|R>>>17))*D+(((R>>>16)*D&65535)<<16)&4294967295}return b^=l.length,b=2246822507*(65535&(b^=b>>>16))+((2246822507*(b>>>16)&65535)<<16)&4294967295,b=3266489909*(65535&(b^=b>>>13))+((3266489909*(b>>>16)&65535)<<16)&4294967295,(b^=b>>>16)>>>0}),sc.exports),i=(Do||(Do=1,lc.exports=function(l,h){for(var g,v=l.length,b=h^v,A=0;v>=4;)g=1540483477*(65535&(g=255&l.charCodeAt(A)|(255&l.charCodeAt(++A))<<8|(255&l.charCodeAt(++A))<<16|(255&l.charCodeAt(++A))<<24))+((1540483477*(g>>>16)&65535)<<16),b=1540483477*(65535&b)+((1540483477*(b>>>16)&65535)<<16)^(g=1540483477*(65535&(g^=g>>>24))+((1540483477*(g>>>16)&65535)<<16)),v-=4,++A;switch(v){case 3:b^=(255&l.charCodeAt(A+2))<<16;case 2:b^=(255&l.charCodeAt(A+1))<<8;case 1:b=1540483477*(65535&(b^=255&l.charCodeAt(A)))+((1540483477*(b>>>16)&65535)<<16)}return b=1540483477*(65535&(b^=b>>>13))+((1540483477*(b>>>16)&65535)<<16),(b^=b>>>15)>>>0}),lc.exports);return Ua.exports=c,Ua.exports.murmur3=c,Ua.exports.murmur2=i,Ua.exports}(),Wr=w(sl);class Ta{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(i,l,h,g){this.ids.push(Ro(i)),this.positions.push(l,h,g)}getPositions(i){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const l=Ro(i);let h=0,g=this.ids.length-1;for(;h<g;){const b=h+g>>1;this.ids[b]>=l?g=b:h=b+1}const v=[];for(;this.ids[h]===l;)v.push({index:this.positions[3*h],start:this.positions[3*h+1],end:this.positions[3*h+2]}),h++;return v}static serialize(i,l){const h=new Float64Array(i.ids),g=new Uint32Array(i.positions);return hs(h,g,0,h.length-1),l&&l.push(h.buffer,g.buffer),{ids:h,positions:g}}static deserialize(i){const l=new Ta;return l.ids=i.ids,l.positions=i.positions,l.indexed=!0,l}}function Ro(c){const i=+c;return!isNaN(i)&&i<=Number.MAX_SAFE_INTEGER?i:Wr(String(c))}function hs(c,i,l,h){for(;l<h;){const g=c[l+h>>1];let v=l-1,b=h+1;for(;;){do v++;while(c[v]<g);do b--;while(c[b]>g);if(v>=b)break;Vi(c,v,b),Vi(i,3*v,3*b),Vi(i,3*v+1,3*b+1),Vi(i,3*v+2,3*b+2)}b-l<h-b?(hs(c,i,l,b),l=b+1):(hs(c,i,b+1,h),h=b)}}function Vi(c,i,l){const h=c[i];c[i]=c[l],c[l]=h}Gt("FeaturePositionMap",Ta);class Ii{constructor(i,l){this.gl=i.gl,this.location=l}}class Fr extends Ii{constructor(i,l){super(i,l),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class Ji extends Ii{constructor(i,l){super(i,l),this.current=[0,0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3]))}}class ym extends Ii{constructor(i,l){super(i,l),this.current=zn.transparent}set(i){i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a))}}const Zy=new Float32Array(16);function Ff(c){return[or(255*c.r,255*c.g),or(255*c.b,255*c.a)]}class cc{constructor(i,l,h){this.value=i,this.uniformNames=l.map(g=>`u_${g}`),this.type=h}setUniform(i,l,h){i.set(h.constantOr(this.value))}getBinding(i,l,h){return this.type==="color"?new ym(i,l):new Fr(i,l)}}class ll{constructor(i,l){this.uniformNames=l.map(h=>`u_${h}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(i,l){this.pixelRatioFrom=l.pixelRatio,this.pixelRatioTo=i.pixelRatio,this.patternFrom=l.tlbr,this.patternTo=i.tlbr}setUniform(i,l,h,g){const v=g==="u_pattern_to"?this.patternTo:g==="u_pattern_from"?this.patternFrom:g==="u_pixel_ratio_to"?this.pixelRatioTo:g==="u_pixel_ratio_from"?this.pixelRatioFrom:null;v&&i.set(v)}getBinding(i,l,h){return h.substr(0,9)==="u_pattern"?new Ji(i,l):new Fr(i,l)}}class ao{constructor(i,l,h,g){this.expression=i,this.type=h,this.maxValue=0,this.paintVertexAttributes=l.map(v=>({name:`a_${v}`,type:"Float32",components:h==="color"?2:1,offset:0})),this.paintVertexArray=new g}populatePaintArray(i,l,h,g,v){const b=this.paintVertexArray.length,A=this.expression.evaluate(new Pi(0),l,{},g,[],v);this.paintVertexArray.resize(i),this._setPaintValue(b,i,A)}updatePaintArray(i,l,h,g){const v=this.expression.evaluate({zoom:0},h,g);this._setPaintValue(i,l,v)}_setPaintValue(i,l,h){if(this.type==="color"){const g=Ff(h);for(let v=i;v<l;v++)this.paintVertexArray.emplace(v,g[0],g[1])}else{for(let g=i;g<l;g++)this.paintVertexArray.emplace(g,h);this.maxValue=Math.max(this.maxValue,Math.abs(h))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class yr{constructor(i,l,h,g,v,b){this.expression=i,this.uniformNames=l.map(A=>`u_${A}_t`),this.type=h,this.useIntegerZoom=g,this.zoom=v,this.maxValue=0,this.paintVertexAttributes=l.map(A=>({name:`a_${A}`,type:"Float32",components:h==="color"?4:2,offset:0})),this.paintVertexArray=new b}populatePaintArray(i,l,h,g,v){const b=this.expression.evaluate(new Pi(this.zoom),l,{},g,[],v),A=this.expression.evaluate(new Pi(this.zoom+1),l,{},g,[],v),C=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(C,i,b,A)}updatePaintArray(i,l,h,g){const v=this.expression.evaluate({zoom:this.zoom},h,g),b=this.expression.evaluate({zoom:this.zoom+1},h,g);this._setPaintValue(i,l,v,b)}_setPaintValue(i,l,h,g){if(this.type==="color"){const v=Ff(h),b=Ff(g);for(let A=i;A<l;A++)this.paintVertexArray.emplace(A,v[0],v[1],b[0],b[1])}else{for(let v=i;v<l;v++)this.paintVertexArray.emplace(v,h,g);this.maxValue=Math.max(this.maxValue,Math.abs(h),Math.abs(g))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,l){const h=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,g=nt(this.expression.interpolationFactor(h,this.zoom,this.zoom+1),0,1);i.set(g)}getBinding(i,l,h){return new Fr(i,l)}}class oo{constructor(i,l,h,g,v,b){this.expression=i,this.type=l,this.useIntegerZoom=h,this.zoom=g,this.layerId=b,this.zoomInPaintVertexArray=new v,this.zoomOutPaintVertexArray=new v}populatePaintArray(i,l,h){const g=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(i),this.zoomOutPaintVertexArray.resize(i),this._setPaintValues(g,i,l.patterns&&l.patterns[this.layerId],h)}updatePaintArray(i,l,h,g,v){this._setPaintValues(i,l,h.patterns&&h.patterns[this.layerId],v)}_setPaintValues(i,l,h,g){if(!g||!h)return;const{min:v,mid:b,max:A}=h,C=g[v],D=g[b],R=g[A];if(C&&D&&R)for(let O=i;O<l;O++)this.zoomInPaintVertexArray.emplace(O,D.tl[0],D.tl[1],D.br[0],D.br[1],C.tl[0],C.tl[1],C.br[0],C.br[1],D.pixelRatio,C.pixelRatio),this.zoomOutPaintVertexArray.emplace(O,D.tl[0],D.tl[1],D.br[0],D.br[1],R.tl[0],R.tl[1],R.br[0],R.br[1],D.pixelRatio,R.pixelRatio)}upload(i){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=i.createVertexBuffer(this.zoomInPaintVertexArray,_r.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=i.createVertexBuffer(this.zoomOutPaintVertexArray,_r.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Of{constructor(i,l,h){this.binders={},this._buffers=[];const g=[];for(const v in i.paint._values){if(!h(v))continue;const b=i.paint.get(v);if(!(b instanceof ja&&Ys(b.property.specification)))continue;const A=Nf(v,i.type),C=b.value,D=b.property.specification.type,R=b.property.useIntegerZoom,O=b.property.specification["property-type"],U=O==="cross-faded"||O==="cross-faded-data-driven";if(C.kind==="constant")this.binders[v]=U?new ll(C.value,A):new cc(C.value,A,D),g.push(`/u_${v}`);else if(C.kind==="source"||U){const Z=jf(v,D,"source");this.binders[v]=U?new oo(C,D,R,l,Z,i.id):new ao(C,A,D,Z),g.push(`/a_${v}`)}else{const Z=jf(v,D,"composite");this.binders[v]=new yr(C,A,D,R,l,Z),g.push(`/z_${v}`)}}this.cacheKey=g.sort().join("")}getMaxValue(i){const l=this.binders[i];return l instanceof ao||l instanceof yr?l.maxValue:0}populatePaintArrays(i,l,h,g,v){for(const b in this.binders){const A=this.binders[b];(A instanceof ao||A instanceof yr||A instanceof oo)&&A.populatePaintArray(i,l,h,g,v)}}setConstantPatternPositions(i,l){for(const h in this.binders){const g=this.binders[h];g instanceof ll&&g.setConstantPatternPositions(i,l)}}updatePaintArrays(i,l,h,g,v){let b=!1;for(const A in i){const C=l.getPositions(A);for(const D of C){const R=h.feature(D.index);for(const O in this.binders){const U=this.binders[O];if((U instanceof ao||U instanceof yr||U instanceof oo)&&U.expression.isStateDependent===!0){const Z=g.paint.get(O);U.expression=Z.value,U.updatePaintArray(D.start,D.end,R,i[A],v),b=!0}}}}return b}defines(){const i=[];for(const l in this.binders){const h=this.binders[l];(h instanceof cc||h instanceof ll)&&i.push(...h.uniformNames.map(g=>`#define HAS_UNIFORM_${g}`))}return i}getBinderAttributes(){const i=[];for(const l in this.binders){const h=this.binders[l];if(h instanceof ao||h instanceof yr)for(let g=0;g<h.paintVertexAttributes.length;g++)i.push(h.paintVertexAttributes[g].name);else if(h instanceof oo)for(let g=0;g<_r.members.length;g++)i.push(_r.members[g].name)}return i}getBinderUniforms(){const i=[];for(const l in this.binders){const h=this.binders[l];if(h instanceof cc||h instanceof ll||h instanceof yr)for(const g of h.uniformNames)i.push(g)}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i,l){const h=[];for(const g in this.binders){const v=this.binders[g];if(v instanceof cc||v instanceof ll||v instanceof yr){for(const b of v.uniformNames)if(l[b]){const A=v.getBinding(i,l[b],b);h.push({name:b,property:g,binding:A})}}}return h}setUniforms(i,l,h,g){for(const{name:v,property:b,binding:A}of l)this.binders[b].setUniform(A,g,h.get(b),v)}updatePaintBuffers(i){this._buffers=[];for(const l in this.binders){const h=this.binders[l];if(i&&h instanceof oo){const g=i.fromScale===2?h.zoomInPaintVertexBuffer:h.zoomOutPaintVertexBuffer;g&&this._buffers.push(g)}else(h instanceof ao||h instanceof yr)&&h.paintVertexBuffer&&this._buffers.push(h.paintVertexBuffer)}}upload(i){for(const l in this.binders){const h=this.binders[l];(h instanceof ao||h instanceof yr||h instanceof oo)&&h.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const l=this.binders[i];(l instanceof ao||l instanceof yr||l instanceof oo)&&l.destroy()}}}class Lo{constructor(i,l,h=()=>!0){this.programConfigurations={};for(const g of i)this.programConfigurations[g.id]=new Of(g,l,h);this.needsUpload=!1,this._featureMap=new Ta,this._bufferOffset=0}populatePaintArrays(i,l,h,g,v,b){for(const A in this.programConfigurations)this.programConfigurations[A].populatePaintArrays(i,l,g,v,b);l.id!==void 0&&this._featureMap.add(l.id,h,this._bufferOffset,i),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,l,h,g){for(const v of h)this.needsUpload=this.programConfigurations[v.id].updatePaintArrays(i,this._featureMap,l,v,g)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}function Nf(c,i){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[c]||[c.replace(`${i}-`,"").replace(/-/g,"_")]}function jf(c,i,l){const h={color:{source:oc,composite:V},number:{source:E,composite:oc}},g=function(v){return{"line-pattern":{source:Wt,composite:Wt},"fill-pattern":{source:Wt,composite:Wt},"fill-extrusion-pattern":{source:Wt,composite:Wt}}[v]}(c);return g&&g[l]||h[i][l]}Gt("ConstantBinder",cc),Gt("CrossFadedConstantBinder",ll),Gt("SourceExpressionBinder",ao),Gt("CrossFadedCompositeBinder",oo),Gt("CompositeExpressionBinder",yr),Gt("ProgramConfiguration",Of,{omit:["_buffers"]}),Gt("ProgramConfigurationSet",Lo);const uc=Math.pow(2,14)-1,jx=-uc-1;function hc(c){const i=ct/c.extent,l=c.loadGeometry();for(let h=0;h<l.length;h++){const g=l[h];for(let v=0;v<g.length;v++){const b=g[v],A=Math.round(b.x*i),C=Math.round(b.y*i);b.x=nt(A,jx,uc),b.y=nt(C,jx,uc),(A<b.x||A>b.x+1||C<b.y||C>b.y+1)&&ht("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return l}function fc(c,i){return{type:c.type,id:c.id,properties:c.properties,geometry:i?hc(c):[]}}const Ux=-32768;function E5(c,i,l,h,g){c.emplaceBack(Ux+8*i+h,Ux+8*l+g)}class Hy{constructor(i){this.zoom=i.zoom,this.globalState=i.globalState,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new je,this.indexArray=new vi,this.segments=new Wn,this.programConfigurations=new Lo(i.layers,i.zoom),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,h){const g=this.layers[0],v=[];let b=null,A=!1,C=g.type==="heatmap";if(g.type==="circle"){const R=g;b=R.layout.get("circle-sort-key"),A=!b.isConstant(),C=C||R.paint.get("circle-pitch-alignment")==="map"}const D=C?l.subdivisionGranularity.circle:1;for(const{feature:R,id:O,index:U,sourceLayerIndex:Z}of i){const W=this.layers[0]._featureFilter.needGeometry,J=fc(R,W);if(!this.layers[0]._featureFilter.filter(new Pi(this.zoom,{globalState:this.globalState}),J,h))continue;const ie=A?b.evaluate(J,{},h):void 0,fe={id:O,properties:R.properties,type:R.type,sourceLayerIndex:Z,index:U,geometry:W?J.geometry:hc(R),patterns:{},sortKey:ie};v.push(fe)}A&&v.sort((R,O)=>R.sortKey-O.sortKey);for(const R of v){const{geometry:O,index:U,sourceLayerIndex:Z}=R,W=i[U].feature;this.addFeature(R,O,U,h,D),l.featureIndex.insert(W,O,U,Z,this.index)}}update(i,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,gr),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,l,h,g,v=1){let b;switch(v){case 1:b=[0,7];break;case 3:b=[0,2,5,7];break;case 5:b=[0,1,3,4,6,7];break;case 7:b=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${v}; valid values are 1, 3, 5, 7.`)}const A=b.length;for(const C of l)for(const D of C){const R=D.x,O=D.y;if(R<0||R>=ct||O<0||O>=ct)continue;const U=this.segments.prepareSegment(A*A,this.layoutVertexArray,this.indexArray,i.sortKey),Z=U.vertexLength;for(let W=0;W<A;W++)for(let J=0;J<A;J++)E5(this.layoutVertexArray,R,O,b[J],b[W]);for(let W=0;W<A-1;W++)for(let J=0;J<A-1;J++){const ie=Z+W*A+J,fe=Z+(W+1)*A+J;this.indexArray.emplaceBack(ie,fe+1,ie+1),this.indexArray.emplaceBack(ie,fe,fe+1)}U.vertexLength+=A*A,U.primitiveLength+=(A-1)*(A-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,h,{},g)}}function Vx(c,i){for(let l=0;l<c.length;l++)if(Bu(i,c[l]))return!0;for(let l=0;l<i.length;l++)if(Bu(c,i[l]))return!0;return!!$y(c,i)}function P5(c,i,l){return!!Bu(c,i)||!!Wy(i,c,l)}function Gx(c,i){if(c.length===1)return Zx(i,c[0]);for(let l=0;l<i.length;l++){const h=i[l];for(let g=0;g<h.length;g++)if(Bu(c,h[g]))return!0}for(let l=0;l<c.length;l++)if(Zx(i,c[l]))return!0;for(let l=0;l<i.length;l++)if($y(c,i[l]))return!0;return!1}function k5(c,i,l){if(c.length>1){if($y(c,i))return!0;for(let h=0;h<i.length;h++)if(Wy(i[h],c,l))return!0}for(let h=0;h<c.length;h++)if(Wy(c[h],i,l))return!0;return!1}function $y(c,i){if(c.length===0||i.length===0)return!1;for(let l=0;l<c.length-1;l++){const h=c[l],g=c[l+1];for(let v=0;v<i.length-1;v++)if(D5(h,g,i[v],i[v+1]))return!0}return!1}function D5(c,i,l,h){return qe(c,l,h)!==qe(i,l,h)&&qe(c,i,l)!==qe(c,i,h)}function Wy(c,i,l){const h=l*l;if(i.length===1)return c.distSqr(i[0])<h;for(let g=1;g<i.length;g++)if(qx(c,i[g-1],i[g])<h)return!0;return!1}function qx(c,i,l){const h=i.distSqr(l);if(h===0)return c.distSqr(i);const g=((c.x-i.x)*(l.x-i.x)+(c.y-i.y)*(l.y-i.y))/h;return c.distSqr(g<0?i:g>1?l:l.sub(i)._mult(g)._add(i))}function Zx(c,i){let l,h,g,v=!1;for(let b=0;b<c.length;b++){l=c[b];for(let A=0,C=l.length-1;A<l.length;C=A++)h=l[A],g=l[C],h.y>i.y!=g.y>i.y&&i.x<(g.x-h.x)*(i.y-h.y)/(g.y-h.y)+h.x&&(v=!v)}return v}function Bu(c,i){let l=!1;for(let h=0,g=c.length-1;h<c.length;g=h++){const v=c[h],b=c[g];v.y>i.y!=b.y>i.y&&i.x<(b.x-v.x)*(i.y-v.y)/(b.y-v.y)+v.x&&(l=!l)}return l}function z5(c,i,l){const h=l[0],g=l[2];if(c.x<h.x&&i.x<h.x||c.x>g.x&&i.x>g.x||c.y<h.y&&i.y<h.y||c.y>g.y&&i.y>g.y)return!1;const v=qe(c,i,l[0]);return v!==qe(c,i,l[1])||v!==qe(c,i,l[2])||v!==qe(c,i,l[3])}function Uf(c,i,l){const h=i.paint.get(c).value;return h.kind==="constant"?h.value:l.programConfigurations.get(i.id).getMaxValue(c)}function vm(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])}function bm(c,i,l,h,g){if(!i[0]&&!i[1])return c;const v=F.convert(i)._mult(g);l==="viewport"&&v._rotate(-h);const b=[];for(let A=0;A<c.length;A++)b.push(c[A].sub(v));return b}let Hx,$x;Gt("CircleBucket",Hy,{omit:["layers"]});var R5={get paint(){return $x=$x||new Br({"circle-radius":new un(Ae.paint_circle["circle-radius"]),"circle-color":new un(Ae.paint_circle["circle-color"]),"circle-blur":new un(Ae.paint_circle["circle-blur"]),"circle-opacity":new un(Ae.paint_circle["circle-opacity"]),"circle-translate":new Qt(Ae.paint_circle["circle-translate"]),"circle-translate-anchor":new Qt(Ae.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Qt(Ae.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Qt(Ae.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new un(Ae.paint_circle["circle-stroke-width"]),"circle-stroke-color":new un(Ae.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new un(Ae.paint_circle["circle-stroke-opacity"])})},get layout(){return Hx=Hx||new Br({"circle-sort-key":new un(Ae.layout_circle["circle-sort-key"])})}};class L5 extends mr{constructor(i){super(i,R5)}createBucket(i){return new Hy(i)}queryRadius(i){const l=i;return Uf("circle-radius",this,l)+Uf("circle-stroke-width",this,l)+vm(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:i,feature:l,featureState:h,geometry:g,transform:v,pixelsToTileUnits:b,unwrappedTileID:A,getElevation:C}){const D=bm(i,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-v.bearingInRadians,b),R=this.paint.get("circle-radius").evaluate(l,h)+this.paint.get("circle-stroke-width").evaluate(l,h),O=this.paint.get("circle-pitch-alignment")==="map",U=O?D:function(W,J,ie,fe){return W.map(Me=>Wx(Me,J,ie,fe))}(D,v,A,C),Z=O?R*b:R;for(const W of g)for(const J of W){const ie=O?J:Wx(J,v,A,C);let fe=Z;const Me=v.projectTileCoordinates(J.x,J.y,A,C).signedDistanceFromCamera;if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?fe*=Me/v.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(fe*=v.cameraToCenterDistance/Me),P5(U,ie,fe))return!0}return!1}}function Wx(c,i,l,h){const g=i.projectTileCoordinates(c.x,c.y,l,h).point;return new F((.5*g.x+.5)*i.width,(.5*-g.y+.5)*i.height)}class Yx extends Hy{}let Xx;Gt("HeatmapBucket",Yx,{omit:["layers"]});var B5={get paint(){return Xx=Xx||new Br({"heatmap-radius":new un(Ae.paint_heatmap["heatmap-radius"]),"heatmap-weight":new un(Ae.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Qt(Ae.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ac(Ae.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Qt(Ae.paint_heatmap["heatmap-opacity"])})}};function Yy(c,{width:i,height:l},h,g){if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==i*l*h)throw new RangeError(`mismatched image size. expected: ${g.length} but got: ${i*l*h}`)}else g=new Uint8Array(i*l*h);return c.width=i,c.height=l,c.data=g,c}function Qx(c,{width:i,height:l},h){if(i===c.width&&l===c.height)return;const g=Yy({},{width:i,height:l},h);Xy(c,g,{x:0,y:0},{x:0,y:0},{width:Math.min(c.width,i),height:Math.min(c.height,l)},h),c.width=i,c.height=l,c.data=g.data}function Xy(c,i,l,h,g,v){if(g.width===0||g.height===0)return i;if(g.width>c.width||g.height>c.height||l.x>c.width-g.width||l.y>c.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>i.width||g.height>i.height||h.x>i.width-g.width||h.y>i.height-g.height)throw new RangeError("out of range destination coordinates for image copy");const b=c.data,A=i.data;if(b===A)throw new Error("srcData equals dstData, so image is already copied");for(let C=0;C<g.height;C++){const D=((l.y+C)*c.width+l.x)*v,R=((h.y+C)*i.width+h.x)*v;for(let O=0;O<g.width*v;O++)A[R+O]=b[D+O]}return i}class Vf{constructor(i,l){Yy(this,i,1,l)}resize(i){Qx(this,i,1)}clone(){return new Vf({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,l,h,g,v){Xy(i,l,h,g,v,1)}}class ra{constructor(i,l){Yy(this,i,4,l)}resize(i){Qx(this,i,4)}replace(i,l){l?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new ra({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,l,h,g,v){Xy(i,l,h,g,v,4)}setPixel(i,l,h){const g=4*(i*this.width+l);this.data[g+0]=Math.round(255*h.r/h.a),this.data[g+1]=Math.round(255*h.g/h.a),this.data[g+2]=Math.round(255*h.b/h.a),this.data[g+3]=Math.round(255*h.a)}}function Kx(c){const i={},l=c.resolution||256,h=c.clips?c.clips.length:1,g=c.image||new ra({width:l,height:h});if(Math.log(l)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${l}`);const v=(b,A,C)=>{i[c.evaluationKey]=C;const D=c.expression.evaluate(i);g.setPixel(b/4/l,A/4,D)};if(c.clips)for(let b=0,A=0;b<h;++b,A+=4*l)for(let C=0,D=0;C<l;C++,D+=4){const R=C/(l-1),{start:O,end:U}=c.clips[b];v(A,D,O*(1-R)+U*R)}else for(let b=0,A=0;b<l;b++,A+=4)v(0,A,b/(l-1));return g}Gt("AlphaImage",Vf),Gt("RGBAImage",ra);const Qy="big-fb";class F5 extends mr{createBucket(i){return new Yx(i)}constructor(i){super(i,B5),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Kx({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Qy)&&this.heatmapFbos.delete(Qy)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Jx;var O5={get paint(){return Jx=Jx||new Br({"hillshade-illumination-direction":new Qt(Ae.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new Qt(Ae.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new Qt(Ae.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Qt(Ae.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Qt(Ae.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Qt(Ae.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Qt(Ae.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new Qt(Ae.paint_hillshade["hillshade-method"])})}};class N5 extends mr{constructor(i){super(i,O5),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let i=this.paint.get("hillshade-illumination-direction").values,l=this.paint.get("hillshade-illumination-altitude").values,h=this.paint.get("hillshade-highlight-color").values,g=this.paint.get("hillshade-shadow-color").values;const v=Math.max(i.length,l.length,h.length,g.length);i=i.concat(Array(v-i.length).fill(i.at(-1))),l=l.concat(Array(v-l.length).fill(l.at(-1))),h=h.concat(Array(v-h.length).fill(h.at(-1))),g=g.concat(Array(v-g.length).fill(g.at(-1)));const b=l.map(yn);return{directionRadians:i.map(yn),altitudeRadians:b,shadowColor:g,highlightColor:h}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let ew;var j5={get paint(){return ew=ew||new Br({"color-relief-opacity":new Qt(Ae["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new ac(Ae["paint_color-relief"]["color-relief-color"])})}};class Ky{constructor(i,l,h,g){this.context=i,this.format=h,this.texture=i.gl.createTexture(),this.update(l,g)}update(i,l,h){const{width:g,height:v}=i,b=!(this.size&&this.size[0]===g&&this.size[1]===v||h),{context:A}=this,{gl:C}=A;if(this.useMipmap=!!(l&&l.useMipmap),C.bindTexture(C.TEXTURE_2D,this.texture),A.pixelStoreUnpackFlipY.set(!1),A.pixelStoreUnpack.set(1),A.pixelStoreUnpackPremultiplyAlpha.set(this.format===C.RGBA&&(!l||l.premultiply!==!1)),b)this.size=[g,v],i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||_n(i)?C.texImage2D(C.TEXTURE_2D,0,this.format,this.format,C.UNSIGNED_BYTE,i):C.texImage2D(C.TEXTURE_2D,0,this.format,g,v,0,this.format,C.UNSIGNED_BYTE,i.data);else{const{x:D,y:R}=h||{x:0,y:0};i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||_n(i)?C.texSubImage2D(C.TEXTURE_2D,0,D,R,C.RGBA,C.UNSIGNED_BYTE,i):C.texSubImage2D(C.TEXTURE_2D,0,D,R,g,v,C.RGBA,C.UNSIGNED_BYTE,i.data)}this.useMipmap&&this.isSizePowerOfTwo()&&C.generateMipmap(C.TEXTURE_2D),A.pixelStoreUnpackFlipY.setDefault(),A.pixelStoreUnpack.setDefault(),A.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(i,l,h){const{context:g}=this,{gl:v}=g;v.bindTexture(v.TEXTURE_2D,this.texture),h!==v.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(h=v.LINEAR),i!==this.filter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,i),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,h||i),this.filter=i),l!==this.wrap&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,l),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,l),this.wrap=l)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}class tw{constructor(i,l,h,g=1,v=1,b=1,A=0){if(this.uid=i,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(h&&!["mapbox","terrarium","custom"].includes(h))return void ht(`"${h}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=l.height;const C=this.dim=l.height-2;switch(this.data=new Uint32Array(l.data.buffer),h){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=g,this.greenFactor=v,this.blueFactor=b,this.baseShift=A;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let D=0;D<C;D++)this.data[this._idx(-1,D)]=this.data[this._idx(0,D)],this.data[this._idx(C,D)]=this.data[this._idx(C-1,D)],this.data[this._idx(D,-1)]=this.data[this._idx(D,0)],this.data[this._idx(D,C)]=this.data[this._idx(D,C-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(C,-1)]=this.data[this._idx(C-1,0)],this.data[this._idx(-1,C)]=this.data[this._idx(0,C-1)],this.data[this._idx(C,C)]=this.data[this._idx(C-1,C-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let D=0;D<C;D++)for(let R=0;R<C;R++){const O=this.get(D,R);O>this.max&&(this.max=O),O<this.min&&(this.min=O)}}get(i,l){const h=new Uint8Array(this.data.buffer),g=4*this._idx(i,l);return this.unpack(h[g],h[g+1],h[g+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(i,l){if(i<-1||i>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(i+1)}unpack(i,l,h){return i*this.redFactor+l*this.greenFactor+h*this.blueFactor-this.baseShift}pack(i){return nw(i,this.getUnpackVector())}getPixels(){return new ra({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(i,l,h){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let g=l*this.dim,v=l*this.dim+this.dim,b=h*this.dim,A=h*this.dim+this.dim;switch(l){case-1:g=v-1;break;case 1:v=g+1}switch(h){case-1:b=A-1;break;case 1:A=b+1}const C=-l*this.dim,D=-h*this.dim;for(let R=b;R<A;R++)for(let O=g;O<v;O++)this.data[this._idx(O,R)]=i.data[this._idx(O+C,R+D)]}}function nw(c,i){const l=i[0],h=i[1],g=i[2],v=i[3],b=Math.min(l,h,g),A=Math.round((c+v)/b);return{r:Math.floor(A*b/l)%256,g:Math.floor(A*b/h)%256,b:Math.floor(A*b/g)%256}}Gt("DEMData",tw);class U5 extends mr{constructor(i){super(i,j5)}_createColorRamp(i){const l={elevationStops:[],colorStops:[]},h=this._transitionablePaint._values["color-relief-color"].value.expression;if(h instanceof Wl&&h._styleExpression.expression instanceof Rr){this.colorRampExpression=h;const b=h._styleExpression.expression;l.elevationStops=b.labels,l.colorStops=[];for(const A of l.elevationStops)l.colorStops.push(b.evaluate({globals:{elevation:A}}))}if(l.elevationStops.length<1&&(l.elevationStops=[0],l.colorStops=[zn.transparent]),l.elevationStops.length<2&&(l.elevationStops.push(l.elevationStops[0]+1),l.colorStops.push(l.colorStops[0])),l.elevationStops.length<=i)return l;const g={elevationStops:[],colorStops:[]},v=(l.elevationStops.length-1)/(i-1);for(let b=0;b<l.elevationStops.length-.5;b+=v)g.elevationStops.push(l.elevationStops[Math.round(b)]),g.colorStops.push(l.colorStops[Math.round(b)]);return ht(`Too many colors in specification of ${this.id} color-relief layer, may not render properly.`),g}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(i,l,h){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const g=this._createColorRamp(l),v=new ra({width:g.colorStops.length,height:1}),b=new ra({width:g.colorStops.length,height:1});for(let A=0;A<g.elevationStops.length;A++){const C=nw(g.elevationStops[A],h);b.setPixel(0,A,new zn(C.r/255,C.g/255,C.b/255,1)),v.setPixel(0,A,g.colorStops[A])}return this.colorRampTextures={elevationTexture:new Ky(i,b,i.gl.RGBA),colorTexture:new Ky(i,v,i.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}const V5=Ni([{name:"a_pos",components:2,type:"Int16"}],4),{members:G5}=V5;function Jy(c,i,l){const h=l.patternDependencies;let g=!1;for(const v of i){const b=v.paint.get(`${c}-pattern`);b.isConstant()||(g=!0);const A=b.constantOr(null);A&&(g=!0,h[A.to]=!0,h[A.from]=!0)}return g}function e0(c,i,l,h,g){const v=g.patternDependencies;for(const b of i){const A=b.paint.get(`${c}-pattern`).value;if(A.kind!=="constant"){let C=A.evaluate({zoom:h-1},l,{},g.availableImages),D=A.evaluate({zoom:h},l,{},g.availableImages),R=A.evaluate({zoom:h+1},l,{},g.availableImages);C=C&&C.name?C.name:C,D=D&&D.name?D.name:D,R=R&&R.name?R.name:R,v[C]=!0,v[D]=!0,v[R]=!0,l.patterns[b.id]={min:C,mid:D,max:R}}}return l}function iw(c,i,l,h,g){let v;if(g===function(b,A,C,D){let R=0;for(let O=A,U=C-D;O<C;O+=D)R+=(b[U]-b[O])*(b[O+1]+b[U+1]),U=O;return R}(c,i,l,h)>0)for(let b=i;b<l;b+=h)v=sw(b/h|0,c[b],c[b+1],v);else for(let b=l-h;b>=i;b-=h)v=sw(b/h|0,c[b],c[b+1],v);return v&&Fu(v,v.next)&&(Hf(v),v=v.next),v}function dc(c,i){if(!c)return c;i||(i=c);let l,h=c;do if(l=!1,h.steiner||!Fu(h,h.next)&&qi(h.prev,h,h.next)!==0)h=h.next;else{if(Hf(h),h=i=h.prev,h===h.next)break;l=!0}while(l||h!==i);return i}function Gf(c,i,l,h,g,v,b){if(!c)return;!b&&v&&function(C,D,R,O){let U=C;do U.z===0&&(U.z=t0(U.x,U.y,D,R,O)),U.prevZ=U.prev,U.nextZ=U.next,U=U.next;while(U!==C);U.prevZ.nextZ=null,U.prevZ=null,function(Z){let W,J=1;do{let ie,fe=Z;Z=null;let Me=null;for(W=0;fe;){W++;let ye=fe,q=0;for(let ve=0;ve<J&&(q++,ye=ye.nextZ,ye);ve++);let ne=J;for(;q>0||ne>0&&ye;)q!==0&&(ne===0||!ye||fe.z<=ye.z)?(ie=fe,fe=fe.nextZ,q--):(ie=ye,ye=ye.nextZ,ne--),Me?Me.nextZ=ie:Z=ie,ie.prevZ=Me,Me=ie;fe=ye}Me.nextZ=null,J*=2}while(W>1)}(U)}(c,h,g,v);let A=c;for(;c.prev!==c.next;){const C=c.prev,D=c.next;if(v?Z5(c,h,g,v):q5(c))i.push(C.i,c.i,D.i),Hf(c),c=D.next,A=D.next;else if((c=D)===A){b?b===1?Gf(c=H5(dc(c),i),i,l,h,g,v,2):b===2&&$5(c,i,l,h,g,v):Gf(dc(c),i,l,h,g,v,1);break}}}function q5(c){const i=c.prev,l=c,h=c.next;if(qi(i,l,h)>=0)return!1;const g=i.x,v=l.x,b=h.x,A=i.y,C=l.y,D=h.y,R=Math.min(g,v,b),O=Math.min(A,C,D),U=Math.max(g,v,b),Z=Math.max(A,C,D);let W=h.next;for(;W!==i;){if(W.x>=R&&W.x<=U&&W.y>=O&&W.y<=Z&&qf(g,A,v,C,b,D,W.x,W.y)&&qi(W.prev,W,W.next)>=0)return!1;W=W.next}return!0}function Z5(c,i,l,h){const g=c.prev,v=c,b=c.next;if(qi(g,v,b)>=0)return!1;const A=g.x,C=v.x,D=b.x,R=g.y,O=v.y,U=b.y,Z=Math.min(A,C,D),W=Math.min(R,O,U),J=Math.max(A,C,D),ie=Math.max(R,O,U),fe=t0(Z,W,i,l,h),Me=t0(J,ie,i,l,h);let ye=c.prevZ,q=c.nextZ;for(;ye&&ye.z>=fe&&q&&q.z<=Me;){if(ye.x>=Z&&ye.x<=J&&ye.y>=W&&ye.y<=ie&&ye!==g&&ye!==b&&qf(A,R,C,O,D,U,ye.x,ye.y)&&qi(ye.prev,ye,ye.next)>=0||(ye=ye.prevZ,q.x>=Z&&q.x<=J&&q.y>=W&&q.y<=ie&&q!==g&&q!==b&&qf(A,R,C,O,D,U,q.x,q.y)&&qi(q.prev,q,q.next)>=0))return!1;q=q.nextZ}for(;ye&&ye.z>=fe;){if(ye.x>=Z&&ye.x<=J&&ye.y>=W&&ye.y<=ie&&ye!==g&&ye!==b&&qf(A,R,C,O,D,U,ye.x,ye.y)&&qi(ye.prev,ye,ye.next)>=0)return!1;ye=ye.prevZ}for(;q&&q.z<=Me;){if(q.x>=Z&&q.x<=J&&q.y>=W&&q.y<=ie&&q!==g&&q!==b&&qf(A,R,C,O,D,U,q.x,q.y)&&qi(q.prev,q,q.next)>=0)return!1;q=q.nextZ}return!0}function H5(c,i){let l=c;do{const h=l.prev,g=l.next.next;!Fu(h,g)&&aw(h,l,l.next,g)&&Zf(h,g)&&Zf(g,h)&&(i.push(h.i,l.i,g.i),Hf(l),Hf(l.next),l=c=g),l=l.next}while(l!==c);return dc(l)}function $5(c,i,l,h,g,v){let b=c;do{let A=b.next.next;for(;A!==b.prev;){if(b.i!==A.i&&K5(b,A)){let C=ow(b,A);return b=dc(b,b.next),C=dc(C,C.next),Gf(b,i,l,h,g,v,0),void Gf(C,i,l,h,g,v,0)}A=A.next}b=b.next}while(b!==c)}function W5(c,i){let l=c.x-i.x;return l===0&&(l=c.y-i.y,l===0)&&(l=(c.next.y-c.y)/(c.next.x-c.x)-(i.next.y-i.y)/(i.next.x-i.x)),l}function Y5(c,i){const l=function(g,v){let b=v;const A=g.x,C=g.y;let D,R=-1/0;if(Fu(g,b))return b;do{if(Fu(g,b.next))return b.next;if(C<=b.y&&C>=b.next.y&&b.next.y!==b.y){const J=b.x+(C-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(J<=A&&J>R&&(R=J,D=b.x<b.next.x?b:b.next,J===A))return D}b=b.next}while(b!==v);if(!D)return null;const O=D,U=D.x,Z=D.y;let W=1/0;b=D;do{if(A>=b.x&&b.x>=U&&A!==b.x&&rw(C<Z?A:R,C,U,Z,C<Z?R:A,C,b.x,b.y)){const J=Math.abs(C-b.y)/(A-b.x);Zf(b,g)&&(J<W||J===W&&(b.x>D.x||b.x===D.x&&X5(D,b)))&&(D=b,W=J)}b=b.next}while(b!==O);return D}(c,i);if(!l)return i;const h=ow(l,c);return dc(h,h.next),dc(l,l.next)}function X5(c,i){return qi(c.prev,c,i.prev)<0&&qi(i.next,c,c.next)<0}function t0(c,i,l,h,g){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-l)*g|0)|c<<8))|c<<4))|c<<2))|c<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-h)*g|0)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function Q5(c){let i=c,l=c;do(i.x<l.x||i.x===l.x&&i.y<l.y)&&(l=i),i=i.next;while(i!==c);return l}function rw(c,i,l,h,g,v,b,A){return(g-b)*(i-A)>=(c-b)*(v-A)&&(c-b)*(h-A)>=(l-b)*(i-A)&&(l-b)*(v-A)>=(g-b)*(h-A)}function qf(c,i,l,h,g,v,b,A){return!(c===b&&i===A)&&rw(c,i,l,h,g,v,b,A)}function K5(c,i){return c.next.i!==i.i&&c.prev.i!==i.i&&!function(l,h){let g=l;do{if(g.i!==l.i&&g.next.i!==l.i&&g.i!==h.i&&g.next.i!==h.i&&aw(g,g.next,l,h))return!0;g=g.next}while(g!==l);return!1}(c,i)&&(Zf(c,i)&&Zf(i,c)&&function(l,h){let g=l,v=!1;const b=(l.x+h.x)/2,A=(l.y+h.y)/2;do g.y>A!=g.next.y>A&&g.next.y!==g.y&&b<(g.next.x-g.x)*(A-g.y)/(g.next.y-g.y)+g.x&&(v=!v),g=g.next;while(g!==l);return v}(c,i)&&(qi(c.prev,c,i.prev)||qi(c,i.prev,i))||Fu(c,i)&&qi(c.prev,c,c.next)>0&&qi(i.prev,i,i.next)>0)}function qi(c,i,l){return(i.y-c.y)*(l.x-i.x)-(i.x-c.x)*(l.y-i.y)}function Fu(c,i){return c.x===i.x&&c.y===i.y}function aw(c,i,l,h){const g=wm(qi(c,i,l)),v=wm(qi(c,i,h)),b=wm(qi(l,h,c)),A=wm(qi(l,h,i));return g!==v&&b!==A||!(g!==0||!xm(c,l,i))||!(v!==0||!xm(c,h,i))||!(b!==0||!xm(l,c,h))||!(A!==0||!xm(l,i,h))}function xm(c,i,l){return i.x<=Math.max(c.x,l.x)&&i.x>=Math.min(c.x,l.x)&&i.y<=Math.max(c.y,l.y)&&i.y>=Math.min(c.y,l.y)}function wm(c){return c>0?1:c<0?-1:0}function Zf(c,i){return qi(c.prev,c,c.next)<0?qi(c,i,c.next)>=0&&qi(c,c.prev,i)>=0:qi(c,i,c.prev)<0||qi(c,c.next,i)<0}function ow(c,i){const l=n0(c.i,c.x,c.y),h=n0(i.i,i.x,i.y),g=c.next,v=i.prev;return c.next=i,i.prev=c,l.next=g,g.prev=l,h.next=l,l.prev=h,v.next=h,h.prev=v,h}function sw(c,i,l,h){const g=n0(c,i,l);return h?(g.next=h.next,g.prev=h,h.next.prev=g,h.next=g):(g.prev=g,g.next=g),g}function Hf(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function n0(c,i,l){return{i:c,x:i,y:l,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class Ou{constructor(i,l){if(l>i)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=i,this._minGranularity=l}getGranularityForZoomLevel(i){return Math.max(Math.floor(this._baseZoomGranularity/(1<<i)),this._minGranularity,1)}}class Am{constructor(i){this.fill=i.fill,this.line=i.line,this.tile=i.tile,this.stencil=i.stencil,this.circle=i.circle}}Am.noSubdivision=new Am({fill:new Ou(0,0),line:new Ou(0,0),tile:new Ou(0,0),stencil:new Ou(0,0),circle:1}),Gt("SubdivisionGranularityExpression",Ou),Gt("SubdivisionGranularitySetting",Am);const Nu=-32768,$f=32767;class J5{constructor(i,l){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=i,this._granularityCellSize=ct/i,this._canonical=l}_getKey(i,l){return(i+=32768)<<16|l+32768}_vertexToIndex(i,l){if(i<-32768||l<-32768||i>32767||l>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const h=0|Math.round(i),g=0|Math.round(l),v=this._getKey(h,g);if(this._vertexDictionary.has(v))return this._vertexDictionary.get(v);const b=this._vertexBuffer.length/2;return this._vertexDictionary.set(v,b),this._vertexBuffer.push(h,g),b}_subdivideTrianglesScanline(i){if(this._granularity<2)return function(g,v){const b=[];for(let A=0;A<v.length;A+=3){const C=v[A],D=v[A+1],R=v[A+2],O=g[2*C],U=g[2*C+1];(g[2*D]-O)*(g[2*R+1]-U)-(g[2*D+1]-U)*(g[2*R]-O)>0?(b.push(C),b.push(R),b.push(D)):(b.push(C),b.push(D),b.push(R))}return b}(this._vertexBuffer,i);const l=[],h=i.length;for(let g=0;g<h;g+=3){const v=[i[g+0],i[g+1],i[g+2]],b=[this._vertexBuffer[2*i[g+0]+0],this._vertexBuffer[2*i[g+0]+1],this._vertexBuffer[2*i[g+1]+0],this._vertexBuffer[2*i[g+1]+1],this._vertexBuffer[2*i[g+2]+0],this._vertexBuffer[2*i[g+2]+1]];let A=1/0,C=1/0,D=-1/0,R=-1/0;for(let J=0;J<3;J++){const ie=b[2*J],fe=b[2*J+1];A=Math.min(A,ie),D=Math.max(D,ie),C=Math.min(C,fe),R=Math.max(R,fe)}if(A===D||C===R)continue;const O=Math.floor(A/this._granularityCellSize),U=Math.ceil(D/this._granularityCellSize),Z=Math.floor(C/this._granularityCellSize),W=Math.ceil(R/this._granularityCellSize);if(O!==U||Z!==W)for(let J=Z;J<W;J++){const ie=this._scanlineGenerateVertexRingForCellRow(J,b,v);ek(this._vertexBuffer,ie,l)}else l.push(...v)}return l}_scanlineGenerateVertexRingForCellRow(i,l,h){const g=i*this._granularityCellSize,v=g+this._granularityCellSize,b=[];for(let A=0;A<3;A++){const C=l[2*A],D=l[2*A+1],R=l[2*(A+1)%6],O=l[(2*(A+1)+1)%6],U=l[2*(A+2)%6],Z=l[(2*(A+2)+1)%6],W=R-C,J=O-D,ie=W===0,fe=J===0,Me=(g-D)/J,ye=(v-D)/J,q=Math.min(Me,ye),ne=Math.max(Me,ye);if(!fe&&(q>=1||ne<=0)||fe&&(D<g||D>v)){O>=g&&O<=v&&b.push(h[(A+1)%3]);continue}!fe&&q>0&&b.push(this._vertexToIndex(C+W*q,D+J*q));const ve=C+W*Math.max(q,0),Ue=C+W*Math.min(ne,1);ie||this._generateIntraEdgeVertices(b,C,D,R,O,ve,Ue),!fe&&ne<1&&b.push(this._vertexToIndex(C+W*ne,D+J*ne)),(fe||O>=g&&O<=v)&&b.push(h[(A+1)%3]),!fe&&(O<=g||O>=v)&&this._generateInterEdgeVertices(b,C,D,R,O,U,Z,Ue,g,v)}return b}_generateIntraEdgeVertices(i,l,h,g,v,b,A){const C=g-l,D=v-h,R=D===0,O=R?Math.min(l,g):Math.min(b,A),U=R?Math.max(l,g):Math.max(b,A),Z=Math.floor(O/this._granularityCellSize)+1,W=Math.ceil(U/this._granularityCellSize)-1;if(R?l<g:b<A)for(let J=Z;J<=W;J++){const ie=J*this._granularityCellSize;i.push(this._vertexToIndex(ie,h+D*(ie-l)/C))}else for(let J=W;J>=Z;J--){const ie=J*this._granularityCellSize;i.push(this._vertexToIndex(ie,h+D*(ie-l)/C))}}_generateInterEdgeVertices(i,l,h,g,v,b,A,C,D,R){const O=v-h,U=b-g,Z=A-v,W=(D-v)/Z,J=(R-v)/Z,ie=Math.min(W,J),fe=Math.max(W,J),Me=g+U*ie;let ye=Math.floor(Math.min(Me,C)/this._granularityCellSize)+1,q=Math.ceil(Math.max(Me,C)/this._granularityCellSize)-1,ne=C<Me;const ve=Z===0;if(ve&&(A===D||A===R))return;if(ve||ie>=1||fe<=0){const ut=h-A,Ye=b+(l-b)*Math.min((D-A)/ut,(R-A)/ut);ye=Math.floor(Math.min(Ye,C)/this._granularityCellSize)+1,q=Math.ceil(Math.max(Ye,C)/this._granularityCellSize)-1,ne=C<Ye}const Ue=O>0?R:D;if(ne)for(let ut=ye;ut<=q;ut++)i.push(this._vertexToIndex(ut*this._granularityCellSize,Ue));else for(let ut=q;ut>=ye;ut--)i.push(this._vertexToIndex(ut*this._granularityCellSize,Ue))}_generateOutline(i){const l=[];for(const h of i){const g=pc(h,this._granularity,!0),v=this._pointArrayToIndices(g),b=[];for(let A=1;A<v.length;A++)b.push(v[A-1]),b.push(v[A]);l.push(b)}return l}_handlePoles(i){let l=!1,h=!1;this._canonical&&(this._canonical.y===0&&(l=!0),this._canonical.y===(1<<this._canonical.z)-1&&(h=!0)),(l||h)&&this._fillPoles(i,l,h)}_ensureNoPoleVertices(){const i=this._vertexBuffer;for(let l=0;l<i.length;l+=2){const h=i[l+1];h===Nu&&(i[l+1]=-32767),h===$f&&(i[l+1]=32766)}}_generatePoleQuad(i,l,h,g,v,b){g>v!=(b===Nu)?(i.push(l),i.push(h),i.push(this._vertexToIndex(g,b)),i.push(h),i.push(this._vertexToIndex(v,b)),i.push(this._vertexToIndex(g,b))):(i.push(h),i.push(l),i.push(this._vertexToIndex(g,b)),i.push(this._vertexToIndex(v,b)),i.push(h),i.push(this._vertexToIndex(g,b)))}_fillPoles(i,l,h){const g=this._vertexBuffer,v=ct,b=i.length;for(let A=2;A<b;A+=3){const C=i[A-2],D=i[A-1],R=i[A],O=g[2*C],U=g[2*C+1],Z=g[2*D],W=g[2*D+1],J=g[2*R],ie=g[2*R+1];l&&(U===0&&W===0&&this._generatePoleQuad(i,C,D,O,Z,Nu),W===0&&ie===0&&this._generatePoleQuad(i,D,R,Z,J,Nu),ie===0&&U===0&&this._generatePoleQuad(i,R,C,J,O,Nu)),h&&(U===v&&W===v&&this._generatePoleQuad(i,C,D,O,Z,$f),W===v&&ie===v&&this._generatePoleQuad(i,D,R,Z,J,$f),ie===v&&U===v&&this._generatePoleQuad(i,R,C,J,O,$f))}}_initializeVertices(i){for(let l=0;l<i.length;l+=2)this._vertexToIndex(i[l],i[l+1])}subdividePolygonInternal(i,l){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:h,holeIndices:g}=function(A){const C=[],D=[];for(const R of A)if(R.length!==0){R!==A[0]&&C.push(D.length/2);for(let O=0;O<R.length;O++)D.push(R[O].x),D.push(R[O].y)}return{flattened:D,holeIndices:C}}(i);let v;this._initializeVertices(h);try{const A=function(D,R,O=2){const U=R&&R.length,Z=U?R[0]*O:D.length;let W=iw(D,0,Z,O,!0);const J=[];if(!W||W.next===W.prev)return J;let ie,fe,Me;if(U&&(W=function(ye,q,ne,ve){const Ue=[];for(let ut=0,Ye=q.length;ut<Ye;ut++){const et=iw(ye,q[ut]*ve,ut<Ye-1?q[ut+1]*ve:ye.length,ve,!1);et===et.next&&(et.steiner=!0),Ue.push(Q5(et))}Ue.sort(W5);for(let ut=0;ut<Ue.length;ut++)ne=Y5(Ue[ut],ne);return ne}(D,R,W,O)),D.length>80*O){ie=1/0,fe=1/0;let ye=-1/0,q=-1/0;for(let ne=O;ne<Z;ne+=O){const ve=D[ne],Ue=D[ne+1];ve<ie&&(ie=ve),Ue<fe&&(fe=Ue),ve>ye&&(ye=ve),Ue>q&&(q=Ue)}Me=Math.max(ye-ie,q-fe),Me=Me!==0?32767/Me:0}return Gf(W,J,O,ie,fe,Me,0),J}(h,g),C=this._convertIndices(h,A);v=this._subdivideTrianglesScanline(C)}catch(A){console.error(A)}let b=[];return l&&(b=this._generateOutline(i)),this._ensureNoPoleVertices(),this._handlePoles(v),{verticesFlattened:this._vertexBuffer,indicesTriangles:v,indicesLineList:b}}_convertIndices(i,l){const h=[];for(let g=0;g<l.length;g++)h.push(this._vertexToIndex(i[2*l[g]],i[2*l[g]+1]));return h}_pointArrayToIndices(i){const l=[];for(let h=0;h<i.length;h++){const g=i[h];l.push(this._vertexToIndex(g.x,g.y))}return l}}function lw(c,i,l,h=!0){return new J5(l,i).subdividePolygonInternal(c,h)}function pc(c,i,l=!1){if(!c||c.length<1)return[];if(c.length<2)return[];const h=c[0],g=c[c.length-1],v=l&&(h.x!==g.x||h.y!==g.y);if(i<2)return v?[...c,c[0]]:[...c];const b=Math.floor(ct/i),A=[];A.push(new F(c[0].x,c[0].y));const C=c.length,D=v?C:C-1;for(let R=0;R<D;R++){const O=c[R],U=R<C-1?c[R+1]:c[0],Z=O.x,W=O.y,J=U.x,ie=U.y,fe=Z!==J,Me=W!==ie;if(!fe&&!Me)continue;const ye=J-Z,q=ie-W,ne=Math.abs(ye),ve=Math.abs(q);let Ue=Z,ut=W;for(;;){const et=ye>0?(Math.floor(Ue/b)+1)*b:(Math.ceil(Ue/b)-1)*b,vt=q>0?(Math.floor(ut/b)+1)*b:(Math.ceil(ut/b)-1)*b,dt=Math.abs(Ue-et),At=Math.abs(ut-vt),at=Math.abs(Ue-J),Yt=Math.abs(ut-ie),sn=fe?dt/ne:Number.POSITIVE_INFINITY,rn=Me?At/ve:Number.POSITIVE_INFINITY;if((at<=dt||!fe)&&(Yt<=At||!Me))break;if(sn<rn&&fe||!Me){Ue=et,ut+=q*sn;const Jt=new F(Ue,Math.round(ut));A[A.length-1].x===Jt.x&&A[A.length-1].y===Jt.y||A.push(Jt)}else{Ue+=ye*rn,ut=vt;const Jt=new F(Math.round(Ue),ut);A[A.length-1].x===Jt.x&&A[A.length-1].y===Jt.y||A.push(Jt)}}const Ye=new F(J,ie);A[A.length-1].x===Ye.x&&A[A.length-1].y===Ye.y||A.push(Ye)}return A}function ek(c,i,l){if(i.length===0)throw new Error("Subdivision vertex ring is empty.");let h=0,g=c[2*i[0]];for(let C=1;C<i.length;C++){const D=c[2*i[C]];D<g&&(g=D,h=C)}const v=i.length;let b=h,A=(b+1)%v;for(;;){const C=b-1>=0?b-1:v-1,D=(A+1)%v,R=c[2*i[C]],O=c[2*i[D]],U=c[2*i[b]],Z=c[2*i[b]+1],W=c[2*i[A]+1];let J=!1;if(R<O)J=!0;else if(R>O)J=!1;else{const ie=W-Z,fe=-(c[2*i[A]]-U),Me=Z<W?1:-1;((R-U)*ie+(c[2*i[C]+1]-Z)*fe)*Me>((O-U)*ie+(c[2*i[D]+1]-Z)*fe)*Me&&(J=!0)}if(J){const ie=i[C],fe=i[b],Me=i[A];ie!==fe&&ie!==Me&&fe!==Me&&l.push(Me,fe,ie),b--,b<0&&(b=v-1)}else{const ie=i[D],fe=i[b],Me=i[A];ie!==fe&&ie!==Me&&fe!==Me&&l.push(Me,fe,ie),A++,A>=v&&(A=0)}if(C===D)break}}function cw(c,i,l,h,g,v,b,A,C){const D=g.length/2,R=b&&A&&C;if(D<Wn.MAX_VERTEX_ARRAY_LENGTH){const O=i.prepareSegment(D,l,h),U=O.vertexLength;for(let J=0;J<v.length;J+=3)h.emplaceBack(U+v[J],U+v[J+1],U+v[J+2]);let Z,W;O.vertexLength+=D,O.primitiveLength+=v.length/3,R&&(W=b.prepareSegment(D,l,A),Z=W.vertexLength,W.vertexLength+=D);for(let J=0;J<g.length;J+=2)c(g[J],g[J+1]);if(R)for(let J=0;J<C.length;J++){const ie=C[J];for(let fe=1;fe<ie.length;fe+=2)A.emplaceBack(Z+ie[fe-1],Z+ie[fe]);W.primitiveLength+=ie.length/2}}else(function(O,U,Z,W,J,ie){const fe=[];for(let ve=0;ve<W.length/2;ve++)fe.push(-1);const Me={count:0};let ye=0,q=O.getOrCreateLatestSegment(U,Z),ne=q.vertexLength;for(let ve=2;ve<J.length;ve+=3){const Ue=J[ve-2],ut=J[ve-1],Ye=J[ve];let et=fe[Ue]<ye,vt=fe[ut]<ye,dt=fe[Ye]<ye;q.vertexLength+((et?1:0)+(vt?1:0)+(dt?1:0))>Wn.MAX_VERTEX_ARRAY_LENGTH&&(q=O.createNewSegment(U,Z),ye=Me.count,et=!0,vt=!0,dt=!0,ne=0);const At=Wf(fe,W,ie,Me,Ue,et,q),at=Wf(fe,W,ie,Me,ut,vt,q),Yt=Wf(fe,W,ie,Me,Ye,dt,q);Z.emplaceBack(ne+At-ye,ne+at-ye,ne+Yt-ye),q.primitiveLength++}})(i,l,h,g,v,c),R&&function(O,U,Z,W,J,ie){const fe=[];for(let ve=0;ve<W.length/2;ve++)fe.push(-1);const Me={count:0};let ye=0,q=O.getOrCreateLatestSegment(U,Z),ne=q.vertexLength;for(let ve=0;ve<J.length;ve++){const Ue=J[ve];for(let ut=1;ut<J[ve].length;ut+=2){const Ye=Ue[ut-1],et=Ue[ut];let vt=fe[Ye]<ye,dt=fe[et]<ye;q.vertexLength+((vt?1:0)+(dt?1:0))>Wn.MAX_VERTEX_ARRAY_LENGTH&&(q=O.createNewSegment(U,Z),ye=Me.count,vt=!0,dt=!0,ne=0);const At=Wf(fe,W,ie,Me,Ye,vt,q),at=Wf(fe,W,ie,Me,et,dt,q);Z.emplaceBack(ne+At-ye,ne+at-ye),q.primitiveLength++}}}(b,l,A,g,C,c),i.forceNewSegmentOnNextPrepare(),b==null||b.forceNewSegmentOnNextPrepare()}function Wf(c,i,l,h,g,v,b){if(v){const A=h.count;return l(i[2*g],i[2*g+1]),c[g]=h.count,h.count++,b.vertexLength++,A}return c[g]}class i0{constructor(i){this.zoom=i.zoom,this.globalState=i.globalState,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new We,this.indexArray=new vi,this.indexArray2=new fi,this.programConfigurations=new Lo(i.layers,i.zoom),this.segments=new Wn,this.segments2=new Wn,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,h){this.hasPattern=Jy("fill",this.layers,l);const g=this.layers[0].layout.get("fill-sort-key"),v=!g.isConstant(),b=[];for(const{feature:A,id:C,index:D,sourceLayerIndex:R}of i){const O=this.layers[0]._featureFilter.needGeometry,U=fc(A,O);if(!this.layers[0]._featureFilter.filter(new Pi(this.zoom,{globalState:this.globalState}),U,h))continue;const Z=v?g.evaluate(U,{},h,l.availableImages):void 0,W={id:C,properties:A.properties,type:A.type,sourceLayerIndex:R,index:D,geometry:O?U.geometry:hc(A),patterns:{},sortKey:Z};b.push(W)}v&&b.sort((A,C)=>A.sortKey-C.sortKey);for(const A of b){const{geometry:C,index:D,sourceLayerIndex:R}=A;if(this.hasPattern){const O=e0("fill",this.layers,A,this.zoom,l);this.patternFeatures.push(O)}else this.addFeature(A,C,D,h,{},l.subdivisionGranularity);l.featureIndex.insert(i[D].feature,C,D,R,this.index)}}update(i,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,h)}addFeatures(i,l,h){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,l,h,i.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,G5),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.indexBuffer2=i.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(i,l,h,g,v,b){for(const A of uu(l,500)){const C=lw(A,g,b.fill.getGranularityForZoomLevel(g.z)),D=this.layoutVertexArray;cw((R,O)=>{D.emplaceBack(R,O)},this.segments,this.layoutVertexArray,this.indexArray,C.verticesFlattened,C.indicesTriangles,this.segments2,this.indexArray2,C.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,h,v,g)}}let uw,hw;Gt("FillBucket",i0,{omit:["layers","patternFeatures"]});var tk={get paint(){return hw=hw||new Br({"fill-antialias":new Qt(Ae.paint_fill["fill-antialias"]),"fill-opacity":new un(Ae.paint_fill["fill-opacity"]),"fill-color":new un(Ae.paint_fill["fill-color"]),"fill-outline-color":new un(Ae.paint_fill["fill-outline-color"]),"fill-translate":new Qt(Ae.paint_fill["fill-translate"]),"fill-translate-anchor":new Qt(Ae.paint_fill["fill-translate-anchor"]),"fill-pattern":new zu(Ae.paint_fill["fill-pattern"])})},get layout(){return uw=uw||new Br({"fill-sort-key":new un(Ae.layout_fill["fill-sort-key"])})}};class nk extends mr{constructor(i){super(i,tk)}recalculate(i,l){super.recalculate(i,l);const h=this.paint._values["fill-outline-color"];h.value.kind==="constant"&&h.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new i0(i)}queryRadius(){return vm(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:i,geometry:l,transform:h,pixelsToTileUnits:g}){return Gx(bm(i,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-h.bearingInRadians,g),l)}isTileClipped(){return!0}}const ik=Ni([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),rk=Ni([{name:"a_centroid",components:2,type:"Int16"}],4),{members:ak}=ik;var r0,fw,a0,dw,o0,pw,mw,Tm={};function gw(){if(fw)return r0;fw=1;var c=k();function i(g,v,b,A,C){this.properties={},this.extent=b,this.type=0,this._pbf=g,this._geometry=-1,this._keys=A,this._values=C,g.readFields(l,this,v)}function l(g,v,b){g==1?v.id=b.readVarint():g==2?function(A,C){for(var D=A.readVarint()+A.pos;A.pos<D;){var R=C._keys[A.readVarint()],O=C._values[A.readVarint()];C.properties[R]=O}}(b,v):g==3?v.type=b.readVarint():g==4&&(v._geometry=b.pos)}function h(g){for(var v,b,A=0,C=0,D=g.length,R=D-1;C<D;R=C++)A+=((b=g[R]).x-(v=g[C]).x)*(v.y+b.y);return A}return r0=i,i.types=["Unknown","Point","LineString","Polygon"],i.prototype.loadGeometry=function(){var g=this._pbf;g.pos=this._geometry;for(var v,b=g.readVarint()+g.pos,A=1,C=0,D=0,R=0,O=[];g.pos<b;){if(C<=0){var U=g.readVarint();A=7&U,C=U>>3}if(C--,A===1||A===2)D+=g.readSVarint(),R+=g.readSVarint(),A===1&&(v&&O.push(v),v=[]),v.push(new c(D,R));else{if(A!==7)throw new Error("unknown command "+A);v&&v.push(v[0].clone())}}return v&&O.push(v),O},i.prototype.bbox=function(){var g=this._pbf;g.pos=this._geometry;for(var v=g.readVarint()+g.pos,b=1,A=0,C=0,D=0,R=1/0,O=-1/0,U=1/0,Z=-1/0;g.pos<v;){if(A<=0){var W=g.readVarint();b=7&W,A=W>>3}if(A--,b===1||b===2)(C+=g.readSVarint())<R&&(R=C),C>O&&(O=C),(D+=g.readSVarint())<U&&(U=D),D>Z&&(Z=D);else if(b!==7)throw new Error("unknown command "+b)}return[R,U,O,Z]},i.prototype.toGeoJSON=function(g,v,b){var A,C,D=this.extent*Math.pow(2,b),R=this.extent*g,O=this.extent*v,U=this.loadGeometry(),Z=i.types[this.type];function W(fe){for(var Me=0;Me<fe.length;Me++){var ye=fe[Me];fe[Me]=[360*(ye.x+R)/D-180,360/Math.PI*Math.atan(Math.exp((180-360*(ye.y+O)/D)*Math.PI/180))-90]}}switch(this.type){case 1:var J=[];for(A=0;A<U.length;A++)J[A]=U[A][0];W(U=J);break;case 2:for(A=0;A<U.length;A++)W(U[A]);break;case 3:for(U=function(fe){var Me=fe.length;if(Me<=1)return[fe];for(var ye,q,ne=[],ve=0;ve<Me;ve++){var Ue=h(fe[ve]);Ue!==0&&(q===void 0&&(q=Ue<0),q===Ue<0?(ye&&ne.push(ye),ye=[fe[ve]]):ye.push(fe[ve]))}return ye&&ne.push(ye),ne}(U),A=0;A<U.length;A++)for(C=0;C<U[A].length;C++)W(U[A][C])}U.length===1?U=U[0]:Z="Multi"+Z;var ie={type:"Feature",geometry:{type:Z,coordinates:U},properties:this.properties};return"id"in this&&(ie.id=this.id),ie},r0}function _w(){if(dw)return a0;dw=1;var c=gw();function i(h,g){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=h,this._keys=[],this._values=[],this._features=[],h.readFields(l,this,g),this.length=this._features.length}function l(h,g,v){h===15?g.version=v.readVarint():h===1?g.name=v.readString():h===5?g.extent=v.readVarint():h===2?g._features.push(v.pos):h===3?g._keys.push(v.readString()):h===4&&g._values.push(function(b){for(var A=null,C=b.readVarint()+b.pos;b.pos<C;){var D=b.readVarint()>>3;A=D===1?b.readString():D===2?b.readFloat():D===3?b.readDouble():D===4?b.readVarint64():D===5?b.readVarint():D===6?b.readSVarint():D===7?b.readBoolean():null}return A}(v))}return a0=i,i.prototype.feature=function(h){if(h<0||h>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[h];var g=this._pbf.readVarint()+this._pbf.pos;return new c(this._pbf,g,this.extent,this._keys,this._values)},a0}function yw(){return mw||(mw=1,Tm.VectorTile=function(){if(pw)return o0;pw=1;var c=_w();function i(l,h,g){if(l===3){var v=new c(g,g.readVarint()+g.pos);v.length&&(h[v.name]=v)}}return o0=function(l,h){this.layers=l.readFields(i,{},h)},o0}(),Tm.VectorTileFeature=gw(),Tm.VectorTileLayer=_w()),Tm}var Yf=w(yw());const ok=Yf.VectorTileFeature.types,s0=Math.pow(2,13);function Xf(c,i,l,h,g,v,b,A){c.emplaceBack(i,l,2*Math.floor(h*s0)+b,g*s0*2,v*s0*2,Math.round(A))}class l0{constructor(i){this.zoom=i.zoom,this.globalState=i.globalState,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new zt,this.centroidVertexArray=new Ne,this.indexArray=new vi,this.programConfigurations=new Lo(i.layers,i.zoom),this.segments=new Wn,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,h){this.features=[],this.hasPattern=Jy("fill-extrusion",this.layers,l);for(const{feature:g,id:v,index:b,sourceLayerIndex:A}of i){const C=this.layers[0]._featureFilter.needGeometry,D=fc(g,C);if(!this.layers[0]._featureFilter.filter(new Pi(this.zoom,{globalState:this.globalState}),D,h))continue;const R={id:v,sourceLayerIndex:A,index:b,geometry:C?D.geometry:hc(g),properties:g.properties,type:g.type,patterns:{}};this.hasPattern?this.features.push(e0("fill-extrusion",this.layers,R,this.zoom,l)):this.addFeature(R,R.geometry,b,h,{},l.subdivisionGranularity),l.featureIndex.insert(g,R.geometry,b,A,this.index,!0)}}addFeatures(i,l,h){for(const g of this.features){const{geometry:v}=g;this.addFeature(g,v,g.index,l,h,i.subdivisionGranularity)}}update(i,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,h)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,ak),this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,rk.members,!0),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(i,l,h,g,v,b){for(const A of uu(l,500)){const C={x:0,y:0,sampleCount:0},D=this.layoutVertexArray.length;this.processPolygon(C,g,i,A,b);const R=this.layoutVertexArray.length-D,O=Math.floor(C.x/C.sampleCount),U=Math.floor(C.y/C.sampleCount);for(let Z=0;Z<R;Z++)this.centroidVertexArray.emplaceBack(O,U)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,h,v,g)}processPolygon(i,l,h,g,v){if(g.length<1||vw(g[0]))return;for(const O of g)O.length!==0&&sk(i,O);const b={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},A=v.fill.getGranularityForZoomLevel(l.z),C=ok[h.type]==="Polygon";for(const O of g){if(O.length===0||vw(O))continue;const U=pc(O,A,C);this._generateSideFaces(U,b)}if(!C)return;const D=lw(g,l,A,!1),R=this.layoutVertexArray;cw((O,U)=>{Xf(R,O,U,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,D.verticesFlattened,D.indicesTriangles)}_generateSideFaces(i,l){let h=0;for(let g=1;g<i.length;g++){const v=i[g],b=i[g-1];if(lk(v,b))continue;l.segment.vertexLength+4>Wn.MAX_VERTEX_ARRAY_LENGTH&&(l.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const A=v.sub(b)._perp()._unit(),C=b.dist(v);h+C>32768&&(h=0),Xf(this.layoutVertexArray,v.x,v.y,A.x,A.y,0,0,h),Xf(this.layoutVertexArray,v.x,v.y,A.x,A.y,0,1,h),h+=C,Xf(this.layoutVertexArray,b.x,b.y,A.x,A.y,0,0,h),Xf(this.layoutVertexArray,b.x,b.y,A.x,A.y,0,1,h);const D=l.segment.vertexLength;this.indexArray.emplaceBack(D,D+2,D+1),this.indexArray.emplaceBack(D+1,D+2,D+3),l.segment.vertexLength+=4,l.segment.primitiveLength+=2}}}function sk(c,i){for(let l=0;l<i.length;l++){const h=i[l];l===i.length-1&&i[0].x===h.x&&i[0].y===h.y||(c.x+=h.x,c.y+=h.y,c.sampleCount++)}}function lk(c,i){return c.x===i.x&&(c.x<0||c.x>ct)||c.y===i.y&&(c.y<0||c.y>ct)}function vw(c){return c.every(i=>i.x<0)||c.every(i=>i.x>ct)||c.every(i=>i.y<0)||c.every(i=>i.y>ct)}let bw;Gt("FillExtrusionBucket",l0,{omit:["layers","features"]});var ck={get paint(){return bw=bw||new Br({"fill-extrusion-opacity":new Qt(Ae["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new un(Ae["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Qt(Ae["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Qt(Ae["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new zu(Ae["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new un(Ae["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new un(Ae["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Qt(Ae["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class uk extends mr{constructor(i){super(i,ck)}createBucket(i){return new l0(i)}queryRadius(){return vm(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:i,feature:l,featureState:h,geometry:g,transform:v,pixelsToTileUnits:b,pixelPosMatrix:A}){const C=bm(i,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-v.bearingInRadians,b),D=this.paint.get("fill-extrusion-height").evaluate(l,h),R=this.paint.get("fill-extrusion-base").evaluate(l,h),O=function(Z,W){const J=[];for(const ie of Z){const fe=[ie.x,ie.y,0,1];Pt(fe,fe,W),J.push(new F(fe[0]/fe[3],fe[1]/fe[3]))}return J}(C,A),U=function(Z,W,J,ie){const fe=[],Me=[],ye=ie[8]*W,q=ie[9]*W,ne=ie[10]*W,ve=ie[11]*W,Ue=ie[8]*J,ut=ie[9]*J,Ye=ie[10]*J,et=ie[11]*J;for(const vt of Z){const dt=[],At=[];for(const at of vt){const Yt=at.x,sn=at.y,rn=ie[0]*Yt+ie[4]*sn+ie[12],Jt=ie[1]*Yt+ie[5]*sn+ie[13],Gn=ie[2]*Yt+ie[6]*sn+ie[14],ji=ie[3]*Yt+ie[7]*sn+ie[15],er=Gn+ne,Ir=ji+ve,Ma=rn+Ue,aa=Jt+ut,vr=Gn+Ye,Fi=ji+et,lr=new F((rn+ye)/Ir,(Jt+q)/Ir);lr.z=er/Ir,dt.push(lr);const br=new F(Ma/Fi,aa/Fi);br.z=vr/Fi,At.push(br)}fe.push(dt),Me.push(At)}return[fe,Me]}(g,R,D,A);return function(Z,W,J){let ie=1/0;Gx(J,W)&&(ie=xw(J,W[0]));for(let fe=0;fe<W.length;fe++){const Me=W[fe],ye=Z[fe];for(let q=0;q<Me.length-1;q++){const ne=Me[q],ve=[ne,Me[q+1],ye[q+1],ye[q],ne];Vx(J,ve)&&(ie=Math.min(ie,xw(J,ve)))}}return ie!==1/0&&ie}(U[0],U[1],O)}}function Qf(c,i){return c.x*i.x+c.y*i.y}function xw(c,i){if(c.length===1){let l=0;const h=i[l++];let g;for(;!g||h.equals(g);)if(g=i[l++],!g)return 1/0;for(;l<i.length;l++){const v=i[l],b=c[0],A=g.sub(h),C=v.sub(h),D=b.sub(h),R=Qf(A,A),O=Qf(A,C),U=Qf(C,C),Z=Qf(D,A),W=Qf(D,C),J=R*U-O*O,ie=(U*Z-O*W)/J,fe=(R*W-O*Z)/J,Me=h.z*(1-ie-fe)+g.z*ie+v.z*fe;if(isFinite(Me))return Me}return 1/0}{let l=1/0;for(const h of i)l=Math.min(l,h.z);return l}}const hk=Ni([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:fk}=hk,dk=Ni([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:pk}=dk,mk=Yf.VectorTileFeature.types,gk=Math.cos(Math.PI/180*37.5),ww=Math.pow(2,14)/.5;class c0{constructor(i){this.zoom=i.zoom,this.globalState=i.globalState,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new Ct,this.layoutVertexArray2=new ft,this.indexArray=new vi,this.programConfigurations=new Lo(i.layers,i.zoom),this.segments=new Wn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,h){this.hasPattern=Jy("line",this.layers,l);const g=this.layers[0].layout.get("line-sort-key"),v=!g.isConstant(),b=[];for(const{feature:A,id:C,index:D,sourceLayerIndex:R}of i){const O=this.layers[0]._featureFilter.needGeometry,U=fc(A,O);if(!this.layers[0]._featureFilter.filter(new Pi(this.zoom,{globalState:this.globalState}),U,h))continue;const Z=v?g.evaluate(U,{},h):void 0,W={id:C,properties:A.properties,type:A.type,sourceLayerIndex:R,index:D,geometry:O?U.geometry:hc(A),patterns:{},sortKey:Z};b.push(W)}v&&b.sort((A,C)=>A.sortKey-C.sortKey);for(const A of b){const{geometry:C,index:D,sourceLayerIndex:R}=A;if(this.hasPattern){const O=e0("line",this.layers,A,this.zoom,l);this.patternFeatures.push(O)}else this.addFeature(A,C,D,h,{},l.subdivisionGranularity);l.featureIndex.insert(i[D].feature,C,D,R,this.index)}}update(i,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,h)}addFeatures(i,l,h){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,l,h,i.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,pk)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,fk),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i){if(i.properties&&Object.prototype.hasOwnProperty.call(i.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(i.properties,"mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}}addFeature(i,l,h,g,v,b){const A=this.layers[0].layout,C=A.get("line-join").evaluate(i,{}),D=A.get("line-cap"),R=A.get("line-miter-limit"),O=A.get("line-round-limit");this.lineClips=this.lineFeatureClips(i);for(const U of l)this.addLine(U,i,C,D,R,O,g,b);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,h,v,g)}addLine(i,l,h,g,v,b,A,C){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,i=pc(i,A?C.line.getGranularityForZoomLevel(A.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ye=0;ye<i.length-1;ye++)this.totalDistance+=i[ye].dist(i[ye+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const D=mk[l.type]==="Polygon";let R=i.length;for(;R>=2&&i[R-1].equals(i[R-2]);)R--;let O=0;for(;O<R-1&&i[O].equals(i[O+1]);)O++;if(R<(D?3:2))return;h==="bevel"&&(v=1.05);const U=this.overscaling<=16?122880/(512*this.overscaling):0,Z=this.segments.prepareSegment(10*R,this.layoutVertexArray,this.indexArray);let W,J,ie,fe,Me;this.e1=this.e2=-1,D&&(W=i[R-2],Me=i[O].sub(W)._unit()._perp());for(let ye=O;ye<R;ye++){if(ie=ye===R-1?D?i[O+1]:void 0:i[ye+1],ie&&i[ye].equals(ie))continue;Me&&(fe=Me),W&&(J=W),W=i[ye],Me=ie?ie.sub(W)._unit()._perp():fe,fe=fe||Me;let q=fe.add(Me);q.x===0&&q.y===0||q._unit();const ne=fe.x*Me.x+fe.y*Me.y,ve=q.x*Me.x+q.y*Me.y,Ue=ve!==0?1/ve:1/0,ut=2*Math.sqrt(2-2*ve),Ye=ve<gk&&J&&ie,et=fe.x*Me.y-fe.y*Me.x>0;if(Ye&&ye>O){const At=W.dist(J);if(At>2*U){const at=W.sub(W.sub(J)._mult(U/At)._round());this.updateDistance(J,at),this.addCurrentVertex(at,fe,0,0,Z),J=at}}const vt=J&&ie;let dt=vt?h:D?"butt":g;if(vt&&dt==="round"&&(Ue<b?dt="miter":Ue<=2&&(dt="fakeround")),dt==="miter"&&Ue>v&&(dt="bevel"),dt==="bevel"&&(Ue>2&&(dt="flipbevel"),Ue<v&&(dt="miter")),J&&this.updateDistance(J,W),dt==="miter")q._mult(Ue),this.addCurrentVertex(W,q,0,0,Z);else if(dt==="flipbevel"){if(Ue>100)q=Me.mult(-1);else{const At=Ue*fe.add(Me).mag()/fe.sub(Me).mag();q._perp()._mult(At*(et?-1:1))}this.addCurrentVertex(W,q,0,0,Z),this.addCurrentVertex(W,q.mult(-1),0,0,Z)}else if(dt==="bevel"||dt==="fakeround"){const At=-Math.sqrt(Ue*Ue-1),at=et?At:0,Yt=et?0:At;if(J&&this.addCurrentVertex(W,fe,at,Yt,Z),dt==="fakeround"){const sn=Math.round(180*ut/Math.PI/20);for(let rn=1;rn<sn;rn++){let Jt=rn/sn;if(Jt!==.5){const ji=Jt-.5;Jt+=Jt*ji*(Jt-1)*((1.0904+ne*(ne*(3.55645-1.43519*ne)-3.2452))*ji*ji+(.848013+ne*(.215638*ne-1.06021)))}const Gn=Me.sub(fe)._mult(Jt)._add(fe)._unit()._mult(et?-1:1);this.addHalfVertex(W,Gn.x,Gn.y,!1,et,0,Z)}}ie&&this.addCurrentVertex(W,Me,-at,-Yt,Z)}else if(dt==="butt")this.addCurrentVertex(W,q,0,0,Z);else if(dt==="square"){const At=J?1:-1;this.addCurrentVertex(W,q,At,At,Z)}else dt==="round"&&(J&&(this.addCurrentVertex(W,fe,0,0,Z),this.addCurrentVertex(W,fe,1,1,Z,!0)),ie&&(this.addCurrentVertex(W,Me,-1,-1,Z,!0),this.addCurrentVertex(W,Me,0,0,Z)));if(Ye&&ye<R-1){const At=W.dist(ie);if(At>2*U){const at=W.add(ie.sub(W)._mult(U/At)._round());this.updateDistance(W,at),this.addCurrentVertex(at,Me,0,0,Z),W=at}}}}addCurrentVertex(i,l,h,g,v,b=!1){const A=l.y*g-l.x,C=-l.y-l.x*g;this.addHalfVertex(i,l.x+l.y*h,l.y-l.x*h,b,!1,h,v),this.addHalfVertex(i,A,C,b,!0,-g,v),this.distance>ww/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(i,l,h,g,v,b))}addHalfVertex({x:i,y:l},h,g,v,b,A,C){const D=.5*(this.lineClips?this.scaledDistance*(ww-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((i<<1)+(v?1:0),(l<<1)+(b?1:0),Math.round(63*h)+128,Math.round(63*g)+128,1+(A===0?0:A<0?-1:1)|(63&D)<<2,D>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const R=C.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,R,this.e2),C.primitiveLength++),b?this.e2=R:this.e1=R}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(i,l){this.distance+=i.dist(l),this.updateScaledDistance()}}let Aw,Tw;Gt("LineBucket",c0,{omit:["layers","patternFeatures"]});var Sw={get paint(){return Tw=Tw||new Br({"line-opacity":new un(Ae.paint_line["line-opacity"]),"line-color":new un(Ae.paint_line["line-color"]),"line-translate":new Qt(Ae.paint_line["line-translate"]),"line-translate-anchor":new Qt(Ae.paint_line["line-translate-anchor"]),"line-width":new un(Ae.paint_line["line-width"]),"line-gap-width":new un(Ae.paint_line["line-gap-width"]),"line-offset":new un(Ae.paint_line["line-offset"]),"line-blur":new un(Ae.paint_line["line-blur"]),"line-dasharray":new zf(Ae.paint_line["line-dasharray"]),"line-pattern":new zu(Ae.paint_line["line-pattern"]),"line-gradient":new ac(Ae.paint_line["line-gradient"])})},get layout(){return Aw=Aw||new Br({"line-cap":new Qt(Ae.layout_line["line-cap"]),"line-join":new un(Ae.layout_line["line-join"]),"line-miter-limit":new Qt(Ae.layout_line["line-miter-limit"]),"line-round-limit":new Qt(Ae.layout_line["line-round-limit"]),"line-sort-key":new un(Ae.layout_line["line-sort-key"])})}};class _k extends un{possiblyEvaluate(i,l){return l=new Pi(Math.floor(l.zoom),{now:l.now,fadeDuration:l.fadeDuration,zoomHistory:l.zoomHistory,transition:l.transition}),super.possiblyEvaluate(i,l)}evaluate(i,l,h,g){return l=Ke({},l,{zoom:Math.floor(l.zoom)}),super.evaluate(i,l,h,g)}}let Sm;class yk extends mr{constructor(i){super(i,Sw),this.gradientVersion=0,Sm||(Sm=new _k(Sw.paint.properties["line-width"].specification),Sm.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){const l=this.gradientExpression();this.stepInterpolant=!!function(h){return h._styleExpression!==void 0}(l)&&l._styleExpression.expression instanceof Us,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,l){super.recalculate(i,l),this.paint._values["line-floorwidth"]=Sm.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new c0(i)}queryRadius(i){const l=i,h=Mw(Uf("line-width",this,l),Uf("line-gap-width",this,l)),g=Uf("line-offset",this,l);return h/2+Math.abs(g)+vm(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:i,feature:l,featureState:h,geometry:g,transform:v,pixelsToTileUnits:b}){const A=bm(i,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-v.bearingInRadians,b),C=b/2*Mw(this.paint.get("line-width").evaluate(l,h),this.paint.get("line-gap-width").evaluate(l,h)),D=this.paint.get("line-offset").evaluate(l,h);return D&&(g=function(R,O){const U=[];for(let Z=0;Z<R.length;Z++){const W=R[Z],J=[];for(let ie=0;ie<W.length;ie++){const fe=W[ie-1],Me=W[ie],ye=W[ie+1],q=ie===0?new F(0,0):Me.sub(fe)._unit()._perp(),ne=ie===W.length-1?new F(0,0):ye.sub(Me)._unit()._perp(),ve=q._add(ne)._unit(),Ue=ve.x*ne.x+ve.y*ne.y;Ue!==0&&ve._mult(1/Ue),J.push(ve._mult(O)._add(Me))}U.push(J)}return U}(g,D*b)),function(R,O,U){for(let Z=0;Z<O.length;Z++){const W=O[Z];if(R.length>=3){for(let J=0;J<W.length;J++)if(Bu(R,W[J]))return!0}if(k5(R,W,U))return!0}return!1}(A,g,C)}isTileClipped(){return!0}}function Mw(c,i){return i>0?i+2*c:c}const vk=Ni([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),bk=Ni([{name:"a_projected_pos",components:3,type:"Float32"}],4);Ni([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const xk=Ni([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Ni([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Cw=Ni([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),wk=Ni([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Ak(c,i,l){return c.sections.forEach(h=>{h.text=function(g,v,b){const A=v.layout.get("text-transform").evaluate(b,{});return A==="uppercase"?g=g.toLocaleUpperCase():A==="lowercase"&&(g=g.toLocaleLowerCase()),Io.applyArabicShaping&&(g=Io.applyArabicShaping(g)),g}(h.text,i,l)}),c}Ni([{name:"triangle",components:3,type:"Uint16"}]),Ni([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Ni([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Ni([{type:"Float32",name:"offsetX"}]),Ni([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Ni([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Kf={"!":"ï¸","#":"ï¼",$:"ï¼","%":"ï¼","&":"ï¼","(":"ï¸µ",")":"ï¸¶","*":"ï¼","+":"ï¼",",":"ï¸","-":"ï¸²",".":"ã»","/":"ï¼",":":"ï¸",";":"ï¸","<":"ï¸¿","=":"ï¼",">":"ï¹","?":"ï¸","@":"ï¼ ","[":"ï¹","\\":"ï¼¼","]":"ï¹","^":"ï¼¾",_:"ï¸³","`":"ï½","{":"ï¸·","|":"â","}":"ï¸¸","~":"ï½","Â¢":"ï¿ ","Â£":"ï¿¡","Â¥":"ï¿¥","Â¦":"ï¿¤","Â¬":"ï¿¢","Â¯":"ï¿£","â":"ï¸²","â":"ï¸±","â":"ï¹","â":"ï¹","â":"ï¹","â":"ï¹","â¦":"ï¸","â§":"ã»","â©":"ï¿¦","ã":"ï¸","ã":"ï¸","ã":"ï¸¿","ã":"ï¹","ã":"ï¸½","ã":"ï¸¾","ã":"ï¹","ã":"ï¹","ã":"ï¹","ã":"ï¹","ã":"ï¸»","ã":"ï¸¼","ã":"ï¸¹","ã":"ï¸º","ã":"ï¸","ã":"ï¸","ï¼":"ï¸","ï¼":"ï¸µ","ï¼":"ï¸¶","ï¼":"ï¸","ï¼":"ï¸²","ï¼":"ã»","ï¼":"ï¸","ï¼":"ï¸","ï¼":"ï¸¿","ï¼":"ï¹","ï¼":"ï¸","ï¼»":"ï¹","ï¼½":"ï¹","ï¼¿":"ï¸³","ï½":"ï¸·","ï½":"â","ï½":"ï¸¸","ï½":"ï¸µ","ï½ ":"ï¸¶","ï½¡":"ï¸","ï½¢":"ï¹","ï½£":"ï¹"};var Iw,u0,Ew,sr=24,h0={};function Tk(){return Iw||(Iw=1,h0.read=function(c,i,l,h,g){var v,b,A=8*g-h-1,C=(1<<A)-1,D=C>>1,R=-7,O=l?g-1:0,U=l?-1:1,Z=c[i+O];for(O+=U,v=Z&(1<<-R)-1,Z>>=-R,R+=A;R>0;v=256*v+c[i+O],O+=U,R-=8);for(b=v&(1<<-R)-1,v>>=-R,R+=h;R>0;b=256*b+c[i+O],O+=U,R-=8);if(v===0)v=1-D;else{if(v===C)return b?NaN:1/0*(Z?-1:1);b+=Math.pow(2,h),v-=D}return(Z?-1:1)*b*Math.pow(2,v-h)},h0.write=function(c,i,l,h,g,v){var b,A,C,D=8*v-g-1,R=(1<<D)-1,O=R>>1,U=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,Z=h?0:v-1,W=h?1:-1,J=i<0||i===0&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(A=isNaN(i)?1:0,b=R):(b=Math.floor(Math.log(i)/Math.LN2),i*(C=Math.pow(2,-b))<1&&(b--,C*=2),(i+=b+O>=1?U/C:U*Math.pow(2,1-O))*C>=2&&(b++,C/=2),b+O>=R?(A=0,b=R):b+O>=1?(A=(i*C-1)*Math.pow(2,g),b+=O):(A=i*Math.pow(2,O-1)*Math.pow(2,g),b=0));g>=8;c[l+Z]=255&A,Z+=W,A/=256,g-=8);for(b=b<<g|A,D+=g;D>0;c[l+Z]=255&b,Z+=W,b/=256,D-=8);c[l+Z-W]|=128*J}),h0}function Pw(){if(Ew)return u0;Ew=1,u0=i;var c=Tk();function i(q){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(q)?q:new Uint8Array(q||0),this.pos=0,this.type=0,this.length=this.buf.length}i.Varint=0,i.Fixed64=1,i.Bytes=2,i.Fixed32=5;var l=4294967296,h=1/l,g=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function v(q){return q.type===i.Bytes?q.readVarint()+q.pos:q.pos+1}function b(q,ne,ve){return ve?4294967296*ne+(q>>>0):4294967296*(ne>>>0)+(q>>>0)}function A(q,ne,ve){var Ue=ne<=16383?1:ne<=2097151?2:ne<=268435455?3:Math.floor(Math.log(ne)/(7*Math.LN2));ve.realloc(Ue);for(var ut=ve.pos-1;ut>=q;ut--)ve.buf[ut+Ue]=ve.buf[ut]}function C(q,ne){for(var ve=0;ve<q.length;ve++)ne.writeVarint(q[ve])}function D(q,ne){for(var ve=0;ve<q.length;ve++)ne.writeSVarint(q[ve])}function R(q,ne){for(var ve=0;ve<q.length;ve++)ne.writeFloat(q[ve])}function O(q,ne){for(var ve=0;ve<q.length;ve++)ne.writeDouble(q[ve])}function U(q,ne){for(var ve=0;ve<q.length;ve++)ne.writeBoolean(q[ve])}function Z(q,ne){for(var ve=0;ve<q.length;ve++)ne.writeFixed32(q[ve])}function W(q,ne){for(var ve=0;ve<q.length;ve++)ne.writeSFixed32(q[ve])}function J(q,ne){for(var ve=0;ve<q.length;ve++)ne.writeFixed64(q[ve])}function ie(q,ne){for(var ve=0;ve<q.length;ve++)ne.writeSFixed64(q[ve])}function fe(q,ne){return(q[ne]|q[ne+1]<<8|q[ne+2]<<16)+16777216*q[ne+3]}function Me(q,ne,ve){q[ve]=ne,q[ve+1]=ne>>>8,q[ve+2]=ne>>>16,q[ve+3]=ne>>>24}function ye(q,ne){return(q[ne]|q[ne+1]<<8|q[ne+2]<<16)+(q[ne+3]<<24)}return i.prototype={destroy:function(){this.buf=null},readFields:function(q,ne,ve){for(ve=ve||this.length;this.pos<ve;){var Ue=this.readVarint(),ut=Ue>>3,Ye=this.pos;this.type=7&Ue,q(ut,ne,this),this.pos===Ye&&this.skip(Ue)}return ne},readMessage:function(q,ne){return this.readFields(q,ne,this.readVarint()+this.pos)},readFixed32:function(){var q=fe(this.buf,this.pos);return this.pos+=4,q},readSFixed32:function(){var q=ye(this.buf,this.pos);return this.pos+=4,q},readFixed64:function(){var q=fe(this.buf,this.pos)+fe(this.buf,this.pos+4)*l;return this.pos+=8,q},readSFixed64:function(){var q=fe(this.buf,this.pos)+ye(this.buf,this.pos+4)*l;return this.pos+=8,q},readFloat:function(){var q=c.read(this.buf,this.pos,!0,23,4);return this.pos+=4,q},readDouble:function(){var q=c.read(this.buf,this.pos,!0,52,8);return this.pos+=8,q},readVarint:function(q){var ne,ve,Ue=this.buf;return ne=127&(ve=Ue[this.pos++]),ve<128?ne:(ne|=(127&(ve=Ue[this.pos++]))<<7,ve<128?ne:(ne|=(127&(ve=Ue[this.pos++]))<<14,ve<128?ne:(ne|=(127&(ve=Ue[this.pos++]))<<21,ve<128?ne:function(ut,Ye,et){var vt,dt,At=et.buf;if(vt=(112&(dt=At[et.pos++]))>>4,dt<128||(vt|=(127&(dt=At[et.pos++]))<<3,dt<128)||(vt|=(127&(dt=At[et.pos++]))<<10,dt<128)||(vt|=(127&(dt=At[et.pos++]))<<17,dt<128)||(vt|=(127&(dt=At[et.pos++]))<<24,dt<128)||(vt|=(1&(dt=At[et.pos++]))<<31,dt<128))return b(ut,vt,Ye);throw new Error("Expected varint not more than 10 bytes")}(ne|=(15&(ve=Ue[this.pos]))<<28,q,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var q=this.readVarint();return q%2==1?(q+1)/-2:q/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var q=this.readVarint()+this.pos,ne=this.pos;return this.pos=q,q-ne>=12&&g?function(ve,Ue,ut){return g.decode(ve.subarray(Ue,ut))}(this.buf,ne,q):function(ve,Ue,ut){for(var Ye="",et=Ue;et<ut;){var vt,dt,At,at=ve[et],Yt=null,sn=at>239?4:at>223?3:at>191?2:1;if(et+sn>ut)break;sn===1?at<128&&(Yt=at):sn===2?(192&(vt=ve[et+1]))==128&&(Yt=(31&at)<<6|63&vt)<=127&&(Yt=null):sn===3?(dt=ve[et+2],(192&(vt=ve[et+1]))==128&&(192&dt)==128&&((Yt=(15&at)<<12|(63&vt)<<6|63&dt)<=2047||Yt>=55296&&Yt<=57343)&&(Yt=null)):sn===4&&(dt=ve[et+2],At=ve[et+3],(192&(vt=ve[et+1]))==128&&(192&dt)==128&&(192&At)==128&&((Yt=(15&at)<<18|(63&vt)<<12|(63&dt)<<6|63&At)<=65535||Yt>=1114112)&&(Yt=null)),Yt===null?(Yt=65533,sn=1):Yt>65535&&(Yt-=65536,Ye+=String.fromCharCode(Yt>>>10&1023|55296),Yt=56320|1023&Yt),Ye+=String.fromCharCode(Yt),et+=sn}return Ye}(this.buf,ne,q)},readBytes:function(){var q=this.readVarint()+this.pos,ne=this.buf.subarray(this.pos,q);return this.pos=q,ne},readPackedVarint:function(q,ne){if(this.type!==i.Bytes)return q.push(this.readVarint(ne));var ve=v(this);for(q=q||[];this.pos<ve;)q.push(this.readVarint(ne));return q},readPackedSVarint:function(q){if(this.type!==i.Bytes)return q.push(this.readSVarint());var ne=v(this);for(q=q||[];this.pos<ne;)q.push(this.readSVarint());return q},readPackedBoolean:function(q){if(this.type!==i.Bytes)return q.push(this.readBoolean());var ne=v(this);for(q=q||[];this.pos<ne;)q.push(this.readBoolean());return q},readPackedFloat:function(q){if(this.type!==i.Bytes)return q.push(this.readFloat());var ne=v(this);for(q=q||[];this.pos<ne;)q.push(this.readFloat());return q},readPackedDouble:function(q){if(this.type!==i.Bytes)return q.push(this.readDouble());var ne=v(this);for(q=q||[];this.pos<ne;)q.push(this.readDouble());return q},readPackedFixed32:function(q){if(this.type!==i.Bytes)return q.push(this.readFixed32());var ne=v(this);for(q=q||[];this.pos<ne;)q.push(this.readFixed32());return q},readPackedSFixed32:function(q){if(this.type!==i.Bytes)return q.push(this.readSFixed32());var ne=v(this);for(q=q||[];this.pos<ne;)q.push(this.readSFixed32());return q},readPackedFixed64:function(q){if(this.type!==i.Bytes)return q.push(this.readFixed64());var ne=v(this);for(q=q||[];this.pos<ne;)q.push(this.readFixed64());return q},readPackedSFixed64:function(q){if(this.type!==i.Bytes)return q.push(this.readSFixed64());var ne=v(this);for(q=q||[];this.pos<ne;)q.push(this.readSFixed64());return q},skip:function(q){var ne=7&q;if(ne===i.Varint)for(;this.buf[this.pos++]>127;);else if(ne===i.Bytes)this.pos=this.readVarint()+this.pos;else if(ne===i.Fixed32)this.pos+=4;else{if(ne!==i.Fixed64)throw new Error("Unimplemented type: "+ne);this.pos+=8}},writeTag:function(q,ne){this.writeVarint(q<<3|ne)},realloc:function(q){for(var ne=this.length||16;ne<this.pos+q;)ne*=2;if(ne!==this.length){var ve=new Uint8Array(ne);ve.set(this.buf),this.buf=ve,this.length=ne}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(q){this.realloc(4),Me(this.buf,q,this.pos),this.pos+=4},writeSFixed32:function(q){this.realloc(4),Me(this.buf,q,this.pos),this.pos+=4},writeFixed64:function(q){this.realloc(8),Me(this.buf,-1&q,this.pos),Me(this.buf,Math.floor(q*h),this.pos+4),this.pos+=8},writeSFixed64:function(q){this.realloc(8),Me(this.buf,-1&q,this.pos),Me(this.buf,Math.floor(q*h),this.pos+4),this.pos+=8},writeVarint:function(q){(q=+q||0)>268435455||q<0?function(ne,ve){var Ue,ut;if(ne>=0?(Ue=ne%4294967296|0,ut=ne/4294967296|0):(ut=~(-ne/4294967296),4294967295^(Ue=~(-ne%4294967296))?Ue=Ue+1|0:(Ue=0,ut=ut+1|0)),ne>=18446744073709552e3||ne<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");ve.realloc(10),function(Ye,et,vt){vt.buf[vt.pos++]=127&Ye|128,Ye>>>=7,vt.buf[vt.pos++]=127&Ye|128,Ye>>>=7,vt.buf[vt.pos++]=127&Ye|128,Ye>>>=7,vt.buf[vt.pos++]=127&Ye|128,vt.buf[vt.pos]=127&(Ye>>>=7)}(Ue,0,ve),function(Ye,et){var vt=(7&Ye)<<4;et.buf[et.pos++]|=vt|((Ye>>>=3)?128:0),Ye&&(et.buf[et.pos++]=127&Ye|((Ye>>>=7)?128:0),Ye&&(et.buf[et.pos++]=127&Ye|((Ye>>>=7)?128:0),Ye&&(et.buf[et.pos++]=127&Ye|((Ye>>>=7)?128:0),Ye&&(et.buf[et.pos++]=127&Ye|((Ye>>>=7)?128:0),Ye&&(et.buf[et.pos++]=127&Ye)))))}(ut,ve)}(q,this):(this.realloc(4),this.buf[this.pos++]=127&q|(q>127?128:0),q<=127||(this.buf[this.pos++]=127&(q>>>=7)|(q>127?128:0),q<=127||(this.buf[this.pos++]=127&(q>>>=7)|(q>127?128:0),q<=127||(this.buf[this.pos++]=q>>>7&127))))},writeSVarint:function(q){this.writeVarint(q<0?2*-q-1:2*q)},writeBoolean:function(q){this.writeVarint(!!q)},writeString:function(q){q=String(q),this.realloc(4*q.length),this.pos++;var ne=this.pos;this.pos=function(Ue,ut,Ye){for(var et,vt,dt=0;dt<ut.length;dt++){if((et=ut.charCodeAt(dt))>55295&&et<57344){if(!vt){et>56319||dt+1===ut.length?(Ue[Ye++]=239,Ue[Ye++]=191,Ue[Ye++]=189):vt=et;continue}if(et<56320){Ue[Ye++]=239,Ue[Ye++]=191,Ue[Ye++]=189,vt=et;continue}et=vt-55296<<10|et-56320|65536,vt=null}else vt&&(Ue[Ye++]=239,Ue[Ye++]=191,Ue[Ye++]=189,vt=null);et<128?Ue[Ye++]=et:(et<2048?Ue[Ye++]=et>>6|192:(et<65536?Ue[Ye++]=et>>12|224:(Ue[Ye++]=et>>18|240,Ue[Ye++]=et>>12&63|128),Ue[Ye++]=et>>6&63|128),Ue[Ye++]=63&et|128)}return Ye}(this.buf,q,this.pos);var ve=this.pos-ne;ve>=128&&A(ne,ve,this),this.pos=ne-1,this.writeVarint(ve),this.pos+=ve},writeFloat:function(q){this.realloc(4),c.write(this.buf,q,this.pos,!0,23,4),this.pos+=4},writeDouble:function(q){this.realloc(8),c.write(this.buf,q,this.pos,!0,52,8),this.pos+=8},writeBytes:function(q){var ne=q.length;this.writeVarint(ne),this.realloc(ne);for(var ve=0;ve<ne;ve++)this.buf[this.pos++]=q[ve]},writeRawMessage:function(q,ne){this.pos++;var ve=this.pos;q(ne,this);var Ue=this.pos-ve;Ue>=128&&A(ve,Ue,this),this.pos=ve-1,this.writeVarint(Ue),this.pos+=Ue},writeMessage:function(q,ne,ve){this.writeTag(q,i.Bytes),this.writeRawMessage(ne,ve)},writePackedVarint:function(q,ne){ne.length&&this.writeMessage(q,C,ne)},writePackedSVarint:function(q,ne){ne.length&&this.writeMessage(q,D,ne)},writePackedBoolean:function(q,ne){ne.length&&this.writeMessage(q,U,ne)},writePackedFloat:function(q,ne){ne.length&&this.writeMessage(q,R,ne)},writePackedDouble:function(q,ne){ne.length&&this.writeMessage(q,O,ne)},writePackedFixed32:function(q,ne){ne.length&&this.writeMessage(q,Z,ne)},writePackedSFixed32:function(q,ne){ne.length&&this.writeMessage(q,W,ne)},writePackedFixed64:function(q,ne){ne.length&&this.writeMessage(q,J,ne)},writePackedSFixed64:function(q,ne){ne.length&&this.writeMessage(q,ie,ne)},writeBytesField:function(q,ne){this.writeTag(q,i.Bytes),this.writeBytes(ne)},writeFixed32Field:function(q,ne){this.writeTag(q,i.Fixed32),this.writeFixed32(ne)},writeSFixed32Field:function(q,ne){this.writeTag(q,i.Fixed32),this.writeSFixed32(ne)},writeFixed64Field:function(q,ne){this.writeTag(q,i.Fixed64),this.writeFixed64(ne)},writeSFixed64Field:function(q,ne){this.writeTag(q,i.Fixed64),this.writeSFixed64(ne)},writeVarintField:function(q,ne){this.writeTag(q,i.Varint),this.writeVarint(ne)},writeSVarintField:function(q,ne){this.writeTag(q,i.Varint),this.writeSVarint(ne)},writeStringField:function(q,ne){this.writeTag(q,i.Bytes),this.writeString(ne)},writeFloatField:function(q,ne){this.writeTag(q,i.Fixed32),this.writeFloat(ne)},writeDoubleField:function(q,ne){this.writeTag(q,i.Fixed64),this.writeDouble(ne)},writeBooleanField:function(q,ne){this.writeVarintField(q,!!ne)}},u0}var cl,f0=w(Pw());function Sk(c,i,l){c===1&&l.readMessage(Mk,i)}function Mk(c,i,l){if(c===3){const{id:h,bitmap:g,width:v,height:b,left:A,top:C,advance:D}=l.readMessage(Ck,{});i.push({id:h,bitmap:new Vf({width:v+6,height:b+6},g),metrics:{width:v,height:b,left:A,top:C,advance:D}})}}function Ck(c,i,l){c===1?i.id=l.readVarint():c===2?i.bitmap=l.readBytes():c===3?i.width=l.readVarint():c===4?i.height=l.readVarint():c===5?i.left=l.readSVarint():c===6?i.top=l.readSVarint():c===7&&(i.advance=l.readVarint())}function kw(c){let i=0,l=0;for(const b of c)i+=b.w*b.h,l=Math.max(l,b.w);c.sort((b,A)=>A.h-b.h);const h=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),l),h:1/0}];let g=0,v=0;for(const b of c)for(let A=h.length-1;A>=0;A--){const C=h[A];if(!(b.w>C.w||b.h>C.h)){if(b.x=C.x,b.y=C.y,v=Math.max(v,b.y+b.h),g=Math.max(g,b.x+b.w),b.w===C.w&&b.h===C.h){const D=h.pop();A<h.length&&(h[A]=D)}else b.h===C.h?(C.x+=b.w,C.w-=b.w):b.w===C.w?(C.y+=b.h,C.h-=b.h):(h.push({x:C.x+b.w,y:C.y,w:C.w-b.w,h:b.h}),C.y+=b.h,C.h-=b.h);break}}return{w:g,h:v,fill:i/(g*v)||0}}class d0{constructor(i,{pixelRatio:l,version:h,stretchX:g,stretchY:v,content:b,textFitWidth:A,textFitHeight:C}){this.paddedRect=i,this.pixelRatio=l,this.stretchX=g,this.stretchY=v,this.content=b,this.version=h,this.textFitWidth=A,this.textFitHeight=C}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Dw{constructor(i,l){const h={},g={};this.haveRenderCallbacks=[];const v=[];this.addImages(i,h,v),this.addImages(l,g,v);const{w:b,h:A}=kw(v),C=new ra({width:b||1,height:A||1});for(const D in i){const R=i[D],O=h[D].paddedRect;ra.copy(R.data,C,{x:0,y:0},{x:O.x+1,y:O.y+1},R.data)}for(const D in l){const R=l[D],O=g[D].paddedRect,U=O.x+1,Z=O.y+1,W=R.data.width,J=R.data.height;ra.copy(R.data,C,{x:0,y:0},{x:U,y:Z},R.data),ra.copy(R.data,C,{x:0,y:J-1},{x:U,y:Z-1},{width:W,height:1}),ra.copy(R.data,C,{x:0,y:0},{x:U,y:Z+J},{width:W,height:1}),ra.copy(R.data,C,{x:W-1,y:0},{x:U-1,y:Z},{width:1,height:J}),ra.copy(R.data,C,{x:0,y:0},{x:U+W,y:Z},{width:1,height:J})}this.image=C,this.iconPositions=h,this.patternPositions=g}addImages(i,l,h){for(const g in i){const v=i[g],b={x:0,y:0,w:v.data.width+2,h:v.data.height+2};h.push(b),l[g]=new d0(b,v),v.hasRenderCallback&&this.haveRenderCallbacks.push(g)}}patchUpdatedImages(i,l){i.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const h in i.updatedImages)this.patchUpdatedImage(this.iconPositions[h],i.getImage(h),l),this.patchUpdatedImage(this.patternPositions[h],i.getImage(h),l)}patchUpdatedImage(i,l,h){if(!i||!l||i.version===l.version)return;i.version=l.version;const[g,v]=i.tl;h.update(l.data,void 0,{x:g,y:v})}}Gt("ImagePosition",d0),Gt("ImageAtlas",Dw),p.an=void 0,(cl=p.an||(p.an={}))[cl.none=0]="none",cl[cl.horizontal=1]="horizontal",cl[cl.vertical=2]="vertical",cl[cl.horizontalOnly=3]="horizontalOnly";class Jf{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(i,l,h){const g=new Jf;return g.scale=i||1,g.fontStack=l,g.verticalAlign=h||"bottom",g}static forImage(i,l){const h=new Jf;return h.imageName=i,h.verticalAlign=l||"bottom",h}}class ju{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,l){const h=new ju;for(let g=0;g<i.sections.length;g++){const v=i.sections[g];v.image?h.addImageSection(v):h.addTextSection(v,l)}return h}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSectionIndex(i){return this.sectionIndex[i]}getCharCode(i){return this.text.charCodeAt(i)}verticalizePunctuation(){this.text=function(i){let l="";for(let h=0;h<i.length;h++){const g=i.charCodeAt(h+1)||null,v=i.charCodeAt(h-1)||null;l+=g&&Pf(g)&&!Kf[i[h+1]]||v&&Pf(v)&&!Kf[i[h-1]]||!Kf[i[h]]?i[h]:Kf[i[h]]}return l}(this.text)}trim(){let i=0;for(let h=0;h<this.text.length&&Cm[this.text.charCodeAt(h)];h++)i++;let l=this.text.length;for(let h=this.text.length-1;h>=0&&h>=i&&Cm[this.text.charCodeAt(h)];h--)l--;this.text=this.text.substring(i,l),this.sectionIndex=this.sectionIndex.slice(i,l)}substring(i,l){const h=new ju;return h.text=this.text.substring(i,l),h.sectionIndex=this.sectionIndex.slice(i,l),h.sections=this.sections,h}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,l)=>Math.max(i,this.sections[l].scale),0)}getMaxImageSize(i){let l=0,h=0;for(let g=0;g<this.length();g++){const v=this.getSection(g);if(v.imageName){const b=i[v.imageName];if(!b)continue;const A=b.displaySize;l=Math.max(l,A[0]),h=Math.max(h,A[1])}}return{maxImageWidth:l,maxImageHeight:h}}addTextSection(i,l){this.text+=i.text,this.sections.push(Jf.forText(i.scale,i.fontStack||l,i.verticalAlign));const h=this.sections.length-1;for(let g=0;g<i.text.length;++g)this.sectionIndex.push(h)}addImageSection(i){const l=i.image?i.image.name:"";if(l.length===0)return void ht("Can't add FormattedSection with an empty image.");const h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCharCode(h),this.sections.push(Jf.forImage(l,i.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):ht("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Mm(c,i,l,h,g,v,b,A,C,D,R,O,U,Z,W){const J=ju.fromFeature(c,g);let ie;O===p.an.vertical&&J.verticalizePunctuation();const{processBidirectionalText:fe,processStyledBidirectionalText:Me}=Io;if(fe&&J.sections.length===1){ie=[];const ne=fe(J.toString(),p0(J,D,v,i,h,Z));for(const ve of ne){const Ue=new ju;Ue.text=ve,Ue.sections=J.sections;for(let ut=0;ut<ve.length;ut++)Ue.sectionIndex.push(0);ie.push(Ue)}}else if(Me){ie=[];const ne=Me(J.text,J.sectionIndex,p0(J,D,v,i,h,Z));for(const ve of ne){const Ue=new ju;Ue.text=ve[0],Ue.sectionIndex=ve[1],Ue.sections=J.sections,ie.push(Ue)}}else ie=function(ne,ve){const Ue=[],ut=ne.text;let Ye=0;for(const et of ve)Ue.push(ne.substring(Ye,et)),Ye=et;return Ye<ut.length&&Ue.push(ne.substring(Ye,ut.length)),Ue}(J,p0(J,D,v,i,h,Z));const ye=[],q={positionedLines:ye,text:J.toString(),top:R[1],bottom:R[1],left:R[0],right:R[0],writingMode:O,iconsInText:!1,verticalizable:!1};return function(ne,ve,Ue,ut,Ye,et,vt,dt,At,at,Yt,sn){let rn=0,Jt=0,Gn=0,ji=0;const er=dt==="right"?1:dt==="left"?0:.5,Ir=sr/sn;let Ma=0;for(const Fi of Ye){Fi.trim();const lr=Fi.getMaxScale(),br={positionedGlyphs:[],lineOffset:0};ne.positionedLines[Ma]=br;const xr=br.positionedGlyphs;let Yr=0;if(!Fi.length()){Jt+=et,++Ma;continue}const Ca=kk(ut,Fi,Ir);for(let oa=0;oa<Fi.length();oa++){const tr=Fi.getSection(oa),ur=Fi.getSectionIndex(oa),hr=Fi.getCharCode(oa),$i=Dk(At,Yt,hr);let Ei;if(tr.imageName){if(ne.iconsInText=!0,tr.scale=tr.scale*Ir,Ei=Rk(tr,$i,lr,Ca,ut),!Ei)continue;Yr=Math.max(Yr,Ei.imageOffset)}else if(Ei=zk(tr,hr,$i,Ca,ve,Ue),!Ei)continue;const{rect:so,metrics:qu,baselineOffset:lo}=Ei;xr.push({glyph:hr,imageName:tr.imageName,x:rn,y:Jt+lo+-17,vertical:$i,scale:tr.scale,fontStack:tr.fontStack,sectionIndex:ur,metrics:qu,rect:so}),$i?(ne.verticalizable=!0,rn+=(tr.imageName?qu.advance:sr)*tr.scale+at):rn+=qu.advance*tr.scale+at}xr.length!==0&&(Gn=Math.max(rn-at,Gn),Lk(xr,0,xr.length-1,er)),rn=0,br.lineOffset=Math.max(Yr,(lr-1)*sr);const cr=et*lr+Yr;Jt+=cr,ji=Math.max(cr,ji),++Ma}const{horizontalAlign:aa,verticalAlign:vr}=m0(vt);(function(Fi,lr,br,xr,Yr,Ca,cr,oa,tr){const ur=(lr-br)*Yr;let hr=0;hr=Ca!==cr?-oa*xr- -17:-xr*tr*cr+.5*cr;for(const $i of Fi)for(const Ei of $i.positionedGlyphs)Ei.x+=ur,Ei.y+=hr})(ne.positionedLines,er,aa,vr,Gn,ji,et,Jt,Ye.length),ne.top+=-vr*Jt,ne.bottom=ne.top+Jt,ne.left+=-aa*Gn,ne.right=ne.left+Gn}(q,i,l,h,ie,b,A,C,O,D,U,W),!function(ne){for(const ve of ne)if(ve.positionedGlyphs.length!==0)return!1;return!0}(ye)&&q}const Cm={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Ik={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},Ek={40:!0};function zw(c,i,l,h,g,v){if(i.imageName){const b=h[i.imageName];return b?b.displaySize[0]*i.scale*sr/v+g:0}{const b=l[i.fontStack],A=b&&b[c];return A?A.metrics.advance*i.scale+g:0}}function Rw(c,i,l,h){const g=Math.pow(c-i,2);return h?c<i?g/2:2*g:g+Math.abs(l)*l}function Pk(c,i,l){let h=0;return c===10&&(h-=1e4),l&&(h+=150),c!==40&&c!==65288||(h+=50),i!==41&&i!==65289||(h+=50),h}function Lw(c,i,l,h,g,v){let b=null,A=Rw(i,l,g,v);for(const C of h){const D=Rw(i-C.x,l,g,v)+C.badness;D<=A&&(b=C,A=D)}return{index:c,x:i,priorBreak:b,badness:A}}function Bw(c){return c?Bw(c.priorBreak).concat(c.index):[]}function p0(c,i,l,h,g,v){if(!c)return[];const b=[],A=function(O,U,Z,W,J,ie){let fe=0;for(let Me=0;Me<O.length();Me++){const ye=O.getSection(Me);fe+=zw(O.getCharCode(Me),ye,W,J,U,ie)}return fe/Math.max(1,Math.ceil(fe/Z))}(c,i,l,h,g,v),C=c.text.indexOf("â")>=0;let D=0;for(let O=0;O<c.length();O++){const U=c.getSection(O),Z=c.getCharCode(O);if(Cm[Z]||(D+=zw(Z,U,h,g,i,v)),O<c.length()-1){const W=!((R=Z)<11904)&&(!!Ln["CJK Compatibility Forms"](R)||!!Ln["CJK Compatibility"](R)||!!Ln["CJK Strokes"](R)||!!Ln["CJK Symbols and Punctuation"](R)||!!Ln["Enclosed CJK Letters and Months"](R)||!!Ln["Halfwidth and Fullwidth Forms"](R)||!!Ln["Ideographic Description Characters"](R)||!!Ln["Vertical Forms"](R)||Ef.test(String.fromCodePoint(R)));(Ik[Z]||W||U.imageName||O!==c.length()-2&&Ek[c.getCharCode(O+1)])&&b.push(Lw(O+1,D,A,b,Pk(Z,c.getCharCode(O+1),W&&C),!1))}}var R;return Bw(Lw(c.length(),D,A,b,0,!0))}function m0(c){let i=.5,l=.5;switch(c){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(c){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:i,verticalAlign:l}}function kk(c,i,l){const h=i.getMaxScale()*sr,{maxImageWidth:g,maxImageHeight:v}=i.getMaxImageSize(c),b=Math.max(h,v*l);return{verticalLineContentWidth:Math.max(h,g*l),horizontalLineContentHeight:b}}function Fw(c){switch(c){case"top":return 0;case"center":return .5;default:return 1}}function Dk(c,i,l){return!(c===p.an.horizontal||!i&&!Pu(l)||i&&(Cm[l]||(h=l,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(h)))));var h}function zk(c,i,l,h,g,v){const b=v[c.fontStack],A=function(D,R,O,U){if(D&&D.rect)return D;const Z=R[O.fontStack],W=Z&&Z[U];return W?{rect:null,metrics:W.metrics}:null}(b&&b[i],g,c,i);if(A===null)return null;let C;if(l)C=h.verticalLineContentWidth-c.scale*sr;else{const D=Fw(c.verticalAlign);C=(h.horizontalLineContentHeight-c.scale*sr)*D}return{rect:A.rect,metrics:A.metrics,baselineOffset:C}}function Rk(c,i,l,h,g){const v=g[c.imageName];if(!v)return null;const b=v.paddedRect,A=v.displaySize,C={width:A[0],height:A[1],left:1,top:-3,advance:i?A[1]:A[0]};let D;if(i)D=h.verticalLineContentWidth-A[1]*c.scale;else{const R=Fw(c.verticalAlign);D=(h.horizontalLineContentHeight-A[1]*c.scale)*R}return{rect:b,metrics:C,baselineOffset:D,imageOffset:(i?A[0]:A[1])*c.scale-sr*l}}function Lk(c,i,l,h){if(h===0)return;const g=c[l],v=(c[l].x+g.metrics.advance*g.scale)*h;for(let b=i;b<=l;b++)c[b].x-=v}function Bk(c,i,l){const{horizontalAlign:h,verticalAlign:g}=m0(l),v=i[0]-c.displaySize[0]*h,b=i[1]-c.displaySize[1]*g;return{image:c,top:b,bottom:b+c.displaySize[1],left:v,right:v+c.displaySize[0]}}function Ow(c){var i,l;let h=c.left,g=c.top,v=c.right-h,b=c.bottom-g;const A=(i=c.image.textFitWidth)!==null&&i!==void 0?i:"stretchOrShrink",C=(l=c.image.textFitHeight)!==null&&l!==void 0?l:"stretchOrShrink",D=(c.image.content[2]-c.image.content[0])/(c.image.content[3]-c.image.content[1]);if(C==="proportional"){if(A==="stretchOnly"&&v/b<D||A==="proportional"){const R=Math.ceil(b*D);h*=R/v,v=R}}else if(A==="proportional"&&C==="stretchOnly"&&D!==0&&v/b>D){const R=Math.ceil(v/D);g*=R/b,b=R}return{x1:h,y1:g,x2:h+v,y2:g+b}}function Nw(c,i,l,h,g,v){const b=c.image;let A;if(b.content){const ie=b.content,fe=b.pixelRatio||1;A=[ie[0]/fe,ie[1]/fe,b.displaySize[0]-ie[2]/fe,b.displaySize[1]-ie[3]/fe]}const C=i.left*v,D=i.right*v;let R,O,U,Z;l==="width"||l==="both"?(Z=g[0]+C-h[3],O=g[0]+D+h[1]):(Z=g[0]+(C+D-b.displaySize[0])/2,O=Z+b.displaySize[0]);const W=i.top*v,J=i.bottom*v;return l==="height"||l==="both"?(R=g[1]+W-h[0],U=g[1]+J+h[2]):(R=g[1]+(W+J-b.displaySize[1])/2,U=R+b.displaySize[1]),{image:b,top:R,right:O,bottom:U,left:Z,collisionPadding:A}}const fs=128,ul=32640;function jw(c,i){const{expression:l}=i;if(l.kind==="constant")return{kind:"constant",layoutSize:l.evaluate(new Pi(c+1))};if(l.kind==="source")return{kind:"source"};{const{zoomStops:h,interpolationType:g}=l;let v=0;for(;v<h.length&&h[v]<=c;)v++;v=Math.max(0,v-1);let b=v;for(;b<h.length&&h[b]<c+1;)b++;b=Math.min(h.length-1,b);const A=h[v],C=h[b];return l.kind==="composite"?{kind:"composite",minZoom:A,maxZoom:C,interpolationType:g}:{kind:"camera",minZoom:A,maxZoom:C,minSize:l.evaluate(new Pi(A)),maxSize:l.evaluate(new Pi(C)),interpolationType:g}}}function g0(c,i,l){let h="never";const g=c.get(i);return g?h=g:c.get(l)&&(h="always"),h}const Fk=Yf.VectorTileFeature.types,Ok=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Im(c,i,l,h,g,v,b,A,C,D,R,O,U){const Z=A?Math.min(ul,Math.round(A[0])):0,W=A?Math.min(ul,Math.round(A[1])):0;c.emplaceBack(i,l,Math.round(32*h),Math.round(32*g),v,b,(Z<<1)+(C?1:0),W,16*D,16*R,256*O,256*U)}function _0(c,i,l){c.emplaceBack(i.x,i.y,l),c.emplaceBack(i.x,i.y,l),c.emplaceBack(i.x,i.y,l),c.emplaceBack(i.x,i.y,l)}function Nk(c){for(const i of c.sections)if(kf(i.text))return!0;return!1}class y0{constructor(i){this.layoutVertexArray=new Mn,this.indexArray=new vi,this.programConfigurations=i,this.segments=new Wn,this.dynamicLayoutVertexArray=new ii,this.opacityVertexArray=new Li,this.hasVisibleVertices=!1,this.placedSymbolArray=new le}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(i,l,h,g){this.isEmpty()||(h&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,vk.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,bk.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,Ok,!0),this.opacityVertexBuffer.itemSize=1),(h||g)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Gt("SymbolBuffers",y0);class v0{constructor(i,l,h){this.layoutVertexArray=new i,this.layoutAttributes=l,this.indexArray=new h,this.segments=new Wn,this.collisionVertexArray=new Bi}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,xk.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Gt("CollisionBuffers",v0);class Uu{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.globalState=i.globalState,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(b=>b.id),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=jw(this.zoom,l["text-size"]),this.iconSizeData=jw(this.zoom,l["icon-size"]);const h=this.layers[0].layout,g=h.get("symbol-sort-key"),v=h.get("symbol-z-order");this.canOverlap=g0(h,"text-overlap","text-allow-overlap")!=="never"||g0(h,"icon-overlap","icon-allow-overlap")!=="never"||h.get("text-ignore-placement")||h.get("icon-ignore-placement"),this.sortFeaturesByKey=v!=="viewport-y"&&!g.isConstant(),this.sortFeaturesByY=(v==="viewport-y"||v==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,h.get("symbol-placement")==="point"&&(this.writingModes=h.get("text-writing-mode").map(b=>p.an[b])),this.stateDependentLayerIds=this.layers.filter(b=>b.isStateDependent()).map(b=>b.id),this.sourceID=i.sourceID}createArrays(){this.text=new y0(new Lo(this.layers,this.zoom,i=>/^text/.test(i))),this.icon=new y0(new Lo(this.layers,this.zoom,i=>/^icon/.test(i))),this.glyphOffsetArray=new me,this.lineVertexArray=new xe,this.symbolInstances=new _e,this.textAnchorOffsets=new ge}calculateGlyphDependencies(i,l,h,g,v){for(let b=0;b<i.length;b++)if(l[i.charCodeAt(b)]=!0,(h||g)&&v){const A=Kf[i.charAt(b)];A&&(l[A.charCodeAt(0)]=!0)}}populate(i,l,h){const g=this.layers[0],v=g.layout,b=v.get("text-font"),A=v.get("text-field"),C=v.get("icon-image"),D=(A.value.kind!=="constant"||A.value.value instanceof Sr&&!A.value.value.isEmpty()||A.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),R=C.value.kind!=="constant"||!!C.value.value||Object.keys(C.parameters).length>0,O=v.get("symbol-sort-key");if(this.features=[],!D&&!R)return;const U=l.iconDependencies,Z=l.glyphDependencies,W=l.availableImages,J=new Pi(this.zoom,{globalState:this.globalState});for(const{feature:ie,id:fe,index:Me,sourceLayerIndex:ye}of i){const q=g._featureFilter.needGeometry,ne=fc(ie,q);if(!g._featureFilter.filter(J,ne,h))continue;let ve,Ue;if(q||(ne.geometry=hc(ie)),D){const Ye=g.getValueAndResolveTokens("text-field",ne,h,W),et=Sr.factory(Ye),vt=this.hasRTLText=this.hasRTLText||Nk(et);(!vt||Io.getRTLTextPluginStatus()==="unavailable"||vt&&Io.isParsed())&&(ve=Ak(et,g,ne))}if(R){const Ye=g.getValueAndResolveTokens("icon-image",ne,h,W);Ue=Ye instanceof qr?Ye:qr.fromString(Ye)}if(!ve&&!Ue)continue;const ut=this.sortFeaturesByKey?O.evaluate(ne,{},h):void 0;if(this.features.push({id:fe,text:ve,icon:Ue,index:Me,sourceLayerIndex:ye,geometry:ne.geometry,properties:ie.properties,type:Fk[ie.type],sortKey:ut}),Ue&&(U[Ue.name]=!0),ve){const Ye=b.evaluate(ne,{},h).join(","),et=v.get("text-rotation-alignment")!=="viewport"&&v.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(p.an.vertical)>=0;for(const vt of ve.sections)if(vt.image)U[vt.image.name]=!0;else{const dt=If(ve.toString()),At=vt.fontStack||Ye,at=Z[At]=Z[At]||{};this.calculateGlyphDependencies(vt.text,at,et,this.allowVerticalPlacement,dt)}}}v.get("symbol-placement")==="line"&&(this.features=function(ie){const fe={},Me={},ye=[];let q=0;function ne(Ye){ye.push(ie[Ye]),q++}function ve(Ye,et,vt){const dt=Me[Ye];return delete Me[Ye],Me[et]=dt,ye[dt].geometry[0].pop(),ye[dt].geometry[0]=ye[dt].geometry[0].concat(vt[0]),dt}function Ue(Ye,et,vt){const dt=fe[et];return delete fe[et],fe[Ye]=dt,ye[dt].geometry[0].shift(),ye[dt].geometry[0]=vt[0].concat(ye[dt].geometry[0]),dt}function ut(Ye,et,vt){const dt=vt?et[0][et[0].length-1]:et[0][0];return`${Ye}:${dt.x}:${dt.y}`}for(let Ye=0;Ye<ie.length;Ye++){const et=ie[Ye],vt=et.geometry,dt=et.text?et.text.toString():null;if(!dt){ne(Ye);continue}const At=ut(dt,vt),at=ut(dt,vt,!0);if(At in Me&&at in fe&&Me[At]!==fe[at]){const Yt=Ue(At,at,vt),sn=ve(At,at,ye[Yt].geometry);delete fe[At],delete Me[at],Me[ut(dt,ye[sn].geometry,!0)]=sn,ye[Yt].geometry=null}else At in Me?ve(At,at,vt):at in fe?Ue(At,at,vt):(ne(Ye),fe[At]=q-1,Me[at]=q-1)}return ye.filter(Ye=>Ye.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ie,fe)=>ie.sortKey-fe.sortKey)}update(i,l,h){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(i,l,this.layers,h),this.icon.programConfigurations.updatePaintArrays(i,l,this.layers,h))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,l){const h=this.lineVertexArray.length;if(i.segment!==void 0){let g=i.dist(l[i.segment+1]),v=i.dist(l[i.segment]);const b={};for(let A=i.segment+1;A<l.length;A++)b[A]={x:l[A].x,y:l[A].y,tileUnitDistanceFromAnchor:g},A<l.length-1&&(g+=l[A+1].dist(l[A]));for(let A=i.segment||0;A>=0;A--)b[A]={x:l[A].x,y:l[A].y,tileUnitDistanceFromAnchor:v},A>0&&(v+=l[A-1].dist(l[A]));for(let A=0;A<l.length;A++){const C=b[A];this.lineVertexArray.emplaceBack(C.x,C.y,C.tileUnitDistanceFromAnchor)}}return{lineStartIndex:h,lineLength:this.lineVertexArray.length-h}}addSymbols(i,l,h,g,v,b,A,C,D,R,O,U){const Z=i.indexArray,W=i.layoutVertexArray,J=i.segments.prepareSegment(4*l.length,W,Z,this.canOverlap?b.sortKey:void 0),ie=this.glyphOffsetArray.length,fe=J.vertexLength,Me=this.allowVerticalPlacement&&A===p.an.vertical?Math.PI/2:0,ye=b.text&&b.text.sections;for(let q=0;q<l.length;q++){const{tl:ne,tr:ve,bl:Ue,br:ut,tex:Ye,pixelOffsetTL:et,pixelOffsetBR:vt,minFontScaleX:dt,minFontScaleY:At,glyphOffset:at,isSDF:Yt,sectionIndex:sn}=l[q],rn=J.vertexLength,Jt=at[1];Im(W,C.x,C.y,ne.x,Jt+ne.y,Ye.x,Ye.y,h,Yt,et.x,et.y,dt,At),Im(W,C.x,C.y,ve.x,Jt+ve.y,Ye.x+Ye.w,Ye.y,h,Yt,vt.x,et.y,dt,At),Im(W,C.x,C.y,Ue.x,Jt+Ue.y,Ye.x,Ye.y+Ye.h,h,Yt,et.x,vt.y,dt,At),Im(W,C.x,C.y,ut.x,Jt+ut.y,Ye.x+Ye.w,Ye.y+Ye.h,h,Yt,vt.x,vt.y,dt,At),_0(i.dynamicLayoutVertexArray,C,Me),Z.emplaceBack(rn,rn+2,rn+1),Z.emplaceBack(rn+1,rn+2,rn+3),J.vertexLength+=4,J.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(at[0]),q!==l.length-1&&sn===l[q+1].sectionIndex||i.programConfigurations.populatePaintArrays(W.length,b,b.index,{},U,ye&&ye[sn])}i.placedSymbolArray.emplaceBack(C.x,C.y,ie,this.glyphOffsetArray.length-ie,fe,D,R,C.segment,h?h[0]:0,h?h[1]:0,g[0],g[1],A,0,!1,0,O)}_addCollisionDebugVertex(i,l,h,g,v,b){return l.emplaceBack(0,0),i.emplaceBack(h.x,h.y,g,v,Math.round(b.x),Math.round(b.y))}addCollisionDebugVertices(i,l,h,g,v,b,A){const C=v.segments.prepareSegment(4,v.layoutVertexArray,v.indexArray),D=C.vertexLength,R=v.layoutVertexArray,O=v.collisionVertexArray,U=A.anchorX,Z=A.anchorY;this._addCollisionDebugVertex(R,O,b,U,Z,new F(i,l)),this._addCollisionDebugVertex(R,O,b,U,Z,new F(h,l)),this._addCollisionDebugVertex(R,O,b,U,Z,new F(h,g)),this._addCollisionDebugVertex(R,O,b,U,Z,new F(i,g)),C.vertexLength+=4;const W=v.indexArray;W.emplaceBack(D,D+1),W.emplaceBack(D+1,D+2),W.emplaceBack(D+2,D+3),W.emplaceBack(D+3,D),C.primitiveLength+=4}addDebugCollisionBoxes(i,l,h,g){for(let v=i;v<l;v++){const b=this.collisionBoxArray.get(v);this.addCollisionDebugVertices(b.x1,b.y1,b.x2,b.y2,g?this.textCollisionBox:this.iconCollisionBox,b.anchorPoint,h)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new v0(hi,Cw.members,fi),this.iconCollisionBox=new v0(hi,Cw.members,fi);for(let i=0;i<this.symbolInstances.length;i++){const l=this.symbolInstances.get(i);this.addDebugCollisionBoxes(l.textBoxStartIndex,l.textBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.iconBoxStartIndex,l.iconBoxEndIndex,l,!1),this.addDebugCollisionBoxes(l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex,l,!1)}}_deserializeCollisionBoxesForSymbol(i,l,h,g,v,b,A,C,D){const R={};for(let O=l;O<h;O++){const U=i.get(O);R.textBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},R.textFeatureIndex=U.featureIndex;break}for(let O=g;O<v;O++){const U=i.get(O);R.verticalTextBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},R.verticalTextFeatureIndex=U.featureIndex;break}for(let O=b;O<A;O++){const U=i.get(O);R.iconBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},R.iconFeatureIndex=U.featureIndex;break}for(let O=C;O<D;O++){const U=i.get(O);R.verticalIconBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},R.verticalIconFeatureIndex=U.featureIndex;break}return R}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const h=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,h.textBoxStartIndex,h.textBoxEndIndex,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h.iconBoxStartIndex,h.iconBoxEndIndex,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(i,l){const h=i.placedSymbolArray.get(l),g=h.vertexStartIndex+4*h.numGlyphs;for(let v=h.vertexStartIndex;v<g;v+=4)i.indexArray.emplaceBack(v,v+2,v+1),i.indexArray.emplaceBack(v+1,v+2,v+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const l=Math.sin(i),h=Math.cos(i),g=[],v=[],b=[];for(let A=0;A<this.symbolInstances.length;++A){b.push(A);const C=this.symbolInstances.get(A);g.push(0|Math.round(l*C.anchorX+h*C.anchorY)),v.push(C.featureIndex)}return b.sort((A,C)=>g[A]-g[C]||v[C]-v[A]),b}addToSortKeyRanges(i,l){const h=this.sortKeyRanges[this.sortKeyRanges.length-1];h&&h.sortKey===l?h.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const h=this.symbolInstances.get(l);this.featureSortOrder.push(h.featureIndex),[h.rightJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.leftJustifiedTextSymbolIndex].forEach((g,v,b)=>{g>=0&&b.indexOf(g)===v&&this.addIndicesForPlacedSymbol(this.text,g)}),h.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,h.verticalPlacedTextSymbolIndex),h.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,h.placedIconSymbolIndex),h.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,h.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Uw,Vw;Gt("SymbolBucket",Uu,{omit:["layers","collisionBoxArray","features","compareText"]}),Uu.MAX_GLYPHS=65535,Uu.addDynamicAttributes=_0;var b0={get paint(){return Vw=Vw||new Br({"icon-opacity":new un(Ae.paint_symbol["icon-opacity"]),"icon-color":new un(Ae.paint_symbol["icon-color"]),"icon-halo-color":new un(Ae.paint_symbol["icon-halo-color"]),"icon-halo-width":new un(Ae.paint_symbol["icon-halo-width"]),"icon-halo-blur":new un(Ae.paint_symbol["icon-halo-blur"]),"icon-translate":new Qt(Ae.paint_symbol["icon-translate"]),"icon-translate-anchor":new Qt(Ae.paint_symbol["icon-translate-anchor"]),"text-opacity":new un(Ae.paint_symbol["text-opacity"]),"text-color":new un(Ae.paint_symbol["text-color"],{runtimeType:Dt,getOverride:c=>c.textColor,hasOverride:c=>!!c.textColor}),"text-halo-color":new un(Ae.paint_symbol["text-halo-color"]),"text-halo-width":new un(Ae.paint_symbol["text-halo-width"]),"text-halo-blur":new un(Ae.paint_symbol["text-halo-blur"]),"text-translate":new Qt(Ae.paint_symbol["text-translate"]),"text-translate-anchor":new Qt(Ae.paint_symbol["text-translate-anchor"])})},get layout(){return Uw=Uw||new Br({"symbol-placement":new Qt(Ae.layout_symbol["symbol-placement"]),"symbol-spacing":new Qt(Ae.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Qt(Ae.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new un(Ae.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Qt(Ae.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Qt(Ae.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Qt(Ae.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Qt(Ae.layout_symbol["icon-ignore-placement"]),"icon-optional":new Qt(Ae.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Qt(Ae.layout_symbol["icon-rotation-alignment"]),"icon-size":new un(Ae.layout_symbol["icon-size"]),"icon-text-fit":new Qt(Ae.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Qt(Ae.layout_symbol["icon-text-fit-padding"]),"icon-image":new un(Ae.layout_symbol["icon-image"]),"icon-rotate":new un(Ae.layout_symbol["icon-rotate"]),"icon-padding":new un(Ae.layout_symbol["icon-padding"]),"icon-keep-upright":new Qt(Ae.layout_symbol["icon-keep-upright"]),"icon-offset":new un(Ae.layout_symbol["icon-offset"]),"icon-anchor":new un(Ae.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Qt(Ae.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Qt(Ae.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Qt(Ae.layout_symbol["text-rotation-alignment"]),"text-field":new un(Ae.layout_symbol["text-field"]),"text-font":new un(Ae.layout_symbol["text-font"]),"text-size":new un(Ae.layout_symbol["text-size"]),"text-max-width":new un(Ae.layout_symbol["text-max-width"]),"text-line-height":new Qt(Ae.layout_symbol["text-line-height"]),"text-letter-spacing":new un(Ae.layout_symbol["text-letter-spacing"]),"text-justify":new un(Ae.layout_symbol["text-justify"]),"text-radial-offset":new un(Ae.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Qt(Ae.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new un(Ae.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new un(Ae.layout_symbol["text-anchor"]),"text-max-angle":new Qt(Ae.layout_symbol["text-max-angle"]),"text-writing-mode":new Qt(Ae.layout_symbol["text-writing-mode"]),"text-rotate":new un(Ae.layout_symbol["text-rotate"]),"text-padding":new Qt(Ae.layout_symbol["text-padding"]),"text-keep-upright":new Qt(Ae.layout_symbol["text-keep-upright"]),"text-transform":new un(Ae.layout_symbol["text-transform"]),"text-offset":new un(Ae.layout_symbol["text-offset"]),"text-allow-overlap":new Qt(Ae.layout_symbol["text-allow-overlap"]),"text-overlap":new Qt(Ae.layout_symbol["text-overlap"]),"text-ignore-placement":new Qt(Ae.layout_symbol["text-ignore-placement"]),"text-optional":new Qt(Ae.layout_symbol["text-optional"])})}};class Gw{constructor(i){if(i.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=i.property.overrides?i.property.overrides.runtimeType:fa,this.defaultValue=i}evaluate(i){if(i.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(i.formattedSection))return l.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Gt("FormatSectionOverride",Gw,{omit:["defaultValue"]});class Em extends mr{constructor(i){super(i,b0)}recalculate(i,l){if(super.recalculate(i,l),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const h=this.layout.get("text-writing-mode");if(h){const g=[];for(const v of h)g.indexOf(v)<0&&g.push(v);this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(i,l,h,g){const v=this.layout.get(i).evaluate(l,{},h,g),b=this._unevaluatedLayout._values[i];return b.isDataDriven()||yu(b.value)||!v?v:function(A,C){return C.replace(/{([^{}]+)}/g,(D,R)=>A&&R in A?String(A[R]):"")}(l.properties,v)}createBucket(i){return new Uu(i)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const i of b0.paint.overridableProperties){if(!Em.hasPaintOverride(this.layout,i))continue;const l=this.paint.get(i),h=new Gw(l),g=new _u(h,l.property.specification);let v=null;v=l.value.kind==="constant"||l.value.kind==="source"?new Wl("source",g):new bu("composite",g,l.value.zoomStops),this.paint._values[i]=new ja(l.property,v,l.parameters)}}_handleOverridablePaintPropertyUpdate(i,l,h){return!(!this.layout||l.isDataDriven()||h.isDataDriven())&&Em.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,l){const h=i.get("text-field"),g=b0.paint.properties[l];let v=!1;const b=A=>{for(const C of A)if(g.overrides&&g.overrides.hasOverride(C))return void(v=!0)};if(h.value.kind==="constant"&&h.value.value instanceof Sr)b(h.value.value.sections);else if(h.value.kind==="source"){const A=D=>{v||(D instanceof zr&&dn(D.value)===lt?b(D.value.sections):D instanceof Ul?b(D.sections):D.eachChild(A))},C=h.value;C._styleExpression&&A(C._styleExpression.expression)}return v}}let qw;var jk={get paint(){return qw=qw||new Br({"background-color":new Qt(Ae.paint_background["background-color"]),"background-pattern":new zf(Ae.paint_background["background-pattern"]),"background-opacity":new Qt(Ae.paint_background["background-opacity"])})}};class Uk extends mr{constructor(i){super(i,jk)}}let Zw;var Vk={get paint(){return Zw=Zw||new Br({"raster-opacity":new Qt(Ae.paint_raster["raster-opacity"]),"raster-hue-rotate":new Qt(Ae.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Qt(Ae.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Qt(Ae.paint_raster["raster-brightness-max"]),"raster-saturation":new Qt(Ae.paint_raster["raster-saturation"]),"raster-contrast":new Qt(Ae.paint_raster["raster-contrast"]),"raster-resampling":new Qt(Ae.paint_raster["raster-resampling"]),"raster-fade-duration":new Qt(Ae.paint_raster["raster-fade-duration"])})}};class Gk extends mr{constructor(i){super(i,Vk)}}class qk extends mr{constructor(i){super(i,{}),this.onAdd=l=>{this.implementation.onAdd&&this.implementation.onAdd(l,l.painter.context.gl)},this.onRemove=l=>{this.implementation.onRemove&&this.implementation.onRemove(l,l.painter.context.gl)},this.implementation=i}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Zk{constructor(i){this._methodToThrottle=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Hk={once:!0},x0=63710088e-1;class hl{constructor(i,l){if(isNaN(i)||isNaN(l))throw new Error(`Invalid LngLat object: (${i}, ${l})`);if(this.lng=+i,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new hl(De(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const l=Math.PI/180,h=this.lat*l,g=i.lat*l,v=Math.sin(h)*Math.sin(g)+Math.cos(h)*Math.cos(g)*Math.cos((i.lng-this.lng)*l);return x0*Math.acos(Math.min(v,1))}static convert(i){if(i instanceof hl)return i;if(Array.isArray(i)&&(i.length===2||i.length===3))return new hl(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&typeof i=="object"&&i!==null)return new hl(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Hw=2*Math.PI*x0;function $w(c){return Hw*Math.cos(c*Math.PI/180)}function Ww(c){return(180+c)/360}function Yw(c){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c*Math.PI/360)))/360}function Xw(c,i){return c/$w(i)}function w0(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}function Qw(c,i){return c*$w(w0(i))}class ed{constructor(i,l,h=0){this.x=+i,this.y=+l,this.z=+h}static fromLngLat(i,l=0){const h=hl.convert(i);return new ed(Ww(h.lng),Yw(h.lat),Xw(l,h.lat))}toLngLat(){return new hl(360*this.x-180,w0(this.y))}toAltitude(){return Qw(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Hw*(i=w0(this.y),1/Math.cos(i*Math.PI/180));var i}}function Kw(c,i,l){var h=2*Math.PI*6378137/256/Math.pow(2,l);return[c*h-2*Math.PI*6378137/2,i*h-2*Math.PI*6378137/2]}class A0{constructor(i,l,h){if(!function(g,v,b){return!(g<0||g>25||b<0||b>=Math.pow(2,g)||v<0||v>=Math.pow(2,g))}(i,l,h))throw new Error(`x=${l}, y=${h}, z=${i} outside of bounds. 0<=x<${Math.pow(2,i)}, 0<=y<${Math.pow(2,i)} 0<=z<=25 `);this.z=i,this.x=l,this.y=h,this.key=Vu(0,i,i,l,h)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}url(i,l,h){const g=(b=this.y,A=this.z,C=Kw(256*(v=this.x),256*(b=Math.pow(2,A)-b-1),A),D=Kw(256*(v+1),256*(b+1),A),C[0]+","+C[1]+","+D[0]+","+D[1]);var v,b,A,C,D;const R=function(O,U,Z){let W,J="";for(let ie=O;ie>0;ie--)W=1<<ie-1,J+=(U&W?1:0)+(Z&W?2:0);return J}(this.z,this.x,this.y);return i[(this.x+this.y)%i.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(h==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,l>1?"@2x":"").replace(/{quadkey}/g,R).replace(/{bbox-epsg-3857}/g,g)}isChildOf(i){const l=this.z-i.z;return l>0&&i.x===this.x>>l&&i.y===this.y>>l}getTilePoint(i){const l=Math.pow(2,this.z);return new F((i.x*l-this.x)*ct,(i.y*l-this.y)*ct)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Jw{constructor(i,l){this.wrap=i,this.canonical=l,this.key=Vu(i,l.z,l.z,l.x,l.y)}}class Sa{constructor(i,l,h,g,v){if(this.terrainRttPosMatrix32f=null,i<h)throw new Error(`overscaledZ should be >= z; overscaledZ = ${i}; z = ${h}`);this.overscaledZ=i,this.wrap=l,this.canonical=new A0(h,+g,+v),this.key=Vu(l,i,h,g,v)}clone(){return new Sa(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){if(i>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${i}; overscaledZ = ${this.overscaledZ}`);const l=this.canonical.z-i;return i>this.canonical.z?new Sa(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Sa(i,this.wrap,i,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(i,l){if(i>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${i}; overscaledZ = ${this.overscaledZ}`);const h=this.canonical.z-i;return i>this.canonical.z?Vu(this.wrap*+l,i,this.canonical.z,this.canonical.x,this.canonical.y):Vu(this.wrap*+l,i,i,this.canonical.x>>h,this.canonical.y>>h)}isChildOf(i){if(i.wrap!==this.wrap)return!1;const l=this.canonical.z-i.canonical.z;return i.overscaledZ===0||i.overscaledZ<this.overscaledZ&&i.canonical.x===this.canonical.x>>l&&i.canonical.y===this.canonical.y>>l}children(i){if(this.overscaledZ>=i)return[new Sa(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,h=2*this.canonical.x,g=2*this.canonical.y;return[new Sa(l,this.wrap,l,h,g),new Sa(l,this.wrap,l,h+1,g),new Sa(l,this.wrap,l,h,g+1),new Sa(l,this.wrap,l,h+1,g+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new Sa(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new Sa(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Jw(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(i){return this.canonical.getTilePoint(new ed(i.x-this.wrap,i.y))}}function Vu(c,i,l,h,g){(c*=2)<0&&(c=-1*c-1);const v=1<<l;return(v*v*c+v*g+h).toString(36)+l.toString(36)+i.toString(36)}Gt("CanonicalTileID",A0),Gt("OverscaledTileID",Sa,{omit:["terrainRttPosMatrix32f"]});class mc{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(i){return this.minX=Math.min(this.minX,i.x),this.minY=Math.min(this.minY,i.y),this.maxX=Math.max(this.maxX,i.x),this.maxY=Math.max(this.maxY,i.y),this}expandBy(i){return this.minX-=i,this.minY-=i,this.maxX+=i,this.maxY+=i,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(i){return this.expandBy(-i)}map(i){const l=new mc;return l.extend(i(new F(this.minX,this.minY))),l.extend(i(new F(this.maxX,this.minY))),l.extend(i(new F(this.minX,this.maxY))),l.extend(i(new F(this.maxX,this.maxY))),l}static fromPoints(i){const l=new mc;for(const h of i)l.extend(h);return l}contains(i){return i.x>=this.minX&&i.x<=this.maxX&&i.y>=this.minY&&i.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(i){return!this.empty()&&!i.empty()&&i.minX>=this.minX&&i.maxX<=this.maxX&&i.minY>=this.minY&&i.maxY<=this.maxY}intersects(i){return!this.empty()&&!i.empty()&&i.minX<=this.maxX&&i.maxX>=this.minX&&i.minY<=this.maxY&&i.maxY>=this.minY}}class e2{constructor(i){this._stringToNumber={},this._numberToString=[];for(let l=0;l<i.length;l++){const h=i[l];this._stringToNumber[h]=l,this._numberToString[l]=h}}encode(i){return this._stringToNumber[i]}decode(i){if(i>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${i} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[i]}}class t2{constructor(i,l,h,g,v){this.type="Feature",this._vectorTileFeature=i,i._z=l,i._x=h,i._y=g,this.properties=i.properties,this.id=v}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={geometry:this.geometry};for(const l in this)l!=="_geometry"&&l!=="_vectorTileFeature"&&(i[l]=this[l]);return i}}class n2{constructor(i,l){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new al(ct,16,0),this.grid3D=new al(ct,16,0),this.featureIndexArray=new $e,this.promoteId=l}insert(i,l,h,g,v,b){const A=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(h,g,v);const C=b?this.grid3D:this.grid;for(let D=0;D<l.length;D++){const R=l[D],O=[1/0,1/0,-1/0,-1/0];for(let U=0;U<R.length;U++){const Z=R[U];O[0]=Math.min(O[0],Z.x),O[1]=Math.min(O[1],Z.y),O[2]=Math.max(O[2],Z.x),O[3]=Math.max(O[3],Z.y)}O[0]<ct&&O[1]<ct&&O[2]>=0&&O[3]>=0&&C.insert(A,O[0],O[1],O[2],O[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Yf.VectorTile(new f0(this.rawTileData)).layers,this.sourceLayerCoder=new e2(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(i,l,h,g){this.loadVTLayers();const v=i.params,b=ct/i.tileSize/i.scale,A=Mo(v.filter),C=i.queryGeometry,D=i.queryPadding*b,R=mc.fromPoints(C),O=this.grid.query(R.minX-D,R.minY-D,R.maxX+D,R.maxY+D),U=mc.fromPoints(i.cameraQueryGeometry).expandBy(D),Z=this.grid3D.query(U.minX,U.minY,U.maxX,U.maxY,(ie,fe,Me,ye)=>function(q,ne,ve,Ue,ut){for(const et of q)if(ne<=et.x&&ve<=et.y&&Ue>=et.x&&ut>=et.y)return!0;const Ye=[new F(ne,ve),new F(ne,ut),new F(Ue,ut),new F(Ue,ve)];if(q.length>2){for(const et of Ye)if(Bu(q,et))return!0}for(let et=0;et<q.length-1;et++)if(z5(q[et],q[et+1],Ye))return!0;return!1}(i.cameraQueryGeometry,ie-D,fe-D,Me+D,ye+D));for(const ie of Z)O.push(ie);O.sort($k);const W={};let J;for(let ie=0;ie<O.length;ie++){const fe=O[ie];if(fe===J)continue;J=fe;const Me=this.featureIndexArray.get(fe);let ye=null;this.loadMatchingFeature(W,Me.bucketIndex,Me.sourceLayerIndex,Me.featureIndex,A,v.layers,v.availableImages,l,h,g,(q,ne,ve)=>(ye||(ye=hc(q)),ne.queryIntersectsFeature({queryGeometry:C,feature:q,featureState:ve,geometry:ye,zoom:this.z,transform:i.transform,pixelsToTileUnits:b,pixelPosMatrix:i.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:i.getElevation})))}return W}loadMatchingFeature(i,l,h,g,v,b,A,C,D,R,O){const U=this.bucketLayerIDs[l];if(b&&!U.some(ie=>b.has(ie)))return;const Z=this.sourceLayerCoder.decode(h),W=this.vtLayers[Z].feature(g);if(v.needGeometry){const ie=fc(W,!0);if(!v.filter(new Pi(this.tileID.overscaledZ),ie,this.tileID.canonical))return}else if(!v.filter(new Pi(this.tileID.overscaledZ),W))return;const J=this.getId(W,Z);for(let ie=0;ie<U.length;ie++){const fe=U[ie];if(b&&!b.has(fe))continue;const Me=C[fe];if(!Me)continue;let ye={};J&&R&&(ye=R.getState(Me.sourceLayer||"_geojsonTileLayer",J));const q=Ke({},D[fe]);q.paint=i2(q.paint,Me.paint,W,ye,A),q.layout=i2(q.layout,Me.layout,W,ye,A);const ne=!O||O(W,Me,ye);if(!ne)continue;const ve=new t2(W,this.z,this.x,this.y,J);ve.layer=q;let Ue=i[fe];Ue===void 0&&(Ue=i[fe]=[]),Ue.push({featureIndex:g,feature:ve,intersectionZ:ne})}}lookupSymbolFeatures(i,l,h,g,v,b,A,C){const D={};this.loadVTLayers();const R=Mo(v);for(const O of i)this.loadMatchingFeature(D,h,g,O,R,b,A,C,l);return D}hasLayer(i){for(const l of this.bucketLayerIDs)for(const h of l)if(i===h)return!0;return!1}getId(i,l){var h;let g=i.id;return this.promoteId&&(g=i.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[l]],typeof g=="boolean"&&(g=Number(g)),g===void 0&&(!((h=i.properties)===null||h===void 0)&&h.cluster)&&this.promoteId&&(g=Number(i.properties.cluster_id))),g}}function i2(c,i,l,h,g){return wt(c,(v,b)=>{const A=i instanceof Du?i.get(b):null;return A&&A.evaluate?A.evaluate(l,h,g):A})}function $k(c,i){return i-c}function r2(c,i,l,h,g){const v=[];for(let b=0;b<c.length;b++){const A=c[b];let C;for(let D=0;D<A.length-1;D++){let R=A[D],O=A[D+1];R.x<i&&O.x<i||(R.x<i?R=new F(i,R.y+(i-R.x)/(O.x-R.x)*(O.y-R.y))._round():O.x<i&&(O=new F(i,R.y+(i-R.x)/(O.x-R.x)*(O.y-R.y))._round()),R.y<l&&O.y<l||(R.y<l?R=new F(R.x+(l-R.y)/(O.y-R.y)*(O.x-R.x),l)._round():O.y<l&&(O=new F(R.x+(l-R.y)/(O.y-R.y)*(O.x-R.x),l)._round()),R.x>=h&&O.x>=h||(R.x>=h?R=new F(h,R.y+(h-R.x)/(O.x-R.x)*(O.y-R.y))._round():O.x>=h&&(O=new F(h,R.y+(h-R.x)/(O.x-R.x)*(O.y-R.y))._round()),R.y>=g&&O.y>=g||(R.y>=g?R=new F(R.x+(g-R.y)/(O.y-R.y)*(O.x-R.x),g)._round():O.y>=g&&(O=new F(R.x+(g-R.y)/(O.y-R.y)*(O.x-R.x),g)._round()),C&&R.equals(C[C.length-1])||(C=[R],v.push(C)),C.push(O)))))}}return v}Gt("FeatureIndex",n2,{omit:["rawTileData","sourceLayerCoder"]});class fl extends F{constructor(i,l,h,g){super(i,l),this.angle=h,g!==void 0&&(this.segment=g)}clone(){return new fl(this.x,this.y,this.angle,this.segment)}}function a2(c,i,l,h,g){if(i.segment===void 0||l===0)return!0;let v=i,b=i.segment+1,A=0;for(;A>-l/2;){if(b--,b<0)return!1;A-=c[b].dist(v),v=c[b]}A+=c[b].dist(c[b+1]),b++;const C=[];let D=0;for(;A<l/2;){const R=c[b],O=c[b+1];if(!O)return!1;let U=c[b-1].angleTo(R)-R.angleTo(O);for(U=Math.abs((U+3*Math.PI)%(2*Math.PI)-Math.PI),C.push({distance:A,angleDelta:U}),D+=U;A-C[0].distance>h;)D-=C.shift().angleDelta;if(D>g)return!1;b++,A+=R.dist(O)}return!0}function o2(c){let i=0;for(let l=0;l<c.length-1;l++)i+=c[l].dist(c[l+1]);return i}function s2(c,i,l){return c?.6*i*l:0}function l2(c,i){return Math.max(c?c.right-c.left:0,i?i.right-i.left:0)}function Wk(c,i,l,h,g,v){const b=s2(l,g,v),A=l2(l,h)*v;let C=0;const D=o2(c)/2;for(let R=0;R<c.length-1;R++){const O=c[R],U=c[R+1],Z=O.dist(U);if(C+Z>D){const W=(D-C)/Z,J=ia.number(O.x,U.x,W),ie=ia.number(O.y,U.y,W),fe=new fl(J,ie,U.angleTo(O),R);return fe._round(),!b||a2(c,fe,A,b,i)?fe:void 0}C+=Z}}function Yk(c,i,l,h,g,v,b,A,C){const D=s2(h,v,b),R=l2(h,g),O=R*b,U=c[0].x===0||c[0].x===C||c[0].y===0||c[0].y===C;return i-O<i/4&&(i=O+i/4),c2(c,U?i/2*A%i:(R/2+2*v)*b*A%i,i,D,l,O,U,!1,C)}function c2(c,i,l,h,g,v,b,A,C){const D=v/2,R=o2(c);let O=0,U=i-l,Z=[];for(let W=0;W<c.length-1;W++){const J=c[W],ie=c[W+1],fe=J.dist(ie),Me=ie.angleTo(J);for(;U+l<O+fe;){U+=l;const ye=(U-O)/fe,q=ia.number(J.x,ie.x,ye),ne=ia.number(J.y,ie.y,ye);if(q>=0&&q<C&&ne>=0&&ne<C&&U-D>=0&&U+D<=R){const ve=new fl(q,ne,Me,W);ve._round(),h&&!a2(c,ve,v,h,g)||Z.push(ve)}}O+=fe}return A||Z.length||b||(Z=c2(c,O/2,l,h,g,v,b,!0,C)),Z}function u2(c,i,l,h){const g=[],v=c.image,b=v.pixelRatio,A=v.paddedRect.w-2,C=v.paddedRect.h-2;let D={x1:c.left,y1:c.top,x2:c.right,y2:c.bottom};const R=v.stretchX||[[0,A]],O=v.stretchY||[[0,C]],U=(at,Yt)=>at+Yt[1]-Yt[0],Z=R.reduce(U,0),W=O.reduce(U,0),J=A-Z,ie=C-W;let fe=0,Me=Z,ye=0,q=W,ne=0,ve=J,Ue=0,ut=ie;if(v.content&&h){const at=v.content,Yt=at[2]-at[0],sn=at[3]-at[1];(v.textFitWidth||v.textFitHeight)&&(D=Ow(c)),fe=Pm(R,0,at[0]),ye=Pm(O,0,at[1]),Me=Pm(R,at[0],at[2]),q=Pm(O,at[1],at[3]),ne=at[0]-fe,Ue=at[1]-ye,ve=Yt-Me,ut=sn-q}const Ye=D.x1,et=D.y1,vt=D.x2-Ye,dt=D.y2-et,At=(at,Yt,sn,rn)=>{const Jt=km(at.stretch-fe,Me,vt,Ye),Gn=Dm(at.fixed-ne,ve,at.stretch,Z),ji=km(Yt.stretch-ye,q,dt,et),er=Dm(Yt.fixed-Ue,ut,Yt.stretch,W),Ir=km(sn.stretch-fe,Me,vt,Ye),Ma=Dm(sn.fixed-ne,ve,sn.stretch,Z),aa=km(rn.stretch-ye,q,dt,et),vr=Dm(rn.fixed-Ue,ut,rn.stretch,W),Fi=new F(Jt,ji),lr=new F(Ir,ji),br=new F(Ir,aa),xr=new F(Jt,aa),Yr=new F(Gn/b,er/b),Ca=new F(Ma/b,vr/b),cr=i*Math.PI/180;if(cr){const ur=Math.sin(cr),hr=Math.cos(cr),$i=[hr,-ur,ur,hr];Fi._matMult($i),lr._matMult($i),xr._matMult($i),br._matMult($i)}const oa=at.stretch+at.fixed,tr=Yt.stretch+Yt.fixed;return{tl:Fi,tr:lr,bl:xr,br,tex:{x:v.paddedRect.x+1+oa,y:v.paddedRect.y+1+tr,w:sn.stretch+sn.fixed-oa,h:rn.stretch+rn.fixed-tr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Yr,pixelOffsetBR:Ca,minFontScaleX:ve/b/vt,minFontScaleY:ut/b/dt,isSDF:l}};if(h&&(v.stretchX||v.stretchY)){const at=h2(R,J,Z),Yt=h2(O,ie,W);for(let sn=0;sn<at.length-1;sn++){const rn=at[sn],Jt=at[sn+1];for(let Gn=0;Gn<Yt.length-1;Gn++)g.push(At(rn,Yt[Gn],Jt,Yt[Gn+1]))}}else g.push(At({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:A+1},{fixed:0,stretch:C+1}));return g}function Pm(c,i,l){let h=0;for(const g of c)h+=Math.max(i,Math.min(l,g[1]))-Math.max(i,Math.min(l,g[0]));return h}function h2(c,i,l){const h=[{fixed:-1,stretch:0}];for(const[g,v]of c){const b=h[h.length-1];h.push({fixed:g-b.stretch,stretch:b.stretch}),h.push({fixed:g-b.stretch,stretch:b.stretch+(v-g)})}return h.push({fixed:i+1,stretch:l}),h}function km(c,i,l,h){return c/i*l+h}function Dm(c,i,l,h){return c-i*l/h}Gt("Anchor",fl);class zm{constructor(i,l,h,g,v,b,A,C,D,R){var O;if(this.boxStartIndex=i.length,D){let U=b.top,Z=b.bottom;const W=b.collisionPadding;W&&(U-=W[1],Z+=W[3]);let J=Z-U;J>0&&(J=Math.max(10,J),this.circleDiameter=J)}else{const U=!((O=b.image)===null||O===void 0)&&O.content&&(b.image.textFitWidth||b.image.textFitHeight)?Ow(b):{x1:b.left,y1:b.top,x2:b.right,y2:b.bottom};U.y1=U.y1*A-C[0],U.y2=U.y2*A+C[2],U.x1=U.x1*A-C[3],U.x2=U.x2*A+C[1];const Z=b.collisionPadding;if(Z&&(U.x1-=Z[0]*A,U.y1-=Z[1]*A,U.x2+=Z[2]*A,U.y2+=Z[3]*A),R){const W=new F(U.x1,U.y1),J=new F(U.x2,U.y1),ie=new F(U.x1,U.y2),fe=new F(U.x2,U.y2),Me=R*Math.PI/180;W._rotate(Me),J._rotate(Me),ie._rotate(Me),fe._rotate(Me),U.x1=Math.min(W.x,J.x,ie.x,fe.x),U.x2=Math.max(W.x,J.x,ie.x,fe.x),U.y1=Math.min(W.y,J.y,ie.y,fe.y),U.y2=Math.max(W.y,J.y,ie.y,fe.y)}i.emplaceBack(l.x,l.y,U.x1,U.y1,U.x2,U.y2,h,g,v)}this.boxEndIndex=i.length}}class Xk{constructor(i=[],l=(h,g)=>h<g?-1:h>g?1:0){if(this.data=i,this.length=this.data.length,this.compare=l,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],l=this.data.pop();return--this.length>0&&(this.data[0]=l,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:l,compare:h}=this,g=l[i];for(;i>0;){const v=i-1>>1,b=l[v];if(h(g,b)>=0)break;l[i]=b,i=v}l[i]=g}_down(i){const{data:l,compare:h}=this,g=this.length>>1,v=l[i];for(;i<g;){let b=1+(i<<1);const A=b+1;if(A<this.length&&h(l[A],l[b])<0&&(b=A),h(l[b],v)>=0)break;l[i]=l[b],i=b}l[i]=v}}function Qk(c,i=1,l=!1){const h=mc.fromPoints(c[0]),g=Math.min(h.width(),h.height());let v=g/2;const b=new Xk([],Kk),{minX:A,minY:C,maxX:D,maxY:R}=h;if(g===0)return new F(A,C);for(let Z=A;Z<D;Z+=g)for(let W=C;W<R;W+=g)b.push(new Gu(Z+v,W+v,v,c));let O=function(Z){let W=0,J=0,ie=0;const fe=Z[0];for(let Me=0,ye=fe.length,q=ye-1;Me<ye;q=Me++){const ne=fe[Me],ve=fe[q],Ue=ne.x*ve.y-ve.x*ne.y;J+=(ne.x+ve.x)*Ue,ie+=(ne.y+ve.y)*Ue,W+=3*Ue}return new Gu(J/W,ie/W,0,Z)}(c),U=b.length;for(;b.length;){const Z=b.pop();(Z.d>O.d||!O.d)&&(O=Z,l&&console.log("found best %d after %d probes",Math.round(1e4*Z.d)/1e4,U)),Z.max-O.d<=i||(v=Z.h/2,b.push(new Gu(Z.p.x-v,Z.p.y-v,v,c)),b.push(new Gu(Z.p.x+v,Z.p.y-v,v,c)),b.push(new Gu(Z.p.x-v,Z.p.y+v,v,c)),b.push(new Gu(Z.p.x+v,Z.p.y+v,v,c)),U+=4)}return l&&(console.log(`num probes: ${U}`),console.log(`best distance: ${O.d}`)),O.p}function Kk(c,i){return i.max-c.max}function Gu(c,i,l,h){this.p=new F(c,i),this.h=l,this.d=function(g,v){let b=!1,A=1/0;for(let C=0;C<v.length;C++){const D=v[C];for(let R=0,O=D.length,U=O-1;R<O;U=R++){const Z=D[R],W=D[U];Z.y>g.y!=W.y>g.y&&g.x<(W.x-Z.x)*(g.y-Z.y)/(W.y-Z.y)+Z.x&&(b=!b),A=Math.min(A,qx(g,Z,W))}}return(b?1:-1)*Math.sqrt(A)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}var Cr;p.aD=void 0,(Cr=p.aD||(p.aD={}))[Cr.center=1]="center",Cr[Cr.left=2]="left",Cr[Cr.right=3]="right",Cr[Cr.top=4]="top",Cr[Cr.bottom=5]="bottom",Cr[Cr["top-left"]=6]="top-left",Cr[Cr["top-right"]=7]="top-right",Cr[Cr["bottom-left"]=8]="bottom-left",Cr[Cr["bottom-right"]=9]="bottom-right";const T0=Number.POSITIVE_INFINITY;function f2(c,i){return i[1]!==T0?function(l,h,g){let v=0,b=0;switch(h=Math.abs(h),g=Math.abs(g),l){case"top-right":case"top-left":case"top":b=g-7;break;case"bottom-right":case"bottom-left":case"bottom":b=7-g}switch(l){case"top-right":case"bottom-right":case"right":v=-h;break;case"top-left":case"bottom-left":case"left":v=h}return[v,b]}(c,i[0],i[1]):function(l,h){let g=0,v=0;h<0&&(h=0);const b=h/Math.SQRT2;switch(l){case"top-right":case"top-left":v=b-7;break;case"bottom-right":case"bottom-left":v=7-b;break;case"bottom":v=7-h;break;case"top":v=h-7}switch(l){case"top-right":case"bottom-right":g=-b;break;case"top-left":case"bottom-left":g=b;break;case"left":g=h;break;case"right":g=-h}return[g,v]}(c,i[0])}function d2(c,i,l){var h;const g=c.layout,v=(h=g.get("text-variable-anchor-offset"))===null||h===void 0?void 0:h.evaluate(i,{},l);if(v){const A=v.values,C=[];for(let D=0;D<A.length;D+=2){const R=C[D]=A[D],O=A[D+1].map(U=>U*sr);R.startsWith("top")?O[1]-=7:R.startsWith("bottom")&&(O[1]+=7),C[D+1]=O}return new Hn(C)}const b=g.get("text-variable-anchor");if(b){let A;A=c._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[g.get("text-radial-offset").evaluate(i,{},l)*sr,T0]:g.get("text-offset").evaluate(i,{},l).map(D=>D*sr);const C=[];for(const D of b)C.push(D,f2(D,A));return new Hn(C)}return null}function S0(c){switch(c){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Jk(c,i,l,h,g,v,b,A,C,D,R,O){let U=v.textMaxSize.evaluate(i,{});U===void 0&&(U=b);const Z=c.layers[0].layout,W=Z.get("icon-offset").evaluate(i,{},R),J=m2(l.horizontal),ie=b/24,fe=c.tilePixelRatio*ie,Me=c.tilePixelRatio*U/24,ye=c.tilePixelRatio*A,q=c.tilePixelRatio*Z.get("symbol-spacing"),ne=Z.get("text-padding")*c.tilePixelRatio,ve=function(sn,rn,Jt,Gn=1){const ji=sn.get("icon-padding").evaluate(rn,{},Jt),er=ji&&ji.values;return[er[0]*Gn,er[1]*Gn,er[2]*Gn,er[3]*Gn]}(Z,i,R,c.tilePixelRatio),Ue=Z.get("text-max-angle")/180*Math.PI,ut=Z.get("text-rotation-alignment")!=="viewport"&&Z.get("symbol-placement")!=="point",Ye=Z.get("icon-rotation-alignment")==="map"&&Z.get("symbol-placement")!=="point",et=Z.get("symbol-placement"),vt=q/2,dt=Z.get("icon-text-fit");let At;h&&dt!=="none"&&(c.allowVerticalPlacement&&l.vertical&&(At=Nw(h,l.vertical,dt,Z.get("icon-text-fit-padding"),W,ie)),J&&(h=Nw(h,J,dt,Z.get("icon-text-fit-padding"),W,ie)));const at=R?O.line.getGranularityForZoomLevel(R.z):1,Yt=(sn,rn)=>{rn.x<0||rn.x>=ct||rn.y<0||rn.y>=ct||function(Jt,Gn,ji,er,Ir,Ma,aa,vr,Fi,lr,br,xr,Yr,Ca,cr,oa,tr,ur,hr,$i,Ei,so,qu,lo,n4){const Zu=Jt.addToLineVertexArray(Gn,ji);let gc,Hu,$u,Wu,v2=0,b2=0,x2=0,w2=0,z0=-1,R0=-1;const ds={};let A2=Wr("");if(Jt.allowVerticalPlacement&&er.vertical){const Or=vr.layout.get("text-rotate").evaluate(Ei,{},lo)+90;$u=new zm(Fi,Gn,lr,br,xr,er.vertical,Yr,Ca,cr,Or),aa&&(Wu=new zm(Fi,Gn,lr,br,xr,aa,tr,ur,cr,Or))}if(Ir){const Or=vr.layout.get("icon-rotate").evaluate(Ei,{}),Ia=vr.layout.get("icon-text-fit")!=="none",_c=u2(Ir,Or,qu,Ia),uo=aa?u2(aa,Or,qu,Ia):void 0;Hu=new zm(Fi,Gn,lr,br,xr,Ir,tr,ur,!1,Or),v2=4*_c.length;const yc=Jt.iconSizeData;let Bo=null;yc.kind==="source"?(Bo=[fs*vr.layout.get("icon-size").evaluate(Ei,{})],Bo[0]>ul&&ht(`${Jt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):yc.kind==="composite"&&(Bo=[fs*so.compositeIconSizes[0].evaluate(Ei,{},lo),fs*so.compositeIconSizes[1].evaluate(Ei,{},lo)],(Bo[0]>ul||Bo[1]>ul)&&ht(`${Jt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Jt.addSymbols(Jt.icon,_c,Bo,$i,hr,Ei,p.an.none,Gn,Zu.lineStartIndex,Zu.lineLength,-1,lo),z0=Jt.icon.placedSymbolArray.length-1,uo&&(b2=4*uo.length,Jt.addSymbols(Jt.icon,uo,Bo,$i,hr,Ei,p.an.vertical,Gn,Zu.lineStartIndex,Zu.lineLength,-1,lo),R0=Jt.icon.placedSymbolArray.length-1)}const T2=Object.keys(er.horizontal);for(const Or of T2){const Ia=er.horizontal[Or];if(!gc){A2=Wr(Ia.text);const uo=vr.layout.get("text-rotate").evaluate(Ei,{},lo);gc=new zm(Fi,Gn,lr,br,xr,Ia,Yr,Ca,cr,uo)}const _c=Ia.positionedLines.length===1;if(x2+=p2(Jt,Gn,Ia,Ma,vr,cr,Ei,oa,Zu,er.vertical?p.an.horizontal:p.an.horizontalOnly,_c?T2:[Or],ds,z0,so,lo),_c)break}er.vertical&&(w2+=p2(Jt,Gn,er.vertical,Ma,vr,cr,Ei,oa,Zu,p.an.vertical,["vertical"],ds,R0,so,lo));const i4=gc?gc.boxStartIndex:Jt.collisionBoxArray.length,r4=gc?gc.boxEndIndex:Jt.collisionBoxArray.length,a4=$u?$u.boxStartIndex:Jt.collisionBoxArray.length,o4=$u?$u.boxEndIndex:Jt.collisionBoxArray.length,s4=Hu?Hu.boxStartIndex:Jt.collisionBoxArray.length,l4=Hu?Hu.boxEndIndex:Jt.collisionBoxArray.length,c4=Wu?Wu.boxStartIndex:Jt.collisionBoxArray.length,u4=Wu?Wu.boxEndIndex:Jt.collisionBoxArray.length;let co=-1;const Lm=(Or,Ia)=>Or&&Or.circleDiameter?Math.max(Or.circleDiameter,Ia):Ia;co=Lm(gc,co),co=Lm($u,co),co=Lm(Hu,co),co=Lm(Wu,co);const S2=co>-1?1:0;S2&&(co*=n4/sr),Jt.glyphOffsetArray.length>=Uu.MAX_GLYPHS&&ht("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ei.sortKey!==void 0&&Jt.addToSortKeyRanges(Jt.symbolInstances.length,Ei.sortKey);const h4=d2(vr,Ei,lo),[f4,d4]=function(Or,Ia){const _c=Or.length,uo=Ia==null?void 0:Ia.values;if((uo==null?void 0:uo.length)>0)for(let yc=0;yc<uo.length;yc+=2){const Bo=uo[yc+1];Or.emplaceBack(p.aD[uo[yc]],Bo[0],Bo[1])}return[_c,Or.length]}(Jt.textAnchorOffsets,h4);Jt.symbolInstances.emplaceBack(Gn.x,Gn.y,ds.right>=0?ds.right:-1,ds.center>=0?ds.center:-1,ds.left>=0?ds.left:-1,ds.vertical||-1,z0,R0,A2,i4,r4,a4,o4,s4,l4,c4,u4,lr,x2,w2,v2,b2,S2,0,Yr,co,f4,d4)}(c,rn,sn,l,h,g,At,c.layers[0],c.collisionBoxArray,i.index,i.sourceLayerIndex,c.index,fe,[ne,ne,ne,ne],ut,C,ye,ve,Ye,W,i,v,D,R,b)};if(et==="line")for(const sn of r2(i.geometry,0,0,ct,ct)){const rn=pc(sn,at),Jt=Yk(rn,q,Ue,l.vertical||J,h,24,Me,c.overscaling,ct);for(const Gn of Jt)J&&e4(c,J.text,vt,Gn)||Yt(rn,Gn)}else if(et==="line-center"){for(const sn of i.geometry)if(sn.length>1){const rn=pc(sn,at),Jt=Wk(rn,Ue,l.vertical||J,h,24,Me);Jt&&Yt(rn,Jt)}}else if(i.type==="Polygon")for(const sn of uu(i.geometry,0)){const rn=Qk(sn,16);Yt(pc(sn[0],at,!0),new fl(rn.x,rn.y,0))}else if(i.type==="LineString")for(const sn of i.geometry){const rn=pc(sn,at);Yt(rn,new fl(rn[0].x,rn[0].y,0))}else if(i.type==="Point")for(const sn of i.geometry)for(const rn of sn)Yt([rn],new fl(rn.x,rn.y,0))}function p2(c,i,l,h,g,v,b,A,C,D,R,O,U,Z,W){const J=function(Me,ye,q,ne,ve,Ue,ut,Ye){const et=ne.layout.get("text-rotate").evaluate(Ue,{})*Math.PI/180,vt=[];for(const dt of ye.positionedLines)for(const At of dt.positionedGlyphs){if(!At.rect)continue;const at=At.rect||{};let Yt=4,sn=!0,rn=1,Jt=0;const Gn=(ve||Ye)&&At.vertical,ji=At.metrics.advance*At.scale/2;if(Ye&&ye.verticalizable&&(Jt=dt.lineOffset/2-(At.imageName?-(sr-At.metrics.width*At.scale)/2:(At.scale-1)*sr)),At.imageName){const ur=ut[At.imageName];sn=ur.sdf,rn=ur.pixelRatio,Yt=1/rn}const er=ve?[At.x+ji,At.y]:[0,0];let Ir=ve?[0,0]:[At.x+ji+q[0],At.y+q[1]-Jt],Ma=[0,0];Gn&&(Ma=Ir,Ir=[0,0]);const aa=At.metrics.isDoubleResolution?2:1,vr=(At.metrics.left-Yt)*At.scale-ji+Ir[0],Fi=(-At.metrics.top-Yt)*At.scale+Ir[1],lr=vr+at.w/aa*At.scale/rn,br=Fi+at.h/aa*At.scale/rn,xr=new F(vr,Fi),Yr=new F(lr,Fi),Ca=new F(vr,br),cr=new F(lr,br);if(Gn){const ur=new F(-ji,ji- -17),hr=-Math.PI/2,$i=12-ji,Ei=new F(22-$i,-(At.imageName?$i:0)),so=new F(...Ma);xr._rotateAround(hr,ur)._add(Ei)._add(so),Yr._rotateAround(hr,ur)._add(Ei)._add(so),Ca._rotateAround(hr,ur)._add(Ei)._add(so),cr._rotateAround(hr,ur)._add(Ei)._add(so)}if(et){const ur=Math.sin(et),hr=Math.cos(et),$i=[hr,-ur,ur,hr];xr._matMult($i),Yr._matMult($i),Ca._matMult($i),cr._matMult($i)}const oa=new F(0,0),tr=new F(0,0);vt.push({tl:xr,tr:Yr,bl:Ca,br:cr,tex:at,writingMode:ye.writingMode,glyphOffset:er,sectionIndex:At.sectionIndex,isSDF:sn,pixelOffsetTL:oa,pixelOffsetBR:tr,minFontScaleX:0,minFontScaleY:0})}return vt}(0,l,A,g,v,b,h,c.allowVerticalPlacement),ie=c.textSizeData;let fe=null;ie.kind==="source"?(fe=[fs*g.layout.get("text-size").evaluate(b,{})],fe[0]>ul&&ht(`${c.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):ie.kind==="composite"&&(fe=[fs*Z.compositeTextSizes[0].evaluate(b,{},W),fs*Z.compositeTextSizes[1].evaluate(b,{},W)],(fe[0]>ul||fe[1]>ul)&&ht(`${c.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),c.addSymbols(c.text,J,fe,A,v,b,D,i,C.lineStartIndex,C.lineLength,U,W);for(const Me of R)O[Me]=c.text.placedSymbolArray.length-1;return 4*J.length}function m2(c){for(const i in c)return c[i];return null}function e4(c,i,l,h){const g=c.compareText;if(i in g){const v=g[i];for(let b=v.length-1;b>=0;b--)if(h.dist(v[b])<l)return!0}else g[i]=[];return g[i].push(h),!1}const g2=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class M0{static from(i){if(!(i instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[l,h]=new Uint8Array(i,0,2);if(l!==219)throw new Error("Data does not appear to be in a KDBush format.");const g=h>>4;if(g!==1)throw new Error(`Got v${g} data when expected v1.`);const v=g2[15&h];if(!v)throw new Error("Unrecognized array type.");const[b]=new Uint16Array(i,2,1),[A]=new Uint32Array(i,4,1);return new M0(A,b,v,i)}constructor(i,l=64,h=Float64Array,g){if(isNaN(i)||i<0)throw new Error(`Unpexpected numItems value: ${i}.`);this.numItems=+i,this.nodeSize=Math.min(Math.max(+l,2),65535),this.ArrayType=h,this.IndexArrayType=i<65536?Uint16Array:Uint32Array;const v=g2.indexOf(this.ArrayType),b=2*i*this.ArrayType.BYTES_PER_ELEMENT,A=i*this.IndexArrayType.BYTES_PER_ELEMENT,C=(8-A%8)%8;if(v<0)throw new Error(`Unexpected typed array class: ${h}.`);g&&g instanceof ArrayBuffer?(this.data=g,this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+A+C,2*i),this._pos=2*i,this._finished=!0):(this.data=new ArrayBuffer(8+b+A+C),this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+A+C,2*i),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+v]),new Uint16Array(this.data,2,1)[0]=l,new Uint32Array(this.data,4,1)[0]=i)}add(i,l){const h=this._pos>>1;return this.ids[h]=h,this.coords[this._pos++]=i,this.coords[this._pos++]=l,h}finish(){const i=this._pos>>1;if(i!==this.numItems)throw new Error(`Added ${i} items when expected ${this.numItems}.`);return C0(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(i,l,h,g){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:v,coords:b,nodeSize:A}=this,C=[0,v.length-1,0],D=[];for(;C.length;){const R=C.pop()||0,O=C.pop()||0,U=C.pop()||0;if(O-U<=A){for(let ie=U;ie<=O;ie++){const fe=b[2*ie],Me=b[2*ie+1];fe>=i&&fe<=h&&Me>=l&&Me<=g&&D.push(v[ie])}continue}const Z=U+O>>1,W=b[2*Z],J=b[2*Z+1];W>=i&&W<=h&&J>=l&&J<=g&&D.push(v[Z]),(R===0?i<=W:l<=J)&&(C.push(U),C.push(Z-1),C.push(1-R)),(R===0?h>=W:g>=J)&&(C.push(Z+1),C.push(O),C.push(1-R))}return D}within(i,l,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:v,nodeSize:b}=this,A=[0,g.length-1,0],C=[],D=h*h;for(;A.length;){const R=A.pop()||0,O=A.pop()||0,U=A.pop()||0;if(O-U<=b){for(let ie=U;ie<=O;ie++)y2(v[2*ie],v[2*ie+1],i,l)<=D&&C.push(g[ie]);continue}const Z=U+O>>1,W=v[2*Z],J=v[2*Z+1];y2(W,J,i,l)<=D&&C.push(g[Z]),(R===0?i-h<=W:l-h<=J)&&(A.push(U),A.push(Z-1),A.push(1-R)),(R===0?i+h>=W:l+h>=J)&&(A.push(Z+1),A.push(O),A.push(1-R))}return C}}function C0(c,i,l,h,g,v){if(g-h<=l)return;const b=h+g>>1;_2(c,i,b,h,g,v),C0(c,i,l,h,b-1,1-v),C0(c,i,l,b+1,g,1-v)}function _2(c,i,l,h,g,v){for(;g>h;){if(g-h>600){const D=g-h+1,R=l-h+1,O=Math.log(D),U=.5*Math.exp(2*O/3),Z=.5*Math.sqrt(O*U*(D-U)/D)*(R-D/2<0?-1:1);_2(c,i,l,Math.max(h,Math.floor(l-R*U/D+Z)),Math.min(g,Math.floor(l+(D-R)*U/D+Z)),v)}const b=i[2*l+v];let A=h,C=g;for(td(c,i,h,l),i[2*g+v]>b&&td(c,i,h,g);A<C;){for(td(c,i,A,C),A++,C--;i[2*A+v]<b;)A++;for(;i[2*C+v]>b;)C--}i[2*h+v]===b?td(c,i,h,C):(C++,td(c,i,C,g)),C<=l&&(h=C+1),l<=C&&(g=C-1)}}function td(c,i,l,h){I0(c,l,h),I0(i,2*l,2*h),I0(i,2*l+1,2*h+1)}function I0(c,i,l){const h=c[i];c[i]=c[l],c[l]=h}function y2(c,i,l,h){const g=c-l,v=i-h;return g*g+v*v}var E0;p.cw=void 0,(E0=p.cw||(p.cw={})).create="create",E0.load="load",E0.fullLoad="fullLoad";let Rm=null,nd=[];const P0=1e3/60,k0="loadTime",D0="fullLoadTime",t4={mark(c){performance.mark(c)},frame(c){const i=c;Rm!=null&&nd.push(i-Rm),Rm=i},clearMetrics(){Rm=null,nd=[],performance.clearMeasures(k0),performance.clearMeasures(D0);for(const c in p.cw)performance.clearMarks(p.cw[c])},getPerformanceMetrics(){performance.measure(k0,p.cw.create,p.cw.load),performance.measure(D0,p.cw.create,p.cw.fullLoad);const c=performance.getEntriesByName(k0)[0].duration,i=performance.getEntriesByName(D0)[0].duration,l=nd.length,h=1/(nd.reduce((v,b)=>v+b,0)/l/1e3),g=nd.filter(v=>v>P0).reduce((v,b)=>v+(b-P0)/P0,0);return{loadTime:c,fullLoadTime:i,fps:h,percentDroppedFrames:g/(l+g)*100,totalFrames:l}}};p.$=ct,p.A=re,p.B=function([c,i,l]){return i+=90,i*=Math.PI/180,l*=Math.PI/180,{x:c*Math.cos(i)*Math.sin(l),y:c*Math.sin(i)*Math.sin(l),z:c*Math.cos(l)}},p.C=ia,p.D=Qt,p.E=Je,p.F=Pi,p.G=Iu,p.H=function(c){if(Ht==null){const i=c.navigator?c.navigator.userAgent:null;Ht=!!c.safari||!(!i||!(/\b(iPad|iPhone|iPod)\b/.test(i)||i.match("Safari")&&!i.match("Chrome")))}return Ht},p.I=d0,p.J=class{constructor(c,i){this.target=c,this.mapId=i,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Zk(()=>this.process()),this.subscription=fn(this.target,"message",l=>this.receive(l),!1),this.globalScope=Mt(self)?c:window}registerMessageHandler(c,i){this.messageHandlers[c]=i}sendAsync(c,i){return new Promise((l,h)=>{const g=Math.round(1e18*Math.random()).toString(36).substring(0,10),v=i?fn(i.signal,"abort",()=>{v==null||v.unsubscribe(),delete this.resolveRejects[g];const C={id:g,type:"<cancel>",origin:location.origin,targetMapId:c.targetMapId,sourceMapId:this.mapId};this.target.postMessage(C)},Hk):null;this.resolveRejects[g]={resolve:C=>{v==null||v.unsubscribe(),l(C)},reject:C=>{v==null||v.unsubscribe(),h(C)}};const b=[],A=Object.assign(Object.assign({},c),{id:g,sourceMapId:this.mapId,origin:location.origin,data:nc(c.data,b)});this.target.postMessage(A,{transfer:b})})}receive(c){const i=c.data,l=i.id;if(!(i.origin!=="file://"&&location.origin!=="file://"&&i.origin!=="resource://android"&&location.origin!=="resource://android"&&i.origin!==location.origin||i.targetMapId&&this.mapId!==i.targetMapId)){if(i.type==="<cancel>"){delete this.tasks[l];const h=this.abortControllers[l];return delete this.abortControllers[l],void(h&&h.abort())}if(Mt(self)||i.mustQueue)return this.tasks[l]=i,this.taskQueue.push(l),void this.invoker.trigger();this.processTask(l,i)}}process(){if(this.taskQueue.length===0)return;const c=this.taskQueue.shift(),i=this.tasks[c];delete this.tasks[c],this.taskQueue.length>0&&this.invoker.trigger(),i&&this.processTask(c,i)}processTask(c,i){return a(this,void 0,void 0,function*(){if(i.type==="<response>"){const g=this.resolveRejects[c];return delete this.resolveRejects[c],g?void(i.error?g.reject(ol(i.error)):g.resolve(ol(i.data))):void 0}if(!this.messageHandlers[i.type])return void this.completeTask(c,new Error(`Could not find a registered handler for ${i.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const l=ol(i.data),h=new AbortController;this.abortControllers[c]=h;try{const g=yield this.messageHandlers[i.type](i.sourceMapId,l,h);this.completeTask(c,null,g)}catch(g){this.completeTask(c,g)}})}completeTask(c,i,l){const h=[];delete this.abortControllers[c];const g={id:c,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:i?nc(i):null,data:nc(l,h)};this.target.postMessage(g,{transfer:h})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},p.K=te,p.L=function(){var c=new re(16);return re!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=0,c[12]=0,c[13]=0,c[14]=0),c[0]=1,c[5]=1,c[10]=1,c[15]=1,c},p.M=function(c,i,l){var h,g,v,b,A,C,D,R,O,U,Z,W,J=l[0],ie=l[1],fe=l[2];return i===c?(c[12]=i[0]*J+i[4]*ie+i[8]*fe+i[12],c[13]=i[1]*J+i[5]*ie+i[9]*fe+i[13],c[14]=i[2]*J+i[6]*ie+i[10]*fe+i[14],c[15]=i[3]*J+i[7]*ie+i[11]*fe+i[15]):(g=i[1],v=i[2],b=i[3],A=i[4],C=i[5],D=i[6],R=i[7],O=i[8],U=i[9],Z=i[10],W=i[11],c[0]=h=i[0],c[1]=g,c[2]=v,c[3]=b,c[4]=A,c[5]=C,c[6]=D,c[7]=R,c[8]=O,c[9]=U,c[10]=Z,c[11]=W,c[12]=h*J+A*ie+O*fe+i[12],c[13]=g*J+C*ie+U*fe+i[13],c[14]=v*J+D*ie+Z*fe+i[14],c[15]=b*J+R*ie+W*fe+i[15]),c},p.N=function(c,i,l){var h=l[0],g=l[1],v=l[2];return c[0]=i[0]*h,c[1]=i[1]*h,c[2]=i[2]*h,c[3]=i[3]*h,c[4]=i[4]*g,c[5]=i[5]*g,c[6]=i[6]*g,c[7]=i[7]*g,c[8]=i[8]*v,c[9]=i[9]*v,c[10]=i[10]*v,c[11]=i[11]*v,c[12]=i[12],c[13]=i[13],c[14]=i[14],c[15]=i[15],c},p.O=function(c,i,l){var h=i[0],g=i[1],v=i[2],b=i[3],A=i[4],C=i[5],D=i[6],R=i[7],O=i[8],U=i[9],Z=i[10],W=i[11],J=i[12],ie=i[13],fe=i[14],Me=i[15],ye=l[0],q=l[1],ne=l[2],ve=l[3];return c[0]=ye*h+q*A+ne*O+ve*J,c[1]=ye*g+q*C+ne*U+ve*ie,c[2]=ye*v+q*D+ne*Z+ve*fe,c[3]=ye*b+q*R+ne*W+ve*Me,c[4]=(ye=l[4])*h+(q=l[5])*A+(ne=l[6])*O+(ve=l[7])*J,c[5]=ye*g+q*C+ne*U+ve*ie,c[6]=ye*v+q*D+ne*Z+ve*fe,c[7]=ye*b+q*R+ne*W+ve*Me,c[8]=(ye=l[8])*h+(q=l[9])*A+(ne=l[10])*O+(ve=l[11])*J,c[9]=ye*g+q*C+ne*U+ve*ie,c[10]=ye*v+q*D+ne*Z+ve*fe,c[11]=ye*b+q*R+ne*W+ve*Me,c[12]=(ye=l[12])*h+(q=l[13])*A+(ne=l[14])*O+(ve=l[15])*J,c[13]=ye*g+q*C+ne*U+ve*ie,c[14]=ye*v+q*D+ne*Z+ve*fe,c[15]=ye*b+q*R+ne*W+ve*Me,c},p.P=F,p.Q=function(c,i){const l={};for(let h=0;h<i.length;h++){const g=i[h];g in c&&(l[g]=c[g])}return l},p.R=ra,p.S=hl,p.T=Ky,p.U=Yw,p.V=Ww,p.W=ae,p.X=ee,p.Y=yt,p.Z=Sa,p._=a,p.a=X,p.a$=function(c,i,l){return c[0]=i[0]*l,c[1]=i[1]*l,c[2]=i[2]*l,c[3]=i[3]*l,c},p.a0=ed,p.a1=mc,p.a2=25,p.a3=A0,p.a4=c=>{const i=window.document.createElement("video");return i.muted=!0,new Promise(l=>{i.onloadstart=()=>{l(i)};for(const h of c){const g=window.document.createElement("source");Fe(h)||(i.crossOrigin="Anonymous"),g.src=h,i.appendChild(g)}})},p.a5=xt,p.a6=function(){return Be++},p.a7=se,p.a8=Uu,p.a9=Mo,p.aA=sr,p.aB=mt,p.aC=function(c,i,l,h,g=!1){if(!l[0]&&!l[1])return[0,0];const v=g?h==="map"?-c.bearingInRadians:0:h==="viewport"?c.bearingInRadians:0;if(v){const b=Math.sin(v),A=Math.cos(v);l=[l[0]*A-l[1]*b,l[0]*b+l[1]*A]}return[g?l[0]:mt(i,l[0],c.zoom),g?l[1]:mt(i,l[1],c.zoom)]},p.aE=g0,p.aF=S0,p.aG=m0,p.aH=M0,p.aI=Ni,p.aJ=Am,p.aK=Ne,p.aL=Wn,p.aM=vi,p.aN=De,p.aO=On,p.aP=Qw,p.aQ=Ze,p.aR=Ve,p.aS=function(c){var i=new re(3);return i[0]=c[0],i[1]=c[1],i[2]=c[2],i},p.aT=function(c,i,l){return c[0]=i[0]-l[0],c[1]=i[1]-l[1],c[2]=i[2]-l[2],c},p.aU=function(c,i){var l=i[0],h=i[1],g=i[2],v=l*l+h*h+g*g;return v>0&&(v=1/Math.sqrt(v)),c[0]=i[0]*v,c[1]=i[1]*v,c[2]=i[2]*v,c},p.aV=Xe,p.aW=function(c,i){return c[0]*i[0]+c[1]*i[1]+c[2]*i[2]},p.aX=function(c,i,l){return c[0]=i[0]*l[0],c[1]=i[1]*l[1],c[2]=i[2]*l[2],c[3]=i[3]*l[3],c},p.aY=Ie,p.aZ=function(c,i,l){const h=i[0]*l[0]+i[1]*l[1]+i[2]*l[2];return h===0?null:(-(c[0]*l[0]+c[1]*l[1]+c[2]*l[2])-l[3])/h},p.a_=ot,p.aa=fc,p.ab=t2,p.ac=function(c){const i={};if(c.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,h,g,v)=>{const b=g||v;return i[h]=!b||b.toLowerCase(),""}),i["max-age"]){const l=parseInt(i["max-age"],10);isNaN(l)?delete i["max-age"]:i["max-age"]=l}return i},p.ad=yn,p.ae=function(c){return Math.pow(2,c)},p.af=be,p.ag=nt,p.ah=85.051129,p.ai=Xw,p.aj=function(c){return Math.log(c)/Math.LN2},p.ak=function(c){var i=c[0],l=c[1];return i*i+l*l},p.al=function(c,i){const l=[];for(const h in c)h in i||l.push(h);return l},p.am=function(c,i){let l=0,h=0;if(c.kind==="constant")h=c.layoutSize;else if(c.kind!=="source"){const{interpolationType:g,minZoom:v,maxZoom:b}=c,A=g?nt(Rr.interpolationFactor(g,i,v,b),0,1):0;c.kind==="camera"?h=ia.number(c.minSize,c.maxSize,A):l=A}return{uSizeT:l,uSize:h}},p.ao=function(c,{uSize:i,uSizeT:l},{lowerSize:h,upperSize:g}){return c.kind==="source"?h/fs:c.kind==="composite"?ia.number(h/fs,g/fs,l):i},p.ap=function(c,i){var l=i[0],h=i[1],g=i[2],v=i[3],b=i[4],A=i[5],C=i[6],D=i[7],R=i[8],O=i[9],U=i[10],Z=i[11],W=i[12],J=i[13],ie=i[14],fe=i[15],Me=l*A-h*b,ye=l*C-g*b,q=l*D-v*b,ne=h*C-g*A,ve=h*D-v*A,Ue=g*D-v*C,ut=R*J-O*W,Ye=R*ie-U*W,et=R*fe-Z*W,vt=O*ie-U*J,dt=O*fe-Z*J,At=U*fe-Z*ie,at=Me*At-ye*dt+q*vt+ne*et-ve*Ye+Ue*ut;return at?(c[0]=(A*At-C*dt+D*vt)*(at=1/at),c[1]=(g*dt-h*At-v*vt)*at,c[2]=(J*Ue-ie*ve+fe*ne)*at,c[3]=(U*ve-O*Ue-Z*ne)*at,c[4]=(C*et-b*At-D*Ye)*at,c[5]=(l*At-g*et+v*Ye)*at,c[6]=(ie*q-W*Ue-fe*ye)*at,c[7]=(R*Ue-U*q+Z*ye)*at,c[8]=(b*dt-A*et+D*ut)*at,c[9]=(h*et-l*dt-v*ut)*at,c[10]=(W*ve-J*q+fe*Me)*at,c[11]=(O*q-R*ve-Z*Me)*at,c[12]=(A*Ye-b*vt-C*ut)*at,c[13]=(l*vt-h*Ye+g*ut)*at,c[14]=(J*ye-W*ne-ie*Me)*at,c[15]=(R*ne-O*ye+U*Me)*at,c):null},p.aq=tt,p.ar=function(c){return Math.hypot(c[0],c[1])},p.as=function(c){return c[0]=0,c[1]=0,c},p.at=function(c,i,l){return c[0]=i[0]*l,c[1]=i[1]*l,c},p.au=_0,p.av=Pt,p.aw=function(c,i,l,h){const g=i.y-c.y,v=i.x-c.x,b=h.y-l.y,A=h.x-l.x,C=b*v-A*g;if(C===0)return null;const D=(A*(c.y-l.y)-b*(c.x-l.x))/C;return new F(c.x+D*v,c.y+D*g)},p.ax=r2,p.ay=Vx,p.az=function(c){let i=1/0,l=1/0,h=-1/0,g=-1/0;for(const v of c)i=Math.min(i,v.x),l=Math.min(l,v.y),h=Math.max(h,v.x),g=Math.max(g,v.y);return[i,l,h,g]},p.b=_n,p.b$=wk,p.b0=function(c,i){return c[0]*i[0]+c[1]*i[1]+c[2]*i[2]+c[3]},p.b1=Jw,p.b2=Vu,p.b3=function(c,i,l,h,g){var v,b=1/Math.tan(i/2);return c[0]=b/l,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=b,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=-1,c[12]=0,c[13]=0,c[15]=0,g!=null&&g!==1/0?(c[10]=(g+h)*(v=1/(h-g)),c[14]=2*g*h*v):(c[10]=-1,c[14]=-2*h),c},p.b4=function(c){var i=new re(16);return i[0]=c[0],i[1]=c[1],i[2]=c[2],i[3]=c[3],i[4]=c[4],i[5]=c[5],i[6]=c[6],i[7]=c[7],i[8]=c[8],i[9]=c[9],i[10]=c[10],i[11]=c[11],i[12]=c[12],i[13]=c[13],i[14]=c[14],i[15]=c[15],i},p.b5=function(c,i,l){var h=Math.sin(l),g=Math.cos(l),v=i[0],b=i[1],A=i[2],C=i[3],D=i[4],R=i[5],O=i[6],U=i[7];return i!==c&&(c[8]=i[8],c[9]=i[9],c[10]=i[10],c[11]=i[11],c[12]=i[12],c[13]=i[13],c[14]=i[14],c[15]=i[15]),c[0]=v*g+D*h,c[1]=b*g+R*h,c[2]=A*g+O*h,c[3]=C*g+U*h,c[4]=D*g-v*h,c[5]=R*g-b*h,c[6]=O*g-A*h,c[7]=U*g-C*h,c},p.b6=function(c,i,l){var h=Math.sin(l),g=Math.cos(l),v=i[4],b=i[5],A=i[6],C=i[7],D=i[8],R=i[9],O=i[10],U=i[11];return i!==c&&(c[0]=i[0],c[1]=i[1],c[2]=i[2],c[3]=i[3],c[12]=i[12],c[13]=i[13],c[14]=i[14],c[15]=i[15]),c[4]=v*g+D*h,c[5]=b*g+R*h,c[6]=A*g+O*h,c[7]=C*g+U*h,c[8]=D*g-v*h,c[9]=R*g-b*h,c[10]=O*g-A*h,c[11]=U*g-C*h,c},p.b7=function(){const c=new Float32Array(16);return be(c),c},p.b8=function(){const c=new Float64Array(16);return be(c),c},p.b9=function(){return new Float64Array(16)},p.bA=function(c){return c[0]=0,c[1]=0,c[2]=0,c},p.bB=function(c,i,l,h){const g=Math.sqrt(c*c+i*i),v=Math.sqrt(l*l+h*h);c/=g,i/=g,l/=v,h/=v;const b=Math.acos(c*l+i*h);return-i*l+c*h>0?b:-b},p.bC=function(c,i){const l=Xt(c,2*Math.PI),h=Xt(i,2*Math.PI);return Math.min(Math.abs(l-h),Math.abs(l-h+2*Math.PI),Math.abs(l-h-2*Math.PI))},p.bD=function(){const c={},i=Ae.$version;for(const l in Ae.$root){const h=Ae.$root[l];if(h.required){let g=null;g=l==="version"?i:h.type==="array"?[]:{},g!=null&&(c[l]=g)}}return c},p.bE=Cf,p.bF=we,p.bG=function c(i,l){if(Array.isArray(i)){if(!Array.isArray(l)||i.length!==l.length)return!1;for(let h=0;h<i.length;h++)if(!c(i[h],l[h]))return!1;return!0}if(typeof i=="object"&&i!==null&&l!==null){if(typeof l!="object"||Object.keys(i).length!==Object.keys(l).length)return!1;for(const h in i)if(!c(i[h],l[h]))return!1;return!0}return i===l},p.bH=function(c){c=c.slice();const i=Object.create(null);for(let l=0;l<c.length;l++)i[c[l].id]=c[l];for(let l=0;l<c.length;l++)"ref"in c[l]&&(c[l]=nn(c[l],i[c[l].ref]));return c},p.bI=function(c){if(c.type==="custom")return new qk(c);switch(c.type){case"background":return new Uk(c);case"circle":return new L5(c);case"color-relief":return new U5(c);case"fill":return new nk(c);case"fill-extrusion":return new uk(c);case"heatmap":return new F5(c);case"hillshade":return new N5(c);case"line":return new yk(c);case"raster":return new Gk(c);case"symbol":return new Em(c)}},p.bJ=Rt,p.bK=function(c,i){if(!c)return[{command:"setStyle",args:[i]}];let l=[];try{if(!jt(c.version,i.version))return[{command:"setStyle",args:[i]}];jt(c.center,i.center)||l.push({command:"setCenter",args:[i.center]}),jt(c.state,i.state)||l.push({command:"setGlobalState",args:[i.state]}),jt(c.centerAltitude,i.centerAltitude)||l.push({command:"setCenterAltitude",args:[i.centerAltitude]}),jt(c.zoom,i.zoom)||l.push({command:"setZoom",args:[i.zoom]}),jt(c.bearing,i.bearing)||l.push({command:"setBearing",args:[i.bearing]}),jt(c.pitch,i.pitch)||l.push({command:"setPitch",args:[i.pitch]}),jt(c.roll,i.roll)||l.push({command:"setRoll",args:[i.roll]}),jt(c.sprite,i.sprite)||l.push({command:"setSprite",args:[i.sprite]}),jt(c.glyphs,i.glyphs)||l.push({command:"setGlyphs",args:[i.glyphs]}),jt(c.transition,i.transition)||l.push({command:"setTransition",args:[i.transition]}),jt(c.light,i.light)||l.push({command:"setLight",args:[i.light]}),jt(c.terrain,i.terrain)||l.push({command:"setTerrain",args:[i.terrain]}),jt(c.sky,i.sky)||l.push({command:"setSky",args:[i.sky]}),jt(c.projection,i.projection)||l.push({command:"setProjection",args:[i.projection]});const h={},g=[];(function(b,A,C,D){let R;for(R in A=A||{},b=b||{})Object.prototype.hasOwnProperty.call(b,R)&&(Object.prototype.hasOwnProperty.call(A,R)||ti(R,C,D));for(R in A)Object.prototype.hasOwnProperty.call(A,R)&&(Object.prototype.hasOwnProperty.call(b,R)?jt(b[R],A[R])||(b[R].type==="geojson"&&A[R].type==="geojson"&&Nn(b,A,R)?Kt(C,{command:"setGeoJSONSourceData",args:[R,A[R].data]}):Pn(R,A,C,D)):en(R,A,C))})(c.sources,i.sources,g,h);const v=[];c.layers&&c.layers.forEach(b=>{"source"in b&&h[b.source]?l.push({command:"removeLayer",args:[b.id]}):v.push(b)}),l=l.concat(g),function(b,A,C){A=A||[];const D=(b=b||[]).map(En),R=A.map(En),O=b.reduce(li,{}),U=A.reduce(li,{}),Z=D.slice(),W=Object.create(null);let J,ie,fe,Me,ye;for(let q=0,ne=0;q<D.length;q++)J=D[q],Object.prototype.hasOwnProperty.call(U,J)?ne++:(Kt(C,{command:"removeLayer",args:[J]}),Z.splice(Z.indexOf(J,ne),1));for(let q=0,ne=0;q<R.length;q++)J=R[R.length-1-q],Z[Z.length-1-q]!==J&&(Object.prototype.hasOwnProperty.call(O,J)?(Kt(C,{command:"removeLayer",args:[J]}),Z.splice(Z.lastIndexOf(J,Z.length-ne),1)):ne++,Me=Z[Z.length-q],Kt(C,{command:"addLayer",args:[U[J],Me]}),Z.splice(Z.length-q,0,J),W[J]=!0);for(let q=0;q<R.length;q++)if(J=R[q],ie=O[J],fe=U[J],!W[J]&&!jt(ie,fe))if(jt(ie.source,fe.source)&&jt(ie["source-layer"],fe["source-layer"])&&jt(ie.type,fe.type)){for(ye in ln(ie.layout,fe.layout,C,J,null,"setLayoutProperty"),ln(ie.paint,fe.paint,C,J,null,"setPaintProperty"),jt(ie.filter,fe.filter)||Kt(C,{command:"setFilter",args:[J,fe.filter]}),jt(ie.minzoom,fe.minzoom)&&jt(ie.maxzoom,fe.maxzoom)||Kt(C,{command:"setLayerZoomRange",args:[J,fe.minzoom,fe.maxzoom]}),ie)Object.prototype.hasOwnProperty.call(ie,ye)&&ye!=="layout"&&ye!=="paint"&&ye!=="filter"&&ye!=="metadata"&&ye!=="minzoom"&&ye!=="maxzoom"&&(ye.indexOf("paint.")===0?ln(ie[ye],fe[ye],C,J,ye.slice(6),"setPaintProperty"):jt(ie[ye],fe[ye])||Kt(C,{command:"setLayerProperty",args:[J,ye,fe[ye]]}));for(ye in fe)Object.prototype.hasOwnProperty.call(fe,ye)&&!Object.prototype.hasOwnProperty.call(ie,ye)&&ye!=="layout"&&ye!=="paint"&&ye!=="filter"&&ye!=="metadata"&&ye!=="minzoom"&&ye!=="maxzoom"&&(ye.indexOf("paint.")===0?ln(ie[ye],fe[ye],C,J,ye.slice(6),"setPaintProperty"):jt(ie[ye],fe[ye])||Kt(C,{command:"setLayerProperty",args:[J,ye,fe[ye]]}))}else Kt(C,{command:"removeLayer",args:[J]}),Me=Z[Z.lastIndexOf(J)+1],Kt(C,{command:"addLayer",args:[fe,Me]})}(v,i.layers,l)}catch(h){console.warn("Unable to compute style diff:",h),l=[{command:"setStyle",args:[i]}]}return l},p.bL=function(c){const i=[],l=c.id;return l===void 0&&i.push({message:`layers.${l}: missing required property "id"`}),c.render===void 0&&i.push({message:`layers.${l}: missing required method "render"`}),c.renderingMode&&c.renderingMode!=="2d"&&c.renderingMode!=="3d"&&i.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),i},p.bM=wt,p.bN=gt,p.bO=class extends Ii{constructor(c,i){super(c,i),this.current=0}set(c){this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))}},p.bP=ym,p.bQ=class extends Ii{constructor(c,i){super(c,i),this.current=Zy}set(c){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(let i=1;i<16;i++)if(c[i]!==this.current[i]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}}},p.bR=Ji,p.bS=class extends Ii{constructor(c,i){super(c,i),this.current=[0,0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2]))}},p.bT=class extends Ii{constructor(c,i){super(c,i),this.current=[0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1]))}},p.bU=he,p.bV=function(c,i){var l=Math.sin(i),h=Math.cos(i);return c[0]=h,c[1]=l,c[2]=0,c[3]=-l,c[4]=h,c[5]=0,c[6]=0,c[7]=0,c[8]=1,c},p.bW=function(c,i,l){var h=i[0],g=i[1],v=i[2];return c[0]=h*l[0]+g*l[3]+v*l[6],c[1]=h*l[1]+g*l[4]+v*l[7],c[2]=h*l[2]+g*l[5]+v*l[8],c},p.bX=function(c,i,l,h,g,v,b){var A=1/(i-l),C=1/(h-g),D=1/(v-b);return c[0]=-2*A,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*C,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*D,c[11]=0,c[12]=(i+l)*A,c[13]=(g+h)*C,c[14]=(b+v)*D,c[15]=1,c},p.bY=class extends Ii{constructor(c,i){super(c,i),this.current=new Array}set(c){if(c!=this.current){this.current=c;const i=new Float32Array(4*c.length);for(let l=0;l<c.length;l++)i[4*l]=c[l].r,i[4*l+1]=c[l].g,i[4*l+2]=c[l].b,i[4*l+3]=c[l].a;this.gl.uniform4fv(this.location,i)}}},p.bZ=class extends Ii{constructor(c,i){super(c,i),this.current=new Array}set(c){if(c!=this.current){this.current=c;const i=new Float32Array(c);this.gl.uniform1fv(this.location,i)}}},p.b_=class extends f{},p.ba=function(c,i,l){const h=new Float64Array(4);return _t(h,c,i-90,l),h},p.bb=function(c,i,l,h){var g,v,b,A,C,D=i[0],R=i[1],O=i[2],U=i[3],Z=l[0],W=l[1],J=l[2],ie=l[3];return(v=D*Z+R*W+O*J+U*ie)<0&&(v=-v,Z=-Z,W=-W,J=-J,ie=-ie),1-v>ce?(g=Math.acos(v),b=Math.sin(g),A=Math.sin((1-h)*g)/b,C=Math.sin(h*g)/b):(A=1-h,C=h),c[0]=A*D+C*Z,c[1]=A*R+C*W,c[2]=A*O+C*J,c[3]=A*U+C*ie,c},p.bc=function(c){const i=new Float64Array(9);var l,h,g,v,b,A,C,D,R,O,U,Z,W,J,ie,fe,Me,ye;O=(g=(h=c)[0])*(C=g+g),U=(v=h[1])*C,W=(b=h[2])*C,J=b*(D=v+v),fe=(A=h[3])*C,Me=A*D,ye=A*(R=b+b),(l=i)[0]=1-(Z=v*D)-(ie=b*R),l[3]=U-ye,l[6]=W+Me,l[1]=U+ye,l[4]=1-O-ie,l[7]=J-fe,l[2]=W-Me,l[5]=J+fe,l[8]=1-O-Z;const q=On(-Math.asin(nt(i[2],-1,1)));let ne,ve;return Math.hypot(i[5],i[8])<.001?(ne=0,ve=-On(Math.atan2(i[3],i[4]))):(ne=On(i[5]===0&&i[8]===0?0:Math.atan2(i[5],i[8])),ve=On(i[1]===0&&i[0]===0?0:Math.atan2(i[1],i[0]))),{roll:ne,pitch:q+90,bearing:ve}},p.bd=function(c,i){return c.roll==i.roll&&c.pitch==i.pitch&&c.bearing==i.bearing},p.be=zn,p.bf=Fr,p.bg=Nu,p.bh=$f,p.bi=Ou,p.bj=Ut,p.bk=St,p.bl=xn,p.bm=function(c,i,l,h,g){return Ut(h,g,nt((c-i)/(l-i),0,1))},p.bn=Xt,p.bo=function(){return new Float64Array(3)},p.bp=function(c,i,l,h){return c[0]=i[0]+l[0]*h,c[1]=i[1]+l[1]*h,c[2]=i[2]+l[2]*h,c},p.bq=_t,p.br=function(c,i,l){var h=l[0],g=l[1],v=l[2],b=i[0],A=i[1],C=i[2],D=g*C-v*A,R=v*b-h*C,O=h*A-g*b,U=g*O-v*R,Z=v*D-h*O,W=h*R-g*D,J=2*l[3];return R*=J,O*=J,Z*=2,W*=2,c[0]=b+(D*=J)+(U*=2),c[1]=A+R+Z,c[2]=C+O+W,c},p.bs=function(c,i,l){const h=(g=[c[0],c[1],c[2],i[0],i[1],i[2],l[0],l[1],l[2]])[0]*((R=g[8])*(b=g[4])-(A=g[5])*(D=g[7]))+g[1]*(-R*(v=g[3])+A*(C=g[6]))+g[2]*(D*v-b*C);var g,v,b,A,C,D,R;if(h===0)return null;const O=Xe([],[i[0],i[1],i[2]],[l[0],l[1],l[2]]),U=Xe([],[l[0],l[1],l[2]],[c[0],c[1],c[2]]),Z=Xe([],[c[0],c[1],c[2]],[i[0],i[1],i[2]]),W=Ze([],O,-c[3]);return Ve(W,W,Ze([],U,-i[3])),Ve(W,W,Ze([],Z,-l[3])),Ze(W,W,1/h),W},p.bt=x0,p.bu=function(){return new Float64Array(4)},p.bv=function(c,i,l,h){var g=[],v=[];return g[0]=i[0]-l[0],g[1]=i[1]-l[1],g[2]=i[2]-l[2],v[0]=g[0]*Math.cos(h)-g[1]*Math.sin(h),v[1]=g[0]*Math.sin(h)+g[1]*Math.cos(h),v[2]=g[2],c[0]=v[0]+l[0],c[1]=v[1]+l[1],c[2]=v[2]+l[2],c},p.bw=function(c,i,l,h){var g=[],v=[];return g[0]=i[0]-l[0],g[1]=i[1]-l[1],g[2]=i[2]-l[2],v[0]=g[0],v[1]=g[1]*Math.cos(h)-g[2]*Math.sin(h),v[2]=g[1]*Math.sin(h)+g[2]*Math.cos(h),c[0]=v[0]+l[0],c[1]=v[1]+l[1],c[2]=v[2]+l[2],c},p.bx=function(c,i,l,h){var g=[],v=[];return g[0]=i[0]-l[0],g[1]=i[1]-l[1],g[2]=i[2]-l[2],v[0]=g[2]*Math.sin(h)+g[0]*Math.cos(h),v[1]=g[1],v[2]=g[2]*Math.cos(h)-g[0]*Math.sin(h),c[0]=v[0]+l[0],c[1]=v[1]+l[1],c[2]=v[2]+l[2],c},p.by=function(c,i,l){var h=Math.sin(l),g=Math.cos(l),v=i[0],b=i[1],A=i[2],C=i[3],D=i[8],R=i[9],O=i[10],U=i[11];return i!==c&&(c[4]=i[4],c[5]=i[5],c[6]=i[6],c[7]=i[7],c[12]=i[12],c[13]=i[13],c[14]=i[14],c[15]=i[15]),c[0]=v*g-D*h,c[1]=b*g-R*h,c[2]=A*g-O*h,c[3]=C*g-U*h,c[8]=v*h+D*g,c[9]=b*h+R*g,c[10]=A*h+O*g,c[11]=C*h+U*g,c},p.bz=function(c,i){const l=Xt(c,360),h=Xt(i,360),g=h-l,v=h>l?g-360:g+360;return Math.abs(g)<Math.abs(v)?g:v},p.c=Ce,p.c0=class extends y{},p.c1=Qy,p.c2=function(c){return c<=1?1:Math.pow(2,Math.ceil(Math.log(c)/Math.LN2))},p.c3=Kx,p.c4=function(c,i,l){var h=i[0],g=i[1],v=i[2],b=l[3]*h+l[7]*g+l[11]*v+l[15];return c[0]=(l[0]*h+l[4]*g+l[8]*v+l[12])/(b=b||1),c[1]=(l[1]*h+l[5]*g+l[9]*v+l[13])/b,c[2]=(l[2]*h+l[6]*g+l[10]*v+l[14])/b,c},p.c5=class extends Rf{},p.c6=class extends N{},p.c7=function(c,i){return c[0]===i[0]&&c[1]===i[1]&&c[2]===i[2]&&c[3]===i[3]&&c[4]===i[4]&&c[5]===i[5]&&c[6]===i[6]&&c[7]===i[7]&&c[8]===i[8]&&c[9]===i[9]&&c[10]===i[10]&&c[11]===i[11]&&c[12]===i[12]&&c[13]===i[13]&&c[14]===i[14]&&c[15]===i[15]},p.c8=function(c,i){var l=c[0],h=c[1],g=c[2],v=c[3],b=c[4],A=c[5],C=c[6],D=c[7],R=c[8],O=c[9],U=c[10],Z=c[11],W=c[12],J=c[13],ie=c[14],fe=c[15],Me=i[0],ye=i[1],q=i[2],ne=i[3],ve=i[4],Ue=i[5],ut=i[6],Ye=i[7],et=i[8],vt=i[9],dt=i[10],At=i[11],at=i[12],Yt=i[13],sn=i[14],rn=i[15];return Math.abs(l-Me)<=ce*Math.max(1,Math.abs(l),Math.abs(Me))&&Math.abs(h-ye)<=ce*Math.max(1,Math.abs(h),Math.abs(ye))&&Math.abs(g-q)<=ce*Math.max(1,Math.abs(g),Math.abs(q))&&Math.abs(v-ne)<=ce*Math.max(1,Math.abs(v),Math.abs(ne))&&Math.abs(b-ve)<=ce*Math.max(1,Math.abs(b),Math.abs(ve))&&Math.abs(A-Ue)<=ce*Math.max(1,Math.abs(A),Math.abs(Ue))&&Math.abs(C-ut)<=ce*Math.max(1,Math.abs(C),Math.abs(ut))&&Math.abs(D-Ye)<=ce*Math.max(1,Math.abs(D),Math.abs(Ye))&&Math.abs(R-et)<=ce*Math.max(1,Math.abs(R),Math.abs(et))&&Math.abs(O-vt)<=ce*Math.max(1,Math.abs(O),Math.abs(vt))&&Math.abs(U-dt)<=ce*Math.max(1,Math.abs(U),Math.abs(dt))&&Math.abs(Z-At)<=ce*Math.max(1,Math.abs(Z),Math.abs(At))&&Math.abs(W-at)<=ce*Math.max(1,Math.abs(W),Math.abs(at))&&Math.abs(J-Yt)<=ce*Math.max(1,Math.abs(J),Math.abs(Yt))&&Math.abs(ie-sn)<=ce*Math.max(1,Math.abs(ie),Math.abs(sn))&&Math.abs(fe-rn)<=ce*Math.max(1,Math.abs(fe),Math.abs(rn))},p.c9=function(c,i){return c[0]=i[0],c[1]=i[1],c[2]=i[2],c[3]=i[3],c[4]=i[4],c[5]=i[5],c[6]=i[6],c[7]=i[7],c[8]=i[8],c[9]=i[9],c[10]=i[10],c[11]=i[11],c[12]=i[12],c[13]=i[13],c[14]=i[14],c[15]=i[15],c},p.cA=function(c){delete X.REGISTERED_PROTOCOLS[c]},p.cB=function(c,i){const l={};for(let g=0;g<c.length;g++){const v=i&&i[c[g].id]||Au(c[g]);i&&(i[c[g].id]=v);let b=l[v];b||(b=l[v]=[]),b.push(c[g])}const h=[];for(const g in l)h.push(l[g]);return h},p.cC=Gt,p.cD=e2,p.cE=n2,p.cF=Dw,p.cG=function(c){c.bucket.createArrays(),c.bucket.tilePixelRatio=ct/(512*c.bucket.overscaling),c.bucket.compareText={},c.bucket.iconsNeedLinear=!1;const i=c.bucket.layers[0],l=i.layout,h=i._unevaluatedLayout._values,g={layoutIconSize:h["icon-size"].possiblyEvaluate(new Pi(c.bucket.zoom+1),c.canonical),layoutTextSize:h["text-size"].possiblyEvaluate(new Pi(c.bucket.zoom+1),c.canonical),textMaxSize:h["text-size"].possiblyEvaluate(new Pi(18))};if(c.bucket.textSizeData.kind==="composite"){const{minZoom:D,maxZoom:R}=c.bucket.textSizeData;g.compositeTextSizes=[h["text-size"].possiblyEvaluate(new Pi(D),c.canonical),h["text-size"].possiblyEvaluate(new Pi(R),c.canonical)]}if(c.bucket.iconSizeData.kind==="composite"){const{minZoom:D,maxZoom:R}=c.bucket.iconSizeData;g.compositeIconSizes=[h["icon-size"].possiblyEvaluate(new Pi(D),c.canonical),h["icon-size"].possiblyEvaluate(new Pi(R),c.canonical)]}const v=l.get("text-line-height")*sr,b=l.get("text-rotation-alignment")!=="viewport"&&l.get("symbol-placement")!=="point",A=l.get("text-keep-upright"),C=l.get("text-size");for(const D of c.bucket.features){const R=l.get("text-font").evaluate(D,{},c.canonical).join(","),O=C.evaluate(D,{},c.canonical),U=g.layoutTextSize.evaluate(D,{},c.canonical),Z=g.layoutIconSize.evaluate(D,{},c.canonical),W={horizontal:{},vertical:void 0},J=D.text;let ie,fe=[0,0];if(J){const q=J.toString(),ne=l.get("text-letter-spacing").evaluate(D,{},c.canonical)*sr,ve=hm(q)?ne:0,Ue=l.get("text-anchor").evaluate(D,{},c.canonical),ut=d2(i,D,c.canonical);if(!ut){const dt=l.get("text-radial-offset").evaluate(D,{},c.canonical);fe=dt?f2(Ue,[dt*sr,T0]):l.get("text-offset").evaluate(D,{},c.canonical).map(At=>At*sr)}let Ye=b?"center":l.get("text-justify").evaluate(D,{},c.canonical);const et=l.get("symbol-placement")==="point"?l.get("text-max-width").evaluate(D,{},c.canonical)*sr:1/0,vt=()=>{c.bucket.allowVerticalPlacement&&If(q)&&(W.vertical=Mm(J,c.glyphMap,c.glyphPositions,c.imagePositions,R,et,v,Ue,"left",ve,fe,p.an.vertical,!0,U,O))};if(!b&&ut){const dt=new Set;if(Ye==="auto")for(let at=0;at<ut.values.length;at+=2)dt.add(S0(ut.values[at]));else dt.add(Ye);let At=!1;for(const at of dt)if(!W.horizontal[at])if(At)W.horizontal[at]=W.horizontal[0];else{const Yt=Mm(J,c.glyphMap,c.glyphPositions,c.imagePositions,R,et,v,"center",at,ve,fe,p.an.horizontal,!1,U,O);Yt&&(W.horizontal[at]=Yt,At=Yt.positionedLines.length===1)}vt()}else{Ye==="auto"&&(Ye=S0(Ue));const dt=Mm(J,c.glyphMap,c.glyphPositions,c.imagePositions,R,et,v,Ue,Ye,ve,fe,p.an.horizontal,!1,U,O);dt&&(W.horizontal[Ye]=dt),vt(),If(q)&&b&&A&&(W.vertical=Mm(J,c.glyphMap,c.glyphPositions,c.imagePositions,R,et,v,Ue,Ye,ve,fe,p.an.vertical,!1,U,O))}}let Me=!1;if(D.icon&&D.icon.name){const q=c.imageMap[D.icon.name];q&&(ie=Bk(c.imagePositions[D.icon.name],l.get("icon-offset").evaluate(D,{},c.canonical),l.get("icon-anchor").evaluate(D,{},c.canonical)),Me=!!q.sdf,c.bucket.sdfIcons===void 0?c.bucket.sdfIcons=Me:c.bucket.sdfIcons!==Me&&ht("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(q.pixelRatio!==c.bucket.pixelRatio||l.get("icon-rotate").constantOr(1)!==0)&&(c.bucket.iconsNeedLinear=!0))}const ye=m2(W.horizontal)||W.vertical;c.bucket.iconsInText=!!ye&&ye.iconsInText,(ye||ie)&&Jk(c.bucket,D,W,ie,c.imageMap,g,U,Z,fe,Me,c.canonical,c.subdivisionGranularity)}c.showCollisionBoxes&&c.bucket.generateCollisionDebugBuffers()},p.cH=c0,p.cI=i0,p.cJ=l0,p.cK=Yf,p.cL=f0,p.cM=class{constructor(c){this._marks={start:[c.url,"start"].join("#"),end:[c.url,"end"].join("#"),measure:c.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let c=performance.getEntriesByName(this._marks.measure);return c.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),c=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),c}},p.cN=function(c,i,l,h,g){return a(this,void 0,void 0,function*(){if(ee())try{return yield yt(c,i,l,h,g)}catch{}return function(v,b,A,C,D){const R=v.width,O=v.height;qt&&Nt||(qt=new OffscreenCanvas(R,O),Nt=qt.getContext("2d",{willReadFrequently:!0})),qt.width=R,qt.height=O,Nt.drawImage(v,0,0,R,O);const U=Nt.getImageData(b,A,C,D);return Nt.clearRect(0,0,R,O),U.data}(c,i,l,h,g)})},p.cO=tw,p.cP=w,p.cQ=k,p.cR=yw,p.cS=Pw,p.cT=vu,p.cU=Io,p.ca=c=>c.type==="symbol",p.cb=c=>c.type==="circle",p.cc=c=>c.type==="heatmap",p.cd=c=>c.type==="line",p.ce=c=>c.type==="fill",p.cf=c=>c.type==="fill-extrusion",p.cg=c=>c.type==="hillshade",p.ch=c=>c.type==="color-relief",p.ci=c=>c.type==="raster",p.cj=c=>c.type==="background",p.ck=c=>c.type==="custom",p.cl=pt,p.cm=function(c,i,l){const h=Tt(i.x-l.x,i.y-l.y),g=Tt(c.x-l.x,c.y-l.y);var v,b;return On(Math.atan2(h[0]*g[1]-h[1]*g[0],(v=h)[0]*(b=g)[0]+v[1]*b[1]))},p.cn=Ft,p.co=function(c,i){return $n[i]&&(c instanceof MouseEvent||c instanceof WheelEvent)},p.cp=function(c,i){return Mi[i]&&"touches"in c},p.cq=function(c){return Mi[c]||$n[c]},p.cr=function(c,i,l){var h=i[0],g=i[1];return c[0]=l[0]*h+l[4]*g+l[12],c[1]=l[1]*h+l[5]*g+l[13],c},p.cs=function(c,i){const{x:l,y:h}=ed.fromLngLat(i);return!(c<0||c>25||h<0||h>=1||l<0||l>=1)},p.ct=function(c,i){return c[0]=i[0],c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=i[1],c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=i[2],c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c},p.cu=class extends Po{},p.cv=t4,p.cx=function(c){return c.message===wi},p.cy=pe,p.cz=function(c,i){X.REGISTERED_PROTOCOLS[c]=i},p.d=Fe,p.e=Ke,p.f=c=>a(void 0,void 0,void 0,function*(){if(c.byteLength===0)return createImageBitmap(new ImageData(1,1));const i=new Blob([new Uint8Array(c)],{type:"image/png"});try{return createImageBitmap(i)}catch(l){throw new Error(`Could not load image because of ${l.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),p.g=K,p.h=c=>new Promise((i,l)=>{const h=new Image;h.onload=()=>{i(h),URL.revokeObjectURL(h.src),h.onload=null,window.requestAnimationFrame(()=>{h.src=In})},h.onerror=()=>l(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const g=new Blob([new Uint8Array(c)],{type:"image/png"});h.src=c.byteLength?URL.createObjectURL(g):In}),p.i=Mt,p.j=(c,i)=>Ee(Ke(c,{type:"json"}),i),p.k=Le,p.l=Ge,p.m=Ee,p.n=(c,i)=>Ee(Ke(c,{type:"arrayBuffer"}),i),p.o=function(c){return new f0(c).readFields(Sk,[])},p.p=kw,p.q=Vf,p.r=Br,p.s=fn,p.t=Df,p.u=Ln,p.v=Ae,p.w=ht,p.x=Ny,p.y=ec,p.z=rl}),u("worker",["./shared"],function(p){class a{constructor(X){this.keyCache={},X&&this.replace(X)}replace(X){this._layerConfigs={},this._layers={},this.update(X,[])}update(X,K){for(const pe of X){this._layerConfigs[pe.id]=pe;const we=this._layers[pe.id]=p.bI(pe);we._featureFilter=p.a9(we.filter),this.keyCache[pe.id]&&delete this.keyCache[pe.id]}for(const pe of K)delete this.keyCache[pe],delete this._layerConfigs[pe],delete this._layers[pe];this.familiesBySource={};const te=p.cB(Object.values(this._layerConfigs),this.keyCache);for(const pe of te){const we=pe.map(Le=>this._layers[Le.id]),Ee=we[0];if(Ee.visibility==="none")continue;const Fe=Ee.source||"";let Pe=this.familiesBySource[Fe];Pe||(Pe=this.familiesBySource[Fe]={});const He=Ee.sourceLayer||"_geojsonTileLayer";let Ge=Pe[He];Ge||(Ge=Pe[He]=[]),Ge.push(we)}}}class w{constructor(X){const K={},te=[];for(const Fe in X){const Pe=X[Fe],He=K[Fe]={};for(const Ge in Pe){const Le=Pe[+Ge];if(!Le||Le.bitmap.width===0||Le.bitmap.height===0)continue;const Je={x:0,y:0,w:Le.bitmap.width+2,h:Le.bitmap.height+2};te.push(Je),He[Ge]={rect:Je,metrics:Le.metrics}}}const{w:pe,h:we}=p.p(te),Ee=new p.q({width:pe||1,height:we||1});for(const Fe in X){const Pe=X[Fe];for(const He in Pe){const Ge=Pe[+He];if(!Ge||Ge.bitmap.width===0||Ge.bitmap.height===0)continue;const Le=K[Fe][He].rect;p.q.copy(Ge.bitmap,Ee,{x:0,y:0},{x:Le.x+1,y:Le.y+1},Ge.bitmap)}}this.image=Ee,this.positions=K}}p.cC("GlyphAtlas",w);class T{constructor(X){this.tileID=new p.Z(X.tileID.overscaledZ,X.tileID.wrap,X.tileID.canonical.z,X.tileID.canonical.x,X.tileID.canonical.y),this.uid=X.uid,this.zoom=X.zoom,this.pixelRatio=X.pixelRatio,this.tileSize=X.tileSize,this.source=X.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=X.showCollisionBoxes,this.collectResourceTiming=!!X.collectResourceTiming,this.returnDependencies=!!X.returnDependencies,this.promoteId=X.promoteId,this.inFlightDependencies=[],this.globalState=X.globalState}parse(X,K,te,pe,we){return p._(this,void 0,void 0,function*(){this.status="parsing",this.data=X,this.collisionBoxArray=new p.a7;const Ee=new p.cD(Object.keys(X.layers).sort()),Fe=new p.cE(this.tileID,this.promoteId);Fe.bucketLayerIDs=[];const Pe={},He={featureIndex:Fe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:te,subdivisionGranularity:we},Ge=K.familiesBySource[this.source];for(const ln in Ge){const En=X.layers[ln];if(!En)continue;En.version===1&&p.w(`Vector tile source "${this.source}" layer "${ln}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const li=Ee.encode(ln),xt=[];for(let mi=0;mi<En.length;mi++){const ci=En.feature(mi),ha=Fe.getId(ci,ln);xt.push({feature:ci,id:ha,index:mi,sourceLayerIndex:li})}for(const mi of Ge[ln]){const ci=mi[0];ci.source!==this.source&&p.w(`layer.source = ${ci.source} does not equal this.source = ${this.source}`),ci.minzoom&&this.zoom<Math.floor(ci.minzoom)||ci.maxzoom&&this.zoom>=ci.maxzoom||ci.visibility!=="none"&&(S(mi,this.zoom,te),(Pe[ci.id]=ci.createBucket({index:Fe.bucketLayerIDs.length,layers:mi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:li,sourceID:this.source,globalState:this.globalState})).populate(xt,He,this.tileID.canonical),Fe.bucketLayerIDs.push(mi.map(ha=>ha.id)))}}const Le=p.bM(He.glyphDependencies,ln=>Object.keys(ln).map(Number));this.inFlightDependencies.forEach(ln=>ln==null?void 0:ln.abort()),this.inFlightDependencies=[];let Je=Promise.resolve({});if(Object.keys(Le).length){const ln=new AbortController;this.inFlightDependencies.push(ln),Je=pe.sendAsync({type:"GG",data:{stacks:Le,source:this.source,tileID:this.tileID,type:"glyphs"}},ln)}const Ae=Object.keys(He.iconDependencies);let Lt=Promise.resolve({});if(Ae.length){const ln=new AbortController;this.inFlightDependencies.push(ln),Lt=pe.sendAsync({type:"GI",data:{icons:Ae,source:this.source,tileID:this.tileID,type:"icons"}},ln)}const nn=Object.keys(He.patternDependencies);let jt=Promise.resolve({});if(nn.length){const ln=new AbortController;this.inFlightDependencies.push(ln),jt=pe.sendAsync({type:"GI",data:{icons:nn,source:this.source,tileID:this.tileID,type:"patterns"}},ln)}const[Kt,en,ti]=yield Promise.all([Je,Lt,jt]),Pn=new w(Kt),Nn=new p.cF(en,ti);for(const ln in Pe){const En=Pe[ln];En instanceof p.a8?(S(En.layers,this.zoom,te),p.cG({bucket:En,glyphMap:Kt,glyphPositions:Pn.positions,imageMap:en,imagePositions:Nn.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:He.subdivisionGranularity})):En.hasPattern&&(En instanceof p.cH||En instanceof p.cI||En instanceof p.cJ)&&(S(En.layers,this.zoom,te),En.addFeatures(He,this.tileID.canonical,Nn.patternPositions))}return this.status="done",{buckets:Object.values(Pe).filter(ln=>!ln.isEmpty()),featureIndex:Fe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Pn.image,imageAtlas:Nn,glyphMap:this.returnDependencies?Kt:null,iconMap:this.returnDependencies?en:null,glyphPositions:this.returnDependencies?Pn.positions:null}})}}function S(Ce,X,K){const te=new p.F(X);for(const pe of Ce)pe.recalculate(te,K)}class k{constructor(X,K,te){this.actor=X,this.layerIndex=K,this.availableImages=te,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(X,K){return p._(this,void 0,void 0,function*(){const te=yield p.n(X.request,K);try{return{vectorTile:new p.cK.VectorTile(new p.cL(te.data)),rawData:te.data,cacheControl:te.cacheControl,expires:te.expires}}catch(pe){const we=new Uint8Array(te.data);let Ee=`Unable to parse the tile at ${X.request.url}, `;throw Ee+=we[0]===31&&we[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${pe.message}`,new Error(Ee)}})}loadTile(X){return p._(this,void 0,void 0,function*(){const K=X.uid,te=!!(X&&X.request&&X.request.collectResourceTiming)&&new p.cM(X.request),pe=new T(X);this.loading[K]=pe;const we=new AbortController;pe.abort=we;try{const Ee=yield this.loadVectorTile(X,we);if(delete this.loading[K],!Ee)return null;const Fe=Ee.rawData,Pe={};Ee.expires&&(Pe.expires=Ee.expires),Ee.cacheControl&&(Pe.cacheControl=Ee.cacheControl);const He={};if(te){const Le=te.finish();Le&&(He.resourceTiming=JSON.parse(JSON.stringify(Le)))}pe.vectorTile=Ee.vectorTile;const Ge=pe.parse(Ee.vectorTile,this.layerIndex,this.availableImages,this.actor,X.subdivisionGranularity);this.loaded[K]=pe,this.fetching[K]={rawTileData:Fe,cacheControl:Pe,resourceTiming:He};try{const Le=yield Ge;return p.e({rawTileData:Fe.slice(0)},Le,Pe,He)}finally{delete this.fetching[K]}}catch(Ee){throw delete this.loading[K],pe.status="done",this.loaded[K]=pe,Ee}})}reloadTile(X){return p._(this,void 0,void 0,function*(){const K=X.uid;if(!this.loaded||!this.loaded[K])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const te=this.loaded[K];if(te.showCollisionBoxes=X.showCollisionBoxes,te.globalState=X.globalState,te.status==="parsing"){const pe=yield te.parse(te.vectorTile,this.layerIndex,this.availableImages,this.actor,X.subdivisionGranularity);let we;if(this.fetching[K]){const{rawTileData:Ee,cacheControl:Fe,resourceTiming:Pe}=this.fetching[K];delete this.fetching[K],we=p.e({rawTileData:Ee.slice(0)},pe,Fe,Pe)}else we=pe;return we}if(te.status==="done"&&te.vectorTile)return te.parse(te.vectorTile,this.layerIndex,this.availableImages,this.actor,X.subdivisionGranularity)})}abortTile(X){return p._(this,void 0,void 0,function*(){const K=this.loading,te=X.uid;K&&K[te]&&K[te].abort&&(K[te].abort.abort(),delete K[te])})}removeTile(X){return p._(this,void 0,void 0,function*(){this.loaded&&this.loaded[X.uid]&&delete this.loaded[X.uid]})}}class I{constructor(){this.loaded={}}loadTile(X){return p._(this,void 0,void 0,function*(){const{uid:K,encoding:te,rawImageData:pe,redFactor:we,greenFactor:Ee,blueFactor:Fe,baseShift:Pe}=X,He=pe.width+2,Ge=pe.height+2,Le=p.b(pe)?new p.R({width:He,height:Ge},yield p.cN(pe,-1,-1,He,Ge)):pe,Je=new p.cO(K,Le,te,we,Ee,Fe,Pe);return this.loaded=this.loaded||{},this.loaded[K]=Je,Je})}removeTile(X){const K=this.loaded,te=X.uid;K&&K[te]&&delete K[te]}}var P,F,G=function(){if(F)return P;function Ce(K,te){if(K.length!==0){X(K[0],te);for(var pe=1;pe<K.length;pe++)X(K[pe],!te)}}function X(K,te){for(var pe=0,we=0,Ee=0,Fe=K.length,Pe=Fe-1;Ee<Fe;Pe=Ee++){var He=(K[Ee][0]-K[Pe][0])*(K[Pe][1]+K[Ee][1]),Ge=pe+He;we+=Math.abs(pe)>=Math.abs(He)?pe-Ge+He:He-Ge+pe,pe=Ge}pe+we>=0!=!!te&&K.reverse()}return F=1,P=function K(te,pe){var we,Ee=te&&te.type;if(Ee==="FeatureCollection")for(we=0;we<te.features.length;we++)K(te.features[we],pe);else if(Ee==="GeometryCollection")for(we=0;we<te.geometries.length;we++)K(te.geometries[we],pe);else if(Ee==="Feature")K(te.geometry,pe);else if(Ee==="Polygon")Ce(te.coordinates,pe);else if(Ee==="MultiPolygon")for(we=0;we<te.coordinates.length;we++)Ce(te.coordinates[we],pe);return te}}(),H=p.cP(G);const Y=p.cK.VectorTileFeature.prototype.toGeoJSON;class ${constructor(X){this._feature=X,this.extent=p.$,this.type=X.type,this.properties=X.tags,"id"in X&&!isNaN(X.id)&&(this.id=parseInt(X.id,10))}loadGeometry(){if(this._feature.type===1){const X=[];for(const K of this._feature.geometry)X.push([new p.P(K[0],K[1])]);return X}{const X=[];for(const K of this._feature.geometry){const te=[];for(const pe of K)te.push(new p.P(pe[0],pe[1]));X.push(te)}return X}}toGeoJSON(X,K,te){return Y.call(this,X,K,te)}}class ae{constructor(X){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=p.$,this.length=X.length,this._features=X}feature(X){return new $(this._features[X])}}var ee,ce,re,he={exports:{}},be=function(){if(re)return he.exports;re=1;var Ce=p.cS(),X=function(){if(ce)return ee;ce=1;var Ge=p.cQ(),Le=p.cR().VectorTileFeature;function Je(Lt,nn){this.options=nn||{},this.features=Lt,this.length=Lt.length}function Ae(Lt,nn){this.id=typeof Lt.id=="number"?Lt.id:void 0,this.type=Lt.type,this.rawGeometry=Lt.type===1?[Lt.geometry]:Lt.geometry,this.properties=Lt.tags,this.extent=nn||4096}return ee=Je,Je.prototype.feature=function(Lt){return new Ae(this.features[Lt],this.options.extent)},Ae.prototype.loadGeometry=function(){var Lt=this.rawGeometry;this.geometry=[];for(var nn=0;nn<Lt.length;nn++){for(var jt=Lt[nn],Kt=[],en=0;en<jt.length;en++)Kt.push(new Ge(jt[en][0],jt[en][1]));this.geometry.push(Kt)}return this.geometry},Ae.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Lt=this.geometry,nn=1/0,jt=-1/0,Kt=1/0,en=-1/0,ti=0;ti<Lt.length;ti++)for(var Pn=Lt[ti],Nn=0;Nn<Pn.length;Nn++){var ln=Pn[Nn];nn=Math.min(nn,ln.x),jt=Math.max(jt,ln.x),Kt=Math.min(Kt,ln.y),en=Math.max(en,ln.y)}return[nn,Kt,jt,en]},Ae.prototype.toGeoJSON=Le.prototype.toGeoJSON,ee}();function K(Ge){var Le=new Ce;return function(Je,Ae){for(var Lt in Je.layers)Ae.writeMessage(3,te,Je.layers[Lt])}(Ge,Le),Le.finish()}function te(Ge,Le){var Je;Le.writeVarintField(15,Ge.version||1),Le.writeStringField(1,Ge.name||""),Le.writeVarintField(5,Ge.extent||4096);var Ae={keys:[],values:[],keycache:{},valuecache:{}};for(Je=0;Je<Ge.length;Je++)Ae.feature=Ge.feature(Je),Le.writeMessage(2,pe,Ae);var Lt=Ae.keys;for(Je=0;Je<Lt.length;Je++)Le.writeStringField(3,Lt[Je]);var nn=Ae.values;for(Je=0;Je<nn.length;Je++)Le.writeMessage(4,He,nn[Je])}function pe(Ge,Le){var Je=Ge.feature;Je.id!==void 0&&Le.writeVarintField(1,Je.id),Le.writeMessage(2,we,Ge),Le.writeVarintField(3,Je.type),Le.writeMessage(4,Pe,Je)}function we(Ge,Le){var Je=Ge.feature,Ae=Ge.keys,Lt=Ge.values,nn=Ge.keycache,jt=Ge.valuecache;for(var Kt in Je.properties){var en=Je.properties[Kt],ti=nn[Kt];if(en!==null){ti===void 0&&(Ae.push(Kt),nn[Kt]=ti=Ae.length-1),Le.writeVarint(ti);var Pn=typeof en;Pn!=="string"&&Pn!=="boolean"&&Pn!=="number"&&(en=JSON.stringify(en));var Nn=Pn+":"+en,ln=jt[Nn];ln===void 0&&(Lt.push(en),jt[Nn]=ln=Lt.length-1),Le.writeVarint(ln)}}}function Ee(Ge,Le){return(Le<<3)+(7&Ge)}function Fe(Ge){return Ge<<1^Ge>>31}function Pe(Ge,Le){for(var Je=Ge.loadGeometry(),Ae=Ge.type,Lt=0,nn=0,jt=Je.length,Kt=0;Kt<jt;Kt++){var en=Je[Kt],ti=1;Ae===1&&(ti=en.length),Le.writeVarint(Ee(1,ti));for(var Pn=Ae===3?en.length-1:en.length,Nn=0;Nn<Pn;Nn++){Nn===1&&Ae!==1&&Le.writeVarint(Ee(2,Pn-1));var ln=en[Nn].x-Lt,En=en[Nn].y-nn;Le.writeVarint(Fe(ln)),Le.writeVarint(Fe(En)),Lt+=ln,nn+=En}Ae===3&&Le.writeVarint(Ee(7,1))}}function He(Ge,Le){var Je=typeof Ge;Je==="string"?Le.writeStringField(1,Ge):Je==="boolean"?Le.writeBooleanField(7,Ge):Je==="number"&&(Ge%1!=0?Le.writeDoubleField(3,Ge):Ge<0?Le.writeSVarintField(6,Ge):Le.writeVarintField(5,Ge))}return he.exports=K,he.exports.fromVectorTileJs=K,he.exports.fromGeojsonVt=function(Ge,Le){Le=Le||{};var Je={};for(var Ae in Ge)Je[Ae]=new X(Ge[Ae].features,Le),Je[Ae].name=Ae,Je[Ae].version=Le.version,Je[Ae].extent=Le.extent;return K({layers:Je})},he.exports.GeoJSONWrapper=X,he.exports}(),ke=p.cP(be);const Ie={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ce=>Ce},ue=Math.fround||(Ve=new Float32Array(1),Ce=>(Ve[0]=+Ce,Ve[0]));var Ve;class Ze{constructor(X){this.options=Object.assign(Object.create(Ie),X),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(X){const{log:K,minZoom:te,maxZoom:pe}=this.options;K&&console.time("total time");const we=`prepare ${X.length} points`;K&&console.time(we),this.points=X;const Ee=[];for(let Pe=0;Pe<X.length;Pe++){const He=X[Pe];if(!He.geometry)continue;const[Ge,Le]=He.geometry.coordinates,Je=ue(ot(Ge)),Ae=ue(Pt(Le));Ee.push(Je,Ae,1/0,Pe,-1,1),this.options.reduce&&Ee.push(0)}let Fe=this.trees[pe+1]=this._createTree(Ee);K&&console.timeEnd(we);for(let Pe=pe;Pe>=te;Pe--){const He=+Date.now();Fe=this.trees[Pe]=this._createTree(this._cluster(Fe,Pe)),K&&console.log("z%d: %d clusters in %dms",Pe,Fe.numItems,+Date.now()-He)}return K&&console.timeEnd("total time"),this}getClusters(X,K){let te=((X[0]+180)%360+360)%360-180;const pe=Math.max(-90,Math.min(90,X[1]));let we=X[2]===180?180:((X[2]+180)%360+360)%360-180;const Ee=Math.max(-90,Math.min(90,X[3]));if(X[2]-X[0]>=360)te=-180,we=180;else if(te>we){const Le=this.getClusters([te,pe,180,Ee],K),Je=this.getClusters([-180,pe,we,Ee],K);return Le.concat(Je)}const Fe=this.trees[this._limitZoom(K)],Pe=Fe.range(ot(te),Pt(Ee),ot(we),Pt(pe)),He=Fe.data,Ge=[];for(const Le of Pe){const Je=this.stride*Le;Ge.push(He[Je+5]>1?Xe(He,Je,this.clusterProps):this.points[He[Je+3]])}return Ge}getChildren(X){const K=this._getOriginId(X),te=this._getOriginZoom(X),pe="No cluster with the specified id.",we=this.trees[te];if(!we)throw new Error(pe);const Ee=we.data;if(K*this.stride>=Ee.length)throw new Error(pe);const Fe=this.options.radius/(this.options.extent*Math.pow(2,te-1)),Pe=we.within(Ee[K*this.stride],Ee[K*this.stride+1],Fe),He=[];for(const Ge of Pe){const Le=Ge*this.stride;Ee[Le+4]===X&&He.push(Ee[Le+5]>1?Xe(Ee,Le,this.clusterProps):this.points[Ee[Le+3]])}if(He.length===0)throw new Error(pe);return He}getLeaves(X,K,te){const pe=[];return this._appendLeaves(pe,X,K=K||10,te=te||0,0),pe}getTile(X,K,te){const pe=this.trees[this._limitZoom(X)],we=Math.pow(2,X),{extent:Ee,radius:Fe}=this.options,Pe=Fe/Ee,He=(te-Pe)/we,Ge=(te+1+Pe)/we,Le={features:[]};return this._addTileFeatures(pe.range((K-Pe)/we,He,(K+1+Pe)/we,Ge),pe.data,K,te,we,Le),K===0&&this._addTileFeatures(pe.range(1-Pe/we,He,1,Ge),pe.data,we,te,we,Le),K===we-1&&this._addTileFeatures(pe.range(0,He,Pe/we,Ge),pe.data,-1,te,we,Le),Le.features.length?Le:null}getClusterExpansionZoom(X){let K=this._getOriginZoom(X)-1;for(;K<=this.options.maxZoom;){const te=this.getChildren(X);if(K++,te.length!==1)break;X=te[0].properties.cluster_id}return K}_appendLeaves(X,K,te,pe,we){const Ee=this.getChildren(K);for(const Fe of Ee){const Pe=Fe.properties;if(Pe&&Pe.cluster?we+Pe.point_count<=pe?we+=Pe.point_count:we=this._appendLeaves(X,Pe.cluster_id,te,pe,we):we<pe?we++:X.push(Fe),X.length===te)break}return we}_createTree(X){const K=new p.aH(X.length/this.stride|0,this.options.nodeSize,Float32Array);for(let te=0;te<X.length;te+=this.stride)K.add(X[te],X[te+1]);return K.finish(),K.data=X,K}_addTileFeatures(X,K,te,pe,we,Ee){for(const Fe of X){const Pe=Fe*this.stride,He=K[Pe+5]>1;let Ge,Le,Je;if(He)Ge=Re(K,Pe,this.clusterProps),Le=K[Pe],Je=K[Pe+1];else{const nn=this.points[K[Pe+3]];Ge=nn.properties;const[jt,Kt]=nn.geometry.coordinates;Le=ot(jt),Je=Pt(Kt)}const Ae={type:1,geometry:[[Math.round(this.options.extent*(Le*we-te)),Math.round(this.options.extent*(Je*we-pe))]],tags:Ge};let Lt;Lt=He||this.options.generateId?K[Pe+3]:this.points[K[Pe+3]].id,Lt!==void 0&&(Ae.id=Lt),Ee.features.push(Ae)}}_limitZoom(X){return Math.max(this.options.minZoom,Math.min(Math.floor(+X),this.options.maxZoom+1))}_cluster(X,K){const{radius:te,extent:pe,reduce:we,minPoints:Ee}=this.options,Fe=te/(pe*Math.pow(2,K)),Pe=X.data,He=[],Ge=this.stride;for(let Le=0;Le<Pe.length;Le+=Ge){if(Pe[Le+2]<=K)continue;Pe[Le+2]=K;const Je=Pe[Le],Ae=Pe[Le+1],Lt=X.within(Pe[Le],Pe[Le+1],Fe),nn=Pe[Le+5];let jt=nn;for(const Kt of Lt){const en=Kt*Ge;Pe[en+2]>K&&(jt+=Pe[en+5])}if(jt>nn&&jt>=Ee){let Kt,en=Je*nn,ti=Ae*nn,Pn=-1;const Nn=(Le/Ge<<5)+(K+1)+this.points.length;for(const ln of Lt){const En=ln*Ge;if(Pe[En+2]<=K)continue;Pe[En+2]=K;const li=Pe[En+5];en+=Pe[En]*li,ti+=Pe[En+1]*li,Pe[En+4]=Nn,we&&(Kt||(Kt=this._map(Pe,Le,!0),Pn=this.clusterProps.length,this.clusterProps.push(Kt)),we(Kt,this._map(Pe,En)))}Pe[Le+4]=Nn,He.push(en/jt,ti/jt,1/0,Nn,-1,jt),we&&He.push(Pn)}else{for(let Kt=0;Kt<Ge;Kt++)He.push(Pe[Le+Kt]);if(jt>1)for(const Kt of Lt){const en=Kt*Ge;if(!(Pe[en+2]<=K)){Pe[en+2]=K;for(let ti=0;ti<Ge;ti++)He.push(Pe[en+ti])}}}}return He}_getOriginId(X){return X-this.points.length>>5}_getOriginZoom(X){return(X-this.points.length)%32}_map(X,K,te){if(X[K+5]>1){const Ee=this.clusterProps[X[K+6]];return te?Object.assign({},Ee):Ee}const pe=this.points[X[K+3]].properties,we=this.options.map(pe);return te&&we===pe?Object.assign({},we):we}}function Xe(Ce,X,K){return{type:"Feature",id:Ce[X+3],properties:Re(Ce,X,K),geometry:{type:"Point",coordinates:[(te=Ce[X],360*(te-.5)),bt(Ce[X+1])]}};var te}function Re(Ce,X,K){const te=Ce[X+5],pe=te>=1e4?`${Math.round(te/1e3)}k`:te>=1e3?Math.round(te/100)/10+"k":te,we=Ce[X+6],Ee=we===-1?{}:Object.assign({},K[we]);return Object.assign(Ee,{cluster:!0,cluster_id:Ce[X+3],point_count:te,point_count_abbreviated:pe})}function ot(Ce){return Ce/360+.5}function Pt(Ce){const X=Math.sin(Ce*Math.PI/180),K=.5-.25*Math.log((1+X)/(1-X))/Math.PI;return K<0?0:K>1?1:K}function bt(Ce){const X=(180-360*Ce)*Math.PI/180;return 360*Math.atan(Math.exp(X))/Math.PI-90}function _t(Ce,X,K,te){let pe=te;const we=X+(K-X>>1);let Ee,Fe=K-X;const Pe=Ce[X],He=Ce[X+1],Ge=Ce[K],Le=Ce[K+1];for(let Je=X+3;Je<K;Je+=3){const Ae=tt(Ce[Je],Ce[Je+1],Pe,He,Ge,Le);if(Ae>pe)Ee=Je,pe=Ae;else if(Ae===pe){const Lt=Math.abs(Je-we);Lt<Fe&&(Ee=Je,Fe=Lt)}}pe>te&&(Ee-X>3&&_t(Ce,X,Ee,te),Ce[Ee+2]=pe,K-Ee>3&&_t(Ce,Ee,K,te))}function tt(Ce,X,K,te,pe,we){let Ee=pe-K,Fe=we-te;if(Ee!==0||Fe!==0){const Pe=((Ce-K)*Ee+(X-te)*Fe)/(Ee*Ee+Fe*Fe);Pe>1?(K=pe,te=we):Pe>0&&(K+=Ee*Pe,te+=Fe*Pe)}return Ee=Ce-K,Fe=X-te,Ee*Ee+Fe*Fe}function Tt(Ce,X,K,te){const pe={id:Ce??null,type:X,geometry:K,tags:te,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(X==="Point"||X==="MultiPoint"||X==="LineString")ct(pe,K);else if(X==="Polygon")ct(pe,K[0]);else if(X==="MultiLineString")for(const we of K)ct(pe,we);else if(X==="MultiPolygon")for(const we of K)ct(pe,we[0]);return pe}function ct(Ce,X){for(let K=0;K<X.length;K+=3)Ce.minX=Math.min(Ce.minX,X[K]),Ce.minY=Math.min(Ce.minY,X[K+1]),Ce.maxX=Math.max(Ce.maxX,X[K]),Ce.maxY=Math.max(Ce.maxY,X[K+1])}function mt(Ce,X,K,te){if(!X.geometry)return;const pe=X.geometry.coordinates;if(pe&&pe.length===0)return;const we=X.geometry.type,Ee=Math.pow(K.tolerance/((1<<K.maxZoom)*K.extent),2);let Fe=[],Pe=X.id;if(K.promoteId?Pe=X.properties[K.promoteId]:K.generateId&&(Pe=te||0),we==="Point")Xt(pe,Fe);else if(we==="MultiPoint")for(const He of pe)Xt(He,Fe);else if(we==="LineString")Ut(pe,Fe,Ee,!1);else if(we==="MultiLineString"){if(K.lineMetrics){for(const He of pe)Fe=[],Ut(He,Fe,Ee,!1),Ce.push(Tt(Pe,"LineString",Fe,X.properties));return}St(pe,Fe,Ee,!1)}else if(we==="Polygon")St(pe,Fe,Ee,!0);else{if(we!=="MultiPolygon"){if(we==="GeometryCollection"){for(const He of X.geometry.geometries)mt(Ce,{id:Pe,geometry:He,properties:X.properties},K,te);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const He of pe){const Ge=[];St(He,Ge,Ee,!0),Fe.push(Ge)}}Ce.push(Tt(Pe,we,Fe,X.properties))}function Xt(Ce,X){X.push(pt(Ce[0]),Ft(Ce[1]),0)}function Ut(Ce,X,K,te){let pe,we,Ee=0;for(let Pe=0;Pe<Ce.length;Pe++){const He=pt(Ce[Pe][0]),Ge=Ft(Ce[Pe][1]);X.push(He,Ge,0),Pe>0&&(Ee+=te?(pe*Ge-He*we)/2:Math.sqrt(Math.pow(He-pe,2)+Math.pow(Ge-we,2))),pe=He,we=Ge}const Fe=X.length-3;X[2]=1,_t(X,0,Fe,K),X[Fe+2]=1,X.size=Math.abs(Ee),X.start=0,X.end=X.size}function St(Ce,X,K,te){for(let pe=0;pe<Ce.length;pe++){const we=[];Ut(Ce[pe],we,K,te),X.push(we)}}function pt(Ce){return Ce/360+.5}function Ft(Ce){const X=Math.sin(Ce*Math.PI/180),K=.5-.25*Math.log((1+X)/(1-X))/Math.PI;return K<0?0:K>1?1:K}function nt(Ce,X,K,te,pe,we,Ee,Fe){if(te/=X,we>=(K/=X)&&Ee<te)return Ce;if(Ee<K||we>=te)return null;const Pe=[];for(const He of Ce){const Ge=He.geometry;let Le=He.type;const Je=pe===0?He.minX:He.minY,Ae=pe===0?He.maxX:He.maxY;if(Je>=K&&Ae<te){Pe.push(He);continue}if(Ae<K||Je>=te)continue;let Lt=[];if(Le==="Point"||Le==="MultiPoint")De(Ge,Lt,K,te,pe);else if(Le==="LineString")Ke(Ge,Lt,K,te,pe,!1,Fe.lineMetrics);else if(Le==="MultiLineString")wt(Ge,Lt,K,te,pe,!1);else if(Le==="Polygon")wt(Ge,Lt,K,te,pe,!0);else if(Le==="MultiPolygon")for(const nn of Ge){const jt=[];wt(nn,jt,K,te,pe,!0),jt.length&&Lt.push(jt)}if(Lt.length){if(Fe.lineMetrics&&Le==="LineString"){for(const nn of Lt)Pe.push(Tt(He.id,Le,nn,He.tags));continue}Le!=="LineString"&&Le!=="MultiLineString"||(Lt.length===1?(Le="LineString",Lt=Lt[0]):Le="MultiLineString"),Le!=="Point"&&Le!=="MultiPoint"||(Le=Lt.length===3?"Point":"MultiPoint"),Pe.push(Tt(He.id,Le,Lt,He.tags))}}return Pe.length?Pe:null}function De(Ce,X,K,te,pe){for(let we=0;we<Ce.length;we+=3){const Ee=Ce[we+pe];Ee>=K&&Ee<=te&&gt(X,Ce[we],Ce[we+1],Ce[we+2])}}function Ke(Ce,X,K,te,pe,we,Ee){let Fe=Be(Ce);const Pe=pe===0?Rt:st;let He,Ge,Le=Ce.start;for(let jt=0;jt<Ce.length-3;jt+=3){const Kt=Ce[jt],en=Ce[jt+1],ti=Ce[jt+2],Pn=Ce[jt+3],Nn=Ce[jt+4],ln=pe===0?Kt:en,En=pe===0?Pn:Nn;let li=!1;Ee&&(He=Math.sqrt(Math.pow(Kt-Pn,2)+Math.pow(en-Nn,2))),ln<K?En>K&&(Ge=Pe(Fe,Kt,en,Pn,Nn,K),Ee&&(Fe.start=Le+He*Ge)):ln>te?En<te&&(Ge=Pe(Fe,Kt,en,Pn,Nn,te),Ee&&(Fe.start=Le+He*Ge)):gt(Fe,Kt,en,ti),En<K&&ln>=K&&(Ge=Pe(Fe,Kt,en,Pn,Nn,K),li=!0),En>te&&ln<=te&&(Ge=Pe(Fe,Kt,en,Pn,Nn,te),li=!0),!we&&li&&(Ee&&(Fe.end=Le+He*Ge),X.push(Fe),Fe=Be(Ce)),Ee&&(Le+=He)}let Je=Ce.length-3;const Ae=Ce[Je],Lt=Ce[Je+1],nn=pe===0?Ae:Lt;nn>=K&&nn<=te&&gt(Fe,Ae,Lt,Ce[Je+2]),Je=Fe.length-3,we&&Je>=3&&(Fe[Je]!==Fe[0]||Fe[Je+1]!==Fe[1])&&gt(Fe,Fe[0],Fe[1],Fe[2]),Fe.length&&X.push(Fe)}function Be(Ce){const X=[];return X.size=Ce.size,X.start=Ce.start,X.end=Ce.end,X}function wt(Ce,X,K,te,pe,we){for(const Ee of Ce)Ke(Ee,X,K,te,pe,we,!1)}function gt(Ce,X,K,te){Ce.push(X,K,te)}function Rt(Ce,X,K,te,pe,we){const Ee=(we-X)/(te-X);return gt(Ce,we,K+(pe-K)*Ee,1),Ee}function st(Ce,X,K,te,pe,we){const Ee=(we-K)/(pe-K);return gt(Ce,X+(te-X)*Ee,we,1),Ee}function ht(Ce,X){const K=[];for(let te=0;te<Ce.length;te++){const pe=Ce[te],we=pe.type;let Ee;if(we==="Point"||we==="MultiPoint"||we==="LineString")Ee=qe(pe.geometry,X);else if(we==="MultiLineString"||we==="Polygon"){Ee=[];for(const Fe of pe.geometry)Ee.push(qe(Fe,X))}else if(we==="MultiPolygon"){Ee=[];for(const Fe of pe.geometry){const Pe=[];for(const He of Fe)Pe.push(qe(He,X));Ee.push(Pe)}}K.push(Tt(pe.id,we,Ee,pe.tags))}return K}function qe(Ce,X){const K=[];K.size=Ce.size,Ce.start!==void 0&&(K.start=Ce.start,K.end=Ce.end);for(let te=0;te<Ce.length;te+=3)K.push(Ce[te]+X,Ce[te+1],Ce[te+2]);return K}function Mt(Ce,X){if(Ce.transformed)return Ce;const K=1<<Ce.z,te=Ce.x,pe=Ce.y;for(const we of Ce.features){const Ee=we.geometry,Fe=we.type;if(we.geometry=[],Fe===1)for(let Pe=0;Pe<Ee.length;Pe+=2)we.geometry.push(Ht(Ee[Pe],Ee[Pe+1],X,K,te,pe));else for(let Pe=0;Pe<Ee.length;Pe++){const He=[];for(let Ge=0;Ge<Ee[Pe].length;Ge+=2)He.push(Ht(Ee[Pe][Ge],Ee[Pe][Ge+1],X,K,te,pe));we.geometry.push(He)}}return Ce.transformed=!0,Ce}function Ht(Ce,X,K,te,pe,we){return[Math.round(K*(Ce*te-pe)),Math.round(K*(X*te-we))]}function _n(Ce,X,K,te,pe){const we=X===pe.maxZoom?0:pe.tolerance/((1<<X)*pe.extent),Ee={features:[],numPoints:0,numSimplified:0,numFeatures:Ce.length,source:null,x:K,y:te,z:X,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Fe of Ce)In(Ee,Fe,we,pe);return Ee}function In(Ce,X,K,te){const pe=X.geometry,we=X.type,Ee=[];if(Ce.minX=Math.min(Ce.minX,X.minX),Ce.minY=Math.min(Ce.minY,X.minY),Ce.maxX=Math.max(Ce.maxX,X.maxX),Ce.maxY=Math.max(Ce.maxY,X.maxY),we==="Point"||we==="MultiPoint")for(let Fe=0;Fe<pe.length;Fe+=3)Ee.push(pe[Fe],pe[Fe+1]),Ce.numPoints++,Ce.numSimplified++;else if(we==="LineString")yt(Ee,pe,Ce,K,!1,!1);else if(we==="MultiLineString"||we==="Polygon")for(let Fe=0;Fe<pe.length;Fe++)yt(Ee,pe[Fe],Ce,K,we==="Polygon",Fe===0);else if(we==="MultiPolygon")for(let Fe=0;Fe<pe.length;Fe++){const Pe=pe[Fe];for(let He=0;He<Pe.length;He++)yt(Ee,Pe[He],Ce,K,!0,He===0)}if(Ee.length){let Fe=X.tags||null;if(we==="LineString"&&te.lineMetrics){Fe={};for(const He in X.tags)Fe[He]=X.tags[He];Fe.mapbox_clip_start=pe.start/pe.size,Fe.mapbox_clip_end=pe.end/pe.size}const Pe={geometry:Ee,type:we==="Polygon"||we==="MultiPolygon"?3:we==="LineString"||we==="MultiLineString"?2:1,tags:Fe};X.id!==null&&(Pe.id=X.id),Ce.features.push(Pe)}}function yt(Ce,X,K,te,pe,we){const Ee=te*te;if(te>0&&X.size<(pe?Ee:te))return void(K.numPoints+=X.length/3);const Fe=[];for(let Pe=0;Pe<X.length;Pe+=3)(te===0||X[Pe+2]>Ee)&&(K.numSimplified++,Fe.push(X[Pe],X[Pe+1])),K.numPoints++;pe&&function(Pe,He){let Ge=0;for(let Le=0,Je=Pe.length,Ae=Je-2;Le<Je;Ae=Le,Le+=2)Ge+=(Pe[Le]-Pe[Ae])*(Pe[Le+1]+Pe[Ae+1]);if(Ge>0===He)for(let Le=0,Je=Pe.length;Le<Je/2;Le+=2){const Ae=Pe[Le],Lt=Pe[Le+1];Pe[Le]=Pe[Je-2-Le],Pe[Le+1]=Pe[Je-1-Le],Pe[Je-2-Le]=Ae,Pe[Je-1-Le]=Lt}}(Fe,we),Ce.push(Fe)}const qt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Nt{constructor(X,K){const te=(K=this.options=function(we,Ee){for(const Fe in Ee)we[Fe]=Ee[Fe];return we}(Object.create(qt),K)).debug;if(te&&console.time("preprocess data"),K.maxZoom<0||K.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(K.promoteId&&K.generateId)throw new Error("promoteId and generateId cannot be used together.");let pe=function(we,Ee){const Fe=[];if(we.type==="FeatureCollection")for(let Pe=0;Pe<we.features.length;Pe++)mt(Fe,we.features[Pe],Ee,Pe);else mt(Fe,we.type==="Feature"?we:{geometry:we},Ee);return Fe}(X,K);this.tiles={},this.tileCoords=[],te&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",K.indexMaxZoom,K.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),pe=function(we,Ee){const Fe=Ee.buffer/Ee.extent;let Pe=we;const He=nt(we,1,-1-Fe,Fe,0,-1,2,Ee),Ge=nt(we,1,1-Fe,2+Fe,0,-1,2,Ee);return(He||Ge)&&(Pe=nt(we,1,-Fe,1+Fe,0,-1,2,Ee)||[],He&&(Pe=ht(He,1).concat(Pe)),Ge&&(Pe=Pe.concat(ht(Ge,-1)))),Pe}(pe,K),pe.length&&this.splitTile(pe,0,0,0),te&&(pe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(X,K,te,pe,we,Ee,Fe){const Pe=[X,K,te,pe],He=this.options,Ge=He.debug;for(;Pe.length;){pe=Pe.pop(),te=Pe.pop(),K=Pe.pop(),X=Pe.pop();const Le=1<<K,Je=fn(K,te,pe);let Ae=this.tiles[Je];if(!Ae&&(Ge>1&&console.time("creation"),Ae=this.tiles[Je]=_n(X,K,te,pe,He),this.tileCoords.push({z:K,x:te,y:pe}),Ge)){Ge>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",K,te,pe,Ae.numFeatures,Ae.numPoints,Ae.numSimplified),console.timeEnd("creation"));const li=`z${K}`;this.stats[li]=(this.stats[li]||0)+1,this.total++}if(Ae.source=X,we==null){if(K===He.indexMaxZoom||Ae.numPoints<=He.indexMaxPoints)continue}else{if(K===He.maxZoom||K===we)continue;if(we!=null){const li=we-K;if(te!==Ee>>li||pe!==Fe>>li)continue}}if(Ae.source=null,X.length===0)continue;Ge>1&&console.time("clipping");const Lt=.5*He.buffer/He.extent,nn=.5-Lt,jt=.5+Lt,Kt=1+Lt;let en=null,ti=null,Pn=null,Nn=null,ln=nt(X,Le,te-Lt,te+jt,0,Ae.minX,Ae.maxX,He),En=nt(X,Le,te+nn,te+Kt,0,Ae.minX,Ae.maxX,He);X=null,ln&&(en=nt(ln,Le,pe-Lt,pe+jt,1,Ae.minY,Ae.maxY,He),ti=nt(ln,Le,pe+nn,pe+Kt,1,Ae.minY,Ae.maxY,He),ln=null),En&&(Pn=nt(En,Le,pe-Lt,pe+jt,1,Ae.minY,Ae.maxY,He),Nn=nt(En,Le,pe+nn,pe+Kt,1,Ae.minY,Ae.maxY,He),En=null),Ge>1&&console.timeEnd("clipping"),Pe.push(en||[],K+1,2*te,2*pe),Pe.push(ti||[],K+1,2*te,2*pe+1),Pe.push(Pn||[],K+1,2*te+1,2*pe),Pe.push(Nn||[],K+1,2*te+1,2*pe+1)}}getTile(X,K,te){X=+X,K=+K,te=+te;const pe=this.options,{extent:we,debug:Ee}=pe;if(X<0||X>24)return null;const Fe=1<<X,Pe=fn(X,K=K+Fe&Fe-1,te);if(this.tiles[Pe])return Mt(this.tiles[Pe],we);Ee>1&&console.log("drilling down to z%d-%d-%d",X,K,te);let He,Ge=X,Le=K,Je=te;for(;!He&&Ge>0;)Ge--,Le>>=1,Je>>=1,He=this.tiles[fn(Ge,Le,Je)];return He&&He.source?(Ee>1&&(console.log("found parent tile z%d-%d-%d",Ge,Le,Je),console.time("drilling down")),this.splitTile(He.source,Ge,Le,Je,X,K,te),Ee>1&&console.timeEnd("drilling down"),this.tiles[Pe]?Mt(this.tiles[Pe],we):null):null}}function fn(Ce,X,K){return 32*((1<<Ce)*K+X)+Ce}function yn(Ce,X){return X?Ce.properties[X]:Ce.id}function On(Ce,X){if(Ce==null)return!0;if(Ce.type==="Feature")return yn(Ce,X)!=null;if(Ce.type==="FeatureCollection"){const K=new Set;for(const te of Ce.features){const pe=yn(te,X);if(pe==null||K.has(pe))return!1;K.add(pe)}return!0}return!1}function Mi(Ce,X){const K=new Map;if(Ce!=null)if(Ce.type==="Feature")K.set(yn(Ce,X),Ce);else for(const te of Ce.features)K.set(yn(te,X),te);return K}class $n extends k{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(X,K){return p._(this,void 0,void 0,function*(){const te=X.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const pe=this._geoJSONIndex.getTile(te.z,te.x,te.y);if(!pe)return null;const we=new ae(pe.features);let Ee=ke(we);return Ee.byteOffset===0&&Ee.byteLength===Ee.buffer.byteLength||(Ee=new Uint8Array(Ee)),{vectorTile:we,rawData:Ee.buffer}})}loadData(X){return p._(this,void 0,void 0,function*(){var K;(K=this._pendingRequest)===null||K===void 0||K.abort();const te=!!(X&&X.request&&X.request.collectResourceTiming)&&new p.cM(X.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(X,this._pendingRequest),this._geoJSONIndex=X.cluster?new Ze(function({superclusterOptions:Ee,clusterProperties:Fe}){if(!Fe||!Ee)return Ee;const Pe={},He={},Ge={accumulated:null,zoom:0},Le={properties:null},Je=Object.keys(Fe);for(const Ae of Je){const[Lt,nn]=Fe[Ae],jt=p.cT(nn),Kt=p.cT(typeof Lt=="string"?[Lt,["accumulated"],["get",Ae]]:Lt);Pe[Ae]=jt.value,He[Ae]=Kt.value}return Ee.map=Ae=>{Le.properties=Ae;const Lt={};for(const nn of Je)Lt[nn]=Pe[nn].evaluate(Ge,Le);return Lt},Ee.reduce=(Ae,Lt)=>{Le.properties=Lt;for(const nn of Je)Ge.accumulated=Ae[nn],Ae[nn]=He[nn].evaluate(Ge,Le)},Ee}(X)).load((yield this._pendingData).features):(pe=yield this._pendingData,new Nt(pe,X.geojsonVtOptions)),this.loaded={};const we={};if(te){const Ee=te.finish();Ee&&(we.resourceTiming={},we.resourceTiming[X.source]=JSON.parse(JSON.stringify(Ee)))}return we}catch(we){if(delete this._pendingRequest,p.cx(we))return{abandoned:!0};throw we}var pe})}getData(){return p._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(X){const K=this.loaded;return K&&K[X.uid]?super.reloadTile(X):this.loadTile(X)}loadAndProcessGeoJSON(X,K){return p._(this,void 0,void 0,function*(){let te=yield this.loadGeoJSON(X,K);if(delete this._pendingRequest,typeof te!="object")throw new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`);if(H(te,!0),X.filter){const pe=p.cT(X.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(pe.result==="error")throw new Error(pe.value.map(Ee=>`${Ee.key}: ${Ee.message}`).join(", "));te={type:"FeatureCollection",features:te.features.filter(Ee=>pe.value.evaluate({zoom:0},Ee))}}return te})}loadGeoJSON(X,K){return p._(this,void 0,void 0,function*(){const{promoteId:te}=X;if(X.request){const pe=yield p.j(X.request,K);return this._dataUpdateable=On(pe.data,te)?Mi(pe.data,te):void 0,pe.data}if(typeof X.data=="string")try{const pe=JSON.parse(X.data);return this._dataUpdateable=On(pe,te)?Mi(pe,te):void 0,pe}catch{throw new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`)}if(!X.dataDiff)throw new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${X.source}`);return function(pe,we,Ee){var Fe,Pe,He,Ge;if(we.removeAll&&pe.clear(),we.remove)for(const Le of we.remove)pe.delete(Le);if(we.add)for(const Le of we.add){const Je=yn(Le,Ee);Je!=null&&pe.set(Je,Le)}if(we.update)for(const Le of we.update){let Je=pe.get(Le.id);if(Je==null)continue;const Ae=!Le.removeAllProperties&&(((Fe=Le.removeProperties)===null||Fe===void 0?void 0:Fe.length)>0||((Pe=Le.addOrUpdateProperties)===null||Pe===void 0?void 0:Pe.length)>0);if((Le.newGeometry||Le.removeAllProperties||Ae)&&(Je=Object.assign({},Je),pe.set(Le.id,Je),Ae&&(Je.properties=Object.assign({},Je.properties))),Le.newGeometry&&(Je.geometry=Le.newGeometry),Le.removeAllProperties)Je.properties={};else if(((He=Le.removeProperties)===null||He===void 0?void 0:He.length)>0)for(const Lt of Le.removeProperties)Object.prototype.hasOwnProperty.call(Je.properties,Lt)&&delete Je.properties[Lt];if(((Ge=Le.addOrUpdateProperties)===null||Ge===void 0?void 0:Ge.length)>0)for(const{key:Lt,value:nn}of Le.addOrUpdateProperties)Je.properties[Lt]=nn}}(this._dataUpdateable,X.dataDiff,te),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(X){return p._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(X){return this._geoJSONIndex.getClusterExpansionZoom(X.clusterId)}getClusterChildren(X){return this._geoJSONIndex.getChildren(X.clusterId)}getClusterLeaves(X){return this._geoJSONIndex.getLeaves(X.clusterId,X.limit,X.offset)}}class wi{constructor(X){this.self=X,this.actor=new p.J(X),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(K,te)=>{if(this.externalWorkerSourceTypes[K])throw new Error(`Worker source with name "${K}" already registered.`);this.externalWorkerSourceTypes[K]=te},this.self.addProtocol=p.cz,this.self.removeProtocol=p.cA,this.self.registerRTLTextPlugin=K=>{p.cU.setMethods(K)},this.actor.registerMessageHandler("LDT",(K,te)=>this._getDEMWorkerSource(K,te.source).loadTile(te)),this.actor.registerMessageHandler("RDT",(K,te)=>p._(this,void 0,void 0,function*(){this._getDEMWorkerSource(K,te.source).removeTile(te)})),this.actor.registerMessageHandler("GCEZ",(K,te)=>p._(this,void 0,void 0,function*(){return this._getWorkerSource(K,te.type,te.source).getClusterExpansionZoom(te)})),this.actor.registerMessageHandler("GCC",(K,te)=>p._(this,void 0,void 0,function*(){return this._getWorkerSource(K,te.type,te.source).getClusterChildren(te)})),this.actor.registerMessageHandler("GCL",(K,te)=>p._(this,void 0,void 0,function*(){return this._getWorkerSource(K,te.type,te.source).getClusterLeaves(te)})),this.actor.registerMessageHandler("LD",(K,te)=>this._getWorkerSource(K,te.type,te.source).loadData(te)),this.actor.registerMessageHandler("GD",(K,te)=>this._getWorkerSource(K,te.type,te.source).getData()),this.actor.registerMessageHandler("LT",(K,te)=>this._getWorkerSource(K,te.type,te.source).loadTile(te)),this.actor.registerMessageHandler("RT",(K,te)=>this._getWorkerSource(K,te.type,te.source).reloadTile(te)),this.actor.registerMessageHandler("AT",(K,te)=>this._getWorkerSource(K,te.type,te.source).abortTile(te)),this.actor.registerMessageHandler("RMT",(K,te)=>this._getWorkerSource(K,te.type,te.source).removeTile(te)),this.actor.registerMessageHandler("RS",(K,te)=>p._(this,void 0,void 0,function*(){if(!this.workerSources[K]||!this.workerSources[K][te.type]||!this.workerSources[K][te.type][te.source])return;const pe=this.workerSources[K][te.type][te.source];delete this.workerSources[K][te.type][te.source],pe.removeSource!==void 0&&pe.removeSource(te)})),this.actor.registerMessageHandler("RM",K=>p._(this,void 0,void 0,function*(){delete this.layerIndexes[K],delete this.availableImages[K],delete this.workerSources[K],delete this.demWorkerSources[K]})),this.actor.registerMessageHandler("SR",(K,te)=>p._(this,void 0,void 0,function*(){this.referrer=te})),this.actor.registerMessageHandler("SRPS",(K,te)=>this._syncRTLPluginState(K,te)),this.actor.registerMessageHandler("IS",(K,te)=>p._(this,void 0,void 0,function*(){this.self.importScripts(te)})),this.actor.registerMessageHandler("SI",(K,te)=>this._setImages(K,te)),this.actor.registerMessageHandler("UL",(K,te)=>p._(this,void 0,void 0,function*(){this._getLayerIndex(K).update(te.layers,te.removedIds)})),this.actor.registerMessageHandler("SL",(K,te)=>p._(this,void 0,void 0,function*(){this._getLayerIndex(K).replace(te)}))}_setImages(X,K){return p._(this,void 0,void 0,function*(){this.availableImages[X]=K;for(const te in this.workerSources[X]){const pe=this.workerSources[X][te];for(const we in pe)pe[we].availableImages=K}})}_syncRTLPluginState(X,K){return p._(this,void 0,void 0,function*(){return yield p.cU.syncState(K,this.self.importScripts)})}_getAvailableImages(X){let K=this.availableImages[X];return K||(K=[]),K}_getLayerIndex(X){let K=this.layerIndexes[X];return K||(K=this.layerIndexes[X]=new a),K}_getWorkerSource(X,K,te){if(this.workerSources[X]||(this.workerSources[X]={}),this.workerSources[X][K]||(this.workerSources[X][K]={}),!this.workerSources[X][K][te]){const pe={sendAsync:(we,Ee)=>(we.targetMapId=X,this.actor.sendAsync(we,Ee))};switch(K){case"vector":this.workerSources[X][K][te]=new k(pe,this._getLayerIndex(X),this._getAvailableImages(X));break;case"geojson":this.workerSources[X][K][te]=new $n(pe,this._getLayerIndex(X),this._getAvailableImages(X));break;default:this.workerSources[X][K][te]=new this.externalWorkerSourceTypes[K](pe,this._getLayerIndex(X),this._getAvailableImages(X))}}return this.workerSources[X][K][te]}_getDEMWorkerSource(X,K){return this.demWorkerSources[X]||(this.demWorkerSources[X]={}),this.demWorkerSources[X][K]||(this.demWorkerSources[X][K]=new I),this.demWorkerSources[X][K]}}return p.i(self)&&(self.worker=new wi(self)),wi}),u("index",["exports","./shared"],function(p,a){var w="5.6.1";function T(){var _=new a.A(4);return a.A!=Float32Array&&(_[1]=0,_[2]=0),_[0]=1,_[3]=1,_}let S,k;const I={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(_,n,s){const f=requestAnimationFrame(y=>{m(),n(y)}),{unsubscribe:m}=a.s(_.signal,"abort",()=>{m(),cancelAnimationFrame(f),s(a.c())},!1)},frameAsync(_){return new Promise((n,s)=>{this.frame(_,n,s)})},getImageData(_,n=0){return this.getImageCanvasContext(_).getImageData(-n,-n,_.width+2*n,_.height+2*n)},getImageCanvasContext(_){const n=window.document.createElement("canvas"),s=n.getContext("2d",{willReadFrequently:!0});if(!s)throw new Error("failed to create canvas 2d context");return n.width=_.width,n.height=_.height,s.drawImage(_,0,0,_.width,_.height),s},resolveURL:_=>(S||(S=document.createElement("a")),S.href=_,S.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(k==null&&(k=matchMedia("(prefers-reduced-motion: reduce)")),k.matches)}};class P{static testProp(n){if(!P.docStyle)return n[0];for(let s=0;s<n.length;s++)if(n[s]in P.docStyle)return n[s];return n[0]}static create(n,s,f){const m=window.document.createElement(n);return s!==void 0&&(m.className=s),f&&f.appendChild(m),m}static createNS(n,s){return window.document.createElementNS(n,s)}static disableDrag(){P.docStyle&&P.selectProp&&(P.userSelect=P.docStyle[P.selectProp],P.docStyle[P.selectProp]="none")}static enableDrag(){P.docStyle&&P.selectProp&&(P.docStyle[P.selectProp]=P.userSelect)}static setTransform(n,s){n.style[P.transformProp]=s}static addEventListener(n,s,f,m={}){n.addEventListener(s,f,"passive"in m?m:m.capture)}static removeEventListener(n,s,f,m={}){n.removeEventListener(s,f,"passive"in m?m:m.capture)}static suppressClickInternal(n){n.preventDefault(),n.stopPropagation(),window.removeEventListener("click",P.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",P.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",P.suppressClickInternal,!0)},0)}static getScale(n){const s=n.getBoundingClientRect();return{x:s.width/n.offsetWidth||1,y:s.height/n.offsetHeight||1,boundingClientRect:s}}static getPoint(n,s,f){const m=s.boundingClientRect;return new a.P((f.clientX-m.left)/s.x-n.clientLeft,(f.clientY-m.top)/s.y-n.clientTop)}static mousePos(n,s){const f=P.getScale(n);return P.getPoint(n,f,s)}static touchPos(n,s){const f=[],m=P.getScale(n);for(let y=0;y<s.length;y++)f.push(P.getPoint(n,m,s[y]));return f}static mouseButton(n){return n.button}static remove(n){n.parentNode&&n.parentNode.removeChild(n)}static sanitize(n){const s=new DOMParser().parseFromString(n,"text/html").body||document.createElement("body"),f=s.querySelectorAll("script");for(const m of f)m.remove();return P.clean(s),s.innerHTML}static isPossiblyDangerous(n,s){const f=s.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(n)||!f.includes("javascript:")&&!f.includes("data:"))||!!n.startsWith("on")||void 0}static clean(n){const s=n.children;for(const f of s)P.removeAttributes(f),P.clean(f)}static removeAttributes(n){for(const{name:s,value:f}of n.attributes)P.isPossiblyDangerous(s,f)&&n.removeAttribute(s)}}P.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,P.selectProp=P.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),P.transformProp=P.testProp(["transform","WebkitTransform"]);const F={supported:!1,testSupport:function(_){!Y&&H&&($?ae(_):G=_)}};let G,H,Y=!1,$=!1;function ae(_){const n=_.createTexture();_.bindTexture(_.TEXTURE_2D,n);try{if(_.texImage2D(_.TEXTURE_2D,0,_.RGBA,_.RGBA,_.UNSIGNED_BYTE,H),_.isContextLost())return;F.supported=!0}catch{}_.deleteTexture(n),Y=!0}var ee;typeof document<"u"&&(H=document.createElement("img"),H.onload=()=>{G&&ae(G),G=null,$=!0},H.onerror=()=>{Y=!0,G=null},H.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(_){let n,s,f,m;_.resetRequestQueue=()=>{n=[],s=0,f=0,m={}},_.addThrottleControl=E=>{const z=f++;return m[z]=E,z},_.removeThrottleControl=E=>{delete m[E],x()},_.getImage=(E,z,B=!0)=>new Promise((j,N)=>{F.supported&&(E.headers||(E.headers={}),E.headers.accept="image/webp,*/*"),a.e(E,{type:"image"}),n.push({abortController:z,requestParameters:E,supportImageRefresh:B,state:"queued",onError:V=>{N(V)},onSuccess:V=>{j(V)}}),x()});const y=E=>a._(this,void 0,void 0,function*(){E.state="running";const{requestParameters:z,supportImageRefresh:B,onError:j,onSuccess:N,abortController:V}=E,Q=B===!1&&!a.i(self)&&!a.g(z.url)&&(!z.headers||Object.keys(z.headers).reduce((le,de)=>le&&de==="accept",!0));s++;const se=Q?M(z,V):a.m(z,V);try{const le=yield se;delete E.abortController,E.state="completed",le.data instanceof HTMLImageElement||a.b(le.data)?N(le):le.data&&N({data:yield(oe=le.data,typeof createImageBitmap=="function"?a.f(oe):a.h(oe)),cacheControl:le.cacheControl,expires:le.expires})}catch(le){delete E.abortController,j(le)}finally{s--,x()}var oe}),x=()=>{const E=(()=>{for(const z of Object.keys(m))if(m[z]())return!0;return!1})()?a.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:a.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let z=s;z<E&&n.length>0;z++){const B=n.shift();B.abortController.signal.aborted?z--:y(B)}},M=(E,z)=>new Promise((B,j)=>{const N=new Image,V=E.url,Q=E.credentials;Q&&Q==="include"?N.crossOrigin="use-credentials":(Q&&Q==="same-origin"||!a.d(V))&&(N.crossOrigin="anonymous"),z.signal.addEventListener("abort",()=>{N.src="",j(a.c())}),N.fetchPriority="high",N.onload=()=>{N.onerror=N.onload=null,B({data:N})},N.onerror=()=>{N.onerror=N.onload=null,z.signal.aborted||j(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},N.src=V})}(ee||(ee={})),ee.resetRequestQueue();class ce{constructor(n){this._transformRequestFn=n}transformRequest(n,s){return this._transformRequestFn&&this._transformRequestFn(n,s)||{url:n}}setTransformRequest(n){this._transformRequestFn=n}}function re(_){const n=[];if(typeof _=="string")n.push({id:"default",url:_});else if(_&&_.length>0){const s=[];for(const{id:f,url:m}of _){const y=`${f}${m}`;s.indexOf(y)===-1&&(s.push(y),n.push({id:f,url:m}))}}return n}function he(_,n,s){try{const f=new URL(_);return f.pathname+=`${n}${s}`,f.toString()}catch{throw new Error(`Invalid sprite URL "${_}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function be(_){const{userImage:n}=_;return!!(n&&n.render&&n.render())&&(_.data.replace(new Uint8Array(n.data.buffer)),!0)}class ke extends a.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(n){if(this.loaded!==n&&(this.loaded=n,n)){for(const{ids:s,promiseResolve:f}of this.requestors)f(this._getImagesForIds(s));this.requestors=[]}}getImage(n){const s=this.images[n];if(s&&!s.data&&s.spriteData){const f=s.spriteData;s.data=new a.R({width:f.width,height:f.height},f.context.getImageData(f.x,f.y,f.width,f.height).data),s.spriteData=null}return s}addImage(n,s){if(this.images[n])throw new Error(`Image id ${n} already exist, use updateImage instead`);this._validate(n,s)&&(this.images[n]=s)}_validate(n,s){let f=!0;const m=s.data||s.spriteData;return this._validateStretch(s.stretchX,m&&m.width)||(this.fire(new a.k(new Error(`Image "${n}" has invalid "stretchX" value`))),f=!1),this._validateStretch(s.stretchY,m&&m.height)||(this.fire(new a.k(new Error(`Image "${n}" has invalid "stretchY" value`))),f=!1),this._validateContent(s.content,s)||(this.fire(new a.k(new Error(`Image "${n}" has invalid "content" value`))),f=!1),f}_validateStretch(n,s){if(!n)return!0;let f=0;for(const m of n){if(m[0]<f||m[1]<m[0]||s<m[1])return!1;f=m[1]}return!0}_validateContent(n,s){if(!n)return!0;if(n.length!==4)return!1;const f=s.spriteData,m=f&&f.width||s.data.width,y=f&&f.height||s.data.height;return!(n[0]<0||m<n[0]||n[1]<0||y<n[1]||n[2]<0||m<n[2]||n[3]<0||y<n[3]||n[2]<n[0]||n[3]<n[1])}updateImage(n,s,f=!0){const m=this.getImage(n);if(f&&(m.data.width!==s.data.width||m.data.height!==s.data.height))throw new Error(`size mismatch between old image (${m.data.width}x${m.data.height}) and new image (${s.data.width}x${s.data.height}).`);s.version=m.version+1,this.images[n]=s,this.updatedImages[n]=!0}removeImage(n){const s=this.images[n];delete this.images[n],delete this.patterns[n],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(n){return new Promise((s,f)=>{let m=!0;if(!this.isLoaded())for(const y of n)this.images[y]||(m=!1);this.isLoaded()||m?s(this._getImagesForIds(n)):this.requestors.push({ids:n,promiseResolve:s})})}_getImagesForIds(n){const s={};for(const f of n){let m=this.getImage(f);m||(this.fire(new a.l("styleimagemissing",{id:f})),m=this.getImage(f)),m?s[f]={data:m.data.clone(),pixelRatio:m.pixelRatio,sdf:m.sdf,version:m.version,stretchX:m.stretchX,stretchY:m.stretchY,content:m.content,textFitWidth:m.textFitWidth,textFitHeight:m.textFitHeight,hasRenderCallback:!!(m.userImage&&m.userImage.render)}:a.w(`Image "${f}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return s}getPixelSize(){const{width:n,height:s}=this.atlasImage;return{width:n,height:s}}getPattern(n){const s=this.patterns[n],f=this.getImage(n);if(!f)return null;if(s&&s.position.version===f.version)return s.position;if(s)s.position.version=f.version;else{const m={w:f.data.width+2,h:f.data.height+2,x:0,y:0},y=new a.I(m,f);this.patterns[n]={bin:m,position:y}}return this._updatePatternAtlas(),this.patterns[n].position}bind(n){const s=n.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new a.T(n,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const n=[];for(const y in this.patterns)n.push(this.patterns[y].bin);const{w:s,h:f}=a.p(n),m=this.atlasImage;m.resize({width:s||1,height:f||1});for(const y in this.patterns){const{bin:x}=this.patterns[y],M=x.x+1,E=x.y+1,z=this.getImage(y).data,B=z.width,j=z.height;a.R.copy(z,m,{x:0,y:0},{x:M,y:E},{width:B,height:j}),a.R.copy(z,m,{x:0,y:j-1},{x:M,y:E-1},{width:B,height:1}),a.R.copy(z,m,{x:0,y:0},{x:M,y:E+j},{width:B,height:1}),a.R.copy(z,m,{x:B-1,y:0},{x:M-1,y:E},{width:1,height:j}),a.R.copy(z,m,{x:0,y:0},{x:M+B,y:E},{width:1,height:j})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(n){for(const s of n){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const f=this.getImage(s);f||a.w(`Image with ID: "${s}" was not found`),be(f)&&this.updateImage(s,f)}}}const Ie=1e20;function ue(_,n,s,f,m,y,x,M,E){for(let z=n;z<n+f;z++)Ve(_,s*y+z,y,m,x,M,E);for(let z=s;z<s+m;z++)Ve(_,z*y+n,1,f,x,M,E)}function Ve(_,n,s,f,m,y,x){y[0]=0,x[0]=-Ie,x[1]=Ie,m[0]=_[n];for(let M=1,E=0,z=0;M<f;M++){m[M]=_[n+M*s];const B=M*M;do{const j=y[E];z=(m[M]-m[j]+B-j*j)/(M-j)/2}while(z<=x[E]&&--E>-1);E++,y[E]=M,x[E]=z,x[E+1]=Ie}for(let M=0,E=0;M<f;M++){for(;x[E+1]<M;)E++;const z=y[E],B=M-z;_[n+M*s]=m[z]+B*B}}class Ze{constructor(n,s){this.requestManager=n,this.localIdeographFontFamily=s,this.entries={}}setURL(n){this.url=n}getGlyphs(n){return a._(this,void 0,void 0,function*(){const s=[];for(const y in n)for(const x of n[y])s.push(this._getAndCacheGlyphsPromise(y,x));const f=yield Promise.all(s),m={};for(const{stack:y,id:x,glyph:M}of f)m[y]||(m[y]={}),m[y][x]=M&&{id:M.id,bitmap:M.bitmap.clone(),metrics:M.metrics};return m})}_getAndCacheGlyphsPromise(n,s){return a._(this,void 0,void 0,function*(){let f=this.entries[n];f||(f=this.entries[n]={glyphs:{},requests:{},ranges:{}});let m=f.glyphs[s];if(m!==void 0)return{stack:n,id:s,glyph:m};if(m=this._tinySDF(f,n,s),m)return f.glyphs[s]=m,{stack:n,id:s,glyph:m};const y=Math.floor(s/256);if(256*y>65535)throw new Error("glyphs > 65535 not supported");if(f.ranges[y])return{stack:n,id:s,glyph:m};if(!this.url)throw new Error("glyphsUrl is not set");if(!f.requests[y]){const M=Ze.loadGlyphRange(n,y,this.url,this.requestManager);f.requests[y]=M}const x=yield f.requests[y];for(const M in x)this._doesCharSupportLocalGlyph(+M)||(f.glyphs[+M]=x[+M]);return f.ranges[y]=!0,{stack:n,id:s,glyph:x[s]||null}})}_doesCharSupportLocalGlyph(n){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(n))||a.u["CJK Unified Ideographs"](n)||a.u["Hangul Syllables"](n)||a.u.Hiragana(n)||a.u.Katakana(n)||a.u["CJK Symbols and Punctuation"](n)||a.u["Halfwidth and Fullwidth Forms"](n))}_tinySDF(n,s,f){const m=this.localIdeographFontFamily;if(!m||!this._doesCharSupportLocalGlyph(f))return;let y=n.tinySDF;if(!y){let M="400";/bold/i.test(s)?M="900":/medium/i.test(s)?M="500":/light/i.test(s)&&(M="200"),y=n.tinySDF=new Ze.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:m,fontWeight:M})}const x=y.draw(String.fromCharCode(f));return{id:f,bitmap:new a.q({width:x.width||60,height:x.height||60},x.data),metrics:{width:x.glyphWidth/2||24,height:x.glyphHeight/2||24,left:x.glyphLeft/2+.5||0,top:x.glyphTop/2-27.5||-8,advance:x.glyphAdvance/2||24,isDoubleResolution:!0}}}}Ze.loadGlyphRange=function(_,n,s,f){return a._(this,void 0,void 0,function*(){const m=256*n,y=m+255,x=f.transformRequest(s.replace("{fontstack}",_).replace("{range}",`${m}-${y}`),"Glyphs"),M=yield a.n(x,new AbortController);if(!M||!M.data)throw new Error(`Could not load glyph range. range: ${n}, ${m}-${y}`);const E={};for(const z of a.o(M.data))E[z.id]=z;return E})},Ze.TinySDF=class{constructor({fontSize:_=24,buffer:n=3,radius:s=8,cutoff:f=.25,fontFamily:m="sans-serif",fontWeight:y="normal",fontStyle:x="normal"}={}){this.buffer=n,this.cutoff=f,this.radius=s;const M=this.size=_+4*n,E=this._createCanvas(M),z=this.ctx=E.getContext("2d",{willReadFrequently:!0});z.font=`${x} ${y} ${_}px ${m}`,z.textBaseline="alphabetic",z.textAlign="left",z.fillStyle="black",this.gridOuter=new Float64Array(M*M),this.gridInner=new Float64Array(M*M),this.f=new Float64Array(M),this.z=new Float64Array(M+1),this.v=new Uint16Array(M)}_createCanvas(_){const n=document.createElement("canvas");return n.width=n.height=_,n}draw(_){const{width:n,actualBoundingBoxAscent:s,actualBoundingBoxDescent:f,actualBoundingBoxLeft:m,actualBoundingBoxRight:y}=this.ctx.measureText(_),x=Math.ceil(s),M=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(y-m))),E=Math.min(this.size-this.buffer,x+Math.ceil(f)),z=M+2*this.buffer,B=E+2*this.buffer,j=Math.max(z*B,0),N=new Uint8ClampedArray(j),V={data:N,width:z,height:B,glyphWidth:M,glyphHeight:E,glyphTop:x,glyphLeft:0,glyphAdvance:n};if(M===0||E===0)return V;const{ctx:Q,buffer:se,gridInner:oe,gridOuter:le}=this;Q.clearRect(se,se,M,E),Q.fillText(_,se,se+x);const de=Q.getImageData(se,se,M,E);le.fill(Ie,0,j),oe.fill(0,0,j);for(let _e=0;_e<E;_e++)for(let me=0;me<M;me++){const xe=de.data[4*(_e*M+me)+3]/255;if(xe===0)continue;const Te=(_e+se)*z+me+se;if(xe===1)le[Te]=0,oe[Te]=Ie;else{const ge=.5-xe;le[Te]=ge>0?ge*ge:0,oe[Te]=ge<0?ge*ge:0}}ue(le,0,0,z,B,z,this.f,this.v,this.z),ue(oe,se,se,M,E,z,this.f,this.v,this.z);for(let _e=0;_e<j;_e++){const me=Math.sqrt(le[_e])-Math.sqrt(oe[_e]);N[_e]=Math.round(255-255*(me/this.radius+this.cutoff))}return V}};class Xe{constructor(){this.specification=a.v.light.position}possiblyEvaluate(n,s){return a.B(n.expression.evaluate(s))}interpolate(n,s,f){return{x:a.C.number(n.x,s.x,f),y:a.C.number(n.y,s.y,f),z:a.C.number(n.z,s.z,f)}}}let Re;class ot extends a.E{constructor(n){super(),Re=Re||new a.r({anchor:new a.D(a.v.light.anchor),position:new Xe,color:new a.D(a.v.light.color),intensity:new a.D(a.v.light.intensity)}),this._transitionable=new a.t(Re),this.setLight(n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,s={}){if(!this._validate(a.x,n,s))for(const f in n){const m=n[f];f.endsWith("-transition")?this._transitionable.setTransition(f.slice(0,-11),m):this._transitionable.setValue(f,m)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,s,f){return(!f||f.validate!==!1)&&a.y(this,n.call(a.z,{value:s,style:{glyphs:!0,sprite:!0},styleSpec:a.v}))}}const Pt=new a.r({"sky-color":new a.D(a.v.sky["sky-color"]),"horizon-color":new a.D(a.v.sky["horizon-color"]),"fog-color":new a.D(a.v.sky["fog-color"]),"fog-ground-blend":new a.D(a.v.sky["fog-ground-blend"]),"horizon-fog-blend":new a.D(a.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new a.D(a.v.sky["sky-horizon-blend"]),"atmosphere-blend":new a.D(a.v.sky["atmosphere-blend"])});class bt extends a.E{constructor(n){super(),this._transitionable=new a.t(Pt),this.setSky(n),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new a.F(0))}setSky(n,s={}){if(!this._validate(a.G,n,s)){n||(n={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const f in n){const m=n[f];f.endsWith("-transition")?this._transitionable.setTransition(f.slice(0,-11),m):this._transitionable.setValue(f,m)}}}getSky(){return this._transitionable.serialize()}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,s,f={}){return(f==null?void 0:f.validate)!==!1&&a.y(this,n.call(a.z,a.e({value:s,style:{glyphs:!0,sprite:!0},styleSpec:a.v})))}calculateFogBlendOpacity(n){return n<60?0:n<70?(n-60)/10:1}}class _t{constructor(n,s){this.width=n,this.height=s,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(n,s){const f=n.join(",")+String(s);return this.dashEntry[f]||(this.dashEntry[f]=this.addDash(n,s)),this.dashEntry[f]}getDashRanges(n,s,f){const m=[];let y=n.length%2==1?-n[n.length-1]*f:0,x=n[0]*f,M=!0;m.push({left:y,right:x,isDash:M,zeroLength:n[0]===0});let E=n[0];for(let z=1;z<n.length;z++){M=!M;const B=n[z];y=E*f,E+=B,x=E*f,m.push({left:y,right:x,isDash:M,zeroLength:B===0})}return m}addRoundDash(n,s,f){const m=s/2;for(let y=-f;y<=f;y++){const x=this.width*(this.nextRow+f+y);let M=0,E=n[M];for(let z=0;z<this.width;z++){z/E.right>1&&(E=n[++M]);const B=Math.abs(z-E.left),j=Math.abs(z-E.right),N=Math.min(B,j);let V;const Q=y/f*(m+1);if(E.isDash){const se=m-Math.abs(Q);V=Math.sqrt(N*N+se*se)}else V=m-Math.sqrt(N*N+Q*Q);this.data[x+z]=Math.max(0,Math.min(255,V+128))}}}addRegularDash(n){for(let M=n.length-1;M>=0;--M){const E=n[M],z=n[M+1];E.zeroLength?n.splice(M,1):z&&z.isDash===E.isDash&&(z.left=E.left,n.splice(M,1))}const s=n[0],f=n[n.length-1];s.isDash===f.isDash&&(s.left=f.left-this.width,f.right=s.right+this.width);const m=this.width*this.nextRow;let y=0,x=n[y];for(let M=0;M<this.width;M++){M/x.right>1&&(x=n[++y]);const E=Math.abs(M-x.left),z=Math.abs(M-x.right),B=Math.min(E,z);this.data[m+M]=Math.max(0,Math.min(255,(x.isDash?B:-B)+128))}}addDash(n,s){const f=s?7:0,m=2*f+1;if(this.nextRow+m>this.height)return a.w("LineAtlas out of space"),null;let y=0;for(let M=0;M<n.length;M++)y+=n[M];if(y!==0){const M=this.width/y,E=this.getDashRanges(n,this.width,M);s?this.addRoundDash(E,M,f):this.addRegularDash(E)}const x={y:(this.nextRow+f+.5)/this.height,height:2*f/this.height,width:y};return this.nextRow+=m,this.dirty=!0,x}bind(n){const s=n.gl;this.texture?(s.bindTexture(s.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,s.texSubImage2D(s.TEXTURE_2D,0,0,0,this.width,this.height,s.ALPHA,s.UNSIGNED_BYTE,this.data))):(this.texture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.ALPHA,this.width,this.height,0,s.ALPHA,s.UNSIGNED_BYTE,this.data))}}const tt="maplibre_preloaded_worker_pool";class Tt{constructor(){this.active={}}acquire(n){if(!this.workers)for(this.workers=[];this.workers.length<Tt.workerCount;)this.workers.push(new Worker(a.a.WORKER_URL));return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[tt]}numActive(){return Object.keys(this.active).length}}const ct=Math.floor(I.hardwareConcurrency/2);let mt,Xt;function Ut(){return mt||(mt=new Tt),mt}Tt.workerCount=a.H(globalThis)?Math.max(Math.min(ct,3),1):1;class St{constructor(n,s){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=s;const f=this.workerPool.acquire(s);for(let m=0;m<f.length;m++){const y=new a.J(f[m],s);y.name=`Worker ${m}`,this.actors.push(y)}if(!this.actors.length)throw new Error("No actors found")}broadcast(n,s){const f=[];for(const m of this.actors)f.push(m.sendAsync({type:n,data:s}));return Promise.all(f)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(n=!0){this.actors.forEach(s=>{s.remove()}),this.actors=[],n&&this.workerPool.release(this.id)}registerMessageHandler(n,s){for(const f of this.actors)f.registerMessageHandler(n,s)}}function pt(){return Xt||(Xt=new St(Ut(),a.K),Xt.registerMessageHandler("GR",(_,n,s)=>a.m(n,s))),Xt}function Ft(_,n){const s=a.L();return a.M(s,s,[1,1,0]),a.N(s,s,[.5*_.width,.5*_.height,1]),_.calculatePosMatrix?a.O(s,s,_.calculatePosMatrix(n.toUnwrapped())):s}function nt(_,n,s,f,m,y,x){var M;const E=function(N,V,Q){if(N)for(const se of N){const oe=V[se];if(oe&&oe.source===Q&&oe.type==="fill-extrusion")return!0}else for(const se in V){const oe=V[se];if(oe.source===Q&&oe.type==="fill-extrusion")return!0}return!1}((M=m==null?void 0:m.layers)!==null&&M!==void 0?M:null,n,_.id),z=y.maxPitchScaleFactor(),B=_.tilesIn(f,z,E);B.sort(De);const j=[];for(const N of B)j.push({wrappedTileID:N.tileID.wrapped().key,queryResults:N.tile.queryRenderedFeatures(n,s,_._state,N.queryGeometry,N.cameraQueryGeometry,N.scale,m,y,z,Ft(_.transform,N.tileID),x?(V,Q)=>x(N.tileID,V,Q):void 0)});return function(N,V){for(const Q in N)for(const se of N[Q])Ke(se,V);return N}(function(N){const V={},Q={};for(const se of N){const oe=se.queryResults,le=se.wrappedTileID,de=Q[le]=Q[le]||{};for(const _e in oe){const me=oe[_e],xe=de[_e]=de[_e]||{},Te=V[_e]=V[_e]||[];for(const ge of me)xe[ge.featureIndex]||(xe[ge.featureIndex]=!0,Te.push(ge))}}return V}(j),_)}function De(_,n){const s=_.tileID,f=n.tileID;return s.overscaledZ-f.overscaledZ||s.canonical.y-f.canonical.y||s.wrap-f.wrap||s.canonical.x-f.canonical.x}function Ke(_,n){const s=_.feature,f=n.getFeatureState(s.layer["source-layer"],s.id);s.source=s.layer.source,s.layer["source-layer"]&&(s.sourceLayer=s.layer["source-layer"]),s.state=f}function Be(_,n,s){return a._(this,void 0,void 0,function*(){let f=_;if(_.url?f=(yield a.j(n.transformRequest(_.url,"Source"),s)).data:yield I.frameAsync(s),!f)return null;const m=a.Q(a.e(f,_),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in f&&f.vector_layers&&(m.vectorLayerIds=f.vector_layers.map(y=>y.id)),m})}class wt{constructor(n,s){n&&(s?this.setSouthWest(n).setNorthEast(s):Array.isArray(n)&&(n.length===4?this.setSouthWest([n[0],n[1]]).setNorthEast([n[2],n[3]]):this.setSouthWest(n[0]).setNorthEast(n[1])))}setNorthEast(n){return this._ne=n instanceof a.S?new a.S(n.lng,n.lat):a.S.convert(n),this}setSouthWest(n){return this._sw=n instanceof a.S?new a.S(n.lng,n.lat):a.S.convert(n),this}extend(n){const s=this._sw,f=this._ne;let m,y;if(n instanceof a.S)m=n,y=n;else{if(!(n instanceof wt))return Array.isArray(n)?n.length===4||n.every(Array.isArray)?this.extend(wt.convert(n)):this.extend(a.S.convert(n)):n&&("lng"in n||"lon"in n)&&"lat"in n?this.extend(a.S.convert(n)):this;if(m=n._sw,y=n._ne,!m||!y)return this}return s||f?(s.lng=Math.min(m.lng,s.lng),s.lat=Math.min(m.lat,s.lat),f.lng=Math.max(y.lng,f.lng),f.lat=Math.max(y.lat,f.lat)):(this._sw=new a.S(m.lng,m.lat),this._ne=new a.S(y.lng,y.lat)),this}getCenter(){return new a.S((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new a.S(this.getWest(),this.getNorth())}getSouthEast(){return new a.S(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(n){const{lng:s,lat:f}=a.S.convert(n);let m=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=f&&f<=this._ne.lat&&m}static convert(n){return n instanceof wt?n:n&&new wt(n)}static fromLngLat(n,s=0){const f=360*s/40075017,m=f/Math.cos(Math.PI/180*n.lat);return new wt(new a.S(n.lng-m,n.lat-f),new a.S(n.lng+m,n.lat+f))}adjustAntiMeridian(){const n=new a.S(this._sw.lng,this._sw.lat),s=new a.S(this._ne.lng,this._ne.lat);return new wt(n,n.lng>s.lng?new a.S(s.lng+360,s.lat):s)}}class gt{constructor(n,s,f){this.bounds=wt.convert(this.validateBounds(n)),this.minzoom=s||0,this.maxzoom=f||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}contains(n){const s=Math.pow(2,n.z),f=Math.floor(a.V(this.bounds.getWest())*s),m=Math.floor(a.U(this.bounds.getNorth())*s),y=Math.ceil(a.V(this.bounds.getEast())*s),x=Math.ceil(a.U(this.bounds.getSouth())*s);return n.x>=f&&n.x<y&&n.y>=m&&n.y<x}}class Rt extends a.E{constructor(n,s,f,m){if(super(),this.id=n,this.dispatcher=f,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.e(this,a.Q(s,["url","scheme","tileSize","promoteId"])),this._options=a.e({type:"vector"},s),this._collectResourceTiming=s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m)}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const n=yield Be(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),n&&(a.e(this,n),n.bounds&&(this.tileBounds=new gt(n.bounds,this.minzoom,this.maxzoom)),this.fire(new a.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.l("data",{dataType:"source",sourceDataType:"content"})))}catch(n){this._tileJSONRequest=null,this.fire(new a.k(n))}})}loaded(){return this._loaded}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}onAdd(n){this.map=n,this.load()}setSourceProperty(n){this._tileJSONRequest&&this._tileJSONRequest.abort(),n(),this.load()}setTiles(n){return this.setSourceProperty(()=>{this._options.tiles=n}),this}setUrl(n){return this.setSourceProperty(()=>{this.url=n,this._options.url=n}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return a.e({},this._options)}loadTile(n){return a._(this,void 0,void 0,function*(){const s=n.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),f={request:this.map._requestManager.transformRequest(s,"Tile"),uid:n.uid,tileID:n.tileID,zoom:n.tileID.overscaledZ,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};f.request.collectResourceTiming=this._collectResourceTiming;let m="RT";if(n.actor&&n.state!=="expired"){if(n.state==="loading")return new Promise((y,x)=>{n.reloadPromise={resolve:y,reject:x}})}else n.actor=this.dispatcher.getActor(),m="LT";n.abortController=new AbortController;try{const y=yield n.actor.sendAsync({type:m,data:f},n.abortController);if(delete n.abortController,n.aborted)return;this._afterTileLoadWorkerResponse(n,y)}catch(y){if(delete n.abortController,n.aborted)return;if(y&&y.status!==404)throw y;this._afterTileLoadWorkerResponse(n,null)}})}_afterTileLoadWorkerResponse(n,s){if(s&&s.resourceTiming&&(n.resourceTiming=s.resourceTiming),s&&this.map._refreshExpiredTiles&&n.setExpiryData(s),n.loadVectorData(s,this.map.painter),n.reloadPromise){const f=n.reloadPromise;n.reloadPromise=null,this.loadTile(n).then(f.resolve).catch(f.reject)}}abortTile(n){return a._(this,void 0,void 0,function*(){n.abortController&&(n.abortController.abort(),delete n.abortController),n.actor&&(yield n.actor.sendAsync({type:"AT",data:{uid:n.uid,type:this.type,source:this.id}}))})}unloadTile(n){return a._(this,void 0,void 0,function*(){n.unloadVectorData(),n.actor&&(yield n.actor.sendAsync({type:"RMT",data:{uid:n.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class st extends a.E{constructor(n,s,f,m){super(),this.id=n,this.dispatcher=f,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.e({type:"raster"},s),a.e(this,a.Q(s,["url","scheme","tileSize"]))}load(){return a._(this,arguments,void 0,function*(n=!1){this._loaded=!1,this.fire(new a.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const s=yield Be(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,s&&(a.e(this,s),s.bounds&&(this.tileBounds=new gt(s.bounds,this.minzoom,this.maxzoom)),this.fire(new a.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:n})))}catch(s){this._tileJSONRequest=null,this.fire(new a.k(s))}})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(n){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),n(),this.load(!0)}setTiles(n){return this.setSourceProperty(()=>{this._options.tiles=n}),this}setUrl(n){return this.setSourceProperty(()=>{this.url=n,this._options.url=n}),this}serialize(){return a.e({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n){return a._(this,void 0,void 0,function*(){const s=n.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);n.abortController=new AbortController;try{const f=yield ee.getImage(this.map._requestManager.transformRequest(s,"Tile"),n.abortController,this.map._refreshExpiredTiles);if(delete n.abortController,n.aborted)return void(n.state="unloaded");if(f&&f.data){this.map._refreshExpiredTiles&&(f.cacheControl||f.expires)&&n.setExpiryData({cacheControl:f.cacheControl,expires:f.expires});const m=this.map.painter.context,y=m.gl,x=f.data;n.texture=this.map.painter.getTileTexture(x.width),n.texture?n.texture.update(x,{useMipmap:!0}):(n.texture=new a.T(m,x,y.RGBA,{useMipmap:!0}),n.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE,y.LINEAR_MIPMAP_NEAREST)),n.state="loaded"}}catch(f){if(delete n.abortController,n.aborted)n.state="unloaded";else if(f)throw n.state="errored",f}})}abortTile(n){return a._(this,void 0,void 0,function*(){n.abortController&&(n.abortController.abort(),delete n.abortController)})}unloadTile(n){return a._(this,void 0,void 0,function*(){n.texture&&this.map.painter.saveTileTexture(n.texture)})}hasTransition(){return!1}}class ht extends st{constructor(n,s,f,m){super(n,s,f,m),this.type="raster-dem",this.maxzoom=22,this._options=a.e({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox",this.redFactor=s.redFactor,this.greenFactor=s.greenFactor,this.blueFactor=s.blueFactor,this.baseShift=s.baseShift}loadTile(n){return a._(this,void 0,void 0,function*(){const s=n.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),f=this.map._requestManager.transformRequest(s,"Tile");n.neighboringTiles=this._getNeighboringTiles(n.tileID),n.abortController=new AbortController;try{const m=yield ee.getImage(f,n.abortController,this.map._refreshExpiredTiles);if(delete n.abortController,n.aborted)return void(n.state="unloaded");if(m&&m.data){const y=m.data;this.map._refreshExpiredTiles&&(m.cacheControl||m.expires)&&n.setExpiryData({cacheControl:m.cacheControl,expires:m.expires});const x=a.b(y)&&a.W()?y:yield this.readImageNow(y),M={type:this.type,uid:n.uid,source:this.id,rawImageData:x,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!n.actor||n.state==="expired"){n.actor=this.dispatcher.getActor();const E=yield n.actor.sendAsync({type:"LDT",data:M});n.dem=E,n.needsHillshadePrepare=!0,n.needsTerrainPrepare=!0,n.state="loaded"}}}catch(m){if(delete n.abortController,n.aborted)n.state="unloaded";else if(m)throw n.state="errored",m}})}readImageNow(n){return a._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&a.X()){const s=n.width+2,f=n.height+2;try{return new a.R({width:s,height:f},yield a.Y(n,-1,-1,s,f))}catch{}}return I.getImageData(n,1)})}_getNeighboringTiles(n){const s=n.canonical,f=Math.pow(2,s.z),m=(s.x-1+f)%f,y=s.x===0?n.wrap-1:n.wrap,x=(s.x+1+f)%f,M=s.x+1===f?n.wrap+1:n.wrap,E={};return E[new a.Z(n.overscaledZ,y,s.z,m,s.y).key]={backfilled:!1},E[new a.Z(n.overscaledZ,M,s.z,x,s.y).key]={backfilled:!1},s.y>0&&(E[new a.Z(n.overscaledZ,y,s.z,m,s.y-1).key]={backfilled:!1},E[new a.Z(n.overscaledZ,n.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},E[new a.Z(n.overscaledZ,M,s.z,x,s.y-1).key]={backfilled:!1}),s.y+1<f&&(E[new a.Z(n.overscaledZ,y,s.z,m,s.y+1).key]={backfilled:!1},E[new a.Z(n.overscaledZ,n.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},E[new a.Z(n.overscaledZ,M,s.z,x,s.y+1).key]={backfilled:!1}),E}unloadTile(n){return a._(this,void 0,void 0,function*(){n.demTexture&&this.map.painter.saveTileTexture(n.demTexture),n.fbo&&(n.fbo.destroy(),delete n.fbo),n.dem&&delete n.dem,delete n.neighboringTiles,n.state="unloaded",n.actor&&(yield n.actor.sendAsync({type:"RDT",data:{type:this.type,uid:n.uid,source:this.id}}))})}}class qe extends a.E{constructor(n,s,f,m){super(),this.id=n,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=f.getActor(),this.setEventedParent(m),this._data=s.data,this._options=a.e({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId,s.clusterMaxZoom!==void 0&&this.maxzoom<=s.clusterMaxZoom&&a.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${s.clusterMaxZoom}".`),this.workerOptions=a.e({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(s.buffer!==void 0?s.buffer:128),tolerance:this._pixelsToTileUnits(s.tolerance!==void 0?s.tolerance:.375),extent:a.$,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(s.clusterMaxZoom),minPoints:Math.max(2,s.clusterMinPoints||2),extent:a.$,radius:this._pixelsToTileUnits(s.clusterRadius||50),log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(n){return n*(a.$/this.tileSize)}_getClusterMaxZoom(n){const s=n?Math.round(n):this.maxzoom-1;return Number.isInteger(n)||n===void 0||a.w(`Integer expected for option 'clusterMaxZoom': provided value "${n}" rounded to "${s}"`),s}load(){return a._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(n){this.map=n,this.load()}setData(n){return this._data=n,this._updateWorkerData(),this}updateData(n){return this._updateWorkerData(n),this}getData(){return a._(this,void 0,void 0,function*(){const n=a.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:n})})}getCoordinatesFromGeometry(n){return n.type==="GeometryCollection"?n.geometries.map(s=>s.coordinates).flat(1/0):n.coordinates.flat(1/0)}getBounds(){return a._(this,void 0,void 0,function*(){const n=new wt,s=yield this.getData();let f;switch(s.type){case"FeatureCollection":f=s.features.map(m=>this.getCoordinatesFromGeometry(m.geometry)).flat(1/0);break;case"Feature":f=this.getCoordinatesFromGeometry(s.geometry);break;default:f=this.getCoordinatesFromGeometry(s)}if(f.length==0)return n;for(let m=0;m<f.length-1;m+=2)n.extend([f[m],f[m+1]]);return n})}setClusterOptions(n){return this.workerOptions.cluster=n.cluster,n&&(n.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(n.clusterRadius)),n.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(n.clusterMaxZoom))),this._updateWorkerData(),this}getClusterExpansionZoom(n){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:n,source:this.id}})}getClusterChildren(n){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:n,source:this.id}})}getClusterLeaves(n,s,f){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:n,limit:s,offset:f}})}_updateWorkerData(n){return a._(this,void 0,void 0,function*(){const s=a.e({type:this.type},this.workerOptions);n?s.dataDiff=n:typeof this._data=="string"?(s.request=this.map._requestManager.transformRequest(I.resolveURL(this._data),"Source"),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new a.l("dataloading",{dataType:"source"}));try{const f=yield this.actor.sendAsync({type:"LD",data:s});if(this._pendingLoads--,this._removed||f.abandoned)return void this.fire(new a.l("dataabort",{dataType:"source"}));let m=null;f.resourceTiming&&f.resourceTiming[this.id]&&(m=f.resourceTiming[this.id].slice(0));const y={dataType:"source"};this._collectResourceTiming&&m&&m.length>0&&a.e(y,{resourceTiming:m}),this.fire(new a.l("data",Object.assign(Object.assign({},y),{sourceDataType:"metadata"}))),this.fire(new a.l("data",Object.assign(Object.assign({},y),{sourceDataType:"content"})))}catch(f){if(this._pendingLoads--,this._removed)return void this.fire(new a.l("dataabort",{dataType:"source"}));this.fire(new a.k(f))}})}loaded(){return this._pendingLoads===0}loadTile(n){return a._(this,void 0,void 0,function*(){const s=n.actor?"RT":"LT";n.actor=this.actor;const f={type:this.type,uid:n.uid,tileID:n.tileID,zoom:n.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};n.abortController=new AbortController;const m=yield this.actor.sendAsync({type:s,data:f},n.abortController);delete n.abortController,n.unloadVectorData(),n.aborted||n.loadVectorData(m,this.map.painter,s==="RT")})}abortTile(n){return a._(this,void 0,void 0,function*(){n.abortController&&(n.abortController.abort(),delete n.abortController),n.aborted=!0})}unloadTile(n){return a._(this,void 0,void 0,function*(){n.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:n.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return a.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class Mt extends a.E{constructor(n,s,f,m){super(),this.flippedWindingOrder=!1,this.id=n,this.dispatcher=f,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(m),this.options=s}load(n){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const s=yield ee.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,s&&s.data&&(this.image=s.data,n&&(this.coordinates=n),this._finishLoading())}catch(s){this._request=null,this._loaded=!0,this.fire(new a.k(s))}})}loaded(){return this._loaded}updateImage(n){return n.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=n.url,this.load(n.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(n){this.coordinates=n;const s=n.map(a.a0.fromLngLat);var f;return this.tileID=function(m){const y=a.a1.fromPoints(m),x=y.width(),M=y.height(),E=Math.max(x,M),z=Math.max(0,Math.floor(-Math.log(E)/Math.LN2)),B=Math.pow(2,z);return new a.a3(z,Math.floor((y.minX+y.maxX)/2*B),Math.floor((y.minY+y.maxY)/2*B))}(s),this.terrainTileRanges=this._getOverlappingTileRanges(s),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=s.map(m=>this.tileID.getTilePoint(m)._round()),this.flippedWindingOrder=((f=this.tileCoords)[1].x-f[0].x)*(f[2].y-f[0].y)-(f[1].y-f[0].y)*(f[2].x-f[0].x)<0,this.fire(new a.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const n=this.map.painter.context,s=n.gl;this.texture||(this.texture=new a.T(n,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let f=!1;for(const m in this.tiles){const y=this.tiles[m];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,f=!0)}f&&this.fire(new a.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(n){return a._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={}):n.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(n){const{minX:s,minY:f,maxX:m,maxY:y}=a.a1.fromPoints(n),x={};for(let M=0;M<=a.a2;M++){const E=Math.pow(2,M),z=Math.floor(s*E),B=Math.floor(f*E),j=Math.floor(m*E),N=Math.floor(y*E);x[M]={minTileX:z,minTileY:B,maxTileX:j,maxTileY:N}}return x}}class Ht extends Mt{constructor(n,s,f,m){super(n,s,f,m),this.roundZoom=!0,this.type="video",this.options=s}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1;const n=this.options;this.urls=[];for(const s of n.urls)this.urls.push(this.map._requestManager.transformRequest(s,"Source").url);try{const s=yield a.a4(this.urls);if(this._loaded=!0,!s)return;this.video=s,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(s){this.fire(new a.k(s))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(n){if(this.video){const s=this.video.seekable;n<s.start(0)||n>s.end(0)?this.fire(new a.k(new a.a5(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=n}}getVideo(){return this.video}onAdd(n){this.map||(this.map=n,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const n=this.map.painter.context,s=n.gl;this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new a.T(n,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let f=!1;for(const m in this.tiles){const y=this.tiles[m];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,f=!0)}f&&this.fire(new a.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class _n extends Mt{constructor(n,s,f,m){super(n,s,f,m),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(y=>!Array.isArray(y)||y.length!==2||y.some(x=>typeof x!="number"))||this.fire(new a.k(new a.a5(`sources.${n}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.k(new a.a5(`sources.${n}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new a.k(new a.a5(`sources.${n}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new a.k(new a.a5(`sources.${n}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.k(new a.a5(`sources.${n}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){return a._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(n){this.map=n,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let n=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,n=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,n=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context,f=s.gl;this.texture?(n||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new a.T(s,this.canvas,f.RGBA,{premultiply:!0});let m=!1;for(const y in this.tiles){const x=this.tiles[y];x.state!=="loaded"&&(x.state="loaded",x.texture=this.texture,m=!0)}m&&this.fire(new a.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const n of[this.canvas.width,this.canvas.height])if(isNaN(n)||n<=0)return!0;return!1}}const In={},yt=_=>{switch(_){case"geojson":return qe;case"image":return Mt;case"raster":return st;case"raster-dem":return ht;case"vector":return Rt;case"video":return Ht;case"canvas":return _n}return In[_]},qt="RTLPluginLoaded";class Nt extends a.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=pt()}_syncState(n){return this.status=n,this.dispatcher.broadcast("SRPS",{pluginStatus:n,pluginURL:this.url}).catch(s=>{throw this.status="error",s})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(n){return a._(this,arguments,void 0,function*(s,f=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=I.resolveURL(s),!this.url)throw new Error(`requested url ${s} is invalid`);if(this.status==="unavailable"){if(!f)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return a._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new a.l(qt))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let fn=null;function yn(){return fn||(fn=new Nt),fn}class On{constructor(n,s){this.timeAdded=0,this.fadeEndTime=0,this.tileID=n,this.uid=a.a6(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(n){const s=n+this.timeAdded;s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(n){this.demTexture&&n.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(n,s,f){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",n){n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=function(m,y){const x={};if(!y)return x;for(const M of m){const E=M.layerIds.map(z=>y.getLayer(z)).filter(Boolean);if(E.length!==0){M.layers=E,M.stateDependentLayerIds&&(M.stateDependentLayers=M.stateDependentLayerIds.map(z=>E.filter(B=>B.id===z)[0]));for(const z of E)x[z.id]=M}}return x}(n.buckets,s==null?void 0:s.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const y=this.buckets[m];if(y instanceof a.a8){if(this.hasSymbolBuckets=!0,!f)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const y=this.buckets[m];if(y instanceof a.a8&&y.hasRTLText){this.hasRTLText=!0,yn().lazyLoad();break}}this.queryPadding=0;for(const m in this.buckets){const y=this.buckets[m];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(m).queryRadius(y))}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage)}else this.collisionBoxArray=new a.a7}unloadVectorData(){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(n){return this.buckets[n.id]}upload(n){for(const f in this.buckets){const m=this.buckets[f];m.uploadPending()&&m.upload(n)}const s=n.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new a.T(n,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new a.T(n,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null)}prepare(n){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture)}queryRenderedFeatures(n,s,f,m,y,x,M,E,z,B,j){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:m,cameraQueryGeometry:y,scale:x,tileSize:this.tileSize,pixelPosMatrix:B,transform:E,params:M,queryPadding:this.queryPadding*z,getElevation:j},n,s,f):{}}querySourceFeatures(n,s){const f=this.latestFeatureIndex;if(!f||!f.rawTileData)return;const m=f.loadVTLayers(),y=s&&s.sourceLayer?s.sourceLayer:"",x=m._geojsonTileLayer||m[y];if(!x)return;const M=a.a9(s&&s.filter),{z:E,x:z,y:B}=this.tileID.canonical,j={z:E,x:z,y:B};for(let N=0;N<x.length;N++){const V=x.feature(N);if(M.needGeometry){const oe=a.aa(V,!0);if(!M.filter(new a.F(this.tileID.overscaledZ),oe,this.tileID.canonical))continue}else if(!M.filter(new a.F(this.tileID.overscaledZ),V))continue;const Q=f.getId(V,y),se=new a.ab(V,E,z,B,Q);se.tile=j,n.push(se)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(n){const s=this.expirationTime;if(n.cacheControl){const f=a.ac(n.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){const f=Date.now();let m=!1;if(this.expirationTime>f)m=!1;else if(s)if(this.expirationTime<s)m=!0;else{const y=this.expirationTime-s;y?this.expirationTime=f+Math.max(y,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(n,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(n).length===0)return;const f=this.latestFeatureIndex.loadVTLayers();for(const m in this.buckets){if(!s.style.hasLayer(m))continue;const y=this.buckets[m],x=y.layers[0].sourceLayer||"_geojsonTileLayer",M=f[x],E=n[x];if(!M||!E||Object.keys(E).length===0)continue;y.update(E,M,this.imageAtlas&&this.imageAtlas.patternPositions||{});const z=s&&s.style&&s.style.getLayer(m);z&&(this.queryPadding=Math.max(this.queryPadding,z.queryRadius(y)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<I.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(n){this.symbolFadeHoldUntil=I.now()+n}setDependencies(n,s){const f={};for(const m of s)f[m]=!0;this.dependencies[n]=f}hasDependency(n,s){for(const f of n){const m=this.dependencies[f];if(m){for(const y of s)if(m[y])return!0}}return!1}}class Mi{constructor(n,s){this.max=n,this.onRemove=s,this.reset()}reset(){for(const n in this.data)for(const s of this.data[n])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(n,s,f){const m=n.wrapped().key;this.data[m]===void 0&&(this.data[m]=[]);const y={value:s,timeout:void 0};if(f!==void 0&&(y.timeout=setTimeout(()=>{this.remove(n,y)},f)),this.data[m].push(y),this.order.push(m),this.order.length>this.max){const x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const s=this.data[n].shift();return s.timeout&&clearTimeout(s.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),s.value}getByKey(n){const s=this.data[n];return s?s[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,s){if(!this.has(n))return this;const f=n.wrapped().key,m=s===void 0?0:this.data[f].indexOf(s),y=this.data[f][m];return this.data[f].splice(m,1),y.timeout&&clearTimeout(y.timeout),this.data[f].length===0&&delete this.data[f],this.onRemove(y.value),this.order.splice(this.order.indexOf(f),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(n){const s=[];for(const f in this.data)for(const m of this.data[f])n(m.value)||s.push(m);for(const f of s)this.remove(f.value.tileID,f)}}class $n{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(n,s,f){const m=String(s);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][m]=this.stateChanges[n][m]||{},a.e(this.stateChanges[n][m],f),this.deletedStates[n]===null){this.deletedStates[n]={};for(const y in this.state[n])y!==m&&(this.deletedStates[n][y]=null)}else if(this.deletedStates[n]&&this.deletedStates[n][m]===null){this.deletedStates[n][m]={};for(const y in this.state[n][m])f[y]||(this.deletedStates[n][m][y]=null)}else for(const y in f)this.deletedStates[n]&&this.deletedStates[n][m]&&this.deletedStates[n][m][y]===null&&delete this.deletedStates[n][m][y]}removeFeatureState(n,s,f){if(this.deletedStates[n]===null)return;const m=String(s);if(this.deletedStates[n]=this.deletedStates[n]||{},f&&s!==void 0)this.deletedStates[n][m]!==null&&(this.deletedStates[n][m]=this.deletedStates[n][m]||{},this.deletedStates[n][m][f]=null);else if(s!==void 0)if(this.stateChanges[n]&&this.stateChanges[n][m])for(f in this.deletedStates[n][m]={},this.stateChanges[n][m])this.deletedStates[n][m][f]=null;else this.deletedStates[n][m]=null;else this.deletedStates[n]=null}getState(n,s){const f=String(s),m=a.e({},(this.state[n]||{})[f],(this.stateChanges[n]||{})[f]);if(this.deletedStates[n]===null)return{};if(this.deletedStates[n]){const y=this.deletedStates[n][s];if(y===null)return{};for(const x in y)delete m[x]}return m}initializeTileState(n,s){n.setFeatureState(this.state,s)}coalesceChanges(n,s){const f={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const y={};for(const x in this.stateChanges[m])this.state[m][x]||(this.state[m][x]={}),a.e(this.state[m][x],this.stateChanges[m][x]),y[x]=this.state[m][x];f[m]=y}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const y={};if(this.deletedStates[m]===null)for(const x in this.state[m])y[x]={},this.state[m][x]={};else for(const x in this.deletedStates[m]){if(this.deletedStates[m][x]===null)this.state[m][x]={};else for(const M of Object.keys(this.deletedStates[m][x]))delete this.state[m][x][M];y[x]=this.state[m][x]}f[m]=f[m]||{},a.e(f[m],y)}if(this.stateChanges={},this.deletedStates={},Object.keys(f).length!==0)for(const m in n)n[m].setFeatureState(f,s)}}const wi=89.25;function Ce(_,n){const s=a.ag(n.lat,-a.ah,a.ah);return new a.P(a.V(n.lng)*_,a.U(s)*_)}function X(_,n){return new a.a0(n.x/_,n.y/_).toLngLat()}function K(_){return _.cameraToCenterDistance*Math.min(.85*Math.tan(a.ad(90-_.pitch)),Math.tan(a.ad(wi-_.pitch)))}function te(_,n){const s=_.canonical,f=n/a.ae(s.z),m=s.x+Math.pow(2,s.z)*_.wrap,y=a.af(new Float64Array(16));return a.M(y,y,[m*f,s.y*f,0]),a.N(y,y,[f/a.$,f/a.$,1]),y}function pe(_,n,s,f,m){const y=a.a0.fromLngLat(_,n),x=m*a.ai(1,_.lat),M=x*Math.cos(a.ad(s)),E=Math.sqrt(x*x-M*M),z=E*Math.sin(a.ad(-f)),B=E*Math.cos(a.ad(-f));return new a.a0(y.x+z,y.y+B,y.z+M)}function we(_,n,s){const f=n.intersectsFrustum(_);if(!s||f===0)return f;const m=n.intersectsPlane(s);return m===0?0:f===2&&m===2?2:1}function Ee(_,n,s){let f=0;const m=(s-n)/10;for(let y=0;y<10;y++)f+=m*Math.pow(Math.cos(n+(y+.5)/10*(s-n)),_);return f}function Fe(_,n){return function(s,f,m,y,x){const M=2*((_-1)/a.aj(Math.cos(a.ad(wi-x))/Math.cos(a.ad(wi)))-1),E=Math.acos(m/y),z=2*Ee(M-1,0,a.ad(x/2)),B=Math.min(a.ad(wi),E+a.ad(x/2)),j=Ee(M-1,Math.min(B,E-a.ad(x/2)),B),N=Math.atan(f/m),V=Math.hypot(f,m);let Q=s;return Q+=a.aj(y/V/Math.max(.5,Math.cos(a.ad(x/2)))),Q+=M*a.aj(Math.cos(N))/2,Q-=a.aj(Math.max(1,j/z/n))/2,Q}}const Pe=Fe(9.314,3);function He(_,n){const s=(n.roundZoom?Math.round:Math.floor)(_.zoom+a.aj(_.tileSize/n.tileSize));return Math.max(0,s)}function Ge(_,n){const s=_.getCameraFrustum(),f=_.getClippingPlane(),m=_.screenPointToMercatorCoordinate(_.getCameraPoint()),y=a.a0.fromLngLat(_.center,_.elevation);m.z=y.z+Math.cos(_.pitchInRadians)*_.cameraToCenterDistance/_.worldSize;const x=_.getCoveringTilesDetailsProvider(),M=x.allowVariableZoom(_,n),E=He(_,n),z=n.minzoom||0,B=n.maxzoom!==void 0?n.maxzoom:_.maxZoom,j=Math.min(Math.max(0,E),B),N=Math.pow(2,j),V=[N*m.x,N*m.y,0],Q=[N*y.x,N*y.y,0],se=Math.hypot(y.x-m.x,y.y-m.y),oe=Math.abs(y.z-m.z),le=Math.hypot(se,oe),de=xe=>({zoom:0,x:0,y:0,wrap:xe,fullyVisible:!1}),_e=[],me=[];if(_.renderWorldCopies&&x.allowWorldCopies())for(let xe=1;xe<=3;xe++)_e.push(de(-xe)),_e.push(de(xe));for(_e.push(de(0));_e.length>0;){const xe=_e.pop(),Te=xe.x,ge=xe.y;let ze=xe.fullyVisible;const $e={x:Te,y:ge,z:xe.zoom},Ne=x.getTileBoundingVolume($e,xe.wrap,_.elevation,n);if(!ze){const Ct=we(s,Ne,f);if(Ct===0)continue;ze=Ct===2}const je=x.distanceToTile2d(m.x,m.y,$e,Ne);let We=E;M&&(We=(n.calculateTileZoom||Pe)(_.zoom+a.aj(_.tileSize/n.tileSize),je,oe,le,_.fov)),We=(n.roundZoom?Math.round:Math.floor)(We),We=Math.max(0,We);const zt=Math.min(We,B);if(xe.wrap=x.getWrap(y,$e,xe.wrap),xe.zoom>=zt){if(xe.zoom<z)continue;const Ct=j-xe.zoom,ft=V[0]-.5-(Te<<Ct),Wt=V[1]-.5-(ge<<Ct),Mn=n.reparseOverscaled?Math.max(xe.zoom,We):xe.zoom;me.push({tileID:new a.Z(xe.zoom===B?Mn:xe.zoom,xe.wrap,xe.zoom,Te,ge),distanceSq:a.ak([Q[0]-.5-Te,Q[1]-.5-ge]),tileDistanceToCamera:Math.sqrt(ft*ft+Wt*Wt)})}else for(let Ct=0;Ct<4;Ct++)_e.push({zoom:xe.zoom+1,x:(Te<<1)+Ct%2,y:(ge<<1)+(Ct>>1),wrap:xe.wrap,fullyVisible:ze})}return me.sort((xe,Te)=>xe.distanceSq-Te.distanceSq).map(xe=>xe.tileID)}const Le=a.a1.fromPoints([new a.P(0,0),new a.P(a.$,a.$)]);class Je extends a.E{constructor(n,s,f){super(),this.id=n,this.dispatcher=f,this.on("data",m=>this._dataHandler(m)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((m,y,x,M)=>{const E=new(yt(y.type))(m,y,x,M);if(E.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${E.id}`);return E})(n,s,f,this),this._tiles={},this._cache=new Mi(0,m=>this._unloadTile(m)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new $n,this._didEmitContent=!1,this._updated=!1}onAdd(n){this.map=n,this._maxTileCacheSize=n?n._maxTileCacheSize:null,this._maxTileCacheZoomLevels=n?n._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(n)}onRemove(n){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(n)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const n in this._tiles){const s=this._tiles[n];if(s.state!=="loaded"&&s.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const n=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,n&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(n,s,f){return a._(this,void 0,void 0,function*(){try{yield this._source.loadTile(n),this._tileLoaded(n,s,f)}catch(m){n.state="errored",m.status!==404?this._source.fire(new a.k(m,{tile:n})):this.update(this.transform,this.terrain)}})}_unloadTile(n){this._source.unloadTile&&this._source.unloadTile(n)}_abortTile(n){this._source.abortTile&&this._source.abortTile(n),this._source.fire(new a.l("dataabort",{tile:n,coord:n.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(n){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const f=this._tiles[s];f.upload(n),f.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(n=>n.tileID).sort(Ae).map(n=>n.key)}getRenderableIds(n){const s=[];for(const f in this._tiles)this._isIdRenderable(f,n)&&s.push(this._tiles[f]);return n?s.sort((f,m)=>{const y=f.tileID,x=m.tileID,M=new a.P(y.canonical.x,y.canonical.y)._rotate(-this.transform.bearingInRadians),E=new a.P(x.canonical.x,x.canonical.y)._rotate(-this.transform.bearingInRadians);return y.overscaledZ-x.overscaledZ||E.y-M.y||E.x-M.x}).map(f=>f.tileID.key):s.map(f=>f.tileID).sort(Ae).map(f=>f.key)}hasRenderableParent(n){const s=this.findLoadedParent(n,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(n,s){return this._tiles[n]&&this._tiles[n].hasData()&&!this._coveredTiles[n]&&(s||!this._tiles[n].holdingForFade())}reload(n){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const s in this._tiles)n?this._reloadTile(s,"expired"):this._tiles[s].state!=="errored"&&this._reloadTile(s,"reloading")}}_reloadTile(n,s){return a._(this,void 0,void 0,function*(){const f=this._tiles[n];f&&(f.state!=="loading"&&(f.state=s),yield this._loadTile(f,n,s))})}_tileLoaded(n,s,f){n.timeAdded=I.now(),f==="expired"&&(n.refreshedUponExpiration=!0),this._setTileReloadTimer(s,n),this.getSource().type==="raster-dem"&&n.dem&&this._backfillDEM(n),this._state.initializeTileState(n,this.map?this.map.painter:null),n.aborted||this._source.fire(new a.l("data",{dataType:"source",tile:n,coord:n.tileID}))}_backfillDEM(n){const s=this.getRenderableIds();for(let m=0;m<s.length;m++){const y=s[m];if(n.neighboringTiles&&n.neighboringTiles[y]){const x=this.getTileByID(y);f(n,x),f(x,n)}}function f(m,y){m.needsHillshadePrepare=!0,m.needsTerrainPrepare=!0;let x=y.tileID.canonical.x-m.tileID.canonical.x;const M=y.tileID.canonical.y-m.tileID.canonical.y,E=Math.pow(2,m.tileID.canonical.z),z=y.tileID.key;x===0&&M===0||Math.abs(M)>1||(Math.abs(x)>1&&(Math.abs(x+E)===1?x+=E:Math.abs(x-E)===1&&(x-=E)),y.dem&&m.dem&&(m.dem.backfillBorder(y.dem,x,M),m.neighboringTiles&&m.neighboringTiles[z]&&(m.neighboringTiles[z].backfilled=!0)))}}getTile(n){return this.getTileByID(n.key)}getTileByID(n){return this._tiles[n]}_retainLoadedChildren(n,s,f,m){for(const y in this._tiles){let x=this._tiles[y];if(m[y]||!x.hasData()||x.tileID.overscaledZ<=s||x.tileID.overscaledZ>f)continue;let M=x.tileID;for(;x&&x.tileID.overscaledZ>s+1;){const z=x.tileID.scaledTo(x.tileID.overscaledZ-1);x=this._tiles[z.key],x&&x.hasData()&&(M=z)}let E=M;for(;E.overscaledZ>s;)if(E=E.scaledTo(E.overscaledZ-1),n[E.key]||n[E.canonical.key]){m[M.key]=M;break}}}findLoadedParent(n,s){if(n.key in this._loadedParentTiles){const f=this._loadedParentTiles[n.key];return f&&f.tileID.overscaledZ>=s?f:null}for(let f=n.overscaledZ-1;f>=s;f--){const m=n.scaledTo(f),y=this._getLoadedTile(m);if(y)return y}}findLoadedSibling(n){return this._getLoadedTile(n)}_getLoadedTile(n){const s=this._tiles[n.key];return s&&s.hasData()?s:this._cache.getByKey(n.wrapped().key)}updateCacheSize(n){const s=Math.ceil(n.width/this._source.tileSize)+1,f=Math.ceil(n.height/this._source.tileSize)+1,m=Math.floor(s*f*(this._maxTileCacheZoomLevels===null?a.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),y=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(y)}handleWrapJump(n){const s=Math.round((n-(this._prevLng===void 0?n:this._prevLng))/360);if(this._prevLng=n,s){const f={};for(const m in this._tiles){const y=this._tiles[m];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+s),f[y.tileID.key]=y}this._tiles=f;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(m,this._tiles[m])}}_updateCoveredAndRetainedTiles(n,s,f,m,y,x){const M={},E={},z=Object.keys(n),B=I.now();for(const j of z){const N=n[j],V=this._tiles[j];if(!V||V.fadeEndTime!==0&&V.fadeEndTime<=B)continue;const Q=this.findLoadedParent(N,s),se=this.findLoadedSibling(N),oe=Q||se||null;oe&&(this._addTile(oe.tileID),M[oe.tileID.key]=oe.tileID),E[j]=N}this._retainLoadedChildren(E,m,f,n);for(const j in M)n[j]||(this._coveredTiles[j]=!0,n[j]=M[j]);if(x){const j={},N={};for(const V of y)this._tiles[V.key].hasData()?j[V.key]=V:N[V.key]=V;for(const V in N){const Q=N[V].children(this._source.maxzoom);this._tiles[Q[0].key]&&this._tiles[Q[1].key]&&this._tiles[Q[2].key]&&this._tiles[Q[3].key]&&(j[Q[0].key]=n[Q[0].key]=Q[0],j[Q[1].key]=n[Q[1].key]=Q[1],j[Q[2].key]=n[Q[2].key]=Q[2],j[Q[3].key]=n[Q[3].key]=Q[3],delete N[V])}for(const V in N){const Q=N[V],se=this.findLoadedParent(Q,this._source.minzoom),oe=this.findLoadedSibling(Q),le=se||oe||null;if(le){j[le.tileID.key]=n[le.tileID.key]=le.tileID;for(const de in j)j[de].isChildOf(le.tileID)&&delete j[de]}}for(const V in this._tiles)j[V]||(this._coveredTiles[V]=!0)}}update(n,s){if(!this._sourceLoaded||this._paused)return;let f;this.transform=n,this.terrain=s,this.updateCacheSize(n),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?f=n.getVisibleUnwrappedCoordinates(this._source.tileID).map(B=>new a.Z(B.canonical.z,B.wrap,B.canonical.z,B.canonical.x,B.canonical.y)):(f=Ge(n,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:s,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(f=f.filter(B=>this._source.hasTile(B)))):f=[];const m=He(n,this._source),y=Math.max(m-Je.maxOverzooming,this._source.minzoom),x=Math.max(m+Je.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const B={};for(const j of f)if(j.canonical.z>this._source.minzoom){const N=j.scaledTo(j.canonical.z-1);B[N.key]=N;const V=j.scaledTo(Math.max(this._source.minzoom,Math.min(j.canonical.z,5)));B[V.key]=V}f=f.concat(Object.values(B))}const M=f.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,M&&this.fire(new a.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const E=this._updateRetainedTiles(f,m);Lt(this._source.type)&&this._updateCoveredAndRetainedTiles(E,y,x,m,f,s);for(const B in E)this._tiles[B].clearFadeHold();const z=a.al(this._tiles,E);for(const B of z){const j=this._tiles[B];j.hasSymbolBuckets&&!j.holdingForFade()?j.setHoldDuration(this.map._fadeDuration):j.hasSymbolBuckets&&!j.symbolFadeFinished()||this._removeTile(B)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const n in this._tiles)this._tiles[n].holdingForFade()&&this._removeTile(n)}_updateRetainedTiles(n,s){var f;const m={},y={},x=Math.max(s-Je.maxOverzooming,this._source.minzoom),M=Math.max(s+Je.maxUnderzooming,this._source.minzoom),E={};for(const z of n){const B=this._addTile(z);m[z.key]=z,B.hasData()||s<this._source.maxzoom&&(E[z.key]=z)}this._retainLoadedChildren(E,s,M,m);for(const z of n){let B=this._tiles[z.key];if(B.hasData())continue;if(s+1>this._source.maxzoom){const N=z.children(this._source.maxzoom)[0],V=this.getTile(N);if(V&&V.hasData()){m[N.key]=N;continue}}else{const N=z.children(this._source.maxzoom);if(m[N[0].key]&&m[N[1].key]&&m[N[2].key]&&m[N[3].key])continue}let j=B.wasRequested();for(let N=z.overscaledZ-1;N>=x;--N){const V=z.scaledTo(N);if(y[V.key])break;if(y[V.key]=!0,B=this.getTile(V),!B&&j&&(B=this._addTile(V)),B){const Q=B.hasData();if((Q||!(!((f=this.map)===null||f===void 0)&&f.cancelPendingTileRequestsWhileZooming)||j)&&(m[V.key]=V),j=B.wasRequested(),Q)break}}}return m}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const n in this._tiles){const s=[];let f,m=this._tiles[n].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){f=this._loadedParentTiles[m.key];break}s.push(m.key);const y=m.scaledTo(m.overscaledZ-1);if(f=this._getLoadedTile(y),f)break;m=y}for(const y of s)this._loadedParentTiles[y]=f}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const n in this._tiles){const s=this._tiles[n].tileID,f=this._getLoadedTile(s);this._loadedSiblingTiles[s.key]=f}}_addTile(n){let s=this._tiles[n.key];if(s)return s;s=this._cache.getAndRemove(n),s&&(this._setTileReloadTimer(n.key,s),s.tileID=n,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[n.key]&&(clearTimeout(this._cacheTimers[n.key]),delete this._cacheTimers[n.key],this._setTileReloadTimer(n.key,s)));const f=s;return s||(s=new On(n,this._source.tileSize*n.overscaleFactor()),this._loadTile(s,n.key,s.state)),s.uses++,this._tiles[n.key]=s,f||this._source.fire(new a.l("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s}_setTileReloadTimer(n,s){n in this._timers&&(clearTimeout(this._timers[n]),delete this._timers[n]);const f=s.getExpiryTimeout();f&&(this._timers[n]=setTimeout(()=>{this._reloadTile(n,"expired"),delete this._timers[n]},f))}refreshTiles(n){for(const s in this._tiles)(this._isIdRenderable(s)||this._tiles[s].state=="errored")&&n.some(f=>f.equals(this._tiles[s].tileID.canonical))&&this._reloadTile(s,"expired")}_removeTile(n){const s=this._tiles[n];s&&(s.uses--,delete this._tiles[n],this._timers[n]&&(clearTimeout(this._timers[n]),delete this._timers[n]),s.uses>0||(s.hasData()&&s.state!=="reloading"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}_dataHandler(n){const s=n.sourceDataType;n.dataType==="source"&&s==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&n.dataType==="source"&&s==="content"&&(this.reload(n.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const n in this._tiles)this._removeTile(n);this._cache.reset()}tilesIn(n,s,f){const m=[],y=this.transform;if(!y)return m;const x=y.getCoveringTilesDetailsProvider().allowWorldCopies(),M=f?y.getCameraQueryGeometry(n):n,E=V=>y.screenPointToMercatorCoordinate(V,this.terrain),z=this.transformBbox(n,E,!x),B=this.transformBbox(M,E,!x),j=this.getIds(),N=a.a1.fromPoints(B);for(let V=0;V<j.length;V++){const Q=this._tiles[j[V]];if(Q.holdingForFade())continue;const se=x?[Q.tileID]:[Q.tileID.unwrapTo(-1),Q.tileID.unwrapTo(0)],oe=Math.pow(2,y.zoom-Q.tileID.overscaledZ),le=s*Q.queryPadding*a.$/Q.tileSize/oe;for(const de of se){const _e=N.map(me=>de.getTilePoint(new a.a0(me.x,me.y)));if(_e.expandBy(le),_e.intersects(Le)){const me=z.map(Te=>de.getTilePoint(Te)),xe=B.map(Te=>de.getTilePoint(Te));m.push({tile:Q,tileID:x?de:de.unwrapTo(0),queryGeometry:me,cameraQueryGeometry:xe,scale:oe})}}}return m}transformBbox(n,s,f){let m=n.map(s);if(f){const y=a.a1.fromPoints(n);y.shrinkBy(.001*Math.min(y.width(),y.height()));const x=y.map(s);a.a1.fromPoints(m).covers(x)||(m=m.map(M=>M.x>.5?new a.a0(M.x-1,M.y,M.z):M))}return m}getVisibleCoordinates(n){const s=this.getRenderableIds(n).map(f=>this._tiles[f].tileID);return this.transform&&this.transform.populateCache(s),s}hasTransition(){if(this._source.hasTransition())return!0;if(Lt(this._source.type)){const n=I.now();for(const s in this._tiles)if(this._tiles[s].fadeEndTime>=n)return!0}return!1}setFeatureState(n,s,f){this._state.updateState(n=n||"_geojsonTileLayer",s,f)}removeFeatureState(n,s,f){this._state.removeFeatureState(n=n||"_geojsonTileLayer",s,f)}getFeatureState(n,s){return this._state.getState(n=n||"_geojsonTileLayer",s)}setDependencies(n,s,f){const m=this._tiles[n];m&&m.setDependencies(s,f)}reloadTilesForDependencies(n,s){for(const f in this._tiles)this._tiles[f].hasDependency(n,s)&&this._reloadTile(f,"reloading");this._cache.filter(f=>!f.hasDependency(n,s))}}function Ae(_,n){const s=Math.abs(2*_.wrap)-+(_.wrap<0),f=Math.abs(2*n.wrap)-+(n.wrap<0);return _.overscaledZ-n.overscaledZ||f-s||n.canonical.y-_.canonical.y||n.canonical.x-_.canonical.x}function Lt(_){return _==="raster"||_==="image"||_==="video"}Je.maxOverzooming=10,Je.maxUnderzooming=3;class nn{constructor(n,s){this.reset(n,s)}reset(n,s){this.points=n||[],this._distances=[0];for(let f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=a.ag(n,0,1);let s=1,f=this._distances[s];const m=n*this.paddedLength+this.padding;for(;f<m&&s<this._distances.length;)f=this._distances[++s];const y=s-1,x=this._distances[y],M=f-x,E=M>0?(m-x)/M:0;return this.points[y].mult(1-E).add(this.points[s].mult(E))}}function jt(_,n){let s=!0;return _==="always"||_!=="never"&&n!=="never"||(s=!1),s}class Kt{constructor(n,s,f){const m=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(n/f),this.yCellCount=Math.ceil(s/f);for(let x=0;x<this.xCellCount*this.yCellCount;x++)m.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=s,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,s,f,m,y){this._forEachCell(s,f,m,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(s),this.bboxes.push(f),this.bboxes.push(m),this.bboxes.push(y)}insertCircle(n,s,f,m){this._forEachCell(s-m,f-m,s+m,f+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(s),this.circles.push(f),this.circles.push(m)}_insertBoxCell(n,s,f,m,y,x){this.boxCells[y].push(x)}_insertCircleCell(n,s,f,m,y,x){this.circleCells[y].push(x)}_query(n,s,f,m,y,x,M){if(f<0||n>this.width||m<0||s>this.height)return[];const E=[];if(n<=0&&s<=0&&this.width<=f&&this.height<=m){if(y)return[{key:null,x1:n,y1:s,x2:f,y2:m}];for(let z=0;z<this.boxKeys.length;z++)E.push({key:this.boxKeys[z],x1:this.bboxes[4*z],y1:this.bboxes[4*z+1],x2:this.bboxes[4*z+2],y2:this.bboxes[4*z+3]});for(let z=0;z<this.circleKeys.length;z++){const B=this.circles[3*z],j=this.circles[3*z+1],N=this.circles[3*z+2];E.push({key:this.circleKeys[z],x1:B-N,y1:j-N,x2:B+N,y2:j+N})}}else this._forEachCell(n,s,f,m,this._queryCell,E,{hitTest:y,overlapMode:x,seenUids:{box:{},circle:{}}},M);return E}query(n,s,f,m){return this._query(n,s,f,m,!1,null)}hitTest(n,s,f,m,y,x){return this._query(n,s,f,m,!0,y,x).length>0}hitTestCircle(n,s,f,m,y){const x=n-f,M=n+f,E=s-f,z=s+f;if(M<0||x>this.width||z<0||E>this.height)return!1;const B=[];return this._forEachCell(x,E,M,z,this._queryCellCircle,B,{hitTest:!0,overlapMode:m,circle:{x:n,y:s,radius:f},seenUids:{box:{},circle:{}}},y),B.length>0}_queryCell(n,s,f,m,y,x,M,E){const{seenUids:z,hitTest:B,overlapMode:j}=M,N=this.boxCells[y];if(N!==null){const Q=this.bboxes;for(const se of N)if(!z.box[se]){z.box[se]=!0;const oe=4*se,le=this.boxKeys[se];if(n<=Q[oe+2]&&s<=Q[oe+3]&&f>=Q[oe+0]&&m>=Q[oe+1]&&(!E||E(le))&&(!B||!jt(j,le.overlapMode))&&(x.push({key:le,x1:Q[oe],y1:Q[oe+1],x2:Q[oe+2],y2:Q[oe+3]}),B))return!0}}const V=this.circleCells[y];if(V!==null){const Q=this.circles;for(const se of V)if(!z.circle[se]){z.circle[se]=!0;const oe=3*se,le=this.circleKeys[se];if(this._circleAndRectCollide(Q[oe],Q[oe+1],Q[oe+2],n,s,f,m)&&(!E||E(le))&&(!B||!jt(j,le.overlapMode))){const de=Q[oe],_e=Q[oe+1],me=Q[oe+2];if(x.push({key:le,x1:de-me,y1:_e-me,x2:de+me,y2:_e+me}),B)return!0}}}return!1}_queryCellCircle(n,s,f,m,y,x,M,E){const{circle:z,seenUids:B,overlapMode:j}=M,N=this.boxCells[y];if(N!==null){const Q=this.bboxes;for(const se of N)if(!B.box[se]){B.box[se]=!0;const oe=4*se,le=this.boxKeys[se];if(this._circleAndRectCollide(z.x,z.y,z.radius,Q[oe+0],Q[oe+1],Q[oe+2],Q[oe+3])&&(!E||E(le))&&!jt(j,le.overlapMode))return x.push(!0),!0}}const V=this.circleCells[y];if(V!==null){const Q=this.circles;for(const se of V)if(!B.circle[se]){B.circle[se]=!0;const oe=3*se,le=this.circleKeys[se];if(this._circlesCollide(Q[oe],Q[oe+1],Q[oe+2],z.x,z.y,z.radius)&&(!E||E(le))&&!jt(j,le.overlapMode))return x.push(!0),!0}}}_forEachCell(n,s,f,m,y,x,M,E){const z=this._convertToXCellCoord(n),B=this._convertToYCellCoord(s),j=this._convertToXCellCoord(f),N=this._convertToYCellCoord(m);for(let V=z;V<=j;V++)for(let Q=B;Q<=N;Q++)if(y.call(this,n,s,f,m,this.xCellCount*Q+V,x,M,E))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,s,f,m,y,x){const M=m-n,E=y-s,z=f+x;return z*z>M*M+E*E}_circleAndRectCollide(n,s,f,m,y,x,M){const E=(x-m)/2,z=Math.abs(n-(m+E));if(z>E+f)return!1;const B=(M-y)/2,j=Math.abs(s-(y+B));if(j>B+f)return!1;if(z<=E||j<=B)return!0;const N=z-E,V=j-B;return N*N+V*V<=f*f}}function en(_,n,s){const f=a.L();if(!_){const{vecSouth:j,vecEast:N}=Pn(n),V=T();V[0]=N[0],V[1]=N[1],V[2]=j[0],V[3]=j[1],m=V,(B=(x=(y=V)[0])*(z=y[3])-(E=y[2])*(M=y[1]))&&(m[0]=z*(B=1/B),m[1]=-M*B,m[2]=-E*B,m[3]=x*B),f[0]=V[0],f[1]=V[1],f[4]=V[2],f[5]=V[3]}var m,y,x,M,E,z,B;return a.N(f,f,[1/s,1/s,1]),f}function ti(_,n,s,f){if(_){const m=a.L();if(!n){const{vecSouth:y,vecEast:x}=Pn(s);m[0]=x[0],m[1]=x[1],m[4]=y[0],m[5]=y[1]}return a.N(m,m,[f,f,1]),m}return s.pixelsToClipSpaceMatrix}function Pn(_){const n=Math.cos(_.rollInRadians),s=Math.sin(_.rollInRadians),f=Math.cos(_.pitchInRadians),m=Math.cos(_.bearingInRadians),y=Math.sin(_.bearingInRadians),x=a.aq();x[0]=-m*f*s-y*n,x[1]=-y*f*s+m*n;const M=a.ar(x);M<1e-9?a.as(x):a.at(x,x,1/M);const E=a.aq();E[0]=m*f*n-y*s,E[1]=y*f*n+m*s;const z=a.ar(E);return z<1e-9?a.as(E):a.at(E,E,1/z),{vecEast:E,vecSouth:x}}function Nn(_,n,s,f){let m;f?(m=[_,n,f(_,n),1],a.av(m,m,s)):(m=[_,n,0,1],lt(m,m,s));const y=m[3];return{point:new a.P(m[0]/y,m[1]/y),signedDistanceFromCamera:y,isOccluded:!1}}function ln(_,n){return .5+_/n*.5}function En(_,n){return _.x>=-n[0]&&_.x<=n[0]&&_.y>=-n[1]&&_.y<=n[1]}function li(_,n,s,f,m,y,x,M,E,z,B,j,N){const V=s?_.textSizeData:_.iconSizeData,Q=a.am(V,n.transform.zoom),se=[256/n.width*2+1,256/n.height*2+1],oe=s?_.text.dynamicLayoutVertexArray:_.icon.dynamicLayoutVertexArray;oe.clear();const le=_.lineVertexArray,de=s?_.text.placedSymbolArray:_.icon.placedSymbolArray,_e=n.transform.width/n.transform.height;let me=!1;for(let xe=0;xe<de.length;xe++){const Te=de.get(xe);if(Te.hidden||Te.writingMode===a.an.vertical&&!me){Oe(Te.numGlyphs,oe);continue}me=!1;const ge=new a.P(Te.anchorX,Te.anchorY),ze={getElevation:N,pitchedLabelPlaneMatrix:f,lineVertexArray:le,pitchWithMap:y,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:n.transform,tileAnchorPoint:ge,unwrappedTileID:E,width:z,height:B,translation:j},$e=rt(Te.anchorX,Te.anchorY,ze);if(!En($e.point,se)){Oe(Te.numGlyphs,oe);continue}const Ne=ln(n.transform.cameraToCenterDistance,$e.signedDistanceFromCamera),je=a.ao(V,Q,Te),We=y?je*n.transform.getPitchedTextCorrection(Te.anchorX,Te.anchorY,E)/Ne:je*Ne,zt=ci({projectionContext:ze,pitchedLabelPlaneMatrixInverse:m,symbol:Te,fontSize:We,flip:!1,keepUpright:x,glyphOffsetArray:_.glyphOffsetArray,dynamicLayoutVertexArray:oe,aspectRatio:_e,rotateToLine:M});me=zt.useVertical,(zt.notEnoughRoom||me||zt.needsFlipping&&ci({projectionContext:ze,pitchedLabelPlaneMatrixInverse:m,symbol:Te,fontSize:We,flip:!0,keepUpright:x,glyphOffsetArray:_.glyphOffsetArray,dynamicLayoutVertexArray:oe,aspectRatio:_e,rotateToLine:M}).notEnoughRoom)&&Oe(Te.numGlyphs,oe)}s?_.text.dynamicLayoutVertexBuffer.updateData(oe):_.icon.dynamicLayoutVertexBuffer.updateData(oe)}function xt(_,n,s,f,m,y,x,M){const E=y.glyphStartIndex+y.numGlyphs,z=y.lineStartIndex,B=y.lineStartIndex+y.lineLength,j=n.getoffsetX(y.glyphStartIndex),N=n.getoffsetX(E-1),V=gi(_*j,s,f,m,y.segment,z,B,M,x);if(!V)return null;const Q=gi(_*N,s,f,m,y.segment,z,B,M,x);return Q?M.projectionCache.anyProjectionOccluded?null:{first:V,last:Q}:null}function mi(_,n,s,f){return _===a.an.horizontal&&Math.abs(s.y-n.y)>Math.abs(s.x-n.x)*f?{useVertical:!0}:(_===a.an.vertical?n.y<s.y:n.x>s.x)?{needsFlipping:!0}:null}function ci(_){const{projectionContext:n,pitchedLabelPlaneMatrixInverse:s,symbol:f,fontSize:m,flip:y,keepUpright:x,glyphOffsetArray:M,dynamicLayoutVertexArray:E,aspectRatio:z,rotateToLine:B}=_,j=m/24,N=f.lineOffsetX*j,V=f.lineOffsetY*j;let Q;if(f.numGlyphs>1){const se=f.glyphStartIndex+f.numGlyphs,oe=f.lineStartIndex,le=f.lineStartIndex+f.lineLength,de=xt(j,M,N,V,y,f,B,n);if(!de)return{notEnoughRoom:!0};const _e=vn(de.first.point.x,de.first.point.y,n,s),me=vn(de.last.point.x,de.last.point.y,n,s);if(x&&!y){const xe=mi(f.writingMode,_e,me,z);if(xe)return xe}Q=[de.first];for(let xe=f.glyphStartIndex+1;xe<se-1;xe++){const Te=gi(j*M.getoffsetX(xe),N,V,y,f.segment,oe,le,n,B);if(!Te)return{notEnoughRoom:!0};Q.push(Te)}Q.push(de.last)}else{if(x&&!y){const oe=kt(n.tileAnchorPoint.x,n.tileAnchorPoint.y,n).point,le=f.lineStartIndex+f.segment+1,de=new a.P(n.lineVertexArray.getx(le),n.lineVertexArray.gety(le)),_e=kt(de.x,de.y,n),me=_e.signedDistanceFromCamera>0?_e.point:ha(n.tileAnchorPoint,de,oe,1,n),xe=vn(oe.x,oe.y,n,s),Te=vn(me.x,me.y,n,s),ge=mi(f.writingMode,xe,Te,z);if(ge)return ge}const se=gi(j*M.getoffsetX(f.glyphStartIndex),N,V,y,f.segment,f.lineStartIndex,f.lineStartIndex+f.lineLength,n,B);if(!se||n.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};Q=[se]}for(const se of Q)a.au(E,se.point,se.angle);return{}}function ha(_,n,s,f,m){const y=_.add(_.sub(n)._unit()),x=kt(y.x,y.y,m).point,M=s.sub(x);return s.add(M._mult(f/M.mag()))}function fa(_,n,s){const f=n.projectionCache;if(f.projections[_])return f.projections[_];const m=new a.P(n.lineVertexArray.getx(_),n.lineVertexArray.gety(_)),y=kt(m.x,m.y,n);if(y.signedDistanceFromCamera>0)return f.projections[_]=y.point,f.anyProjectionOccluded=f.anyProjectionOccluded||y.isOccluded,y.point;const x=_-s.direction;return ha(s.distanceFromAnchor===0?n.tileAnchorPoint:new a.P(n.lineVertexArray.getx(x),n.lineVertexArray.gety(x)),m,s.previousVertex,s.absOffsetX-s.distanceFromAnchor+1,n)}function kt(_,n,s){const f=_+s.translation[0],m=n+s.translation[1];let y;return s.pitchWithMap?(y=Nn(f,m,s.pitchedLabelPlaneMatrix,s.getElevation),y.isOccluded=!1):(y=s.transform.projectTileCoordinates(f,m,s.unwrappedTileID,s.getElevation),y.point.x=(.5*y.point.x+.5)*s.width,y.point.y=(.5*-y.point.y+.5)*s.height),y}function vn(_,n,s,f){if(s.pitchWithMap){const m=[_,n,0,1];return a.av(m,m,f),s.transform.projectTileCoordinates(m[0]/m[3],m[1]/m[3],s.unwrappedTileID,s.getElevation).point}return{x:_/s.width*2-1,y:1-n/s.height*2}}function rt(_,n,s){return s.transform.projectTileCoordinates(_,n,s.unwrappedTileID,s.getElevation)}function Dt(_,n,s){return _._unit()._perp()._mult(n*s)}function Ci(_,n,s,f,m,y,x,M,E){if(M.projectionCache.offsets[_])return M.projectionCache.offsets[_];const z=s.add(n);if(_+E.direction<f||_+E.direction>=m)return M.projectionCache.offsets[_]=z,z;const B=fa(_+E.direction,M,E),j=Dt(B.sub(s),x,E.direction),N=s.add(j),V=B.add(j);return M.projectionCache.offsets[_]=a.aw(y,z,N,V)||z,M.projectionCache.offsets[_]}function gi(_,n,s,f,m,y,x,M,E){const z=f?_-n:_+n;let B=z>0?1:-1,j=0;f&&(B*=-1,j=Math.PI),B<0&&(j+=Math.PI);let N,V=B>0?y+m:y+m+1;M.projectionCache.cachedAnchorPoint?N=M.projectionCache.cachedAnchorPoint:(N=kt(M.tileAnchorPoint.x,M.tileAnchorPoint.y,M).point,M.projectionCache.cachedAnchorPoint=N);let Q,se,oe=N,le=N,de=0,_e=0;const me=Math.abs(z),xe=[];let Te;for(;de+_e<=me;){if(V+=B,V<y||V>=x)return null;de+=_e,le=oe,se=Q;const $e={absOffsetX:me,direction:B,distanceFromAnchor:de,previousVertex:le};if(oe=fa(V,M,$e),s===0)xe.push(le),Te=oe.sub(le);else{let Ne;const je=oe.sub(le);Ne=je.mag()===0?Dt(fa(V+B,M,$e).sub(oe),s,B):Dt(je,s,B),se||(se=le.add(Ne)),Q=Ci(V,Ne,oe,y,x,se,s,M,$e),xe.push(se),Te=Q.sub(se)}_e=Te.mag()}const ge=Te._mult((me-de)/_e)._add(se||le),ze=j+Math.atan2(oe.y-le.y,oe.x-le.x);return xe.push(ge),{point:ge,angle:E?ze:0,path:xe}}const on=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Oe(_,n){for(let s=0;s<_;s++){const f=n.length;n.resize(f+4),n.float32.set(on,3*f)}}function lt(_,n,s){const f=n[0],m=n[1];return _[0]=s[0]*f+s[4]*m+s[12],_[1]=s[1]*f+s[5]*m+s[13],_[3]=s[3]*f+s[7]*m+s[15],_}const Ot=100;class cn{constructor(n,s=new Kt(n.width+200,n.height+200,25),f=new Kt(n.width+200,n.height+200,25)){this.transform=n,this.grid=s,this.ignoredGrid=f,this.pitchFactor=Math.cos(n.pitch*Math.PI/180)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+Ot,this.screenBottomBoundary=n.height+Ot,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(n,s,f,m,y,x,M,E,z,B,j,N){const V=this.projectAndGetPerspectiveRatio(n.anchorPointX+E[0],n.anchorPointY+E[1],y,B,N),Q=f*V.perspectiveRatio;let se;if(x||M)se=this._projectCollisionBox(n,Q,m,y,x,M,E,V,B,j,N);else{const Te=V.x+(j?j.x*Q:0),ge=V.y+(j?j.y*Q:0);se={allPointsOccluded:!1,box:[Te+n.x1*Q,ge+n.y1*Q,Te+n.x2*Q,ge+n.y2*Q]}}const[oe,le,de,_e]=se.box,me=x?se.allPointsOccluded:V.isOccluded;let xe=me;return xe||(xe=V.perspectiveRatio<this.perspectiveRatioCutoff),xe||(xe=!this.isInsideGrid(oe,le,de,_e)),xe||s!=="always"&&this.grid.hitTest(oe,le,de,_e,s,z)?{box:[oe,le,de,_e],placeable:!1,offscreen:!1,occluded:me}:{box:[oe,le,de,_e],placeable:!0,offscreen:this.isOffscreen(oe,le,de,_e),occluded:me}}placeCollisionCircles(n,s,f,m,y,x,M,E,z,B,j,N,V,Q){const se=[],oe=new a.P(s.anchorX,s.anchorY),le=this.getPerspectiveRatio(oe.x,oe.y,x,Q),de=(z?y*this.transform.getPitchedTextCorrection(s.anchorX,s.anchorY,x)/le:y*le)/a.aA,_e={getElevation:Q,pitchedLabelPlaneMatrix:M,lineVertexArray:f,pitchWithMap:z,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:oe,unwrappedTileID:x,width:this.transform.width,height:this.transform.height,translation:V},me=xt(de,m,s.lineOffsetX*de,s.lineOffsetY*de,!1,s,!1,_e);let xe=!1,Te=!1,ge=!0;if(me){const ze=.5*j*le+N,$e=new a.P(-100,-100),Ne=new a.P(this.screenRightBoundary,this.screenBottomBoundary),je=new nn,We=me.first,zt=me.last;let Ct=[];for(let Mn=We.path.length-1;Mn>=1;Mn--)Ct.push(We.path[Mn]);for(let Mn=1;Mn<zt.path.length;Mn++)Ct.push(zt.path[Mn]);const ft=2.5*ze;if(z){const Mn=this.projectPathToScreenSpace(Ct,_e);Ct=Mn.some(ii=>ii.signedDistanceFromCamera<=0)?[]:Mn.map(ii=>ii.point)}let Wt=[];if(Ct.length>0){const Mn=Ct[0].clone(),ii=Ct[0].clone();for(let Li=1;Li<Ct.length;Li++)Mn.x=Math.min(Mn.x,Ct[Li].x),Mn.y=Math.min(Mn.y,Ct[Li].y),ii.x=Math.max(ii.x,Ct[Li].x),ii.y=Math.max(ii.y,Ct[Li].y);Wt=Mn.x>=$e.x&&ii.x<=Ne.x&&Mn.y>=$e.y&&ii.y<=Ne.y?[Ct]:ii.x<$e.x||Mn.x>Ne.x||ii.y<$e.y||Mn.y>Ne.y?[]:a.ax([Ct],$e.x,$e.y,Ne.x,Ne.y)}for(const Mn of Wt){je.reset(Mn,.25*ze);let ii=0;ii=je.length<=.5*ze?1:Math.ceil(je.paddedLength/ft)+1;for(let Li=0;Li<ii;Li++){const hi=Li/Math.max(ii-1,1),Bi=je.lerp(hi),vi=Bi.x+Ot,fi=Bi.y+Ot;se.push(vi,fi,ze,0);const bi=vi-ze,gr=fi-ze,Wn=vi+ze,or=fi+ze;if(ge=ge&&this.isOffscreen(bi,gr,Wn,or),Te=Te||this.isInsideGrid(bi,gr,Wn,or),n!=="always"&&this.grid.hitTestCircle(vi,fi,ze,n,B)&&(xe=!0,!E))return{circles:[],offscreen:!1,collisionDetected:xe}}}}return{circles:!E&&xe||!Te||le<this.perspectiveRatioCutoff?[]:se,offscreen:ge,collisionDetected:xe}}projectPathToScreenSpace(n,s){const f=function(m,y){const x=a.L();return a.ap(x,y.pitchedLabelPlaneMatrix),m.map(M=>{const E=Nn(M.x,M.y,x,y.getElevation),z=y.transform.projectTileCoordinates(E.point.x,E.point.y,y.unwrappedTileID,y.getElevation);return z.point.x=(.5*z.point.x+.5)*y.width,z.point.y=(.5*-z.point.y+.5)*y.height,z})}(n,s);return function(m){let y=0,x=0,M=0,E=0;for(let z=0;z<m.length;z++)m[z].isOccluded?(M=z+1,E=0):(E++,E>x&&(x=E,y=M));return m.slice(y,y+x)}(f)}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[],f=new a.a1;for(const j of n){const N=new a.P(j.x+Ot,j.y+Ot);f.extend(N),s.push(N)}const{minX:m,minY:y,maxX:x,maxY:M}=f,E=this.grid.query(m,y,x,M).concat(this.ignoredGrid.query(m,y,x,M)),z={},B={};for(const j of E){const N=j.key;if(z[N.bucketInstanceId]===void 0&&(z[N.bucketInstanceId]={}),z[N.bucketInstanceId][N.featureIndex])continue;const V=[new a.P(j.x1,j.y1),new a.P(j.x2,j.y1),new a.P(j.x2,j.y2),new a.P(j.x1,j.y2)];a.ay(s,V)&&(z[N.bucketInstanceId][N.featureIndex]=!0,B[N.bucketInstanceId]===void 0&&(B[N.bucketInstanceId]=[]),B[N.bucketInstanceId].push(N.featureIndex))}return B}insertCollisionBox(n,s,f,m,y,x){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:y,collisionGroupID:x,overlapMode:s},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,s,f,m,y,x){const M=f?this.ignoredGrid:this.grid,E={bucketInstanceId:m,featureIndex:y,collisionGroupID:x,overlapMode:s};for(let z=0;z<n.length;z+=4)M.insertCircle(E,n[z],n[z+1],n[z+2])}projectAndGetPerspectiveRatio(n,s,f,m,y){if(y){let x;m?(x=[n,s,m(n,s),1],a.av(x,x,y)):(x=[n,s,0,1],lt(x,x,y));const M=x[3];return{x:(x[0]/M+1)/2*this.transform.width+Ot,y:(-x[1]/M+1)/2*this.transform.height+Ot,perspectiveRatio:.5+this.transform.cameraToCenterDistance/M*.5,isOccluded:!1,signedDistanceFromCamera:M}}{const x=this.transform.projectTileCoordinates(n,s,f,m);return{x:(x.point.x+1)/2*this.transform.width+Ot,y:(1-x.point.y)/2*this.transform.height+Ot,perspectiveRatio:.5+this.transform.cameraToCenterDistance/x.signedDistanceFromCamera*.5,isOccluded:x.isOccluded,signedDistanceFromCamera:x.signedDistanceFromCamera}}}getPerspectiveRatio(n,s,f,m){const y=this.transform.projectTileCoordinates(n,s,f,m);return .5+this.transform.cameraToCenterDistance/y.signedDistanceFromCamera*.5}isOffscreen(n,s,f,m){return f<Ot||n>=this.screenRightBoundary||m<Ot||s>this.screenBottomBoundary}isInsideGrid(n,s,f,m){return f>=0&&n<this.gridRightBoundary&&m>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const n=a.af([]);return a.M(n,n,[-100,-100,0]),n}_projectCollisionBox(n,s,f,m,y,x,M,E,z,B,j){let N=1,V=0,Q=0,se=1;const oe=n.anchorPointX+M[0],le=n.anchorPointY+M[1];if(x&&!y){const Ct=this.projectAndGetPerspectiveRatio(oe+1,le,m,z,j),ft=Ct.x-E.x,Wt=Math.atan((Ct.y-E.y)/ft)+(ft<0?Math.PI:0),Mn=Math.sin(Wt),ii=Math.cos(Wt);N=ii,V=Mn,Q=-Mn,se=ii}else if(!x&&y){const Ct=Pn(this.transform);N=Ct.vecEast[0],V=Ct.vecEast[1],Q=Ct.vecSouth[0],se=Ct.vecSouth[1]}let de=E.x,_e=E.y,me=s;y&&(de=oe,_e=le,me=Math.pow(2,-(this.transform.zoom-f.overscaledZ)),me*=this.transform.getPitchedTextCorrection(oe,le,m),B||(me*=a.ag(.5+E.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),B&&(de+=N*B.x*me+Q*B.y*me,_e+=V*B.x*me+se*B.y*me);const xe=n.x1*me,Te=n.x2*me,ge=(xe+Te)/2,ze=n.y1*me,$e=n.y2*me,Ne=(ze+$e)/2,je=[{offsetX:xe,offsetY:ze},{offsetX:ge,offsetY:ze},{offsetX:Te,offsetY:ze},{offsetX:Te,offsetY:Ne},{offsetX:Te,offsetY:$e},{offsetX:ge,offsetY:$e},{offsetX:xe,offsetY:$e},{offsetX:xe,offsetY:Ne}];let We=[];for(const{offsetX:Ct,offsetY:ft}of je)We.push(new a.P(de+N*Ct+Q*ft,_e+V*Ct+se*ft));let zt=!1;if(y){const Ct=We.map(ft=>this.projectAndGetPerspectiveRatio(ft.x,ft.y,m,z,j));zt=Ct.some(ft=>!ft.isOccluded),We=Ct.map(ft=>new a.P(ft.x,ft.y))}else zt=!0;return{box:a.az(We),allPointsOccluded:!zt}}}class gn{constructor(n,s,f,m){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?s:-s))):m&&f?1:0,this.placed=f}isHidden(){return this.opacity===0&&!this.placed}}class mn{constructor(n,s,f,m,y){this.text=new gn(n?n.text:null,s,f,y),this.icon=new gn(n?n.icon:null,s,m,y)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class bn{constructor(n,s,f){this.text=n,this.icon=s,this.skipFade=f}}class hn{constructor(n,s,f,m,y){this.bucketInstanceId=n,this.featureIndex=s,this.sourceLayerIndex=f,this.bucketIndex=m,this.tileID=y}}class An{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const s=++this.maxGroupID;this.collisionGroups[n]={ID:s,predicate:f=>f.collisionGroupID===s}}return this.collisionGroups[n]}}function Qi(_,n,s,f,m){const{horizontalAlign:y,verticalAlign:x}=a.aG(_);return new a.P(-(y-.5)*n+f[0]*m,-(x-.5)*s+f[1]*m)}class kn{constructor(n,s,f,m,y){this.transform=n.clone(),this.terrain=s,this.collisionIndex=new cn(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new An(m),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(n){const s=this.terrain;return s?(f,m)=>s.getElevation(n,f,m):null}getBucketParts(n,s,f,m){const y=f.getBucket(s),x=f.latestFeatureIndex;if(!y||!x||s.id!==y.layerIds[0])return;const M=f.collisionBoxArray,E=y.layers[0].layout,z=y.layers[0].paint,B=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),j=f.tileSize/a.$,N=f.tileID.toUnwrapped(),V=E.get("text-rotation-alignment")==="map",Q=a.aB(f,1,this.transform.zoom),se=a.aC(this.collisionIndex.transform,f,z.get("text-translate"),z.get("text-translate-anchor")),oe=a.aC(this.collisionIndex.transform,f,z.get("icon-translate"),z.get("icon-translate-anchor")),le=en(V,this.transform,Q);this.retainedQueryData[y.bucketInstanceId]=new hn(y.bucketInstanceId,x,y.sourceLayerIndex,y.index,f.tileID);const de={bucket:y,layout:E,translationText:se,translationIcon:oe,unwrappedTileID:N,pitchedLabelPlaneMatrix:le,scale:B,textPixelRatio:j,holdingForFade:f.holdingForFade(),collisionBoxArray:M,partiallyEvaluatedTextSize:a.am(y.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(y.sourceID)};if(m)for(const _e of y.sortKeyRanges){const{sortKey:me,symbolInstanceStart:xe,symbolInstanceEnd:Te}=_e;n.push({sortKey:me,symbolInstanceStart:xe,symbolInstanceEnd:Te,parameters:de})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:y.symbolInstances.length,parameters:de})}attemptAnchorPlacement(n,s,f,m,y,x,M,E,z,B,j,N,V,Q,se,oe,le,de,_e,me){const xe=a.aD[n.textAnchor],Te=[n.textOffset0,n.textOffset1],ge=Qi(xe,f,m,Te,y),ze=this.collisionIndex.placeCollisionBox(s,N,E,z,B,M,x,oe,j.predicate,_e,ge,me);if((!de||this.collisionIndex.placeCollisionBox(de,N,E,z,B,M,x,le,j.predicate,_e,ge,me).placeable)&&ze.placeable){let $e;if(this.prevPlacement&&this.prevPlacement.variableOffsets[V.crossTileID]&&this.prevPlacement.placements[V.crossTileID]&&this.prevPlacement.placements[V.crossTileID].text&&($e=this.prevPlacement.variableOffsets[V.crossTileID].anchor),V.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[V.crossTileID]={textOffset:Te,width:f,height:m,anchor:xe,textBoxScale:y,prevAnchor:$e},this.markUsedJustification(Q,xe,V,se),Q.allowVerticalPlacement&&(this.markUsedOrientation(Q,se,V),this.placedOrientations[V.crossTileID]=se),{shift:ge,placedGlyphBoxes:ze}}}placeLayerBucketPart(n,s,f){const{bucket:m,layout:y,translationText:x,translationIcon:M,unwrappedTileID:E,pitchedLabelPlaneMatrix:z,textPixelRatio:B,holdingForFade:j,collisionBoxArray:N,partiallyEvaluatedTextSize:V,collisionGroup:Q}=n.parameters,se=y.get("text-optional"),oe=y.get("icon-optional"),le=a.aE(y,"text-overlap","text-allow-overlap"),de=le==="always",_e=a.aE(y,"icon-overlap","icon-allow-overlap"),me=_e==="always",xe=y.get("text-rotation-alignment")==="map",Te=y.get("text-pitch-alignment")==="map",ge=y.get("icon-text-fit")!=="none",ze=y.get("symbol-z-order")==="viewport-y",$e=de&&(me||!m.hasIconData()||oe),Ne=me&&(de||!m.hasTextData()||se);!m.collisionArrays&&N&&m.deserializeCollisionBoxes(N);const je=this.retainedQueryData[m.bucketInstanceId].tileID,We=this._getTerrainElevationFunc(je),zt=this.transform.getFastPathSimpleProjectionMatrix(je),Ct=(ft,Wt,Mn)=>{var ii,Li;if(s[ft.crossTileID])return;if(j)return void(this.placements[ft.crossTileID]=new bn(!1,!1,!1));let hi=!1,Bi=!1,vi=!0,fi=null,bi={box:null,placeable:!1,offscreen:null,occluded:!1},gr={placeable:!1},Wn=null,or=null,_r=null,ko=0,Do=0,zo=0;Wt.textFeatureIndex?ko=Wt.textFeatureIndex:ft.useRuntimeCollisionCircles&&(ko=ft.featureIndex),Wt.verticalTextFeatureIndex&&(Do=Wt.verticalTextFeatureIndex);const Ua=Wt.textBox;if(Ua){const Wr=Vi=>{let Ii=a.an.horizontal;if(m.allowVerticalPlacement&&!Vi&&this.prevPlacement){const Fr=this.prevPlacement.placedOrientations[ft.crossTileID];Fr&&(this.placedOrientations[ft.crossTileID]=Fr,Ii=Fr,this.markUsedOrientation(m,Ii,ft))}return Ii},Ta=(Vi,Ii)=>{if(m.allowVerticalPlacement&&ft.numVerticalGlyphVertices>0&&Wt.verticalTextBox){for(const Fr of m.writingModes)if(Fr===a.an.vertical?(bi=Ii(),gr=bi):bi=Vi(),bi&&bi.placeable)break}else bi=Vi()},Ro=ft.textAnchorOffsetStartIndex,hs=ft.textAnchorOffsetEndIndex;if(hs===Ro){const Vi=(Ii,Fr)=>{const Ji=this.collisionIndex.placeCollisionBox(Ii,le,B,je,E,Te,xe,x,Q.predicate,We,void 0,zt);return Ji&&Ji.placeable&&(this.markUsedOrientation(m,Fr,ft),this.placedOrientations[ft.crossTileID]=Fr),Ji};Ta(()=>Vi(Ua,a.an.horizontal),()=>{const Ii=Wt.verticalTextBox;return m.allowVerticalPlacement&&ft.numVerticalGlyphVertices>0&&Ii?Vi(Ii,a.an.vertical):{box:null,offscreen:null}}),Wr(bi&&bi.placeable)}else{let Vi=a.aD[(Li=(ii=this.prevPlacement)===null||ii===void 0?void 0:ii.variableOffsets[ft.crossTileID])===null||Li===void 0?void 0:Li.anchor];const Ii=(Ji,ym,Zy)=>{const Ff=Ji.x2-Ji.x1,cc=Ji.y2-Ji.y1,ll=ft.textBoxScale,ao=ge&&_e==="never"?ym:null;let yr=null,oo=le==="never"?1:2,Of="never";Vi&&oo++;for(let Lo=0;Lo<oo;Lo++){for(let Nf=Ro;Nf<hs;Nf++){const jf=m.textAnchorOffsets.get(Nf);if(Vi&&jf.textAnchor!==Vi)continue;const uc=this.attemptAnchorPlacement(jf,Ji,Ff,cc,ll,xe,Te,B,je,E,Q,Of,ft,m,Zy,x,M,ao,We);if(uc&&(yr=uc.placedGlyphBoxes,yr&&yr.placeable))return hi=!0,fi=uc.shift,yr}Vi?Vi=null:Of=le}return f&&!yr&&(yr={box:this.collisionIndex.placeCollisionBox(Ua,"always",B,je,E,Te,xe,x,Q.predicate,We,void 0,zt).box,offscreen:!1,placeable:!1,occluded:!1}),yr};Ta(()=>Ii(Ua,Wt.iconBox,a.an.horizontal),()=>{const Ji=Wt.verticalTextBox;return m.allowVerticalPlacement&&(!bi||!bi.placeable)&&ft.numVerticalGlyphVertices>0&&Ji?Ii(Ji,Wt.verticalIconBox,a.an.vertical):{box:null,occluded:!0,offscreen:null}}),bi&&(hi=bi.placeable,vi=bi.offscreen);const Fr=Wr(bi&&bi.placeable);if(!hi&&this.prevPlacement){const Ji=this.prevPlacement.variableOffsets[ft.crossTileID];Ji&&(this.variableOffsets[ft.crossTileID]=Ji,this.markUsedJustification(m,Ji.anchor,ft,Fr))}}}if(Wn=bi,hi=Wn&&Wn.placeable,vi=Wn&&Wn.offscreen,ft.useRuntimeCollisionCircles){const Wr=m.text.placedSymbolArray.get(ft.centerJustifiedTextSymbolIndex),Ta=a.ao(m.textSizeData,V,Wr),Ro=y.get("text-padding");or=this.collisionIndex.placeCollisionCircles(le,Wr,m.lineVertexArray,m.glyphOffsetArray,Ta,E,z,f,Te,Q.predicate,ft.collisionCircleDiameter,Ro,x,We),or.circles.length&&or.collisionDetected&&!f&&a.w("Collisions detected, but collision boxes are not shown"),hi=de||or.circles.length>0&&!or.collisionDetected,vi=vi&&or.offscreen}if(Wt.iconFeatureIndex&&(zo=Wt.iconFeatureIndex),Wt.iconBox){const Wr=Ta=>this.collisionIndex.placeCollisionBox(Ta,_e,B,je,E,Te,xe,M,Q.predicate,We,ge&&fi?fi:void 0,zt);gr&&gr.placeable&&Wt.verticalIconBox?(_r=Wr(Wt.verticalIconBox),Bi=_r.placeable):(_r=Wr(Wt.iconBox),Bi=_r.placeable),vi=vi&&_r.offscreen}const sc=se||ft.numHorizontalGlyphVertices===0&&ft.numVerticalGlyphVertices===0,lc=oe||ft.numIconVertices===0;sc||lc?lc?sc||(Bi=Bi&&hi):hi=Bi&&hi:Bi=hi=Bi&&hi;const sl=Bi&&_r.placeable;if(hi&&Wn.placeable&&this.collisionIndex.insertCollisionBox(Wn.box,le,y.get("text-ignore-placement"),m.bucketInstanceId,gr&&gr.placeable&&Do?Do:ko,Q.ID),sl&&this.collisionIndex.insertCollisionBox(_r.box,_e,y.get("icon-ignore-placement"),m.bucketInstanceId,zo,Q.ID),or&&hi&&this.collisionIndex.insertCollisionCircles(or.circles,le,y.get("text-ignore-placement"),m.bucketInstanceId,ko,Q.ID),f&&this.storeCollisionData(m.bucketInstanceId,Mn,Wt,Wn,_r,or),ft.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(m.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[ft.crossTileID]=new bn((hi||$e)&&!(Wn!=null&&Wn.occluded),(Bi||Ne)&&!(_r!=null&&_r.occluded),vi||m.justReloaded),s[ft.crossTileID]=!0};if(ze){if(n.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const ft=m.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let Wt=ft.length-1;Wt>=0;--Wt){const Mn=ft[Wt];Ct(m.symbolInstances.get(Mn),m.collisionArrays[Mn],Mn)}}else for(let ft=n.symbolInstanceStart;ft<n.symbolInstanceEnd;ft++)Ct(m.symbolInstances.get(ft),m.collisionArrays[ft],ft);m.justReloaded=!1}storeCollisionData(n,s,f,m,y,x){if(f.textBox||f.iconBox){let M,E;this.collisionBoxArrays.has(n)?M=this.collisionBoxArrays.get(n):(M=new Map,this.collisionBoxArrays.set(n,M)),M.has(s)?E=M.get(s):(E={text:null,icon:null},M.set(s,E)),f.textBox&&(E.text=m.box),f.iconBox&&(E.icon=y.box)}if(x){let M=this.collisionCircleArrays[n];M===void 0&&(M=this.collisionCircleArrays[n]=[]);for(let E=0;E<x.circles.length;E+=4)M.push(x.circles[E+0]-Ot),M.push(x.circles[E+1]-Ot),M.push(x.circles[E+2]),M.push(x.collisionDetected?1:0)}}markUsedJustification(n,s,f,m){let y;y=m===a.an.vertical?f.verticalPlacedTextSymbolIndex:{left:f.leftJustifiedTextSymbolIndex,center:f.centerJustifiedTextSymbolIndex,right:f.rightJustifiedTextSymbolIndex}[a.aF(s)];const x=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex,f.verticalPlacedTextSymbolIndex];for(const M of x)M>=0&&(n.text.placedSymbolArray.get(M).crossTileID=y>=0&&M!==y?0:f.crossTileID)}markUsedOrientation(n,s,f){const m=s===a.an.horizontal||s===a.an.horizontalOnly?s:0,y=s===a.an.vertical?s:0,x=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex];for(const M of x)n.text.placedSymbolArray.get(M).placedOrientation=m;f.verticalPlacedTextSymbolIndex&&(n.text.placedSymbolArray.get(f.verticalPlacedTextSymbolIndex).placedOrientation=y)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let f=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const m=s?s.symbolFadeChange(n):1,y=s?s.opacities:{},x=s?s.variableOffsets:{},M=s?s.placedOrientations:{};for(const E in this.placements){const z=this.placements[E],B=y[E];B?(this.opacities[E]=new mn(B,m,z.text,z.icon),f=f||z.text!==B.text.placed||z.icon!==B.icon.placed):(this.opacities[E]=new mn(null,m,z.text,z.icon,z.skipFade),f=f||z.text||z.icon)}for(const E in y){const z=y[E];if(!this.opacities[E]){const B=new mn(z,m,!1,!1);B.isHidden()||(this.opacities[E]=B,f=f||z.text.placed||z.icon.placed)}}for(const E in x)this.variableOffsets[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.variableOffsets[E]=x[E]);for(const E in M)this.placedOrientations[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.placedOrientations[E]=M[E]);if(s&&s.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");f?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:n)}updateLayerOpacities(n,s){const f={};for(const m of s){const y=m.getBucket(n);y&&m.latestFeatureIndex&&n.id===y.layerIds[0]&&this.updateBucketOpacities(y,m.tileID,f,m.collisionBoxArray)}}updateBucketOpacities(n,s,f,m){n.hasTextData()&&(n.text.opacityVertexArray.clear(),n.text.hasVisibleVertices=!1),n.hasIconData()&&(n.icon.opacityVertexArray.clear(),n.icon.hasVisibleVertices=!1),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const y=n.layers[0],x=y.layout,M=new mn(null,0,!1,!1,!0),E=x.get("text-allow-overlap"),z=x.get("icon-allow-overlap"),B=y._unevaluatedLayout.hasValue("text-variable-anchor")||y._unevaluatedLayout.hasValue("text-variable-anchor-offset"),j=x.get("text-rotation-alignment")==="map",N=x.get("text-pitch-alignment")==="map",V=x.get("icon-text-fit")!=="none",Q=new mn(null,0,E&&(z||!n.hasIconData()||x.get("icon-optional")),z&&(E||!n.hasTextData()||x.get("text-optional")),!0);!n.collisionArrays&&m&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(m);const se=(le,de,_e)=>{for(let me=0;me<de/4;me++)le.opacityVertexArray.emplaceBack(_e);le.hasVisibleVertices=le.hasVisibleVertices||_e!==Vn},oe=this.collisionBoxArrays.get(n.bucketInstanceId);for(let le=0;le<n.symbolInstances.length;le++){const de=n.symbolInstances.get(le),{numHorizontalGlyphVertices:_e,numVerticalGlyphVertices:me,crossTileID:xe}=de;let Te=this.opacities[xe];f[xe]?Te=M:Te||(Te=Q,this.opacities[xe]=Te),f[xe]=!0;const ge=de.numIconVertices>0,ze=this.placedOrientations[de.crossTileID],$e=ze===a.an.vertical,Ne=ze===a.an.horizontal||ze===a.an.horizontalOnly;if(_e>0||me>0){const We=_i(Te.text);se(n.text,_e,$e?Vn:We),se(n.text,me,Ne?Vn:We);const zt=Te.text.isHidden();[de.rightJustifiedTextSymbolIndex,de.centerJustifiedTextSymbolIndex,de.leftJustifiedTextSymbolIndex].forEach(Wt=>{Wt>=0&&(n.text.placedSymbolArray.get(Wt).hidden=zt||$e?1:0)}),de.verticalPlacedTextSymbolIndex>=0&&(n.text.placedSymbolArray.get(de.verticalPlacedTextSymbolIndex).hidden=zt||Ne?1:0);const Ct=this.variableOffsets[de.crossTileID];Ct&&this.markUsedJustification(n,Ct.anchor,de,ze);const ft=this.placedOrientations[de.crossTileID];ft&&(this.markUsedJustification(n,"left",de,ft),this.markUsedOrientation(n,ft,de))}if(ge){const We=_i(Te.icon),zt=!(V&&de.verticalPlacedIconSymbolIndex&&$e);de.placedIconSymbolIndex>=0&&(se(n.icon,de.numIconVertices,zt?We:Vn),n.icon.placedSymbolArray.get(de.placedIconSymbolIndex).hidden=Te.icon.isHidden()),de.verticalPlacedIconSymbolIndex>=0&&(se(n.icon,de.numVerticalIconVertices,zt?Vn:We),n.icon.placedSymbolArray.get(de.verticalPlacedIconSymbolIndex).hidden=Te.icon.isHidden())}const je=oe&&oe.has(le)?oe.get(le):{text:null,icon:null};if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const We=n.collisionArrays[le];if(We){let zt=new a.P(0,0);if(We.textBox||We.verticalTextBox){let Ct=!0;if(B){const ft=this.variableOffsets[xe];ft?(zt=Qi(ft.anchor,ft.width,ft.height,ft.textOffset,ft.textBoxScale),j&&zt._rotate(N?-this.transform.bearingInRadians:this.transform.bearingInRadians)):Ct=!1}if(We.textBox||We.verticalTextBox){let ft;We.textBox&&(ft=$e),We.verticalTextBox&&(ft=Ne),jn(n.textCollisionBox.collisionVertexArray,Te.text.placed,!Ct||ft,je.text,zt.x,zt.y)}}if(We.iconBox||We.verticalIconBox){const Ct=!!(!Ne&&We.verticalIconBox);let ft;We.iconBox&&(ft=Ct),We.verticalIconBox&&(ft=!Ct),jn(n.iconCollisionBox.collisionVertexArray,Te.icon.placed,ft,je.icon,V?zt.x:0,V?zt.y:0)}}}}if(n.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.text.opacityVertexArray.length!==n.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${n.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${n.text.layoutVertexArray.length}) / 4`);if(n.icon.opacityVertexArray.length!==n.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${n.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${n.icon.layoutVertexArray.length}) / 4`);n.bucketInstanceId in this.collisionCircleArrays&&(n.collisionCircleArray=this.collisionCircleArrays[n.bucketInstanceId],delete this.collisionCircleArrays[n.bucketInstanceId])}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,s){const f=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*f>n}setStale(){this.stale=!0}}function jn(_,n,s,f,m,y){f&&f.length!==0||(f=[0,0,0,0]);const x=f[0]-Ot,M=f[1]-Ot,E=f[2]-Ot,z=f[3]-Ot;_.emplaceBack(n?1:0,s?1:0,m||0,y||0,x,M),_.emplaceBack(n?1:0,s?1:0,m||0,y||0,E,M),_.emplaceBack(n?1:0,s?1:0,m||0,y||0,E,z),_.emplaceBack(n?1:0,s?1:0,m||0,y||0,x,z)}const Qn=Math.pow(2,25),Ai=Math.pow(2,24),Jn=Math.pow(2,17),Un=Math.pow(2,16),Dn=Math.pow(2,9),ui=Math.pow(2,8),oi=Math.pow(2,1);function _i(_){if(_.opacity===0&&!_.placed)return 0;if(_.opacity===1&&_.placed)return 4294967295;const n=_.placed?1:0,s=Math.floor(127*_.opacity);return s*Qn+n*Ai+s*Jn+n*Un+s*Dn+n*ui+s*oi+n}const Vn=0;class Gi{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&!n.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(n,s,f,m,y){const x=this._bucketParts;for(;this._currentTileIndex<n.length;)if(s.getBucketParts(x,m,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,x.sort((M,E)=>M.sortKey-E.sortKey));this._currentPartIndex<x.length;)if(s.placeLayerBucketPart(x[this._currentPartIndex],this._seenCrossTileIDs,f),this._currentPartIndex++,y())return!0;return!1}}class Di{constructor(n,s,f,m,y,x,M,E){this.placement=new kn(n,s,x,M,E),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(n,s,f){const m=I.now(),y=()=>!this._forceFullPlacement&&I.now()-m>2;for(;this._currentPlacementIndex>=0;){const x=s[n[this._currentPlacementIndex]],M=this.placement.collisionIndex.transform.zoom;if(x.type==="symbol"&&(!x.minzoom||x.minzoom<=M)&&(!x.maxzoom||x.maxzoom>M)){if(this._inProgressLayer||(this._inProgressLayer=new Gi(x)),this._inProgressLayer.continuePlacement(f[x.source],this.placement,this._showCollisionBoxes,x,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const Cn=512/a.$/2;class yi{constructor(n,s,f){this.tileID=n,this.bucketInstanceId=f,this._symbolsByKey={};const m=new Map;for(let y=0;y<s.length;y++){const x=s.get(y),M=x.key,E=m.get(M);E?E.push(x):m.set(M,[x])}for(const[y,x]of m){const M={positions:x.map(E=>({x:Math.floor(E.anchorX*Cn),y:Math.floor(E.anchorY*Cn)})),crossTileIDs:x.map(E=>E.crossTileID)};if(M.positions.length>128){const E=new a.aH(M.positions.length,16,Uint16Array);for(const{x:z,y:B}of M.positions)E.add(z,B);E.finish(),delete M.positions,M.index=E}this._symbolsByKey[y]=M}}getScaledCoordinates(n,s){const{x:f,y:m,z:y}=this.tileID.canonical,{x,y:M,z:E}=s.canonical,z=Cn/Math.pow(2,E-y),B=(M*a.$+n.anchorY)*z,j=m*a.$*Cn;return{x:Math.floor((x*a.$+n.anchorX)*z-f*a.$*Cn),y:Math.floor(B-j)}}findMatches(n,s,f){const m=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let y=0;y<n.length;y++){const x=n.get(y);if(x.crossTileID)continue;const M=this._symbolsByKey[x.key];if(!M)continue;const E=this.getScaledCoordinates(x,s);if(M.index){const z=M.index.range(E.x-m,E.y-m,E.x+m,E.y+m).sort();for(const B of z){const j=M.crossTileIDs[B];if(!f[j]){f[j]=!0,x.crossTileID=j;break}}}else if(M.positions)for(let z=0;z<M.positions.length;z++){const B=M.positions[z],j=M.crossTileIDs[z];if(Math.abs(B.x-E.x)<=m&&Math.abs(B.y-E.y)<=m&&!f[j]){f[j]=!0,x.crossTileID=j;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:n})=>n)}}class Ki{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Gr{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const s=Math.round((n-this.lng)/360);if(s!==0)for(const f in this.indexes){const m=this.indexes[f],y={};for(const x in m){const M=m[x];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+s),y[M.tileID.key]=M}this.indexes[f]=y}this.lng=n}addBucket(n,s,f){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let y=0;y<s.symbolInstances.length;y++)s.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]={});const m=this.usedCrossTileIDs[n.overscaledZ];for(const y in this.indexes){const x=this.indexes[y];if(Number(y)>n.overscaledZ)for(const M in x){const E=x[M];E.tileID.isChildOf(n)&&E.findMatches(s.symbolInstances,n,m)}else{const M=x[n.scaledTo(Number(y)).key];M&&M.findMatches(s.symbolInstances,n,m)}}for(let y=0;y<s.symbolInstances.length;y++){const x=s.symbolInstances.get(y);x.crossTileID||(x.crossTileID=f.generate(),m[x.crossTileID]=!0)}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new yi(n,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(n,s){for(const f of s.getCrossTileIDsLists())for(const m of f)delete this.usedCrossTileIDs[n][m]}removeStaleBuckets(n){let s=!1;for(const f in this.indexes){const m=this.indexes[f];for(const y in m)n[m[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,m[y]),delete m[y],s=!0)}return s}}class Bs{constructor(){this.layerIndexes={},this.crossTileIDs=new Ki,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,s,f){let m=this.layerIndexes[n.id];m===void 0&&(m=this.layerIndexes[n.id]=new Gr);let y=!1;const x={};m.handleWrapJump(f);for(const M of s){const E=M.getBucket(n);E&&n.id===E.layerIds[0]&&(E.bucketInstanceId||(E.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(M.tileID,E,this.crossTileIDs)&&(y=!0),x[E.bucketInstanceId]=!0)}return m.removeStaleBuckets(x)&&(y=!0),y}pruneUnusedLayers(n){const s={};n.forEach(f=>{s[f]=!0});for(const f in this.layerIndexes)s[f]||delete this.layerIndexes[f]}}var ba="void main() {fragColor=vec4(1.0);}";const Tr={prelude:Tn(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:Tn("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:Tn("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:Tn(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:Tn(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Tn(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Tn(ba,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:Tn(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:Tn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Tn("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Tn("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:Tn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:Tn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:Tn(ba,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:Tn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:Tn(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:Tn(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:Tn(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Tn(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Tn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Tn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Tn(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:Tn(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Tn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Tn(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Tn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Tn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:Tn(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Tn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Tn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Tn("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Tn("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Tn("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:Tn("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:Tn(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:Tn("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Tn(_,n){const s=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,f=n.match(/in ([\w]+) ([\w]+)/g),m=_.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),y=n.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),x=y?y.concat(m):m,M={};return{fragmentSource:_=_.replace(s,(E,z,B,j,N)=>(M[N]=!0,z==="define"?`
#ifndef HAS_UNIFORM_u_${N}
in ${B} ${j} ${N};
#else
uniform ${B} ${j} u_${N};
#endif
`:`
#ifdef HAS_UNIFORM_u_${N}
    ${B} ${j} ${N} = u_${N};
#endif
`)),vertexSource:n=n.replace(s,(E,z,B,j,N)=>{const V=j==="float"?"vec2":"vec4",Q=N.match(/color/)?"color":V;return M[N]?z==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
in ${B} ${V} a_${N};
out ${B} ${j} ${N};
#else
uniform ${B} ${j} u_${N};
#endif
`:Q==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = a_${N};
#else
    ${B} ${j} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = unpack_mix_${Q}(a_${N}, u_${N}_t);
#else
    ${B} ${j} ${N} = u_${N};
#endif
`:z==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
in ${B} ${V} a_${N};
#else
uniform ${B} ${j} u_${N};
#endif
`:Q==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${B} ${j} ${N} = a_${N};
#else
    ${B} ${j} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${B} ${j} ${N} = unpack_mix_${Q}(a_${N}, u_${N}_t);
#else
    ${B} ${j} ${N} = u_${N};
#endif
`}),staticAttributes:f,staticUniforms:x}}class to{constructor(n,s,f){this.vertexBuffer=n,this.indexBuffer=s,this.segments=f}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var no=a.aI([{name:"a_pos",type:"Int16",components:2}]);const ts="#define PROJECTION_MERCATOR",$h="mercator";class Wh{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return $h}get shaderDefine(){return ts}get shaderPreludeCode(){return Tr.projectionMercator}get vertexShaderPreludeCode(){return Tr.projectionMercator.vertexSource}get subdivisionGranularity(){return a.aJ.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(n){}getMeshFromTileID(n,s,f,m,y){if(this._cachedMesh)return this._cachedMesh;const x=new a.aK;x.emplaceBack(0,0),x.emplaceBack(a.$,0),x.emplaceBack(0,a.$),x.emplaceBack(a.$,a.$);const M=n.createVertexBuffer(x,no.members),E=a.aL.simpleSegment(0,0,4,2),z=new a.aM;z.emplaceBack(1,0,2),z.emplaceBack(1,2,3);const B=n.createIndexBuffer(z);return this._cachedMesh=new to(M,B,E),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(n){}}class da{constructor(n=0,s=0,f=0,m=0){if(isNaN(n)||n<0||isNaN(s)||s<0||isNaN(f)||f<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=s,this.left=f,this.right=m}interpolate(n,s,f){return s.top!=null&&n.top!=null&&(this.top=a.C.number(n.top,s.top,f)),s.bottom!=null&&n.bottom!=null&&(this.bottom=a.C.number(n.bottom,s.bottom,f)),s.left!=null&&n.left!=null&&(this.left=a.C.number(n.left,s.left,f)),s.right!=null&&n.right!=null&&(this.right=a.C.number(n.right,s.right,f)),this}getCenter(n,s){const f=a.ag((this.left+n-this.right)/2,0,n),m=a.ag((this.top+s-this.bottom)/2,0,s);return new a.P(f,m)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new da(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function io(_,n){if(!_.renderWorldCopies||_.lngRange)return;const s=n.lng-_.center.lng;n.lng+=s>180?-360:s<-180?360:0}function zn(_){return Math.max(0,Math.floor(_))}class Rl{constructor(n,s,f,m,y,x){this._callbacks=n,this._tileSize=512,this._renderWorldCopies=x===void 0||!!x,this._minZoom=s||0,this._maxZoom=f||22,this._minPitch=m??0,this._maxPitch=y??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new a.S(0,0),this._elevation=0,this._zoom=0,this._tileZoom=zn(this._zoom),this._scale=a.ae(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new da,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(n,s,f){this._latRange=n.latRange,this._lngRange=n.lngRange,this._width=n.width,this._height=n.height,this._center=n.center,this._elevation=n.elevation,this._minElevationForCurrentTile=n.minElevationForCurrentTile,this._zoom=n.zoom,this._tileZoom=zn(this._zoom),this._scale=a.ae(this._zoom),this._bearingInRadians=n.bearingInRadians,this._fovInRadians=n.fovInRadians,this._pitchInRadians=n.pitchInRadians,this._rollInRadians=n.rollInRadians,this._unmodified=n.unmodified,this._edgeInsets=new da(n.padding.top,n.padding.bottom,n.padding.left,n.padding.right),this._minZoom=n.minZoom,this._maxZoom=n.maxZoom,this._minPitch=n.minPitch,this._maxPitch=n.maxPitch,this._renderWorldCopies=n.renderWorldCopies,this._cameraToCenterDistance=n.cameraToCenterDistance,this._nearZ=n.nearZ,this._farZ=n.farZ,this._autoCalculateNearFarZ=!f&&n.autoCalculateNearFarZ,s&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(n){this._minElevationForCurrentTile=n}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(n){this._minZoom!==n&&(this._minZoom=n,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(n){this._minPitch!==n&&(this._minPitch=n,this.setPitch(Math.max(this.pitch,n)))}get maxPitch(){return this._maxPitch}setMaxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.setPitch(Math.min(this.pitch,n)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(n){const s=a.aN(n,-180,180)*Math.PI/180;var f,m,y,x,M,E,z,B,j;this._bearingInRadians!==s&&(this._unmodified=!1,this._bearingInRadians=s,this._calcMatrices(),this._rotationMatrix=T(),f=this._rotationMatrix,y=-this._bearingInRadians,x=(m=this._rotationMatrix)[0],M=m[1],E=m[2],z=m[3],B=Math.sin(y),j=Math.cos(y),f[0]=x*j+E*B,f[1]=M*j+z*B,f[2]=x*-B+E*j,f[3]=M*-B+z*j)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(n){const s=a.ag(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==s&&(this._unmodified=!1,this._pitchInRadians=s,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(n){const s=n/180*Math.PI;this._rollInRadians!==s&&(this._unmodified=!1,this._rollInRadians=s,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return a.aO(this._fovInRadians)}setFov(n){n=a.ag(n,.1,150),this.fov!==n&&(this._unmodified=!1,this._fovInRadians=a.ad(n),this._calcMatrices())}get zoom(){return this._zoom}setZoom(n){const s=this.getConstrained(this._center,n).zoom;this._zoom!==s&&(this._unmodified=!1,this._zoom=s,this._tileZoom=Math.max(0,Math.floor(s)),this._scale=a.ae(s),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(n){n!==this._elevation&&(this._elevation=n,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(n,s){this._autoCalculateNearFarZ=!1,this._nearZ=n,this._farZ=s,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,s,f){this._unmodified=!1,this._edgeInsets.interpolate(n,s,f),this._constrain(),this._calcMatrices()}resize(n,s,f=!0){this._width=n,this._height=s,f&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new wt([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(n){n?(this._lngRange=[n.getWest(),n.getEast()],this._latRange=[n.getSouth(),n.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-a.ah,a.ah])}getConstrained(n,s){return this._callbacks.getConstrained(n,s)}getCameraQueryGeometry(n,s){if(s.length===1)return[s[0],n];{const{minX:f,minY:m,maxX:y,maxY:x}=a.a1.fromPoints(s).extend(n);return[new a.P(f,m),new a.P(y,m),new a.P(y,x),new a.P(f,x),new a.P(f,m)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const n=this._unmodified,{center:s,zoom:f}=this.getConstrained(this.center,this.zoom);this.setCenter(s),this.setZoom(f),this._unmodified=n,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let n=a.af(new Float64Array(16));a.N(n,n,[this._width/2,-this._height/2,1]),a.M(n,n,[1,-1,0]),this._clipSpaceToPixelsMatrix=n,n=a.af(new Float64Array(16)),a.N(n,n,[1,-1,1]),a.M(n,n,[-1,-1,0]),a.N(n,n,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=n,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(n,s,f,m){const y=f!==void 0?f:this.bearing,x=m=m!==void 0?m:this.pitch,M=a.a0.fromLngLat(n,s),E=-Math.cos(a.ad(x)),z=Math.sin(a.ad(x)),B=z*Math.sin(a.ad(y)),j=-z*Math.cos(a.ad(y));let N=this.elevation;const V=s-N;let Q;E*V>=0||Math.abs(E)<.1?(Q=1e4,N=s+Q*E):Q=-V/E;let se,oe,le=a.aP(1,M.y),de=0;do{if(de+=1,de>10)break;oe=Q/le,se=new a.a0(M.x+B*oe,M.y+j*oe),le=1/se.meterInMercatorCoordinateUnits()}while(Math.abs(Q-oe*le)>1e-12);return{center:se.toLngLat(),elevation:N,zoom:a.aj(this.height/2/Math.tan(this.fovInRadians/2)/oe/this.tileSize)}}recalculateZoomAndCenter(n){if(this.elevation-n==0)return;const s=a.ai(1,this.center.lat)*this.worldSize,f=this.cameraToCenterDistance/s,m=a.a0.fromLngLat(this.center,this.elevation),y=pe(this.center,this.elevation,this.pitch,this.bearing,f);this._elevation=n;const x=this.calculateCenterFromCameraLngLatAlt(y.toLngLat(),a.aP(y.z,m.y),this.bearing,this.pitch);this._elevation=x.elevation,this._center=x.center,this.setZoom(x.zoom)}getCameraPoint(){const n=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(n*Math.sin(this.rollInRadians),n*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const n=a.ai(1,this.center.lat)*this.worldSize;return pe(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/n).toLngLat()}getMercatorTileCoordinates(n){if(!n)return[0,0,1,1];const s=n.canonical.z>=0?1<<n.canonical.z:Math.pow(2,n.canonical.z);return[n.canonical.x/s,n.canonical.y/s,1/s/a.$,1/s/a.$]}}class iu{constructor(n,s){this.min=n,this.max=s,this.center=a.aQ([],a.aR([],this.min,this.max),.5)}quadrant(n){const s=[n%2==0,n<2],f=a.aS(this.min),m=a.aS(this.max);for(let y=0;y<s.length;y++)f[y]=s[y]?this.min[y]:this.center[y],m[y]=s[y]?this.center[y]:this.max[y];return m[2]=this.max[2],new iu(f,m)}distanceX(n){return Math.max(Math.min(this.max[0],n[0]),this.min[0])-n[0]}distanceY(n){return Math.max(Math.min(this.max[1],n[1]),this.min[1])-n[1]}intersectsFrustum(n){let s=!0;for(let f=0;f<n.planes.length;f++){const m=this.intersectsPlane(n.planes[f]);if(m===0)return 0;m===1&&(s=!1)}return s?2:n.aabb.min[0]>this.max[0]||n.aabb.min[1]>this.max[1]||n.aabb.min[2]>this.max[2]||n.aabb.max[0]<this.min[0]||n.aabb.max[1]<this.min[1]||n.aabb.max[2]<this.min[2]?0:1}intersectsPlane(n){let s=n[3],f=n[3];for(let m=0;m<3;m++)n[m]>0?(s+=n[m]*this.min[m],f+=n[m]*this.max[m]):(f+=n[m]*this.min[m],s+=n[m]*this.max[m]);return s>=0?2:f<0?0:1}}class Yh{distanceToTile2d(n,s,f,m){const y=m.distanceX([n,s]),x=m.distanceY([n,s]);return Math.hypot(y,x)}getWrap(n,s,f){return f}getTileBoundingVolume(n,s,f,m){var y,x;let M=f,E=f;if(m!=null&&m.terrain){const B=new a.Z(n.z,s,n.z,n.x,n.y),j=m.terrain.getMinMaxElevation(B);M=(y=j.minElevation)!==null&&y!==void 0?y:f,E=(x=j.maxElevation)!==null&&x!==void 0?x:f}const z=1<<n.z;return new iu([s+n.x/z,n.y/z,M],[s+(n.x+1)/z,(n.y+1)/z,E])}allowVariableZoom(n,s){const f=n.fov*(Math.abs(Math.cos(n.rollInRadians))*n.height+Math.abs(Math.sin(n.rollInRadians))*n.width)/n.height,m=a.ag(78.5-f/2,0,60);return!!s.terrain||n.pitch>m}allowWorldCopies(){return!0}prepareNextFrame(){}}class Sr{constructor(n,s,f){this.points=n,this.planes=s,this.aabb=f}static fromInvProjectionMatrix(n,s=1,f=0,m,y){const x=y?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],M=Math.pow(2,f),E=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(N=>function(V,Q,se,oe){const le=a.av([],V,Q),de=1/le[3]/se*oe;return a.aX(le,le,[de,de,1/le[3],de])}(N,n,s,M));m&&function(N,V,Q,se){const oe=se?4:0,le=se?0:4;let de=0;const _e=[],me=[];for(let ge=0;ge<4;ge++){const ze=a.aT([],N[ge+le],N[ge+oe]),$e=a.aY(ze);a.aQ(ze,ze,1/$e),_e.push($e),me.push(ze)}for(let ge=0;ge<4;ge++){const ze=a.aZ(N[ge+oe],me[ge],Q);de=ze!==null&&ze>=0?Math.max(de,ze):Math.max(de,_e[ge])}const xe=function(ge,ze){const $e=a.aT([],ge[ze[0]],ge[ze[1]]),Ne=a.aT([],ge[ze[2]],ge[ze[1]]),je=[0,0,0,0];return a.aU(je,a.aV([],$e,Ne)),je[3]=-a.aW(je,ge[ze[0]]),je}(N,V),Te=function(ge,ze){const $e=a.a_(ge),Ne=a.a$([],ge,1/$e),je=a.aT([],ze,a.aQ([],Ne,a.aW(ze,Ne))),We=a.a_(je);if(We>0){const zt=Math.sqrt(1-Ne[3]*Ne[3]),Ct=a.aQ([],Ne,-Ne[3]),ft=a.aR([],Ct,a.aQ([],je,zt/We));return a.b0(ze,ft)}return null}(Q,xe);if(Te!==null){const ge=Te/a.aW(me[0],xe);de=Math.min(de,ge)}for(let ge=0;ge<4;ge++){const ze=Math.min(de,_e[ge]);N[ge+le]=[N[ge+oe][0]+me[ge][0]*ze,N[ge+oe][1]+me[ge][1]*ze,N[ge+oe][2]+me[ge][2]*ze,1]}}(E,x[0],m,y);const z=x.map(N=>{const V=a.aT([],E[N[0]],E[N[1]]),Q=a.aT([],E[N[2]],E[N[1]]),se=a.aU([],a.aV([],V,Q)),oe=-a.aW(se,E[N[1]]);return se.concat(oe)}),B=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],j=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const N of E)for(let V=0;V<3;V++)B[V]=Math.min(B[V],N[V]),j[V]=Math.max(j[V],N[V]);return new Sr(E,z,new iu(B,j))}}class Zi{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(n){this._helper.setMinZoom(n)}setMaxZoom(n){this._helper.setMaxZoom(n)}setMinPitch(n){this._helper.setMinPitch(n)}setMaxPitch(n){this._helper.setMaxPitch(n)}setRenderWorldCopies(n){this._helper.setRenderWorldCopies(n)}setBearing(n){this._helper.setBearing(n)}setPitch(n){this._helper.setPitch(n)}setRoll(n){this._helper.setRoll(n)}setFov(n){this._helper.setFov(n)}setZoom(n){this._helper.setZoom(n)}setCenter(n){this._helper.setCenter(n)}setElevation(n){this._helper.setElevation(n)}setMinElevationForCurrentTile(n){this._helper.setMinElevationForCurrentTile(n)}setPadding(n){this._helper.setPadding(n)}interpolatePadding(n,s,f){return this._helper.interpolatePadding(n,s,f)}isPaddingEqual(n){return this._helper.isPaddingEqual(n)}resize(n,s,f=!0){this._helper.resize(n,s,f)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(n){this._helper.setMaxBounds(n)}overrideNearFarZ(n,s){this._helper.overrideNearFarZ(n,s)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(n){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),n)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(n,s){}constructor(n,s,f,m,y){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new Rl({calcMatrices:()=>{this._calcMatrices()},getConstrained:(x,M)=>this.getConstrained(x,M)},n,s,f,m,y),this._coveringTilesDetailsProvider=new Yh}clone(){const n=new Zi;return n.apply(this),n}apply(n,s,f){this._helper.apply(n,s,f)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(n){const s=[new a.b1(0,n)];if(this._helper._renderWorldCopies){const f=this.screenPointToMercatorCoordinate(new a.P(0,0)),m=this.screenPointToMercatorCoordinate(new a.P(this._helper._width,0)),y=this.screenPointToMercatorCoordinate(new a.P(this._helper._width,this._helper._height)),x=this.screenPointToMercatorCoordinate(new a.P(0,this._helper._height)),M=Math.floor(Math.min(f.x,m.x,y.x,x.x)),E=Math.floor(Math.max(f.x,m.x,y.x,x.x)),z=1;for(let B=M-z;B<=E+z;B++)B!==0&&s.push(new a.b1(B,n))}return s}getCameraFrustum(){return Sr.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(n){const s=this.screenPointToLocation(this.centerPoint,n),f=n?n.getElevationForLngLatZoom(s,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(f)}setLocationAtPoint(n,s){const f=a.ai(this.elevation,this.center.lat),m=this.screenPointToMercatorCoordinateAtZ(s,f),y=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,f),x=a.a0.fromLngLat(n),M=new a.a0(x.x-(m.x-y.x),x.y-(m.y-y.y));this.setCenter(M==null?void 0:M.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(n,s){return s?this.coordinatePoint(a.a0.fromLngLat(n),s.getElevationForLngLatZoom(n,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(a.a0.fromLngLat(n))}screenPointToLocation(n,s){var f;return(f=this.screenPointToMercatorCoordinate(n,s))===null||f===void 0?void 0:f.toLngLat()}screenPointToMercatorCoordinate(n,s){if(s){const f=s.pointCoordinate(n);if(f!=null)return f}return this.screenPointToMercatorCoordinateAtZ(n)}screenPointToMercatorCoordinateAtZ(n,s){const f=s||0,m=[n.x,n.y,0,1],y=[n.x,n.y,1,1];a.av(m,m,this._pixelMatrixInverse),a.av(y,y,this._pixelMatrixInverse);const x=m[3],M=y[3],E=m[1]/x,z=y[1]/M,B=m[2]/x,j=y[2]/M,N=B===j?0:(f-B)/(j-B);return new a.a0(a.C.number(m[0]/x,y[0]/M,N)/this.worldSize,a.C.number(E,z,N)/this.worldSize,f)}coordinatePoint(n,s=0,f=this._pixelMatrix){const m=[n.x*this.worldSize,n.y*this.worldSize,s,1];return a.av(m,m,f),new a.P(m[0]/m[3],m[1]/m[3])}getBounds(){const n=Math.max(0,this._helper._height/2-K(this));return new wt().extend(this.screenPointToLocation(new a.P(0,n))).extend(this.screenPointToLocation(new a.P(this._helper._width,n))).extend(this.screenPointToLocation(new a.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new a.P(0,this._helper._height)))}isPointOnMapSurface(n,s){return s?s.pointCoordinate(n)!=null:n.y>this.height/2-K(this)}calculatePosMatrix(n,s=!1,f){var m;const y=(m=n.key)!==null&&m!==void 0?m:a.b2(n.wrap,n.canonical.z,n.canonical.z,n.canonical.x,n.canonical.y),x=s?this._alignedPosMatrixCache:this._posMatrixCache;if(x.has(y)){const z=x.get(y);return f?z.f32:z.f64}const M=te(n,this.worldSize);a.O(M,s?this._alignedProjMatrix:this._viewProjMatrix,M);const E={f64:M,f32:new Float32Array(M)};return x.set(y,E),f?E.f32:E.f64}calculateFogMatrix(n){const s=n.key,f=this._fogMatrixCacheF32;if(f.has(s))return f.get(s);const m=te(n,this.worldSize);return a.O(m,this._fogMatrix,m),f.set(s,new Float32Array(m)),f.get(s)}getConstrained(n,s){s=a.ag(+s,this.minZoom,this.maxZoom);const f={center:new a.S(n.lng,n.lat),zoom:s};let m=this._helper._lngRange;if(!this._helper._renderWorldCopies&&m===null){const _e=179.9999999999;m=[-_e,_e]}const y=this.tileSize*a.ae(f.zoom);let x=0,M=y,E=0,z=y,B=0,j=0;const{x:N,y:V}=this.size;if(this._helper._latRange){const _e=this._helper._latRange;x=a.U(_e[1])*y,M=a.U(_e[0])*y,M-x<V&&(B=V/(M-x))}m&&(E=a.aN(a.V(m[0])*y,0,y),z=a.aN(a.V(m[1])*y,0,y),z<E&&(z+=y),z-E<N&&(j=N/(z-E)));const{x:Q,y:se}=Ce(y,n);let oe,le;const de=Math.max(j||0,B||0);if(de){const _e=new a.P(j?(z+E)/2:Q,B?(M+x)/2:se);return f.center=X(y,_e).wrap(),f.zoom+=a.aj(de),f}if(this._helper._latRange){const _e=V/2;se-_e<x&&(le=x+_e),se+_e>M&&(le=M-_e)}if(m){const _e=(E+z)/2;let me=Q;this._helper._renderWorldCopies&&(me=a.aN(Q,_e-y/2,_e+y/2));const xe=N/2;me-xe<E&&(oe=E+xe),me+xe>z&&(oe=z-xe)}if(oe!==void 0||le!==void 0){const _e=new a.P(oe??Q,le??se);f.center=X(y,_e).wrap()}return f}calculateCenterFromCameraLngLatAlt(n,s,f,m){return this._helper.calculateCenterFromCameraLngLatAlt(n,s,f,m)}_calculateNearFarZIfNeeded(n,s,f){if(!this._helper.autoCalculateNearFarZ)return;const m=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),y=n-m*this._helper._pixelPerMeter/Math.cos(s),x=m<0?y:n,M=Math.PI/2+this.pitchInRadians,E=a.ad(this.fov)*(Math.abs(Math.cos(a.ad(this.roll)))*this.height+Math.abs(Math.sin(a.ad(this.roll)))*this.width)/this.height*(.5+f.y/this.height),z=Math.sin(E)*x/Math.sin(a.ag(Math.PI-M-E,.01,Math.PI-.01)),B=K(this),j=Math.atan(B/this._helper.cameraToCenterDistance),N=a.ad(.75),V=j>N?2*j*(.5+f.y/(2*B)):N,Q=Math.sin(V)*x/Math.sin(a.ag(Math.PI-M-V,.01,Math.PI-.01)),se=Math.min(z,Q);this._helper._farZ=1.01*(Math.cos(Math.PI/2-s)*se+x),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const n=this.centerOffset,s=Ce(this.worldSize,this.center),f=s.x,m=s.y;this._helper._pixelPerMeter=a.ai(1,this.center.lat)*this.worldSize;const y=a.ad(Math.min(this.pitch,wi)),x=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(y));let M;this._calculateNearFarZIfNeeded(x,y,n),M=new Float64Array(16),a.b3(M,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),a.ap(this._invProjMatrix,M),M[8]=2*-n.x/this._helper._width,M[9]=2*n.y/this._helper._height,this._projectionMatrix=a.b4(M),a.N(M,M,[1,-1,1]),a.M(M,M,[0,0,-this._helper.cameraToCenterDistance]),a.b5(M,M,-this.rollInRadians),a.b6(M,M,this.pitchInRadians),a.b5(M,M,-this.bearingInRadians),a.M(M,M,[-f,-m,0]),this._mercatorMatrix=a.N([],M,[this.worldSize,this.worldSize,this.worldSize]),a.N(M,M,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=a.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,M),a.M(M,M,[0,0,-this.elevation]),this._viewProjMatrix=M,this._invViewProjMatrix=a.ap([],M);const E=[0,0,-1,1];a.av(E,E,this._invViewProjMatrix),this._cameraPosition=[E[0]/E[3],E[1]/E[3],E[2]/E[3]],this._fogMatrix=new Float64Array(16),a.b3(this._fogMatrix,this.fovInRadians,this.width/this.height,x,this._helper._farZ),this._fogMatrix[8]=2*-n.x/this.width,this._fogMatrix[9]=2*n.y/this.height,a.N(this._fogMatrix,this._fogMatrix,[1,-1,1]),a.M(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),a.b5(this._fogMatrix,this._fogMatrix,-this.rollInRadians),a.b6(this._fogMatrix,this._fogMatrix,this.pitchInRadians),a.b5(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),a.M(this._fogMatrix,this._fogMatrix,[-f,-m,0]),a.N(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),a.M(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=a.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,M);const z=this._helper._width%2/2,B=this._helper._height%2/2,j=Math.cos(this.bearingInRadians),N=Math.sin(-this.bearingInRadians),V=f-Math.round(f)+j*z+N*B,Q=m-Math.round(m)+j*B+N*z,se=new Float64Array(M);if(a.M(se,se,[V>.5?V-1:V,Q>.5?Q-1:Q,0]),this._alignedProjMatrix=se,M=a.ap(new Float64Array(16),this._pixelMatrix),!M)throw new Error("failed to invert matrix");this._pixelMatrixInverse=M,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const n=this.screenPointToMercatorCoordinate(new a.P(0,0)),s=[n.x*this.worldSize,n.y*this.worldSize,0,1];return a.av(s,s,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const n=a.ai(1,this.center.lat)*this.worldSize;return pe(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/n).toLngLat()}lngLatToCameraDepth(n,s){const f=a.a0.fromLngLat(n),m=[f.x*this.worldSize,f.y*this.worldSize,s,1];return a.av(m,m,this._viewProjMatrix),m[2]/m[3]}getProjectionData(n){const{overscaledTileID:s,aligned:f,applyTerrainMatrix:m}=n,y=this._helper.getMercatorTileCoordinates(s),x=s?this.calculatePosMatrix(s,f,!0):null;let M;return M=s&&s.terrainRttPosMatrix32f&&m?s.terrainRttPosMatrix32f:x||a.b7(),{mainMatrix:M,tileMercatorCoords:y,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:M}}isLocationOccluded(n){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(n,s,f){return 1}transformLightDirection(n){return a.aS(n)}getRayDirectionFromPixel(n){throw new Error("Not implemented.")}projectTileCoordinates(n,s,f,m){const y=this.calculatePosMatrix(f);let x;m?(x=[n,s,m(n,s),1],a.av(x,x,y)):(x=[n,s,0,1],lt(x,x,y));const M=x[3];return{point:new a.P(x[0]/M,x[1]/M),signedDistanceFromCamera:M,isOccluded:!1}}populateCache(n){for(const s of n)this.calculatePosMatrix(s)}getMatrixForModel(n,s){const f=a.a0.fromLngLat(n,s),m=f.meterInMercatorCoordinateUnits(),y=a.b8();return a.M(y,y,[f.x,f.y,f.z]),a.b5(y,y,Math.PI),a.b6(y,y,Math.PI/2),a.N(y,y,[-m,m,m]),y}getProjectionDataForCustomLayer(n=!0){const s=new a.Z(0,0,0,0,0),f=this.getProjectionData({overscaledTileID:s,applyGlobeMatrix:n}),m=te(s,this.worldSize);a.O(m,this._viewProjMatrix,m),f.tileMercatorCoords=[0,0,1,1];const y=[a.$,a.$,this.worldSize/this._helper.pixelsPerMeter],x=a.b9();return a.N(x,m,y),f.fallbackMatrix=x,f.mainMatrix=x,f}getFastPathSimpleProjectionMatrix(n){return this.calculatePosMatrix(n)}}function Mr(){a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function rr(_){if(_.useSlerp)if(_.k<1){const n=a.ba(_.startEulerAngles.roll,_.startEulerAngles.pitch,_.startEulerAngles.bearing),s=a.ba(_.endEulerAngles.roll,_.endEulerAngles.pitch,_.endEulerAngles.bearing),f=new Float64Array(4);a.bb(f,n,s,_.k);const m=a.bc(f);_.tr.setRoll(m.roll),_.tr.setPitch(m.pitch),_.tr.setBearing(m.bearing)}else _.tr.setRoll(_.endEulerAngles.roll),_.tr.setPitch(_.endEulerAngles.pitch),_.tr.setBearing(_.endEulerAngles.bearing);else _.tr.setRoll(a.C.number(_.startEulerAngles.roll,_.endEulerAngles.roll,_.k)),_.tr.setPitch(a.C.number(_.startEulerAngles.pitch,_.endEulerAngles.pitch,_.k)),_.tr.setBearing(a.C.number(_.startEulerAngles.bearing,_.endEulerAngles.bearing,_.k))}function zi(_,n,s,f,m){const y=m.padding,x=Ce(m.worldSize,s.getNorthWest()),M=Ce(m.worldSize,s.getNorthEast()),E=Ce(m.worldSize,s.getSouthEast()),z=Ce(m.worldSize,s.getSouthWest()),B=a.ad(-f),j=x.rotate(B),N=M.rotate(B),V=E.rotate(B),Q=z.rotate(B),se=new a.P(Math.max(j.x,N.x,Q.x,V.x),Math.max(j.y,N.y,Q.y,V.y)),oe=new a.P(Math.min(j.x,N.x,Q.x,V.x),Math.min(j.y,N.y,Q.y,V.y)),le=se.sub(oe),de=(m.width-(y.left+y.right+n.left+n.right))/le.x,_e=(m.height-(y.top+y.bottom+n.top+n.bottom))/le.y;if(_e<0||de<0)return void Mr();const me=Math.min(a.aj(m.scale*Math.min(de,_e)),_.maxZoom),xe=a.P.convert(_.offset),Te=new a.P((n.left-n.right)/2,(n.top-n.bottom)/2).rotate(a.ad(f)),ge=xe.add(Te).mult(m.scale/a.ae(me));return{center:X(m.worldSize,x.add(E).div(2).sub(ge)),zoom:me,bearing:f}}class ru{get useGlobeControls(){return!1}handlePanInertia(n,s){return{easingOffset:n,easingCenter:s.center}}handleMapControlsRollPitchBearingZoom(n,s){n.bearingDelta&&s.setBearing(s.bearing+n.bearingDelta),n.pitchDelta&&s.setPitch(s.pitch+n.pitchDelta),n.rollDelta&&s.setRoll(s.roll+n.rollDelta),n.zoomDelta&&s.setZoom(s.zoom+n.zoomDelta)}handleMapControlsPan(n,s,f){n.around.distSqr(s.centerPoint)<.01||s.setLocationAtPoint(f,n.around)}cameraForBoxAndBearing(n,s,f,m,y){return zi(n,s,f,m,y)}handleJumpToCenterZoom(n,s){n.zoom!==(s.zoom!==void 0?+s.zoom:n.zoom)&&n.setZoom(+s.zoom),s.center!==void 0&&n.setCenter(a.S.convert(s.center))}handleEaseTo(n,s){const f=n.zoom,m=n.padding,y={roll:n.roll,pitch:n.pitch,bearing:n.bearing},x={roll:s.roll===void 0?n.roll:s.roll,pitch:s.pitch===void 0?n.pitch:s.pitch,bearing:s.bearing===void 0?n.bearing:s.bearing},M=s.zoom!==void 0,E=!n.isPaddingEqual(s.padding);let z=!1;const B=M?+s.zoom:n.zoom;let j=n.centerPoint.add(s.offsetAsPoint);const N=n.screenPointToLocation(j),{center:V,zoom:Q}=n.getConstrained(a.S.convert(s.center||N),B??f);io(n,V);const se=Ce(n.worldSize,N),oe=Ce(n.worldSize,V).sub(se),le=a.ae(Q-f);return z=Q!==f,{easeFunc:de=>{if(z&&n.setZoom(a.C.number(f,Q,de)),a.bd(y,x)||rr({startEulerAngles:y,endEulerAngles:x,tr:n,k:de,useSlerp:y.roll!=x.roll}),E&&(n.interpolatePadding(m,s.padding,de),j=n.centerPoint.add(s.offsetAsPoint)),s.around)n.setLocationAtPoint(s.around,s.aroundPoint);else{const _e=a.ae(n.zoom-f),me=Q>f?Math.min(2,le):Math.max(.5,le),xe=Math.pow(me,1-de),Te=X(n.worldSize,se.add(oe.mult(de*xe)).mult(_e));n.setLocationAtPoint(n.renderWorldCopies?Te.wrap():Te,j)}},isZooming:z,elevationCenter:V}}handleFlyTo(n,s){const f=s.zoom!==void 0,m=n.zoom,y=n.getConstrained(a.S.convert(s.center||s.locationAtOffset),f?+s.zoom:m),x=y.center,M=y.zoom;io(n,x);const E=Ce(n.worldSize,s.locationAtOffset),z=Ce(n.worldSize,x).sub(E),B=z.mag(),j=a.ae(M-m);let N;if(s.minZoom!==void 0){const V=Math.min(+s.minZoom,m,M),Q=n.getConstrained(x,V).zoom;N=a.ae(Q-m)}return{easeFunc:(V,Q,se,oe)=>{n.setZoom(V===1?M:m+a.aj(Q));const le=V===1?x:X(n.worldSize,E.add(z.mult(se)).mult(Q));n.setLocationAtPoint(n.renderWorldCopies?le.wrap():le,oe)},scaleOfZoom:j,targetCenter:x,scaleOfMinZoom:N,pixelPathLength:B}}}class Hn{constructor(n,s,f){this.blendFunction=n,this.blendColor=s,this.mask=f}}Hn.Replace=[1,0],Hn.disabled=new Hn(Hn.Replace,a.be.transparent,[!1,!1,!1,!1]),Hn.unblended=new Hn(Hn.Replace,a.be.transparent,[!0,!0,!0,!0]),Hn.alphaBlended=new Hn([1,771],a.be.transparent,[!0,!0,!0,!0]);const qr=2305;class xn{constructor(n,s,f){this.enable=n,this.mode=s,this.frontFace=f}}xn.disabled=new xn(!1,1029,qr),xn.backCCW=new xn(!0,1029,qr),xn.frontCCW=new xn(!0,1028,qr);class Sn{constructor(n,s,f){this.func=n,this.mask=s,this.range=f}}Sn.ReadOnly=!1,Sn.ReadWrite=!0,Sn.disabled=new Sn(519,Sn.ReadOnly,[0,1]);const ns=7680;class dn{constructor(n,s,f,m,y,x){this.test=n,this.ref=s,this.mask=f,this.fail=m,this.depthFail=y,this.pass=x}}dn.disabled=new dn({func:519,mask:0},0,0,ns,ns,ns);const is=new WeakMap;function zr(_){var n;if(is.has(_))return is.get(_);{const s=(n=_.getParameter(_.VERSION))===null||n===void 0?void 0:n.startsWith("WebGL 2.0");return is.set(_,s),s}}class Fs{get awaitingQuery(){return!!this._readbackQueue}constructor(n){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=n;const s=n.context,f=s.gl;this._texFormat=f.RGBA,this._texType=f.UNSIGNED_BYTE;const m=new a.aK;m.emplaceBack(-1,-1),m.emplaceBack(2,-1),m.emplaceBack(-1,2);const y=new a.aM;y.emplaceBack(0,1,2),this._fullscreenTriangle=new to(s.createVertexBuffer(m,no.members),s.createIndexBuffer(y),a.aL.simpleSegment(0,0,m.length,y.length)),this._resultBuffer=new Uint8Array(4),s.activeTexture.set(f.TEXTURE1);const x=f.createTexture();f.bindTexture(f.TEXTURE_2D,x),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.NEAREST),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.NEAREST),f.texImage2D(f.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=s.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(x),zr(f)&&(this._pbo=f.createBuffer(),f.bindBuffer(f.PIXEL_PACK_BUFFER,this._pbo),f.bufferData(f.PIXEL_PACK_BUFFER,4,f.STREAM_READ),f.bindBuffer(f.PIXEL_PACK_BUFFER,null))}destroy(){const n=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),n.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(n,s){const f=this._updateCount;return this._readbackQueue?f>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():f>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(n,s),this._updateCount++,this._measuredError}_bindFramebuffer(){const n=this._cachedRenderContext.context,s=n.gl;n.activeTexture.set(s.TEXTURE1),s.bindTexture(s.TEXTURE_2D,this._fbo.colorAttachment.get()),n.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(n,s){const f=this._cachedRenderContext.context,m=f.gl;if(this._bindFramebuffer(),f.viewport.set([0,0,this._texWidth,this._texHeight]),f.clear({color:a.be.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(f,m.TRIANGLES,Sn.disabled,dn.disabled,Hn.unblended,xn.disabled,((y,x)=>({u_input:y,u_output_expected:x}))(n,s),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&zr(m)){m.bindBuffer(m.PIXEL_PACK_BUFFER,this._pbo),m.readBuffer(m.COLOR_ATTACHMENT0),m.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),m.bindBuffer(m.PIXEL_PACK_BUFFER,null);const y=m.fenceSync(m.SYNC_GPU_COMMANDS_COMPLETE,0);m.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:y}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const n=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&zr(n)){const s=n.clientWaitSync(this._readbackQueue.sync,0,0);if(s===n.WAIT_FAILED)return a.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(s===n.TIMEOUT_EXPIRED)return;n.bindBuffer(n.PIXEL_PACK_BUFFER,this._pbo),n.getBufferSubData(n.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),n.bindBuffer(n.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),n.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Fs._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(n){let s=0;return s+=n[0]/256,s+=n[1]/65536,s+=n[2]/16777216,n[3]<127&&(s=-s),s/128}}const Zr=a.$/128;function Xh(_,n){const s=_.granularity!==void 0?Math.max(_.granularity,1):1,f=s+(_.generateBorders?2:0),m=s+(_.extendToNorthPole||_.generateBorders?1:0)+(_.extendToSouthPole||_.generateBorders?1:0),y=f+1,x=m+1,M=_.generateBorders?-1:0,E=_.generateBorders||_.extendToNorthPole?-1:0,z=s+(_.generateBorders?1:0),B=s+(_.generateBorders||_.extendToSouthPole?1:0),j=y*x,N=f*m*6,V=y*x>65536;if(V&&n==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const Q=V||n==="32bit",se=new Int16Array(2*j);let oe=0;for(let _e=E;_e<=B;_e++)for(let me=M;me<=z;me++){let xe=me/s*a.$;me===-1&&(xe=-Zr),me===s+1&&(xe=a.$+Zr);let Te=_e/s*a.$;_e===-1&&(Te=_.extendToNorthPole?a.bg:-Zr),_e===s+1&&(Te=_.extendToSouthPole?a.bh:a.$+Zr),se[oe++]=xe,se[oe++]=Te}const le=Q?new Uint32Array(N):new Uint16Array(N);let de=0;for(let _e=0;_e<m;_e++)for(let me=0;me<f;me++){const xe=me+1+_e*y,Te=me+(_e+1)*y,ge=me+1+(_e+1)*y;le[de++]=me+_e*y,le[de++]=Te,le[de++]=xe,le[de++]=xe,le[de++]=Te,le[de++]=ge}return{vertices:se.buffer.slice(0),indices:le.buffer.slice(0),uses32bitIndices:Q}}const Fa=new a.aJ({fill:new a.bi(128,2),line:new a.bi(512,0),tile:new a.bi(128,32),stencil:new a.bi(128,1),circle:3});class zp{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Tr.projectionGlobe}get vertexShaderPreludeCode(){return Tr.projectionMercator.vertexSource}get subdivisionGranularity(){return Fa}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(n){this._errorMeasurement||(this._errorMeasurement=new Fs(n));const s=a.U(this._errorQueryLatitudeDegrees),f=2*Math.atan(Math.exp(Math.PI-s*Math.PI*2))-.5*Math.PI,m=this._errorMeasurement.updateErrorLoop(s,f),y=I.now();m!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=m,this._errorMeasurementLastChangeTime=y);const x=Math.min(Math.max((y-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=a.bj(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,a.bk(x))}_getMeshKey(n){return`${n.granularity.toString(36)}_${n.generateBorders?"b":""}${n.extendToNorthPole?"n":""}${n.extendToSouthPole?"s":""}`}getMeshFromTileID(n,s,f,m,y){const x=(y==="stencil"?Fa.stencil:Fa.tile).getGranularityForZoomLevel(s.z);return this._getMesh(n,{granularity:x,generateBorders:f,extendToNorthPole:s.y===0&&m,extendToSouthPole:s.y===(1<<s.z)-1&&m})}_getMesh(n,s){const f=this._getMeshKey(s);if(f in this._tileMeshCache)return this._tileMeshCache[f];const m=function(y,x){const M=Xh(x,"16bit"),E=a.aK.deserialize({arrayBuffer:M.vertices,length:M.vertices.byteLength/2/2}),z=a.aM.deserialize({arrayBuffer:M.indices,length:M.indices.byteLength/2/3});return new to(y.createVertexBuffer(E,no.members),y.createIndexBuffer(z),a.aL.simpleSegment(0,0,E.length,z.length))}(n,s);return this._tileMeshCache[f]=m,m}recalculate(n){}hasTransition(){const n=I.now();let s=!1;return s=s||(n-this._errorMeasurementLastChangeTime)/1e3<.7,s=s||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,s}setErrorQueryLatitudeDegrees(n){this._errorQueryLatitudeDegrees=n}}const Rp=new a.r({type:new a.D(a.v.projection.type)});class Ll extends a.E{constructor(n){super(),this._transitionable=new a.t(Rp),this.setProjection(n),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new a.F(0)),this._mercatorProjection=new Wh,this._verticalPerspectiveProjection=new zp}get transitionState(){const n=this.properties.get("type");if(typeof n=="string"&&n==="mercator")return 0;if(typeof n=="string"&&n==="vertical-perspective")return 1;if(n instanceof a.bl){if(n.from==="vertical-perspective"&&n.to==="mercator")return 1-n.transition;if(n.from==="mercator"&&n.to==="vertical-perspective")return n.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(n){this._mercatorProjection.updateGPUdependent(n),this._verticalPerspectiveProjection.updateGPUdependent(n)}getMeshFromTileID(n,s,f,m,y){return this.currentProjection.getMeshFromTileID(n,s,f,m,y)}setProjection(n){this._transitionable.setValue("type",(n==null?void 0:n.type)||"mercator")}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}setErrorQueryLatitudeDegrees(n){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(n),this._mercatorProjection.setErrorQueryLatitudeDegrees(n)}}function Bl(_){const n=Os(_.worldSize,_.center.lat);return 2*Math.PI*n}function xa(_,n,s,f,m){const y=1/(1<<m),x=n/a.$*y+f*y,M=a.bn((_/a.$*y+s*y)*Math.PI*2+Math.PI,2*Math.PI),E=2*Math.atan(Math.exp(Math.PI-x*Math.PI*2))-.5*Math.PI,z=Math.cos(E),B=new Float64Array(3);return B[0]=Math.sin(M)*z,B[1]=Math.sin(E),B[2]=Math.cos(M)*z,B}function ar(_){return function(n,s){const f=Math.cos(s),m=new Float64Array(3);return m[0]=Math.sin(n)*f,m[1]=Math.sin(s),m[2]=Math.cos(n)*f,m}(_.lng*Math.PI/180,_.lat*Math.PI/180)}function Os(_,n){return _/(2*Math.PI)/Math.cos(n*Math.PI/180)}function Fl(_){const n=Math.asin(_[1])/Math.PI*180,s=Math.sqrt(_[0]*_[0]+_[2]*_[2]);if(s>1e-6){const f=_[0]/s,m=Math.acos(_[2]/s),y=(f>0?m:-m)/Math.PI*180;return new a.S(a.aN(y,-180,180),n)}return new a.S(0,n)}function Ns(_){return Math.cos(_*Math.PI/180)}function Hi(_,n){const s=Ns(_),f=Ns(n);return a.aj(f/s)}function Ol(_,n){const s=_.rotate(n.bearingInRadians),f=n.zoom+Hi(n.center.lat,0),m=a.bj(1/Ns(n.center.lat),1/Ns(Math.min(Math.abs(n.center.lat),60)),a.bm(f,7,3,0,1)),y=360/Bl({worldSize:n.worldSize,center:{lat:n.center.lat}});return new a.S(n.center.lng-s.x*y*m,a.ag(n.center.lat+s.y*y,-a.ah,a.ah))}function js(_){const n=.5*_,s=Math.sin(n),f=Math.cos(n);return Math.log(s+f)-Math.log(f-s)}function Us(_,n,s,f){const m=_.lat+s*f;if(Math.abs(s)>1){const y=(Math.sign(_.lat+s)!==Math.sign(_.lat)?-Math.abs(_.lat):Math.abs(_.lat))*Math.PI/180,x=Math.abs(_.lat+s)*Math.PI/180,M=js(y+f*(x-y)),E=js(y),z=js(x);return new a.S(_.lng+n*((M-E)/(z-E)),m)}return new a.S(_.lng+n*f,m)}class by{constructor(n){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=n}swapBuffers(){if(!this._hadAnyChanges)return;const n=this._cachePrevious;this._cachePrevious=this._cache,this._cache=n,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(n,s,f,m){const y=`${n.z}_${n.x}_${n.y}_${m!=null&&m.terrain?"t":""}`,x=this._cache.get(y);if(x)return x;const M=this._cachePrevious.get(y);if(M)return this._cache.set(y,M),M;const E=this._boundingVolumeFactory(n,s,f,m);return this._cache.set(y,E),this._hadAnyChanges=!0,E}}class So{constructor(n,s,f,m){this.min=f,this.max=m,this.points=n,this.planes=s}static fromAabb(n,s){const f=[];for(let m=0;m<8;m++)f.push([1&~m?n[0]:s[0],(m>>1&1)==1?s[1]:n[1],(m>>2&1)==1?s[2]:n[2]]);return new So(f,[[-1,0,0,s[0]],[1,0,0,-n[0]],[0,-1,0,s[1]],[0,1,0,-n[1]],[0,0,-1,s[2]],[0,0,1,-n[2]]],n,s)}static fromCenterSizeAngles(n,s,f){const m=a.bq([],f[0],f[1],f[2]),y=a.br([],[s[0],0,0],m),x=a.br([],[0,s[1],0],m),M=a.br([],[0,0,s[2]],m),E=[...n],z=[...n];for(let j=0;j<8;j++)for(let N=0;N<3;N++){const V=n[N]+y[N]*(1&~j?-1:1)+x[N]*((j>>1&1)==1?1:-1)+M[N]*((j>>2&1)==1?1:-1);E[N]=Math.min(E[N],V),z[N]=Math.max(z[N],V)}const B=[];for(let j=0;j<8;j++){const N=[...n];a.aR(N,N,a.aQ([],y,1&~j?-1:1)),a.aR(N,N,a.aQ([],x,(j>>1&1)==1?1:-1)),a.aR(N,N,a.aQ([],M,(j>>2&1)==1?1:-1)),B.push(N)}return new So(B,[[...y,-a.aW(y,B[0])],[...x,-a.aW(x,B[0])],[...M,-a.aW(M,B[0])],[-y[0],-y[1],-y[2],-a.aW(y,B[7])],[-x[0],-x[1],-x[2],-a.aW(x,B[7])],[-M[0],-M[1],-M[2],-a.aW(M,B[7])]],E,z)}intersectsFrustum(n){let s=!0;const f=this.points.length,m=this.planes.length,y=n.planes.length,x=n.points.length;for(let M=0;M<y;M++){const E=n.planes[M];let z=0;for(let B=0;B<f;B++){const j=this.points[B];E[0]*j[0]+E[1]*j[1]+E[2]*j[2]+E[3]>=0&&z++}if(z===0)return 0;z<f&&(s=!1)}if(s)return 2;for(let M=0;M<m;M++){const E=this.planes[M];let z=0;for(let B=0;B<x;B++){const j=n.points[B];E[0]*j[0]+E[1]*j[1]+E[2]*j[2]+E[3]>=0&&z++}if(z===0)return 0}return 1}intersectsPlane(n){const s=this.points.length;let f=0;for(let m=0;m<s;m++){const y=this.points[m];n[0]*y[0]+n[1]*y[1]+n[2]*y[2]+n[3]>=0&&f++}return f===s?2:f===0?0:1}}function Nl(_,n,s){const f=_-n;return f<0?-f:Math.max(0,f-s)}function Qh(_,n,s,f,m){const y=_-s;let x;return x=y<0?Math.min(-y,1+y-m):y>1?Math.min(Math.max(y-m,0),1-y):0,Math.max(x,Nl(n,f,m))}class xy{constructor(){this._boundingVolumeCache=new by(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(n,s,f,m){const y=1<<f.z,x=1/y,M=f.x/y,E=f.y/y;let z=2;return z=Math.min(z,Qh(n,s,M,E,x)),z=Math.min(z,Qh(n,s,M+.5,-E-x,x)),z=Math.min(z,Qh(n,s,M+.5,2-E-x,x)),z}getWrap(n,s,f){const m=1<<s.z,y=1/m,x=s.x/m,M=Nl(n.x,x,y),E=Nl(n.x,x-1,y),z=Nl(n.x,x+1,y),B=Math.min(M,E,z);return B===z?1:B===E?-1:0}allowVariableZoom(n,s){return He(n,s)>4}allowWorldCopies(){return!1}getTileBoundingVolume(n,s,f,m){return this._boundingVolumeCache.getTileBoundingVolume(n,s,f,m)}_computeTileBoundingVolume(n,s,f,m){var y,x;let M=f,E=f;if(m!=null&&m.terrain){const z=new a.Z(n.z,s,n.z,n.x,n.y),B=m.terrain.getMinMaxElevation(z);M=(y=B.minElevation)!==null&&y!==void 0?y:f,E=(x=B.maxElevation)!==null&&x!==void 0?x:f}if(M/=a.bt,E/=a.bt,M+=1,E+=1,n.z<=0)return So.fromAabb([-E,-E,-E],[E,E,E]);if(n.z===1)return So.fromAabb([n.x===0?-E:0,n.y===0?0:-E,-E],[n.x===0?0:E,n.y===0?E:0,E]);{const z=[xa(0,0,n.x,n.y,n.z),xa(a.$,0,n.x,n.y,n.z),xa(a.$,a.$,n.x,n.y,n.z),xa(0,a.$,n.x,n.y,n.z)],B=[];for(const je of z)B.push(a.aQ([],je,E));if(E!==M)for(const je of z)B.push(a.aQ([],je,M));n.y===0&&B.push([0,1,0]),n.y===(1<<n.z)-1&&B.push([0,-1,0]);const j=[1,1,1],N=[-1,-1,-1];for(const je of B)for(let We=0;We<3;We++)j[We]=Math.min(j[We],je[We]),N[We]=Math.max(N[We],je[We]);const V=xa(a.$/2,a.$/2,n.x,n.y,n.z),Q=a.aV([],[0,1,0],V);a.aU(Q,Q);const se=a.aV([],V,Q);a.aU(se,se);const oe=a.aV([],z[2],z[1]);a.aU(oe,oe);const le=a.aV([],z[0],z[3]);a.aU(le,le),B.push(a.aQ([],V,E)),n.y>=(1<<n.z)/2&&B.push(a.aQ([],xa(a.$/2,0,n.x,n.y,n.z),E)),n.y<(1<<n.z)/2&&B.push(a.aQ([],xa(a.$/2,a.$,n.x,n.y,n.z),E));const de=Rr(V,B),_e=Rr(se,B),me=[-V[0],-V[1],-V[2],de.max],xe=[V[0],V[1],V[2],-de.min],Te=[-se[0],-se[1],-se[2],_e.max],ge=[se[0],se[1],se[2],-_e.min],ze=[...oe,0],$e=[...le,0],Ne=[];return n.y===0?Ne.push(a.bs($e,ze,me),a.bs($e,ze,xe)):Ne.push(a.bs(Te,ze,me),a.bs(Te,ze,xe),a.bs(Te,$e,me),a.bs(Te,$e,xe)),n.y===(1<<n.z)-1?Ne.push(a.bs($e,ze,me),a.bs($e,ze,xe)):Ne.push(a.bs(ge,ze,me),a.bs(ge,ze,xe),a.bs(ge,$e,me),a.bs(ge,$e,xe)),new So(Ne,[me,xe,Te,ge,ze,$e],j,N)}}}function Rr(_,n){let s=1/0,f=-1/0;for(const m of n){const y=a.aW(_,m);s=Math.min(s,y),f=Math.max(f,y)}return{min:s,max:f}}class Vs{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(n){this._helper.setMinZoom(n)}setMaxZoom(n){this._helper.setMaxZoom(n)}setMinPitch(n){this._helper.setMinPitch(n)}setMaxPitch(n){this._helper.setMaxPitch(n)}setRenderWorldCopies(n){this._helper.setRenderWorldCopies(n)}setBearing(n){this._helper.setBearing(n)}setPitch(n){this._helper.setPitch(n)}setRoll(n){this._helper.setRoll(n)}setFov(n){this._helper.setFov(n)}setZoom(n){this._helper.setZoom(n)}setCenter(n){this._helper.setCenter(n)}setElevation(n){this._helper.setElevation(n)}setMinElevationForCurrentTile(n){this._helper.setMinElevationForCurrentTile(n)}setPadding(n){this._helper.setPadding(n)}interpolatePadding(n,s,f){return this._helper.interpolatePadding(n,s,f)}isPaddingEqual(n){return this._helper.isPaddingEqual(n)}resize(n,s){this._helper.resize(n,s)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(n){this._helper.setMaxBounds(n)}overrideNearFarZ(n,s){this._helper.overrideNearFarZ(n,s)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(n){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),n)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(n){}constructor(){this._cachedClippingPlane=a.bu(),this._projectionMatrix=a.b8(),this._globeViewProjMatrix32f=a.b7(),this._globeViewProjMatrixNoCorrection=a.b8(),this._globeViewProjMatrixNoCorrectionInverted=a.b8(),this._globeProjMatrixInverted=a.b8(),this._cameraPosition=a.bo(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new Rl({calcMatrices:()=>{this._calcMatrices()},getConstrained:(n,s)=>this.getConstrained(n,s)}),this._coveringTilesDetailsProvider=new xy}clone(){const n=new Vs;return n.apply(this),n}apply(n,s){this._globeLatitudeErrorCorrectionRadians=s||0,this._helper.apply(n)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const n=a.bo();return n[0]=this._cameraPosition[0],n[1]=this._cameraPosition[1],n[2]=this._cameraPosition[2],n}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(n){const{overscaledTileID:s,applyGlobeMatrix:f}=n,m=this._helper.getMercatorTileCoordinates(s);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:m,clippingPlane:this._cachedClippingPlane,projectionTransition:f?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(n){const s=this.pitchInRadians,f=this.cameraToCenterDistance/n,m=Math.sin(s)*f,y=Math.cos(s)*f+1,x=1/Math.sqrt(m*m+y*y)*1;let M=-m,E=y;const z=Math.sqrt(M*M+E*E);M/=z,E/=z;const B=[0,M,E];a.bv(B,B,[0,0,0],-this.bearingInRadians),a.bw(B,B,[0,0,0],-1*this.center.lat*Math.PI/180),a.bx(B,B,[0,0,0],this.center.lng*Math.PI/180);const j=1/a.aY(B);return a.aQ(B,B,j),[...B,-x*j]}isLocationOccluded(n){return!this.isSurfacePointVisible(ar(n))}transformLightDirection(n){const s=this._helper._center.lng*Math.PI/180,f=this._helper._center.lat*Math.PI/180,m=Math.cos(f),y=[Math.sin(s)*m,Math.sin(f),Math.cos(s)*m],x=[y[2],0,-y[0]],M=[0,0,0];a.aV(M,x,y),a.aU(x,x),a.aU(M,M);const E=[0,0,0];return a.aU(E,[x[0]*n[0]+M[0]*n[1]+y[0]*n[2],x[1]*n[0]+M[1]*n[1]+y[1]*n[2],x[2]*n[0]+M[2]*n[1]+y[2]*n[2]]),E}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(n,s,f){const m=function(M,E,z){const B=1/(1<<z.z);return new a.a0(M/a.$*B+z.x*B,E/a.$*B+z.y*B)}(n,s,f.canonical),y=(x=m.y,[a.bn(m.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-x*Math.PI*2))-.5*Math.PI]);var x;return this.getCircleRadiusCorrection()/Math.cos(y[1])}projectTileCoordinates(n,s,f,m){const y=f.canonical,x=xa(n,s,y.x,y.y,y.z),M=1+(m?m(n,s):0)/a.bt,E=[x[0]*M,x[1]*M,x[2]*M,1];a.av(E,E,this._globeViewProjMatrixNoCorrection);const z=this._cachedClippingPlane,B=z[0]*x[0]+z[1]*x[1]+z[2]*x[2]+z[3]<0;return{point:new a.P(E[0]/E[3],E[1]/E[3]),signedDistanceFromCamera:E[3],isOccluded:B}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const n=Os(this.worldSize,this.center.lat),s=a.b9(),f=a.b9();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*n),a.b3(s,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const m=this.centerOffset;s[8]=2*-m.x/this._helper._width,s[9]=2*m.y/this._helper._height,this._projectionMatrix=a.b4(s),this._globeProjMatrixInverted=a.b9(),a.ap(this._globeProjMatrixInverted,s),a.M(s,s,[0,0,-this.cameraToCenterDistance]),a.b5(s,s,this.rollInRadians),a.b6(s,s,-this.pitchInRadians),a.b5(s,s,this.bearingInRadians),a.M(s,s,[0,0,-n]);const y=a.bo();y[0]=n,y[1]=n,y[2]=n,a.b6(f,s,this.center.lat*Math.PI/180),a.by(f,f,-this.center.lng*Math.PI/180),a.N(f,f,y),this._globeViewProjMatrixNoCorrection=f,a.b6(s,s,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),a.by(s,s,-this.center.lng*Math.PI/180),a.N(s,s,y),this._globeViewProjMatrix32f=new Float32Array(s),this._globeViewProjMatrixNoCorrectionInverted=a.b9(),a.ap(this._globeViewProjMatrixNoCorrectionInverted,f);const x=a.bo();this._cameraPosition=a.bo(),this._cameraPosition[2]=this.cameraToCenterDistance/n,a.bv(this._cameraPosition,this._cameraPosition,x,-this.rollInRadians),a.bw(this._cameraPosition,this._cameraPosition,x,this.pitchInRadians),a.bv(this._cameraPosition,this._cameraPosition,x,-this.bearingInRadians),a.aR(this._cameraPosition,this._cameraPosition,[0,0,1]),a.bw(this._cameraPosition,this._cameraPosition,x,-this.center.lat*Math.PI/180),a.bx(this._cameraPosition,this._cameraPosition,x,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(n);const M=a.b4(this._globeViewProjMatrixNoCorrectionInverted);a.N(M,M,[1,1,-1]),this._cachedFrustum=Sr.fromInvProjectionMatrix(M,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(n){a.w("calculateFogMatrix is not supported on globe projection.");const s=a.b9();return a.af(s),s}getVisibleUnwrappedCoordinates(n){return[new a.b1(0,n)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(n){n&&a.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(n,s){if(!this._globeViewProjMatrixNoCorrection)return 1;const f=ar(n);a.aQ(f,f,1+s/a.bt);const m=a.bu();return a.av(m,[f[0],f[1],f[2],1],this._globeViewProjMatrixNoCorrection),m[2]/m[3]}populateCache(n){}getBounds(){const n=.5*this.width,s=.5*this.height,f=[new a.P(0,0),new a.P(n,0),new a.P(this.width,0),new a.P(this.width,s),new a.P(this.width,this.height),new a.P(n,this.height),new a.P(0,this.height),new a.P(0,s)],m=[];for(const j of f)m.push(this.unprojectScreenPoint(j));let y=0,x=0,M=0,E=0;const z=this.center;for(const j of m){const N=a.bz(z.lng,j.lng),V=a.bz(z.lat,j.lat);N<x&&(x=N),N>y&&(y=N),V<E&&(E=V),V>M&&(M=V)}const B=[z.lng+x,z.lat+E,z.lng+y,z.lat+M];return this.isSurfacePointOnScreen([0,1,0])&&(B[3]=90,B[0]=-180,B[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(B[1]=-90,B[0]=-180,B[2]=180),new wt(B)}getConstrained(n,s){const f=a.ag(n.lat,-a.ah,a.ah),m=a.ag(+s,this.minZoom+Hi(0,f),this.maxZoom);return{center:new a.S(n.lng,f),zoom:m}}calculateCenterFromCameraLngLatAlt(n,s,f,m){return this._helper.calculateCenterFromCameraLngLatAlt(n,s,f,m)}setLocationAtPoint(n,s){const f=ar(this.unprojectScreenPoint(s)),m=ar(n),y=a.bo();a.bA(y);const x=a.bo();a.bx(x,f,y,-this.center.lng*Math.PI/180),a.bw(x,x,y,this.center.lat*Math.PI/180);const M=m[0]*m[0]+m[2]*m[2],E=x[0]*x[0];if(M<E)return;const z=Math.sqrt(M-E),B=-z,j=a.bB(m[0],m[2],x[0],z),N=a.bB(m[0],m[2],x[0],B),V=a.bo();a.bx(V,m,y,-j);const Q=a.bB(V[1],V[2],x[1],x[2]),se=a.bo();a.bx(se,m,y,-N);const oe=a.bB(se[1],se[2],x[1],x[2]),le=.5*Math.PI,de=Q>=-le&&Q<=le,_e=oe>=-le&&oe<=le;let me,xe;if(de&&_e){const $e=this.center.lng*Math.PI/180,Ne=this.center.lat*Math.PI/180;a.bC(j,$e)+a.bC(Q,Ne)<a.bC(N,$e)+a.bC(oe,Ne)?(me=j,xe=Q):(me=N,xe=oe)}else if(de)me=j,xe=Q;else{if(!_e)return;me=N,xe=oe}const Te=me/Math.PI*180,ge=xe/Math.PI*180,ze=this.center.lat;this.setCenter(new a.S(Te,a.ag(ge,-90,90))),this.setZoom(this.zoom+Hi(ze,this.center.lat))}locationToScreenPoint(n,s){const f=ar(n);if(s){const m=s.getElevationForLngLatZoom(n,this._helper._tileZoom);a.aQ(f,f,1+m/a.bt)}return this._projectSurfacePointToScreen(f)}_projectSurfacePointToScreen(n){const s=a.bu();return a.av(s,[...n,1],this._globeViewProjMatrixNoCorrection),s[0]/=s[3],s[1]/=s[3],new a.P((.5*s[0]+.5)*this.width,(.5*-s[1]+.5)*this.height)}screenPointToMercatorCoordinate(n,s){if(s){const f=s.pointCoordinate(n);if(f)return f}return a.a0.fromLngLat(this.unprojectScreenPoint(n))}screenPointToLocation(n,s){var f;return(f=this.screenPointToMercatorCoordinate(n,s))===null||f===void 0?void 0:f.toLngLat()}isPointOnMapSurface(n,s){const f=this._cameraPosition,m=this.getRayDirectionFromPixel(n);return!!this.rayPlanetIntersection(f,m)}getRayDirectionFromPixel(n){const s=a.bu();s[0]=n.x/this.width*2-1,s[1]=-1*(n.y/this.height*2-1),s[2]=1,s[3]=1,a.av(s,s,this._globeViewProjMatrixNoCorrectionInverted),s[0]/=s[3],s[1]/=s[3],s[2]/=s[3];const f=a.bo();f[0]=s[0]-this._cameraPosition[0],f[1]=s[1]-this._cameraPosition[1],f[2]=s[2]-this._cameraPosition[2];const m=a.bo();return a.aU(m,f),m}isSurfacePointVisible(n){const s=this._cachedClippingPlane;return s[0]*n[0]+s[1]*n[1]+s[2]*n[2]+s[3]>=0}isSurfacePointOnScreen(n){if(!this.isSurfacePointVisible(n))return!1;const s=a.bu();return a.av(s,[...n,1],this._globeViewProjMatrixNoCorrection),s[0]/=s[3],s[1]/=s[3],s[2]/=s[3],s[0]>-1&&s[0]<1&&s[1]>-1&&s[1]<1&&s[2]>-1&&s[2]<1}rayPlanetIntersection(n,s){const f=a.aW(n,s),m=a.bo(),y=a.bo();a.aQ(y,s,f),a.aT(m,n,y);const x=1-a.aW(m,m);if(x<0)return null;const M=a.aW(n,n)-1,E=-f+(f<0?1:-1)*Math.sqrt(x),z=M/E,B=E;return{tMin:Math.min(z,B),tMax:Math.max(z,B)}}unprojectScreenPoint(n){const s=this._cameraPosition,f=this.getRayDirectionFromPixel(n),m=this.rayPlanetIntersection(s,f);if(m){const B=a.bo();a.aR(B,s,[f[0]*m.tMin,f[1]*m.tMin,f[2]*m.tMin]);const j=a.bo();return a.aU(j,B),Fl(j)}const y=this._cachedClippingPlane,x=y[0]*f[0]+y[1]*f[1]+y[2]*f[2],M=-a.b0(y,s)/x,E=a.bo();if(M>0)a.aR(E,s,[f[0]*M,f[1]*M,f[2]*M]);else{const B=a.bo();a.aR(B,s,[2*f[0],2*f[1],2*f[2]]);const j=a.b0(this._cachedClippingPlane,B);a.aT(E,B,[this._cachedClippingPlane[0]*j,this._cachedClippingPlane[1]*j,this._cachedClippingPlane[2]*j])}const z=function(B){const j=a.bo();return j[0]=B[0]*-B[3],j[1]=B[1]*-B[3],j[2]=B[2]*-B[3],{center:j,radius:Math.sqrt(1-B[3]*B[3])}}(y);return Fl(function(B,j,N){const V=a.bo();a.aT(V,N,B);const Q=a.bo();return a.bp(Q,B,V,j/a.a_(V)),Q}(z.center,z.radius,E))}getMatrixForModel(n,s){const f=a.S.convert(n),m=1/a.bt,y=a.b8();return a.by(y,y,f.lng/180*Math.PI),a.b6(y,y,-f.lat/180*Math.PI),a.M(y,y,[0,0,1+s/a.bt]),a.b6(y,y,.5*Math.PI),a.N(y,y,[m,m,m]),y}getProjectionDataForCustomLayer(n=!0){const s=this.getProjectionData({overscaledTileID:new a.Z(0,0,0,0,0),applyGlobeMatrix:n});return s.tileMercatorCoords=[0,0,1,1],s}getFastPathSimpleProjectionMatrix(n){}}class ia{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(n){this._helper.setMinZoom(n)}setMaxZoom(n){this._helper.setMaxZoom(n)}setMinPitch(n){this._helper.setMinPitch(n)}setMaxPitch(n){this._helper.setMaxPitch(n)}setRenderWorldCopies(n){this._helper.setRenderWorldCopies(n)}setBearing(n){this._helper.setBearing(n)}setPitch(n){this._helper.setPitch(n)}setRoll(n){this._helper.setRoll(n)}setFov(n){this._helper.setFov(n)}setZoom(n){this._helper.setZoom(n)}setCenter(n){this._helper.setCenter(n)}setElevation(n){this._helper.setElevation(n)}setMinElevationForCurrentTile(n){this._helper.setMinElevationForCurrentTile(n)}setPadding(n){this._helper.setPadding(n)}interpolatePadding(n,s,f){return this._helper.interpolatePadding(n,s,f)}isPaddingEqual(n){return this._helper.isPaddingEqual(n)}resize(n,s,f=!0){this._helper.resize(n,s,f)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(n){this._helper.setMaxBounds(n)}overrideNearFarZ(n,s){this._helper.overrideNearFarZ(n,s)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(n){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),n)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(n,s){this._globeness=n,this._globeLatitudeErrorCorrectionRadians=s,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new Rl({calcMatrices:()=>{this._calcMatrices()},getConstrained:(n,s)=>this.getConstrained(n,s)}),this._globeness=1,this._mercatorTransform=new Zi,this._verticalPerspectiveTransform=new Vs}clone(){const n=new ia;return n._globeness=this._globeness,n._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,n.apply(this),n}apply(n){this._helper.apply(n),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(n){const s=this._mercatorTransform.getProjectionData(n),f=this._verticalPerspectiveTransform.getProjectionData(n);return{mainMatrix:this.isGlobeRendering?f.mainMatrix:s.mainMatrix,clippingPlane:f.clippingPlane,tileMercatorCoords:f.tileMercatorCoords,projectionTransition:n.applyGlobeMatrix?this._globeness:0,fallbackMatrix:s.fallbackMatrix}}isLocationOccluded(n){return this.currentTransform.isLocationOccluded(n)}transformLightDirection(n){return this.currentTransform.transformLightDirection(n)}getPixelScale(){return a.bj(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return a.bj(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(n,s,f){const m=this._mercatorTransform.getPitchedTextCorrection(n,s,f),y=this._verticalPerspectiveTransform.getPitchedTextCorrection(n,s,f);return a.bj(m,y,this._globeness)}projectTileCoordinates(n,s,f,m){return this.currentTransform.projectTileCoordinates(n,s,f,m)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(n){return this.currentTransform.calculateFogMatrix(n)}getVisibleUnwrappedCoordinates(n){return this.currentTransform.getVisibleUnwrappedCoordinates(n)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(n){this._mercatorTransform.recalculateZoomAndCenter(n),this._verticalPerspectiveTransform.recalculateZoomAndCenter(n)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(n,s){return this.currentTransform.lngLatToCameraDepth(n,s)}populateCache(n){this._mercatorTransform.populateCache(n),this._verticalPerspectiveTransform.populateCache(n)}getBounds(){return this.currentTransform.getBounds()}getConstrained(n,s){return this.currentTransform.getConstrained(n,s)}calculateCenterFromCameraLngLatAlt(n,s,f,m){return this._helper.calculateCenterFromCameraLngLatAlt(n,s,f,m)}setLocationAtPoint(n,s){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(n,s),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(n,s),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(n,s){return this.currentTransform.locationToScreenPoint(n,s)}screenPointToMercatorCoordinate(n,s){return this.currentTransform.screenPointToMercatorCoordinate(n,s)}screenPointToLocation(n,s){return this.currentTransform.screenPointToLocation(n,s)}isPointOnMapSurface(n,s){return this.currentTransform.isPointOnMapSurface(n,s)}getRayDirectionFromPixel(n){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(n)}getMatrixForModel(n,s){return this.currentTransform.getMatrixForModel(n,s)}getProjectionDataForCustomLayer(n=!0){const s=this._mercatorTransform.getProjectionDataForCustomLayer(n);if(!this.isGlobeRendering)return s;const f=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(n);return f.fallbackMatrix=s.mainMatrix,f}getFastPathSimpleProjectionMatrix(n){return this.currentTransform.getFastPathSimpleProjectionMatrix(n)}}class Hr{get useGlobeControls(){return!0}handlePanInertia(n,s){const f=Ol(n,s);return Math.abs(f.lng-s.center.lng)>180&&(f.lng=s.center.lng+179.5*Math.sign(f.lng-s.center.lng)),{easingCenter:f,easingOffset:new a.P(0,0)}}handleMapControlsRollPitchBearingZoom(n,s){const f=n.around,m=s.screenPointToLocation(f);n.bearingDelta&&s.setBearing(s.bearing+n.bearingDelta),n.pitchDelta&&s.setPitch(s.pitch+n.pitchDelta),n.rollDelta&&s.setRoll(s.roll+n.rollDelta);const y=s.zoom;n.zoomDelta&&s.setZoom(s.zoom+n.zoomDelta);const x=s.zoom-y;if(x===0)return;const M=a.bz(s.center.lng,m.lng),E=M/(Math.abs(M/180)+1),z=a.bz(s.center.lat,m.lat),B=s.getRayDirectionFromPixel(f),j=s.cameraPosition,N=-1*a.aW(j,B),V=a.bo();a.aR(V,j,[B[0]*N,B[1]*N,B[2]*N]);const Q=a.aY(V)-1,se=Math.exp(.5*-Math.max(Q-.3,0)),oe=Os(s.worldSize,s.center.lat)/Math.min(s.width,s.height),le=a.bm(oe,.9,.5,1,.25),de=(1-a.ae(-x))*Math.min(se,le),_e=s.center.lat,me=s.zoom,xe=new a.S(s.center.lng+E*de,a.ag(s.center.lat+z*de,-a.ah,a.ah));s.setLocationAtPoint(m,f);const Te=s.center,ge=a.bm(Math.abs(M),45,85,0,1),ze=a.bm(oe,.75,.35,0,1),$e=Math.pow(Math.max(ge,ze),.25),Ne=a.bz(Te.lng,xe.lng),je=a.bz(Te.lat,xe.lat);s.setCenter(new a.S(Te.lng+Ne*$e,Te.lat+je*$e).wrap()),s.setZoom(me+Hi(_e,s.center.lat))}handleMapControlsPan(n,s,f){if(!n.panDelta)return;const m=s.center.lat,y=s.zoom;s.setCenter(Ol(n.panDelta,s).wrap()),s.setZoom(y+Hi(m,s.center.lat))}cameraForBoxAndBearing(n,s,f,m,y){const x=zi(n,s,f,m,y),M=s.left/y.width*2-1,E=(y.width-s.right)/y.width*2-1,z=s.top/y.height*-2+1,B=(y.height-s.bottom)/y.height*-2+1,j=a.bz(f.getWest(),f.getEast())<0,N=j?f.getEast():f.getWest(),V=j?f.getWest():f.getEast(),Q=Math.max(f.getNorth(),f.getSouth()),se=Math.min(f.getNorth(),f.getSouth()),oe=N+.5*a.bz(N,V),le=Q+.5*a.bz(Q,se),de=y.clone();de.setCenter(x.center),de.setBearing(x.bearing),de.setPitch(0),de.setRoll(0),de.setZoom(x.zoom);const _e=de.modelViewProjectionMatrix,me=[ar(f.getNorthWest()),ar(f.getNorthEast()),ar(f.getSouthWest()),ar(f.getSouthEast()),ar(new a.S(V,le)),ar(new a.S(N,le)),ar(new a.S(oe,Q)),ar(new a.S(oe,se))],xe=ar(x.center);let Te=Number.POSITIVE_INFINITY;for(const ge of me)M<0&&(Te=Hr.getLesserNonNegativeNonNull(Te,Hr.solveVectorScale(ge,xe,_e,"x",M))),E>0&&(Te=Hr.getLesserNonNegativeNonNull(Te,Hr.solveVectorScale(ge,xe,_e,"x",E))),z>0&&(Te=Hr.getLesserNonNegativeNonNull(Te,Hr.solveVectorScale(ge,xe,_e,"y",z))),B<0&&(Te=Hr.getLesserNonNegativeNonNull(Te,Hr.solveVectorScale(ge,xe,_e,"y",B)));if(Number.isFinite(Te)&&Te!==0)return x.zoom=de.zoom+a.aj(Te),x;Mr()}handleJumpToCenterZoom(n,s){const f=n.center.lat,m=n.getConstrained(s.center?a.S.convert(s.center):n.center,n.zoom).center;n.setCenter(m.wrap());const y=s.zoom!==void 0?+s.zoom:n.zoom+Hi(f,m.lat);n.zoom!==y&&n.setZoom(y)}handleEaseTo(n,s){const f=n.zoom,m=n.center,y=n.padding,x={roll:n.roll,pitch:n.pitch,bearing:n.bearing},M={roll:s.roll===void 0?n.roll:s.roll,pitch:s.pitch===void 0?n.pitch:s.pitch,bearing:s.bearing===void 0?n.bearing:s.bearing},E=s.zoom!==void 0,z=!n.isPaddingEqual(s.padding);let B=!1;const j=s.center?a.S.convert(s.center):m,N=n.getConstrained(j,f).center;io(n,N);const V=n.clone();V.setCenter(N),V.setZoom(E?+s.zoom:f+Hi(m.lat,j.lat)),V.setBearing(s.bearing);const Q=new a.P(a.ag(n.centerPoint.x+s.offsetAsPoint.x,0,n.width),a.ag(n.centerPoint.y+s.offsetAsPoint.y,0,n.height));V.setLocationAtPoint(N,Q);const se=(s.offset&&s.offsetAsPoint.mag())>0?V.center:N,oe=E?+s.zoom:f+Hi(m.lat,se.lat),le=f+Hi(m.lat,0),de=oe+Hi(se.lat,0),_e=a.bz(m.lng,se.lng),me=a.bz(m.lat,se.lat),xe=a.ae(de-le);return B=oe!==f,{easeFunc:Te=>{if(a.bd(x,M)||rr({startEulerAngles:x,endEulerAngles:M,tr:n,k:Te,useSlerp:x.roll!=M.roll}),z&&n.interpolatePadding(y,s.padding,Te),s.around)a.w("Easing around a point is not supported under globe projection."),n.setLocationAtPoint(s.around,s.aroundPoint);else{const ge=de>le?Math.min(2,xe):Math.max(.5,xe),ze=Math.pow(ge,1-Te),$e=Us(m,_e,me,Te*ze);n.setCenter($e.wrap())}if(B){const ge=a.C.number(le,de,Te)+Hi(0,n.center.lat);n.setZoom(ge)}},isZooming:B,elevationCenter:se}}handleFlyTo(n,s){const f=s.zoom!==void 0,m=n.center,y=n.zoom,x=n.padding,M=!n.isPaddingEqual(s.padding),E=n.getConstrained(a.S.convert(s.center||s.locationAtOffset),y).center,z=f?+s.zoom:n.zoom+Hi(n.center.lat,E.lat),B=n.clone();B.setCenter(E),B.setZoom(z),B.setBearing(s.bearing);const j=new a.P(a.ag(n.centerPoint.x+s.offsetAsPoint.x,0,n.width),a.ag(n.centerPoint.y+s.offsetAsPoint.y,0,n.height));B.setLocationAtPoint(E,j);const N=B.center;io(n,N);const V=function(me,xe,Te){const ge=ar(xe),ze=ar(Te),$e=a.aW(ge,ze),Ne=Math.acos($e),je=Bl(me);return Ne/(2*Math.PI)*je}(n,m,N),Q=y+Hi(m.lat,0),se=z+Hi(N.lat,0),oe=a.ae(se-Q);let le;if(typeof s.minZoom=="number"){const me=+s.minZoom+Hi(N.lat,0),xe=Math.min(me,Q,se)+Hi(0,N.lat),Te=n.getConstrained(N,xe).zoom+Hi(N.lat,0);le=a.ae(Te-Q)}const de=a.bz(m.lng,N.lng),_e=a.bz(m.lat,N.lat);return{easeFunc:(me,xe,Te,ge)=>{const ze=Us(m,de,_e,Te);M&&n.interpolatePadding(x,s.padding,me);const $e=me===1?N:ze;n.setCenter($e.wrap());const Ne=Q+a.aj(xe);n.setZoom(me===1?z:Ne+Hi(0,$e.lat))},scaleOfZoom:oe,targetCenter:N,scaleOfMinZoom:le,pixelPathLength:V}}static solveVectorScale(n,s,f,m,y){const x=m==="x"?[f[0],f[4],f[8],f[12]]:[f[1],f[5],f[9],f[13]],M=[f[3],f[7],f[11],f[15]],E=n[0]*x[0]+n[1]*x[1]+n[2]*x[2],z=n[0]*M[0]+n[1]*M[1]+n[2]*M[2],B=s[0]*x[0]+s[1]*x[1]+s[2]*x[2],j=s[0]*M[0]+s[1]*M[1]+s[2]*M[2];return B+y*z===E+y*j||M[3]*(E-B)+x[3]*(j-z)+E*j==B*z?null:(B+x[3]-y*j-y*M[3])/(B-E-y*j+y*z)}static getLesserNonNegativeNonNull(n,s){return s!==null&&s>=0&&s<n?s:n}}class Kh{constructor(n){this._globe=n,this._mercatorCameraHelper=new ru,this._verticalPerspectiveCameraHelper=new Hr}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(n,s){return this.currentHelper.handlePanInertia(n,s)}handleMapControlsRollPitchBearingZoom(n,s){return this.currentHelper.handleMapControlsRollPitchBearingZoom(n,s)}handleMapControlsPan(n,s,f){this.currentHelper.handleMapControlsPan(n,s,f)}cameraForBoxAndBearing(n,s,f,m,y){return this.currentHelper.cameraForBoxAndBearing(n,s,f,m,y)}handleJumpToCenterZoom(n,s){this.currentHelper.handleJumpToCenterZoom(n,s)}handleEaseTo(n,s){return this.currentHelper.handleEaseTo(n,s)}handleFlyTo(n,s){return this.currentHelper.handleFlyTo(n,s)}}const jl=(_,n)=>a.y(_,n&&n.filter(s=>s.identifier!=="source.canvas")),Gs=a.bD();class Jh extends a.E{constructor(n,s={}){super(),this._rtlPluginLoaded=()=>{for(const f in this.sourceCaches){const m=this.sourceCaches[f].getSource().type;m!=="vector"&&m!=="geojson"||this.sourceCaches[f].reload()}},this.map=n,this.dispatcher=new St(Ut(),n._getMapId()),this.dispatcher.registerMessageHandler("GG",(f,m)=>this.getGlyphs(f,m)),this.dispatcher.registerMessageHandler("GI",(f,m)=>this.getImages(f,m)),this.imageManager=new ke,this.imageManager.setEventedParent(this),this.glyphManager=new Ze(n._requestManager,s.localIdeographFontFamily),this.lineAtlas=new _t(256,512),this.crossTileSymbolIndex=new Bs,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new a.bE,this._loaded=!1,this._availableImages=[],this._globalState={},this._resetUpdates(),this.dispatcher.broadcast("SR",a.bF()),yn().on(qt,this._rtlPluginLoaded),this.on("data",f=>{if(f.dataType!=="source"||f.sourceDataType!=="metadata")return;const m=this.sourceCaches[f.sourceId];if(!m)return;const y=m.getSource();if(y&&y.vectorLayerIds)for(const x in this._layers){const M=this._layers[x];M.source===y.id&&this._validateLayer(M)}})}setGlobalStateProperty(n,s){var f,m,y;this._checkLoaded();const x=s===null?(y=(m=(f=this.stylesheet.state)===null||f===void 0?void 0:f[n])===null||m===void 0?void 0:m.default)!==null&&y!==void 0?y:null:s;if(a.bG(x,this._globalState[n]))return this;this._globalState[n]=x;const M=this._findGlobalStateAffectedSources([n]);for(const E in this.sourceCaches)M.has(E)&&(this._reloadSource(E),this._changed=!0)}getGlobalState(){return this._globalState}setGlobalState(n){this._checkLoaded();const s=[];for(const m in n)!a.bG(this._globalState[m],n[m].default)&&(s.push(m),this._globalState[m]=n[m].default);const f=this._findGlobalStateAffectedSources(s);for(const m in this.sourceCaches)f.has(m)&&(this._reloadSource(m),this._changed=!0)}_findGlobalStateAffectedSources(n){if(n.length===0)return new Set;const s=new Set;for(const f in this._layers){const m=this._layers[f],y=m.getLayoutAffectingGlobalStateRefs();for(const x of n)y.has(x)&&s.add(m.source)}return s}loadURL(n,s={},f){this.fire(new a.l("dataloading",{dataType:"style"})),s.validate=typeof s.validate!="boolean"||s.validate;const m=this.map._requestManager.transformRequest(n,"Style");this._loadStyleRequest=new AbortController;const y=this._loadStyleRequest;a.j(m,this._loadStyleRequest).then(x=>{this._loadStyleRequest=null,this._load(x.data,s,f)}).catch(x=>{this._loadStyleRequest=null,x&&!y.signal.aborted&&this.fire(new a.k(x))})}loadJSON(n,s={},f){this.fire(new a.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,I.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,s.validate=s.validate!==!1,this._load(n,s,f)}).catch(()=>{})}loadEmpty(){this.fire(new a.l("dataloading",{dataType:"style"})),this._load(Gs,{validate:!1})}_load(n,s,f){var m,y,x;const M=s.transformStyle?s.transformStyle(f,n):n;if(!s.validate||!jl(this,a.z(M))){this._loaded=!0,this.stylesheet=M;for(const E in M.sources)this.addSource(E,M.sources[E],{validate:!1});M.sprite?this._loadSprite(M.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(M.glyphs),this._createLayers(),this.light=new ot(this.stylesheet.light),this._setProjectionInternal(((m=this.stylesheet.projection)===null||m===void 0?void 0:m.type)||"mercator"),this.sky=new bt(this.stylesheet.sky),this.map.setTerrain((y=this.stylesheet.terrain)!==null&&y!==void 0?y:null),this.setGlobalState((x=this.stylesheet.state)!==null&&x!==void 0?x:null),this.fire(new a.l("data",{dataType:"style"})),this.fire(new a.l("style.load"))}}_createLayers(){const n=a.bH(this.stylesheet.layers);this.dispatcher.broadcast("SL",n),this._order=n.map(s=>s.id),this._layers={},this._serializedLayers=null;for(const s of n){const f=a.bI(s);f.setEventedParent(this,{layer:{id:s.id}}),this._layers[s.id]=f}}_loadSprite(n,s=!1,f=void 0){let m;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(y,x,M,E){return a._(this,void 0,void 0,function*(){const z=re(y),B=M>1?"@2x":"",j={},N={};for(const{id:V,url:Q}of z){const se=x.transformRequest(he(Q,B,".json"),"SpriteJSON");j[V]=a.j(se,E);const oe=x.transformRequest(he(Q,B,".png"),"SpriteImage");N[V]=ee.getImage(oe,E)}return yield Promise.all([...Object.values(j),...Object.values(N)]),function(V,Q){return a._(this,void 0,void 0,function*(){const se={};for(const oe in V){se[oe]={};const le=I.getImageCanvasContext((yield Q[oe]).data),de=(yield V[oe]).data;for(const _e in de){const{width:me,height:xe,x:Te,y:ge,sdf:ze,pixelRatio:$e,stretchX:Ne,stretchY:je,content:We,textFitWidth:zt,textFitHeight:Ct}=de[_e];se[oe][_e]={data:null,pixelRatio:$e,sdf:ze,stretchX:Ne,stretchY:je,content:We,textFitWidth:zt,textFitHeight:Ct,spriteData:{width:me,height:xe,x:Te,y:ge,context:le}}}}return se})}(j,N)})}(n,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(y=>{if(this._spriteRequest=null,y)for(const x in y){this._spritesImagesIds[x]=[];const M=this._spritesImagesIds[x]?this._spritesImagesIds[x].filter(E=>!(E in y)):[];for(const E of M)this.imageManager.removeImage(E),this._changedImages[E]=!0;for(const E in y[x]){const z=x==="default"?E:`${x}:${E}`;this._spritesImagesIds[x].push(z),z in this.imageManager.images?this.imageManager.updateImage(z,y[x][E],!1):this.imageManager.addImage(z,y[x][E]),s&&(this._changedImages[z]=!0)}}}).catch(y=>{this._spriteRequest=null,m=y,this.fire(new a.k(m))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),s&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.l("data",{dataType:"style"})),f&&f(m)})}_unloadSprite(){for(const n of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(n),this._changedImages[n]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.l("data",{dataType:"style"}))}_validateLayer(n){const s=this.sourceCaches[n.source];if(!s)return;const f=n.sourceLayer;if(!f)return;const m=s.getSource();(m.type==="geojson"||m.vectorLayerIds&&m.vectorLayerIds.indexOf(f)===-1)&&this.fire(new a.k(new Error(`Source layer "${f}" does not exist on source "${m.id}" as specified by style layer "${n.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const n in this.sourceCaches)if(!this.sourceCaches[n].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(n,s=!1){const f=this._serializedAllLayers();if(!n||n.length===0)return Object.values(s?a.bJ(f):f);const m=[];for(const y of n)if(f[y]){const x=s?a.bJ(f[y]):f[y];m.push(x)}return m}_serializedAllLayers(){let n=this._serializedLayers;if(n)return n;n=this._serializedLayers={};const s=Object.keys(this._layers);for(const f of s){const m=this._layers[f];m.type!=="custom"&&(n[f]=m.serialize())}return n}hasTransitions(){var n,s,f;if(!((n=this.light)===null||n===void 0)&&n.hasTransition()||!((s=this.sky)===null||s===void 0)&&s.hasTransition()||!((f=this.projection)===null||f===void 0)&&f.hasTransition())return!0;for(const m in this.sourceCaches)if(this.sourceCaches[m].hasTransition())return!0;for(const m in this._layers)if(this._layers[m].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(n){if(!this._loaded)return;const s=this._changed;if(s){const m=Object.keys(this._updatedLayers),y=Object.keys(this._removedLayers);(m.length||y.length)&&this._updateWorkerLayers(m,y);for(const x in this._updatedSources){const M=this._updatedSources[x];if(M==="reload")this._reloadSource(x);else{if(M!=="clear")throw new Error(`Invalid action ${M}`);this._clearSource(x)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const x in this._updatedPaintProps)this._layers[x].updateTransitions(n);this.light.updateTransitions(n),this.sky.updateTransitions(n),this._resetUpdates()}const f={};for(const m in this.sourceCaches){const y=this.sourceCaches[m];f[m]=y.used,y.used=!1}for(const m of this._order){const y=this._layers[m];y.recalculate(n,this._availableImages),!y.isHidden(n.zoom)&&y.source&&(this.sourceCaches[y.source].used=!0)}for(const m in f){const y=this.sourceCaches[m];!!f[m]!=!!y.used&&y.fire(new a.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:m}))}this.light.recalculate(n),this.sky.recalculate(n),this.projection.recalculate(n),this.z=n.zoom,s&&this.fire(new a.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const n=Object.keys(this._changedImages);if(n.length){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],n);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const n in this.sourceCaches)this.sourceCaches[n].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(n,s){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(n,!1),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(n,s={}){var f;this._checkLoaded();const m=this.serialize();if(n=s.transformStyle?s.transformStyle(m,n):n,((f=s.validate)===null||f===void 0||f)&&jl(this,a.z(n)))return!1;(n=a.bJ(n)).layers=a.bH(n.layers);const y=a.bK(m,n),x=this._getOperationsToPerform(y);if(x.unimplemented.length>0)throw new Error(`Unimplemented: ${x.unimplemented.join(", ")}.`);if(x.operations.length===0)return!1;for(const M of x.operations)M();return this.stylesheet=n,this._serializedLayers=null,!0}_getOperationsToPerform(n){const s=[],f=[];for(const m of n)switch(m.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":s.push(()=>this.addLayer.apply(this,m.args));break;case"removeLayer":s.push(()=>this.removeLayer.apply(this,m.args));break;case"setPaintProperty":s.push(()=>this.setPaintProperty.apply(this,m.args));break;case"setLayoutProperty":s.push(()=>this.setLayoutProperty.apply(this,m.args));break;case"setFilter":s.push(()=>this.setFilter.apply(this,m.args));break;case"addSource":s.push(()=>this.addSource.apply(this,m.args));break;case"removeSource":s.push(()=>this.removeSource.apply(this,m.args));break;case"setLayerZoomRange":s.push(()=>this.setLayerZoomRange.apply(this,m.args));break;case"setLight":s.push(()=>this.setLight.apply(this,m.args));break;case"setGeoJSONSourceData":s.push(()=>this.setGeoJSONSourceData.apply(this,m.args));break;case"setGlyphs":s.push(()=>this.setGlyphs.apply(this,m.args));break;case"setSprite":s.push(()=>this.setSprite.apply(this,m.args));break;case"setTerrain":s.push(()=>this.map.setTerrain.apply(this,m.args));break;case"setSky":s.push(()=>this.setSky.apply(this,m.args));break;case"setProjection":this.setProjection.apply(this,m.args);break;case"setGlobalState":s.push(()=>this.setGlobalState.apply(this,m.args));break;case"setTransition":s.push(()=>{});break;default:f.push(m.command)}return{operations:s,unimplemented:f}}addImage(n,s){if(this.getImage(n))return this.fire(new a.k(new Error(`An image named "${n}" already exists.`)));this.imageManager.addImage(n,s),this._afterImageUpdated(n)}updateImage(n,s){this.imageManager.updateImage(n,s)}getImage(n){return this.imageManager.getImage(n)}removeImage(n){if(!this.getImage(n))return this.fire(new a.k(new Error(`An image named "${n}" does not exist.`)));this.imageManager.removeImage(n),this._afterImageUpdated(n)}_afterImageUpdated(n){this._availableImages=this.imageManager.listImages(),this._changedImages[n]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(n,s,f={}){if(this._checkLoaded(),this.sourceCaches[n]!==void 0)throw new Error(`Source "${n}" already exists.`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(a.z.source,`sources.${n}`,s,null,f))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const m=this.sourceCaches[n]=new Je(n,s,this.dispatcher);m.style=this,m.setEventedParent(this,()=>({isSourceLoaded:m.loaded(),source:m.serialize(),sourceId:n})),m.onAdd(this.map),this._changed=!0}removeSource(n){if(this._checkLoaded(),this.sourceCaches[n]===void 0)throw new Error("There is no source with this ID");for(const f in this._layers)if(this._layers[f].source===n)return this.fire(new a.k(new Error(`Source "${n}" cannot be removed while layer "${f}" is using it.`)));const s=this.sourceCaches[n];delete this.sourceCaches[n],delete this._updatedSources[n],s.fire(new a.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:n})),s.setEventedParent(null),s.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(n,s){if(this._checkLoaded(),this.sourceCaches[n]===void 0)throw new Error(`There is no source with this ID=${n}`);const f=this.sourceCaches[n].getSource();if(f.type!=="geojson")throw new Error(`geojsonSource.type is ${f.type}, which is !== 'geojson`);f.setData(s),this._changed=!0}getSource(n){return this.sourceCaches[n]&&this.sourceCaches[n].getSource()}addLayer(n,s,f={}){this._checkLoaded();const m=n.id;if(this.getLayer(m))return void this.fire(new a.k(new Error(`Layer "${m}" already exists on this map.`)));let y;if(n.type==="custom"){if(jl(this,a.bL(n)))return;y=a.bI(n)}else{if("source"in n&&typeof n.source=="object"&&(this.addSource(m,n.source),n=a.bJ(n),n=a.e(n,{source:m})),this._validate(a.z.layer,`layers.${m}`,n,{arrayIndex:-1},f))return;y=a.bI(n),this._validateLayer(y),y.setEventedParent(this,{layer:{id:m}})}const x=s?this._order.indexOf(s):this._order.length;if(s&&x===-1)this.fire(new a.k(new Error(`Cannot add layer "${m}" before non-existing layer "${s}".`)));else{if(this._order.splice(x,0,m),this._layerOrderChanged=!0,this._layers[m]=y,this._removedLayers[m]&&y.source&&y.type!=="custom"){const M=this._removedLayers[m];delete this._removedLayers[m],M.type!==y.type?this._updatedSources[y.source]="clear":(this._updatedSources[y.source]="reload",this.sourceCaches[y.source].pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map)}}moveLayer(n,s){if(this._checkLoaded(),this._changed=!0,!this._layers[n])return void this.fire(new a.k(new Error(`The layer '${n}' does not exist in the map's style and cannot be moved.`)));if(n===s)return;const f=this._order.indexOf(n);this._order.splice(f,1);const m=s?this._order.indexOf(s):this._order.length;s&&m===-1?this.fire(new a.k(new Error(`Cannot move layer "${n}" before non-existing layer "${s}".`))):(this._order.splice(m,0,n),this._layerOrderChanged=!0)}removeLayer(n){this._checkLoaded();const s=this._layers[n];if(!s)return void this.fire(new a.k(new Error(`Cannot remove non-existing layer "${n}".`)));s.setEventedParent(null);const f=this._order.indexOf(n);this._order.splice(f,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[n]=s,delete this._layers[n],this._serializedLayers&&delete this._serializedLayers[n],delete this._updatedLayers[n],delete this._updatedPaintProps[n],s.onRemove&&s.onRemove(this.map)}getLayer(n){return this._layers[n]}getLayersOrder(){return[...this._order]}hasLayer(n){return n in this._layers}setLayerZoomRange(n,s,f){this._checkLoaded();const m=this.getLayer(n);m?m.minzoom===s&&m.maxzoom===f||(s!=null&&(m.minzoom=s),f!=null&&(m.maxzoom=f),this._updateLayer(m)):this.fire(new a.k(new Error(`Cannot set the zoom range of non-existing layer "${n}".`)))}setFilter(n,s,f={}){this._checkLoaded();const m=this.getLayer(n);if(m){if(!a.bG(m.filter,s))return s==null?(m.setFilter(void 0),void this._updateLayer(m)):void(this._validate(a.z.filter,`layers.${m.id}.filter`,s,null,f)||(m.setFilter(a.bJ(s)),this._updateLayer(m)))}else this.fire(new a.k(new Error(`Cannot filter non-existing layer "${n}".`)))}getFilter(n){return a.bJ(this.getLayer(n).filter)}setLayoutProperty(n,s,f,m={}){this._checkLoaded();const y=this.getLayer(n);y?a.bG(y.getLayoutProperty(s),f)||(y.setLayoutProperty(s,f,m),this._updateLayer(y)):this.fire(new a.k(new Error(`Cannot style non-existing layer "${n}".`)))}getLayoutProperty(n,s){const f=this.getLayer(n);if(f)return f.getLayoutProperty(s);this.fire(new a.k(new Error(`Cannot get style of non-existing layer "${n}".`)))}setPaintProperty(n,s,f,m={}){this._checkLoaded();const y=this.getLayer(n);y?a.bG(y.getPaintProperty(s),f)||(y.setPaintProperty(s,f,m)&&this._updateLayer(y),this._changed=!0,this._updatedPaintProps[n]=!0,this._serializedLayers=null):this.fire(new a.k(new Error(`Cannot style non-existing layer "${n}".`)))}getPaintProperty(n,s){return this.getLayer(n).getPaintProperty(s)}setFeatureState(n,s){this._checkLoaded();const f=n.source,m=n.sourceLayer,y=this.sourceCaches[f];if(y===void 0)return void this.fire(new a.k(new Error(`The source '${f}' does not exist in the map's style.`)));const x=y.getSource().type;x==="geojson"&&m?this.fire(new a.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):x!=="vector"||m?(n.id===void 0&&this.fire(new a.k(new Error("The feature id parameter must be provided."))),y.setFeatureState(m,n.id,s)):this.fire(new a.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(n,s){this._checkLoaded();const f=n.source,m=this.sourceCaches[f];if(m===void 0)return void this.fire(new a.k(new Error(`The source '${f}' does not exist in the map's style.`)));const y=m.getSource().type,x=y==="vector"?n.sourceLayer:void 0;y!=="vector"||x?s&&typeof n.id!="string"&&typeof n.id!="number"?this.fire(new a.k(new Error("A feature id is required to remove its specific state property."))):m.removeFeatureState(x,n.id,s):this.fire(new a.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(n){this._checkLoaded();const s=n.source,f=n.sourceLayer,m=this.sourceCaches[s];if(m!==void 0)return m.getSource().type!=="vector"||f?(n.id===void 0&&this.fire(new a.k(new Error("The feature id parameter must be provided."))),m.getFeatureState(f,n.id)):void this.fire(new a.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new a.k(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return a.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const n=a.bM(this.sourceCaches,y=>y.serialize()),s=this._serializeByIds(this._order,!0),f=this.map.getTerrain()||void 0,m=this.stylesheet;return a.bN({version:m.version,name:m.name,metadata:m.metadata,light:m.light,sky:m.sky,center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch,sprite:m.sprite,glyphs:m.glyphs,transition:m.transition,projection:m.projection,sources:n,layers:s,terrain:f},y=>y!==void 0)}_updateLayer(n){this._updatedLayers[n.id]=!0,n.source&&!this._updatedSources[n.source]&&this.sourceCaches[n.source].getSource().type!=="raster"&&(this._updatedSources[n.source]="reload",this.sourceCaches[n.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(n){const s=x=>this._layers[x].type==="fill-extrusion",f={},m=[];for(let x=this._order.length-1;x>=0;x--){const M=this._order[x];if(s(M)){f[M]=x;for(const E of n){const z=E[M];if(z)for(const B of z)m.push(B)}}}m.sort((x,M)=>M.intersectionZ-x.intersectionZ);const y=[];for(let x=this._order.length-1;x>=0;x--){const M=this._order[x];if(s(M))for(let E=m.length-1;E>=0;E--){const z=m[E].feature;if(f[z.layer.id]<x)break;y.push(z),m.pop()}else for(const E of n){const z=E[M];if(z)for(const B of z)y.push(B.feature)}}return y}queryRenderedFeatures(n,s,f){s&&s.filter&&this._validate(a.z.filter,"queryRenderedFeatures.filter",s.filter,null,s);const m={};if(s&&s.layers){if(!(Array.isArray(s.layers)||s.layers instanceof Set))return this.fire(new a.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const z of s.layers){const B=this._layers[z];if(!B)return this.fire(new a.k(new Error(`The layer '${z}' does not exist in the map's style and cannot be queried for features.`))),[];m[B.source]=!0}}const y=[];s.availableImages=this._availableImages;const x=this._serializedAllLayers(),M=s.layers instanceof Set?s.layers:Array.isArray(s.layers)?new Set(s.layers):null,E=Object.assign(Object.assign({},s),{layers:M});for(const z in this.sourceCaches)s.layers&&!m[z]||y.push(nt(this.sourceCaches[z],this._layers,x,n,E,f,this.map.terrain?(B,j,N)=>this.map.terrain.getElevation(B,j,N):void 0));return this.placement&&y.push(function(z,B,j,N,V,Q,se){const oe={},le=Q.queryRenderedSymbols(N),de=[];for(const _e of Object.keys(le).map(Number))de.push(se[_e]);de.sort(De);for(const _e of de){const me=_e.featureIndex.lookupSymbolFeatures(le[_e.bucketInstanceId],B,_e.bucketIndex,_e.sourceLayerIndex,V.filter,V.layers,V.availableImages,z);for(const xe in me){const Te=oe[xe]=oe[xe]||[],ge=me[xe];ge.sort((ze,$e)=>{const Ne=_e.featureSortOrder;if(Ne){const je=Ne.indexOf(ze.featureIndex);return Ne.indexOf($e.featureIndex)-je}return $e.featureIndex-ze.featureIndex});for(const ze of ge)Te.push(ze)}}return function(_e,me,xe){for(const Te in _e)for(const ge of _e[Te])Ke(ge,xe[me[Te].source]);return _e}(oe,z,j)}(this._layers,x,this.sourceCaches,n,E,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(y)}querySourceFeatures(n,s){s&&s.filter&&this._validate(a.z.filter,"querySourceFeatures.filter",s.filter,null,s);const f=this.sourceCaches[n];return f?function(m,y){const x=m.getRenderableIds().map(z=>m.getTileByID(z)),M=[],E={};for(let z=0;z<x.length;z++){const B=x[z],j=B.tileID.canonical.key;E[j]||(E[j]=!0,B.querySourceFeatures(M,y))}return M}(f,s):[]}getLight(){return this.light.getLight()}setLight(n,s={}){this._checkLoaded();const f=this.light.getLight();let m=!1;for(const x in n)if(!a.bG(n[x],f[x])){m=!0;break}if(!m)return;const y={now:I.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(n,s),this.light.updateTransitions(y)}getProjection(){var n;return(n=this.stylesheet)===null||n===void 0?void 0:n.projection}setProjection(n){if(this._checkLoaded(),this.projection){if(this.projection.name===n.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=n,this._setProjectionInternal(n.type)}getSky(){var n;return(n=this.stylesheet)===null||n===void 0?void 0:n.sky}setSky(n,s={}){this._checkLoaded();const f=this.getSky();let m=!1;if(!n&&!f)return;if(n&&!f)m=!0;else if(!n&&f)m=!0;else for(const x in n)if(!a.bG(n[x],f[x])){m=!0;break}if(!m)return;const y={now:I.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=n,this.sky.setSky(n,s),this.sky.updateTransitions(y)}_setProjectionInternal(n){const s=function(f){if(Array.isArray(f)){const m=new Ll({type:f});return{projection:m,transform:new ia,cameraHelper:new Kh(m)}}switch(f){case"mercator":return{projection:new Wh,transform:new Zi,cameraHelper:new ru};case"globe":{const m=new Ll({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:m,transform:new ia,cameraHelper:new Kh(m)}}case"vertical-perspective":return{projection:new zp,transform:new Vs,cameraHelper:new Hr};default:return a.w(`Unknown projection name: ${f}. Falling back to mercator projection.`),{projection:new Wh,transform:new Zi,cameraHelper:new ru}}}(n);this.projection=s.projection,this.map.migrateProjection(s.transform,s.cameraHelper);for(const f in this.sourceCaches)this.sourceCaches[f].reload()}_validate(n,s,f,m,y={}){return(!y||y.validate!==!1)&&jl(this,n.call(a.z,a.e({key:s,style:this.serialize(),value:f,styleSpec:a.v},m)))}_remove(n=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),yn().off(qt,this._rtlPluginLoaded);for(const s in this._layers)this._layers[s].setEventedParent(null);for(const s in this.sourceCaches){const f=this.sourceCaches[s];f.setEventedParent(null),f.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),n&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(n)}_clearSource(n){this.sourceCaches[n].clearTiles()}_reloadSource(n){this.sourceCaches[n].resume(),this.sourceCaches[n].reload()}_updateSources(n){for(const s in this.sourceCaches)this.sourceCaches[s].update(n,this.map.terrain)}_generateCollisionBoxes(){for(const n in this.sourceCaches)this._reloadSource(n)}_updatePlacement(n,s,f,m,y=!1){let x=!1,M=!1;const E={};for(const z of this._order){const B=this._layers[z];if(B.type!=="symbol")continue;if(!E[B.source]){const N=this.sourceCaches[B.source];E[B.source]=N.getRenderableIds(!0).map(V=>N.getTileByID(V)).sort((V,Q)=>Q.tileID.overscaledZ-V.tileID.overscaledZ||(V.tileID.isLessThan(Q.tileID)?-1:1))}const j=this.crossTileSymbolIndex.addLayer(B,E[B.source],n.center.lng);x=x||j}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((y=y||this._layerOrderChanged||f===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(I.now(),n.zoom))&&(this.pauseablePlacement=new Di(n,this.map.terrain,this._order,y,s,f,m,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,E),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(I.now()),M=!0),x&&this.pauseablePlacement.placement.setStale()),M||x)for(const z of this._order){const B=this._layers[z];B.type==="symbol"&&this.placement.updateLayerOpacities(B,E[B.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(I.now())}_releaseSymbolFadeTiles(){for(const n in this.sourceCaches)this.sourceCaches[n].releaseSymbolFadeTiles()}getImages(n,s){return a._(this,void 0,void 0,function*(){const f=yield this.imageManager.getImages(s.icons);this._updateTilesForChangedImages();const m=this.sourceCaches[s.source];return m&&m.setDependencies(s.tileID.key,s.type,s.icons),f})}getGlyphs(n,s){return a._(this,void 0,void 0,function*(){const f=yield this.glyphManager.getGlyphs(s.stacks),m=this.sourceCaches[s.source];return m&&m.setDependencies(s.tileID.key,s.type,[""]),f})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(n,s={}){this._checkLoaded(),n&&this._validate(a.z.glyphs,"glyphs",n,null,s)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=n,this.glyphManager.entries={},this.glyphManager.setURL(n))}addSprite(n,s,f={},m){this._checkLoaded();const y=[{id:n,url:s}],x=[...re(this.stylesheet.sprite),...y];this._validate(a.z.sprite,"sprite",x,null,f)||(this.stylesheet.sprite=x,this._loadSprite(y,!0,m))}removeSprite(n){this._checkLoaded();const s=re(this.stylesheet.sprite);if(s.find(f=>f.id===n)){if(this._spritesImagesIds[n])for(const f of this._spritesImagesIds[n])this.imageManager.removeImage(f),this._changedImages[f]=!0;s.splice(s.findIndex(f=>f.id===n),1),this.stylesheet.sprite=s.length>0?s:void 0,delete this._spritesImagesIds[n],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.l("data",{dataType:"style"}))}else this.fire(new a.k(new Error(`Sprite "${n}" doesn't exists on this map.`)))}getSprite(){return re(this.stylesheet.sprite)}setSprite(n,s={},f){this._checkLoaded(),n&&this._validate(a.z.sprite,"sprite",n,null,s)||(this.stylesheet.sprite=n,n?this._loadSprite(n,!0,f):(this._unloadSprite(),f&&f(null)))}}var wy=a.aI([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Ay{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(n,s,f,m,y,x,M,E,z){this.context=n;let B=this.boundPaintVertexBuffers.length!==m.length;for(let j=0;!B&&j<m.length;j++)this.boundPaintVertexBuffers[j]!==m[j]&&(B=!0);!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==f||B||this.boundIndexBuffer!==y||this.boundVertexOffset!==x||this.boundDynamicVertexBuffer!==M||this.boundDynamicVertexBuffer2!==E||this.boundDynamicVertexBuffer3!==z?this.freshBind(s,f,m,y,x,M,E,z):(n.bindVertexArray.set(this.vao),M&&M.bind(),y&&y.dynamicDraw&&y.bind(),E&&E.bind(),z&&z.bind())}freshBind(n,s,f,m,y,x,M,E){const z=n.numAttributes,B=this.context,j=B.gl;this.vao&&this.destroy(),this.vao=B.createVertexArray(),B.bindVertexArray.set(this.vao),this.boundProgram=n,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=m,this.boundVertexOffset=y,this.boundDynamicVertexBuffer=x,this.boundDynamicVertexBuffer2=M,this.boundDynamicVertexBuffer3=E,s.enableAttributes(j,n);for(const N of f)N.enableAttributes(j,n);x&&x.enableAttributes(j,n),M&&M.enableAttributes(j,n),E&&E.enableAttributes(j,n),s.bind(),s.setVertexAttribPointers(j,n,y);for(const N of f)N.bind(),N.setVertexAttribPointers(j,n,y);x&&(x.bind(),x.setVertexAttribPointers(j,n,y)),m&&m.bind(),M&&(M.bind(),M.setVertexAttribPointers(j,n,y)),E&&(E.bind(),E.setVertexAttribPointers(j,n,y)),B.currentNumAttributes=z}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Ty=(_,n,s,f,m)=>({u_texture:0,u_ele_delta:_,u_fog_matrix:n,u_fog_color:s?s.properties.get("fog-color"):a.be.white,u_fog_ground_blend:s?s.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:m?0:s?s.calculateFogBlendOpacity(f):0,u_horizon_color:s?s.properties.get("horizon-color"):a.be.white,u_horizon_fog_blend:s?s.properties.get("horizon-fog-blend"):1,u_is_globe_mode:m?1:0}),Sy={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function au(_){const n=[];for(let s=0;s<_.length;s++){if(_[s]===null)continue;const f=_[s].split(" ");n.push(f.pop())}return n}class ou{constructor(n,s,f,m,y,x,M,E,z=[]){const B=n.gl;this.program=B.createProgram();const j=au(s.staticAttributes),N=f?f.getBinderAttributes():[],V=j.concat(N),Q=Tr.prelude.staticUniforms?au(Tr.prelude.staticUniforms):[],se=M.staticUniforms?au(M.staticUniforms):[],oe=s.staticUniforms?au(s.staticUniforms):[],le=f?f.getBinderUniforms():[],de=Q.concat(se).concat(oe).concat(le),_e=[];for(const Ne of de)_e.indexOf(Ne)<0&&_e.push(Ne);const me=f?f.defines():[];zr(B)&&me.unshift("#version 300 es"),y&&me.push("#define OVERDRAW_INSPECTOR;"),x&&me.push("#define TERRAIN3D;"),E&&me.push(E),z&&me.push(...z);let xe=me.concat(Tr.prelude.fragmentSource,M.fragmentSource,s.fragmentSource).join(`
`),Te=me.concat(Tr.prelude.vertexSource,M.vertexSource,s.vertexSource).join(`
`);zr(B)||(xe=function(Ne){return Ne.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(xe),Te=function(Ne){return Ne.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(Te));const ge=B.createShader(B.FRAGMENT_SHADER);if(B.isContextLost())return void(this.failedToCreate=!0);if(B.shaderSource(ge,xe),B.compileShader(ge),!B.getShaderParameter(ge,B.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${B.getShaderInfoLog(ge)}`);B.attachShader(this.program,ge);const ze=B.createShader(B.VERTEX_SHADER);if(B.isContextLost())return void(this.failedToCreate=!0);if(B.shaderSource(ze,Te),B.compileShader(ze),!B.getShaderParameter(ze,B.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${B.getShaderInfoLog(ze)}`);B.attachShader(this.program,ze),this.attributes={};const $e={};this.numAttributes=V.length;for(let Ne=0;Ne<this.numAttributes;Ne++)V[Ne]&&(B.bindAttribLocation(this.program,Ne,V[Ne]),this.attributes[V[Ne]]=Ne);if(B.linkProgram(this.program),!B.getProgramParameter(this.program,B.LINK_STATUS))throw new Error(`Program failed to link: ${B.getProgramInfoLog(this.program)}`);B.deleteShader(ze),B.deleteShader(ge);for(let Ne=0;Ne<_e.length;Ne++){const je=_e[Ne];if(je&&!$e[je]){const We=B.getUniformLocation(this.program,je);We&&($e[je]=We)}}this.fixedUniforms=m(n,$e),this.terrainUniforms=((Ne,je)=>({u_depth:new a.bO(Ne,je.u_depth),u_terrain:new a.bO(Ne,je.u_terrain),u_terrain_dim:new a.bf(Ne,je.u_terrain_dim),u_terrain_matrix:new a.bQ(Ne,je.u_terrain_matrix),u_terrain_unpack:new a.bR(Ne,je.u_terrain_unpack),u_terrain_exaggeration:new a.bf(Ne,je.u_terrain_exaggeration)}))(n,$e),this.projectionUniforms=((Ne,je)=>({u_projection_matrix:new a.bQ(Ne,je.u_projection_matrix),u_projection_tile_mercator_coords:new a.bR(Ne,je.u_projection_tile_mercator_coords),u_projection_clipping_plane:new a.bR(Ne,je.u_projection_clipping_plane),u_projection_transition:new a.bf(Ne,je.u_projection_transition),u_projection_fallback_matrix:new a.bQ(Ne,je.u_projection_fallback_matrix)}))(n,$e),this.binderUniforms=f?f.getUniforms(n,$e):[]}draw(n,s,f,m,y,x,M,E,z,B,j,N,V,Q,se,oe,le,de,_e){const me=n.gl;if(this.failedToCreate)return;if(n.program.set(this.program),n.setDepthMode(f),n.setStencilMode(m),n.setColorMode(y),n.setCullFace(x),E){n.activeTexture.set(me.TEXTURE2),me.bindTexture(me.TEXTURE_2D,E.depthTexture),n.activeTexture.set(me.TEXTURE3),me.bindTexture(me.TEXTURE_2D,E.texture);for(const Te in this.terrainUniforms)this.terrainUniforms[Te].set(E[Te])}if(z)for(const Te in z)this.projectionUniforms[Sy[Te]].set(z[Te]);if(M)for(const Te in this.fixedUniforms)this.fixedUniforms[Te].set(M[Te]);oe&&oe.setUniforms(n,this.binderUniforms,Q,{zoom:se});let xe=0;switch(s){case me.LINES:xe=2;break;case me.TRIANGLES:xe=3;break;case me.LINE_STRIP:xe=1}for(const Te of V.get()){const ge=Te.vaos||(Te.vaos={});(ge[B]||(ge[B]=new Ay)).bind(n,this,j,oe?oe.getPaintVertexBuffers():[],N,Te.vertexOffset,le,de,_e),me.drawElements(s,Te.primitiveLength*xe,me.UNSIGNED_SHORT,Te.primitiveOffset*xe*2)}}}function su(_,n,s){const f=1/a.aB(s,1,n.transform.tileZoom),m=Math.pow(2,s.tileID.overscaledZ),y=s.tileSize*Math.pow(2,n.transform.tileZoom)/m,x=y*(s.tileID.canonical.x+s.tileID.wrap*m),M=y*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[f,_.fromScale,_.toScale],u_fade:_.t,u_pixel_coord_upper:[x>>16,M>>16],u_pixel_coord_lower:[65535&x,65535&M]}}const Ul=(_,n,s,f)=>{const m=_.style.light,y=m.properties.get("position"),x=[y.x,y.y,y.z],M=a.bU();m.properties.get("anchor")==="viewport"&&a.bV(M,_.transform.bearingInRadians),a.bW(x,x,M);const E=_.transform.transformLightDirection(x),z=m.properties.get("color");return{u_lightpos:x,u_lightpos_globe:E,u_lightintensity:m.properties.get("intensity"),u_lightcolor:[z.r,z.g,z.b],u_vertical_gradient:+n,u_opacity:s,u_fill_translate:f}},ef=(_,n,s,f,m,y,x)=>a.e(Ul(_,n,s,f),su(y,_,x),{u_height_factor:-Math.pow(2,m.overscaledZ)/x.tileSize/8}),lu=(_,n,s,f)=>a.e(su(n,_,s),{u_fill_translate:f}),Oa=(_,n)=>({u_world:_,u_fill_translate:n}),My=(_,n,s,f,m)=>a.e(lu(_,n,s,m),{u_world:f}),tf=(_,n,s,f,m)=>{const y=_.transform;let x,M,E=0;if(s.paint.get("circle-pitch-alignment")==="map"){const z=a.aB(n,1,y.zoom);x=!0,M=[z,z],E=z/(a.$*Math.pow(2,n.tileID.overscaledZ))*2*Math.PI*m}else x=!1,M=y.pixelsToGLUnits;return{u_camera_to_center_distance:y.cameraToCenterDistance,u_scale_with_map:+(s.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+x,u_device_pixel_ratio:_.pixelRatio,u_extrude_scale:M,u_globe_extrude_scale:E,u_translate:f}},Vl=_=>({u_pixel_extrude_scale:[1/_.width,1/_.height]}),Gl=_=>({u_viewport_size:[_.width,_.height]}),Lp=(_,n=1)=>({u_color:_,u_overlay:0,u_overlay_scale:n}),ql=(_,n,s,f)=>{const m=a.aB(_,1,n)/(a.$*Math.pow(2,_.tileID.overscaledZ))*2*Math.PI*f;return{u_extrude_scale:a.aB(_,1,n),u_intensity:s,u_globe_extrude_scale:m}},Bp=(_,n,s,f)=>{const m=a.L();a.bX(m,0,_.width,_.height,0,0,1);const y=_.context.gl;return{u_matrix:m,u_world:[y.drawingBufferWidth,y.drawingBufferHeight],u_image:s,u_color_ramp:f,u_opacity:n.paint.get("heatmap-opacity")}},qs=(_,n,s)=>{const f=s.paint.get("hillshade-accent-color");let m;switch(s.paint.get("hillshade-method")){case"basic":m=4;break;case"combined":m=1;break;case"igor":m=2;break;case"multidirectional":m=3;break;default:m=0}const y=s.getIlluminationProperties();for(let x=0;x<y.directionRadians.length;x++)s.paint.get("hillshade-illumination-anchor")==="viewport"&&(y.directionRadians[x]+=_.transform.bearingInRadians);return{u_image:0,u_latrange:Fp(0,n.tileID),u_exaggeration:s.paint.get("hillshade-exaggeration"),u_altitudes:y.altitudeRadians,u_azimuths:y.directionRadians,u_accent:f,u_method:m,u_highlights:y.highlightColor,u_shadows:y.shadowColor}},Cy=(_,n)=>{const s=n.stride,f=a.L();return a.bX(f,0,a.$,-a.$,0,0,1),a.M(f,f,[0,-a.$,0]),{u_matrix:f,u_image:1,u_dimension:[s,s],u_zoom:_.overscaledZ,u_unpack:n.getUnpackVector()}};function Fp(_,n){const s=Math.pow(2,n.canonical.z),f=n.canonical.y;return[new a.a0(0,f/s).toLngLat().lat,new a.a0(0,(f+1)/s).toLngLat().lat]}const Iy=(_,n,s=0)=>({u_image:0,u_unpack:n.getUnpackVector(),u_dimension:[n.stride,n.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:s,u_opacity:_.paint.get("color-relief-opacity")}),cu=(_,n,s,f)=>{const m=_.transform;return{u_translation:af(_,n,s),u_ratio:f/a.aB(n,1,m.zoom),u_device_pixel_ratio:_.pixelRatio,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},nf=(_,n,s,f,m)=>a.e(cu(_,n,s,f),{u_image:0,u_image_height:m}),Op=(_,n,s,f,m)=>{const y=_.transform,x=rf(n,y);return{u_translation:af(_,n,s),u_texsize:n.imageAtlasTexture.size,u_ratio:f/a.aB(n,1,y.zoom),u_device_pixel_ratio:_.pixelRatio,u_image:0,u_scale:[x,m.fromScale,m.toScale],u_fade:m.t,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},Np=(_,n,s,f,m,y)=>{const x=_.lineAtlas,M=rf(n,_.transform),E=s.layout.get("line-cap")==="round",z=x.getDash(m.from,E),B=x.getDash(m.to,E),j=z.width*y.fromScale,N=B.width*y.toScale;return a.e(cu(_,n,s,f),{u_patternscale_a:[M/j,-z.height/2],u_patternscale_b:[M/N,-B.height/2],u_sdfgamma:x.width/(256*Math.min(j,N)*_.pixelRatio)/2,u_image:0,u_tex_y_a:z.y,u_tex_y_b:B.y,u_mix:y.t})};function rf(_,n){return 1/a.aB(_,1,n.tileZoom)}function af(_,n,s){return a.aC(_.transform,n,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const rs=(_,n,s,f,m)=>{return{u_tl_parent:_,u_scale_parent:n,u_buffer_scale:1,u_fade_t:s.mix,u_opacity:s.opacity*f.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:f.paint.get("raster-brightness-min"),u_brightness_high:f.paint.get("raster-brightness-max"),u_saturation_factor:(x=f.paint.get("raster-saturation"),x>0?1-1/(1.001-x):-x),u_contrast_factor:(y=f.paint.get("raster-contrast"),y>0?1/(1-y):1+y),u_spin_weights:jp(f.paint.get("raster-hue-rotate")),u_coords_top:[m[0].x,m[0].y,m[1].x,m[1].y],u_coords_bottom:[m[3].x,m[3].y,m[2].x,m[2].y]};var y,x};function jp(_){_*=Math.PI/180;const n=Math.sin(_),s=Math.cos(_);return[(2*s+1)/3,(-Math.sqrt(3)*n-s+1)/3,(Math.sqrt(3)*n-s+1)/3]}const of=(_,n,s,f,m,y,x,M,E,z,B,j,N)=>{const V=x.transform;return{u_is_size_zoom_constant:+(_==="constant"||_==="source"),u_is_size_feature_constant:+(_==="constant"||_==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:V.cameraToCenterDistance,u_pitch:V.pitch/360*2*Math.PI,u_rotate_symbol:+s,u_aspect_ratio:V.width/V.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_label_plane_matrix:M,u_coord_matrix:E,u_is_text:+B,u_pitch_with_map:+f,u_is_along_line:m,u_is_variable_anchor:y,u_texsize:j,u_texture:0,u_translation:z,u_pitched_scale:N}},Zs=(_,n,s,f,m,y,x,M,E,z,B,j,N,V)=>{const Q=x.transform;return a.e(of(_,n,s,f,m,y,x,M,E,z,B,j,V),{u_gamma_scale:f?Math.cos(Q.pitch*Math.PI/180)*Q.cameraToCenterDistance:1,u_device_pixel_ratio:x.pixelRatio,u_is_halo:1})},Ey=(_,n,s,f,m,y,x,M,E,z,B,j,N)=>a.e(Zs(_,n,s,f,m,y,x,M,E,z,!0,B,0,N),{u_texsize_icon:j,u_texture_icon:1}),uu=(_,n)=>({u_opacity:_,u_color:n}),Py=(_,n,s,f,m)=>a.e(function(y,x,M,E){const z=M.imageManager.getPattern(y.from.toString()),B=M.imageManager.getPattern(y.to.toString()),{width:j,height:N}=M.imageManager.getPixelSize(),V=Math.pow(2,E.tileID.overscaledZ),Q=E.tileSize*Math.pow(2,M.transform.tileZoom)/V,se=Q*(E.tileID.canonical.x+E.tileID.wrap*V),oe=Q*E.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:z.tl,u_pattern_br_a:z.br,u_pattern_tl_b:B.tl,u_pattern_br_b:B.br,u_texsize:[j,N],u_mix:x.t,u_pattern_size_a:z.displaySize,u_pattern_size_b:B.displaySize,u_scale_a:x.fromScale,u_scale_b:x.toScale,u_tile_units_to_pixels:1/a.aB(E,1,M.transform.tileZoom),u_pixel_coord_upper:[se>>16,oe>>16],u_pixel_coord_lower:[65535&se,65535&oe]}}(s,m,n,f),{u_opacity:_}),Up=(_,n)=>{},Vp={fillExtrusion:(_,n)=>({u_lightpos:new a.bS(_,n.u_lightpos),u_lightpos_globe:new a.bS(_,n.u_lightpos_globe),u_lightintensity:new a.bf(_,n.u_lightintensity),u_lightcolor:new a.bS(_,n.u_lightcolor),u_vertical_gradient:new a.bf(_,n.u_vertical_gradient),u_opacity:new a.bf(_,n.u_opacity),u_fill_translate:new a.bT(_,n.u_fill_translate)}),fillExtrusionPattern:(_,n)=>({u_lightpos:new a.bS(_,n.u_lightpos),u_lightpos_globe:new a.bS(_,n.u_lightpos_globe),u_lightintensity:new a.bf(_,n.u_lightintensity),u_lightcolor:new a.bS(_,n.u_lightcolor),u_vertical_gradient:new a.bf(_,n.u_vertical_gradient),u_height_factor:new a.bf(_,n.u_height_factor),u_opacity:new a.bf(_,n.u_opacity),u_fill_translate:new a.bT(_,n.u_fill_translate),u_image:new a.bO(_,n.u_image),u_texsize:new a.bT(_,n.u_texsize),u_pixel_coord_upper:new a.bT(_,n.u_pixel_coord_upper),u_pixel_coord_lower:new a.bT(_,n.u_pixel_coord_lower),u_scale:new a.bS(_,n.u_scale),u_fade:new a.bf(_,n.u_fade)}),fill:(_,n)=>({u_fill_translate:new a.bT(_,n.u_fill_translate)}),fillPattern:(_,n)=>({u_image:new a.bO(_,n.u_image),u_texsize:new a.bT(_,n.u_texsize),u_pixel_coord_upper:new a.bT(_,n.u_pixel_coord_upper),u_pixel_coord_lower:new a.bT(_,n.u_pixel_coord_lower),u_scale:new a.bS(_,n.u_scale),u_fade:new a.bf(_,n.u_fade),u_fill_translate:new a.bT(_,n.u_fill_translate)}),fillOutline:(_,n)=>({u_world:new a.bT(_,n.u_world),u_fill_translate:new a.bT(_,n.u_fill_translate)}),fillOutlinePattern:(_,n)=>({u_world:new a.bT(_,n.u_world),u_image:new a.bO(_,n.u_image),u_texsize:new a.bT(_,n.u_texsize),u_pixel_coord_upper:new a.bT(_,n.u_pixel_coord_upper),u_pixel_coord_lower:new a.bT(_,n.u_pixel_coord_lower),u_scale:new a.bS(_,n.u_scale),u_fade:new a.bf(_,n.u_fade),u_fill_translate:new a.bT(_,n.u_fill_translate)}),circle:(_,n)=>({u_camera_to_center_distance:new a.bf(_,n.u_camera_to_center_distance),u_scale_with_map:new a.bO(_,n.u_scale_with_map),u_pitch_with_map:new a.bO(_,n.u_pitch_with_map),u_extrude_scale:new a.bT(_,n.u_extrude_scale),u_device_pixel_ratio:new a.bf(_,n.u_device_pixel_ratio),u_globe_extrude_scale:new a.bf(_,n.u_globe_extrude_scale),u_translate:new a.bT(_,n.u_translate)}),collisionBox:(_,n)=>({u_pixel_extrude_scale:new a.bT(_,n.u_pixel_extrude_scale)}),collisionCircle:(_,n)=>({u_viewport_size:new a.bT(_,n.u_viewport_size)}),debug:(_,n)=>({u_color:new a.bP(_,n.u_color),u_overlay:new a.bO(_,n.u_overlay),u_overlay_scale:new a.bf(_,n.u_overlay_scale)}),depth:Up,clippingMask:Up,heatmap:(_,n)=>({u_extrude_scale:new a.bf(_,n.u_extrude_scale),u_intensity:new a.bf(_,n.u_intensity),u_globe_extrude_scale:new a.bf(_,n.u_globe_extrude_scale)}),heatmapTexture:(_,n)=>({u_matrix:new a.bQ(_,n.u_matrix),u_world:new a.bT(_,n.u_world),u_image:new a.bO(_,n.u_image),u_color_ramp:new a.bO(_,n.u_color_ramp),u_opacity:new a.bf(_,n.u_opacity)}),hillshade:(_,n)=>({u_image:new a.bO(_,n.u_image),u_latrange:new a.bT(_,n.u_latrange),u_exaggeration:new a.bf(_,n.u_exaggeration),u_altitudes:new a.bZ(_,n.u_altitudes),u_azimuths:new a.bZ(_,n.u_azimuths),u_accent:new a.bP(_,n.u_accent),u_method:new a.bO(_,n.u_method),u_shadows:new a.bY(_,n.u_shadows),u_highlights:new a.bY(_,n.u_highlights)}),hillshadePrepare:(_,n)=>({u_matrix:new a.bQ(_,n.u_matrix),u_image:new a.bO(_,n.u_image),u_dimension:new a.bT(_,n.u_dimension),u_zoom:new a.bf(_,n.u_zoom),u_unpack:new a.bR(_,n.u_unpack)}),colorRelief:(_,n)=>({u_image:new a.bO(_,n.u_image),u_unpack:new a.bR(_,n.u_unpack),u_dimension:new a.bT(_,n.u_dimension),u_elevation_stops:new a.bO(_,n.u_elevation_stops),u_color_stops:new a.bO(_,n.u_color_stops),u_color_ramp_size:new a.bO(_,n.u_color_ramp_size),u_opacity:new a.bf(_,n.u_opacity)}),line:(_,n)=>({u_translation:new a.bT(_,n.u_translation),u_ratio:new a.bf(_,n.u_ratio),u_device_pixel_ratio:new a.bf(_,n.u_device_pixel_ratio),u_units_to_pixels:new a.bT(_,n.u_units_to_pixels)}),lineGradient:(_,n)=>({u_translation:new a.bT(_,n.u_translation),u_ratio:new a.bf(_,n.u_ratio),u_device_pixel_ratio:new a.bf(_,n.u_device_pixel_ratio),u_units_to_pixels:new a.bT(_,n.u_units_to_pixels),u_image:new a.bO(_,n.u_image),u_image_height:new a.bf(_,n.u_image_height)}),linePattern:(_,n)=>({u_translation:new a.bT(_,n.u_translation),u_texsize:new a.bT(_,n.u_texsize),u_ratio:new a.bf(_,n.u_ratio),u_device_pixel_ratio:new a.bf(_,n.u_device_pixel_ratio),u_image:new a.bO(_,n.u_image),u_units_to_pixels:new a.bT(_,n.u_units_to_pixels),u_scale:new a.bS(_,n.u_scale),u_fade:new a.bf(_,n.u_fade)}),lineSDF:(_,n)=>({u_translation:new a.bT(_,n.u_translation),u_ratio:new a.bf(_,n.u_ratio),u_device_pixel_ratio:new a.bf(_,n.u_device_pixel_ratio),u_units_to_pixels:new a.bT(_,n.u_units_to_pixels),u_patternscale_a:new a.bT(_,n.u_patternscale_a),u_patternscale_b:new a.bT(_,n.u_patternscale_b),u_sdfgamma:new a.bf(_,n.u_sdfgamma),u_image:new a.bO(_,n.u_image),u_tex_y_a:new a.bf(_,n.u_tex_y_a),u_tex_y_b:new a.bf(_,n.u_tex_y_b),u_mix:new a.bf(_,n.u_mix)}),raster:(_,n)=>({u_tl_parent:new a.bT(_,n.u_tl_parent),u_scale_parent:new a.bf(_,n.u_scale_parent),u_buffer_scale:new a.bf(_,n.u_buffer_scale),u_fade_t:new a.bf(_,n.u_fade_t),u_opacity:new a.bf(_,n.u_opacity),u_image0:new a.bO(_,n.u_image0),u_image1:new a.bO(_,n.u_image1),u_brightness_low:new a.bf(_,n.u_brightness_low),u_brightness_high:new a.bf(_,n.u_brightness_high),u_saturation_factor:new a.bf(_,n.u_saturation_factor),u_contrast_factor:new a.bf(_,n.u_contrast_factor),u_spin_weights:new a.bS(_,n.u_spin_weights),u_coords_top:new a.bR(_,n.u_coords_top),u_coords_bottom:new a.bR(_,n.u_coords_bottom)}),symbolIcon:(_,n)=>({u_is_size_zoom_constant:new a.bO(_,n.u_is_size_zoom_constant),u_is_size_feature_constant:new a.bO(_,n.u_is_size_feature_constant),u_size_t:new a.bf(_,n.u_size_t),u_size:new a.bf(_,n.u_size),u_camera_to_center_distance:new a.bf(_,n.u_camera_to_center_distance),u_pitch:new a.bf(_,n.u_pitch),u_rotate_symbol:new a.bO(_,n.u_rotate_symbol),u_aspect_ratio:new a.bf(_,n.u_aspect_ratio),u_fade_change:new a.bf(_,n.u_fade_change),u_label_plane_matrix:new a.bQ(_,n.u_label_plane_matrix),u_coord_matrix:new a.bQ(_,n.u_coord_matrix),u_is_text:new a.bO(_,n.u_is_text),u_pitch_with_map:new a.bO(_,n.u_pitch_with_map),u_is_along_line:new a.bO(_,n.u_is_along_line),u_is_variable_anchor:new a.bO(_,n.u_is_variable_anchor),u_texsize:new a.bT(_,n.u_texsize),u_texture:new a.bO(_,n.u_texture),u_translation:new a.bT(_,n.u_translation),u_pitched_scale:new a.bf(_,n.u_pitched_scale)}),symbolSDF:(_,n)=>({u_is_size_zoom_constant:new a.bO(_,n.u_is_size_zoom_constant),u_is_size_feature_constant:new a.bO(_,n.u_is_size_feature_constant),u_size_t:new a.bf(_,n.u_size_t),u_size:new a.bf(_,n.u_size),u_camera_to_center_distance:new a.bf(_,n.u_camera_to_center_distance),u_pitch:new a.bf(_,n.u_pitch),u_rotate_symbol:new a.bO(_,n.u_rotate_symbol),u_aspect_ratio:new a.bf(_,n.u_aspect_ratio),u_fade_change:new a.bf(_,n.u_fade_change),u_label_plane_matrix:new a.bQ(_,n.u_label_plane_matrix),u_coord_matrix:new a.bQ(_,n.u_coord_matrix),u_is_text:new a.bO(_,n.u_is_text),u_pitch_with_map:new a.bO(_,n.u_pitch_with_map),u_is_along_line:new a.bO(_,n.u_is_along_line),u_is_variable_anchor:new a.bO(_,n.u_is_variable_anchor),u_texsize:new a.bT(_,n.u_texsize),u_texture:new a.bO(_,n.u_texture),u_gamma_scale:new a.bf(_,n.u_gamma_scale),u_device_pixel_ratio:new a.bf(_,n.u_device_pixel_ratio),u_is_halo:new a.bO(_,n.u_is_halo),u_translation:new a.bT(_,n.u_translation),u_pitched_scale:new a.bf(_,n.u_pitched_scale)}),symbolTextAndIcon:(_,n)=>({u_is_size_zoom_constant:new a.bO(_,n.u_is_size_zoom_constant),u_is_size_feature_constant:new a.bO(_,n.u_is_size_feature_constant),u_size_t:new a.bf(_,n.u_size_t),u_size:new a.bf(_,n.u_size),u_camera_to_center_distance:new a.bf(_,n.u_camera_to_center_distance),u_pitch:new a.bf(_,n.u_pitch),u_rotate_symbol:new a.bO(_,n.u_rotate_symbol),u_aspect_ratio:new a.bf(_,n.u_aspect_ratio),u_fade_change:new a.bf(_,n.u_fade_change),u_label_plane_matrix:new a.bQ(_,n.u_label_plane_matrix),u_coord_matrix:new a.bQ(_,n.u_coord_matrix),u_is_text:new a.bO(_,n.u_is_text),u_pitch_with_map:new a.bO(_,n.u_pitch_with_map),u_is_along_line:new a.bO(_,n.u_is_along_line),u_is_variable_anchor:new a.bO(_,n.u_is_variable_anchor),u_texsize:new a.bT(_,n.u_texsize),u_texsize_icon:new a.bT(_,n.u_texsize_icon),u_texture:new a.bO(_,n.u_texture),u_texture_icon:new a.bO(_,n.u_texture_icon),u_gamma_scale:new a.bf(_,n.u_gamma_scale),u_device_pixel_ratio:new a.bf(_,n.u_device_pixel_ratio),u_is_halo:new a.bO(_,n.u_is_halo),u_translation:new a.bT(_,n.u_translation),u_pitched_scale:new a.bf(_,n.u_pitched_scale)}),background:(_,n)=>({u_opacity:new a.bf(_,n.u_opacity),u_color:new a.bP(_,n.u_color)}),backgroundPattern:(_,n)=>({u_opacity:new a.bf(_,n.u_opacity),u_image:new a.bO(_,n.u_image),u_pattern_tl_a:new a.bT(_,n.u_pattern_tl_a),u_pattern_br_a:new a.bT(_,n.u_pattern_br_a),u_pattern_tl_b:new a.bT(_,n.u_pattern_tl_b),u_pattern_br_b:new a.bT(_,n.u_pattern_br_b),u_texsize:new a.bT(_,n.u_texsize),u_mix:new a.bf(_,n.u_mix),u_pattern_size_a:new a.bT(_,n.u_pattern_size_a),u_pattern_size_b:new a.bT(_,n.u_pattern_size_b),u_scale_a:new a.bf(_,n.u_scale_a),u_scale_b:new a.bf(_,n.u_scale_b),u_pixel_coord_upper:new a.bT(_,n.u_pixel_coord_upper),u_pixel_coord_lower:new a.bT(_,n.u_pixel_coord_lower),u_tile_units_to_pixels:new a.bf(_,n.u_tile_units_to_pixels)}),terrain:(_,n)=>({u_texture:new a.bO(_,n.u_texture),u_ele_delta:new a.bf(_,n.u_ele_delta),u_fog_matrix:new a.bQ(_,n.u_fog_matrix),u_fog_color:new a.bP(_,n.u_fog_color),u_fog_ground_blend:new a.bf(_,n.u_fog_ground_blend),u_fog_ground_blend_opacity:new a.bf(_,n.u_fog_ground_blend_opacity),u_horizon_color:new a.bP(_,n.u_horizon_color),u_horizon_fog_blend:new a.bf(_,n.u_horizon_fog_blend),u_is_globe_mode:new a.bf(_,n.u_is_globe_mode)}),terrainDepth:(_,n)=>({u_ele_delta:new a.bf(_,n.u_ele_delta)}),terrainCoords:(_,n)=>({u_texture:new a.bO(_,n.u_texture),u_terrain_coords_id:new a.bf(_,n.u_terrain_coords_id),u_ele_delta:new a.bf(_,n.u_ele_delta)}),projectionErrorMeasurement:(_,n)=>({u_input:new a.bf(_,n.u_input),u_output_expected:new a.bf(_,n.u_output_expected)}),atmosphere:(_,n)=>({u_sun_pos:new a.bS(_,n.u_sun_pos),u_atmosphere_blend:new a.bf(_,n.u_atmosphere_blend),u_globe_position:new a.bS(_,n.u_globe_position),u_globe_radius:new a.bf(_,n.u_globe_radius),u_inv_proj_matrix:new a.bQ(_,n.u_inv_proj_matrix)}),sky:(_,n)=>({u_sky_color:new a.bP(_,n.u_sky_color),u_horizon_color:new a.bP(_,n.u_horizon_color),u_horizon:new a.bT(_,n.u_horizon),u_horizon_normal:new a.bT(_,n.u_horizon_normal),u_sky_horizon_blend:new a.bf(_,n.u_sky_horizon_blend),u_sky_blend:new a.bf(_,n.u_sky_blend)})};class Gp{constructor(n,s,f){this.context=n;const m=n.gl;this.buffer=m.createBuffer(),this.dynamicDraw=!!f,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){const s=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const qp={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class sf{constructor(n,s,f,m){this.length=s.length,this.attributes=f,this.itemSize=s.bytesPerElement,this.dynamicDraw=m,this.context=n;const y=n.gl;this.buffer=y.createBuffer(),n.bindVertexBuffer.set(this.buffer),y.bufferData(y.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){if(n.length!==this.length)throw new Error(`Length of new data is ${n.length}, which doesn't match current length of ${this.length}`);const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,s){for(let f=0;f<this.attributes.length;f++){const m=s.attributes[this.attributes[f].name];m!==void 0&&n.enableVertexAttribArray(m)}}setVertexAttribPointers(n,s,f){for(let m=0;m<this.attributes.length;m++){const y=this.attributes[m],x=s.attributes[y.name];x!==void 0&&n.vertexAttribPointer(x,y.components,n[qp[y.type]],!1,this.itemSize,y.offset+this.itemSize*(f||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class ni{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class hu extends ni{getDefault(){return a.be.transparent}set(n){const s=this.current;(n.r!==s.r||n.g!==s.g||n.b!==s.b||n.a!==s.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class ro extends ni{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class lf extends ni{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class cf extends ni{getDefault(){return[!0,!0,!0,!0]}set(n){const s=this.current;(n[0]!==s[0]||n[1]!==s[1]||n[2]!==s[2]||n[3]!==s[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class uf extends ni{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class Zp extends ni{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class hf extends ni{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const s=this.current;(n.func!==s.func||n.ref!==s.ref||n.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class as extends ni{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const s=this.current;(n[0]!==s[0]||n[1]!==s[1]||n[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class ff extends ni{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;n?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=n,this.dirty=!1}}class ky extends ni{getDefault(){return[0,1]}set(n){const s=this.current;(n[0]!==s[0]||n[1]!==s[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class Dy extends ni{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;n?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=n,this.dirty=!1}}class zy extends ni{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class Ry extends ni{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;n?s.enable(s.BLEND):s.disable(s.BLEND),this.current=n,this.dirty=!1}}class Hp extends ni{getDefault(){const n=this.gl;return[n.ONE,n.ZERO]}set(n){const s=this.current;(n[0]!==s[0]||n[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(n[0],n[1]),this.current=n,this.dirty=!1)}}class Ly extends ni{getDefault(){return a.be.transparent}set(n){const s=this.current;(n.r!==s.r||n.g!==s.g||n.b!==s.b||n.a!==s.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class $p extends ni{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquation(n),this.current=n,this.dirty=!1)}}class fu extends ni{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;n?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=n,this.dirty=!1}}class du extends ni{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class pu extends ni{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}class df extends ni{getDefault(){return null}set(n){(n!==this.current||this.dirty)&&(this.gl.useProgram(n),this.current=n,this.dirty=!1)}}class os extends ni{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class Zl extends ni{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const s=this.current;(n[0]!==s[0]||n[1]!==s[1]||n[2]!==s[2]||n[3]!==s[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Hs extends ni{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class pa extends ni{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Wp extends ni{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class Yp extends ni{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class pf extends ni{getDefault(){return null}set(n){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class ss extends ni{getDefault(){return null}set(n){var s;if(n===this.current&&!this.dirty)return;const f=this.gl;zr(f)?f.bindVertexArray(n):(s=f.getExtension("OES_vertex_array_object"))===null||s===void 0||s.bindVertexArrayOES(n),this.current=n,this.dirty=!1}}class mu extends ni{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class gu extends ni{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class Hl extends ni{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class $s extends ni{constructor(n,s){super(n),this.context=n,this.parent=s}getDefault(){return null}}class Xp extends $s{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class Ws extends $s{set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Ys extends $s{set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,n),this.current=n,this.dirty=!1}}const mf="Framebuffer is not complete";class gf{constructor(n,s,f,m,y){this.context=n,this.width=s,this.height=f;const x=n.gl,M=this.framebuffer=x.createFramebuffer();if(this.colorAttachment=new Xp(n,M),m)this.depthAttachment=y?new Ys(n,M):new Ws(n,M);else if(y)throw new Error("Stencil cannot be set without depth");if(x.checkFramebufferStatus(x.FRAMEBUFFER)!==x.FRAMEBUFFER_COMPLETE)throw new Error(mf)}destroy(){const n=this.context.gl,s=this.colorAttachment.get();if(s&&n.deleteTexture(s),this.depthAttachment){const f=this.depthAttachment.get();f&&n.deleteRenderbuffer(f)}n.deleteFramebuffer(this.framebuffer)}}class Rn{constructor(n){var s,f;if(this.gl=n,this.clearColor=new hu(this),this.clearDepth=new ro(this),this.clearStencil=new lf(this),this.colorMask=new cf(this),this.depthMask=new uf(this),this.stencilMask=new Zp(this),this.stencilFunc=new hf(this),this.stencilOp=new as(this),this.stencilTest=new ff(this),this.depthRange=new ky(this),this.depthTest=new Dy(this),this.depthFunc=new zy(this),this.blend=new Ry(this),this.blendFunc=new Hp(this),this.blendColor=new Ly(this),this.blendEquation=new $p(this),this.cullFace=new fu(this),this.cullFaceSide=new du(this),this.frontFace=new pu(this),this.program=new df(this),this.activeTexture=new os(this),this.viewport=new Zl(this),this.bindFramebuffer=new Hs(this),this.bindRenderbuffer=new pa(this),this.bindTexture=new Wp(this),this.bindVertexBuffer=new Yp(this),this.bindElementBuffer=new pf(this),this.bindVertexArray=new ss(this),this.pixelStoreUnpack=new mu(this),this.pixelStoreUnpackPremultiplyAlpha=new gu(this),this.pixelStoreUnpackFlipY=new Hl(this),this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),zr(n)){this.HALF_FLOAT=n.HALF_FLOAT;const m=n.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(s=n.RGBA16F)!==null&&s!==void 0?s:m==null?void 0:m.RGBA16F_EXT,this.RGB16F=(f=n.RGB16F)!==null&&f!==void 0?f:m==null?void 0:m.RGB16F_EXT,n.getExtension("EXT_color_buffer_float")}else{n.getExtension("EXT_color_buffer_half_float"),n.getExtension("OES_texture_half_float_linear");const m=n.getExtension("OES_texture_half_float");this.HALF_FLOAT=m==null?void 0:m.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,s){return new Gp(this,n,s)}createVertexBuffer(n,s,f){return new sf(this,n,s,f)}createRenderbuffer(n,s,f){const m=this.gl,y=m.createRenderbuffer();return this.bindRenderbuffer.set(y),m.renderbufferStorage(m.RENDERBUFFER,n,s,f),this.bindRenderbuffer.set(null),y}createFramebuffer(n,s,f,m){return new gf(this,n,s,f,m)}clear({color:n,depth:s,stencil:f}){const m=this.gl;let y=0;n&&(y|=m.COLOR_BUFFER_BIT,this.clearColor.set(n),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(y|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),f!==void 0&&(y|=m.STENCIL_BUFFER_BIT,this.clearStencil.set(f),this.stencilMask.set(255)),m.clear(y)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){a.bG(n.blendFunction,Hn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor)),this.colorMask.set(n.mask)}createVertexArray(){var n;return zr(this.gl)?this.gl.createVertexArray():(n=this.gl.getExtension("OES_vertex_array_object"))===null||n===void 0?void 0:n.createVertexArrayOES()}deleteVertexArray(n){var s;return zr(this.gl)?this.gl.deleteVertexArray(n):(s=this.gl.getExtension("OES_vertex_array_object"))===null||s===void 0?void 0:s.deleteVertexArrayOES(n)}unbindVAO(){this.bindVertexArray.set(null)}}let ls;function Qp(_,n,s,f,m){const y=_.context,x=_.transform,M=y.gl,E=_.useProgram("collisionBox"),z=[];let B=0,j=0;for(let le=0;le<f.length;le++){const de=f[le],_e=n.getTile(de).getBucket(s);if(!_e)continue;const me=m?_e.textCollisionBox:_e.iconCollisionBox,xe=_e.collisionCircleArray;xe.length>0&&(z.push({circleArray:xe,circleOffset:j,coord:de}),B+=xe.length/4,j=B),me&&E.draw(y,M.LINES,Sn.disabled,dn.disabled,_.colorModeForRenderPass(),xn.disabled,Vl(_.transform),_.style.map.terrain&&_.style.map.terrain.getTerrainData(de),x.getProjectionData({overscaledTileID:de,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),s.id,me.layoutVertexBuffer,me.indexBuffer,me.segments,null,_.transform.zoom,null,null,me.collisionVertexBuffer)}if(!m||!z.length)return;const N=_.useProgram("collisionCircle"),V=new a.b_;V.resize(4*B),V._trim();let Q=0;for(const le of z)for(let de=0;de<le.circleArray.length/4;de++){const _e=4*de,me=le.circleArray[_e+0],xe=le.circleArray[_e+1],Te=le.circleArray[_e+2],ge=le.circleArray[_e+3];V.emplace(Q++,me,xe,Te,ge,0),V.emplace(Q++,me,xe,Te,ge,1),V.emplace(Q++,me,xe,Te,ge,2),V.emplace(Q++,me,xe,Te,ge,3)}(!ls||ls.length<2*B)&&(ls=function(le){const de=2*le,_e=new a.c0;_e.resize(de),_e._trim();for(let me=0;me<de;me++){const xe=6*me;_e.uint16[xe+0]=4*me+0,_e.uint16[xe+1]=4*me+1,_e.uint16[xe+2]=4*me+2,_e.uint16[xe+3]=4*me+2,_e.uint16[xe+4]=4*me+3,_e.uint16[xe+5]=4*me+0}return _e}(B));const se=y.createIndexBuffer(ls,!0),oe=y.createVertexBuffer(V,a.b$.members,!0);for(const le of z){const de=Gl(_.transform);N.draw(y,M.TRIANGLES,Sn.disabled,dn.disabled,_.colorModeForRenderPass(),xn.disabled,de,_.style.map.terrain&&_.style.map.terrain.getTerrainData(le.coord),null,s.id,oe,se,a.aL.simpleSegment(0,2*le.circleOffset,le.circleArray.length,le.circleArray.length/2),null,_.transform.zoom,null,null,null)}oe.destroy(),se.destroy()}const Kp=a.af(new Float32Array(16));function $l(_,n,s,f,m,y){const{horizontalAlign:x,verticalAlign:M}=a.aG(_);return new a.P((-(x-.5)*n/m+f[0])*y,(-(M-.5)*s/m+f[1])*y)}function By(_,n,s,f,m,y){const x=n.tileAnchorPoint.add(new a.P(n.translation[0],n.translation[1]));if(n.pitchWithMap){let M=f.mult(y);s||(M=M.rotate(-m));const E=x.add(M);return Nn(E.x,E.y,n.pitchedLabelPlaneMatrix,n.getElevation).point}if(s){const M=kt(n.tileAnchorPoint.x+1,n.tileAnchorPoint.y,n).point.sub(_),E=Math.atan(M.y/M.x)+(M.x<0?Math.PI:0);return _.add(f.rotate(E))}return _.add(f)}function Fy(_,n,s,f,m,y,x,M,E,z,B,j){const N=_.text.placedSymbolArray,V=_.text.dynamicLayoutVertexArray,Q=_.icon.dynamicLayoutVertexArray,se={};V.clear();for(let oe=0;oe<N.length;oe++){const le=N.get(oe),de=le.hidden||!le.crossTileID||_.allowVerticalPlacement&&!le.placedOrientation?null:f[le.crossTileID];if(de){const _e=new a.P(le.anchorX,le.anchorY),me={getElevation:j,width:m.width,height:m.height,pitchedLabelPlaneMatrix:y,pitchWithMap:s,transform:m,tileAnchorPoint:_e,translation:z,unwrappedTileID:B},xe=s?rt(_e.x,_e.y,me):kt(_e.x,_e.y,me),Te=ln(m.cameraToCenterDistance,xe.signedDistanceFromCamera);let ge=a.ao(_.textSizeData,M,le)*Te/a.aA;s&&(ge*=_.tilePixelRatio/x);const{width:ze,height:$e,anchor:Ne,textOffset:je,textBoxScale:We}=de,zt=$l(Ne,ze,$e,je,We,ge),Ct=m.getPitchedTextCorrection(_e.x+z[0],_e.y+z[1],B),ft=By(xe.point,me,n,zt,-m.bearingInRadians,Ct),Wt=_.allowVerticalPlacement&&le.placedOrientation===a.an.vertical?Math.PI/2:0;for(let Mn=0;Mn<le.numGlyphs;Mn++)a.au(V,ft,Wt);E&&le.associatedIconIndex>=0&&(se[le.associatedIconIndex]={shiftedAnchor:ft,angle:Wt})}else Oe(le.numGlyphs,V)}if(E){Q.clear();const oe=_.icon.placedSymbolArray;for(let le=0;le<oe.length;le++){const de=oe.get(le);if(de.hidden)Oe(de.numGlyphs,Q);else{const _e=se[le];if(_e)for(let me=0;me<de.numGlyphs;me++)a.au(Q,_e.shiftedAnchor,_e.angle);else Oe(de.numGlyphs,Q)}}_.icon.dynamicLayoutVertexBuffer.updateData(Q)}_.text.dynamicLayoutVertexBuffer.updateData(V)}function Jp(_,n,s){return s.iconsInText&&n?"symbolTextAndIcon":_?"symbolSDF":"symbolIcon"}function em(_,n,s,f,m,y,x,M,E,z,B,j,N){const V=_.context,Q=V.gl,se=_.transform,oe=M==="map",le=E==="map",de=M!=="viewport"&&s.layout.get("symbol-placement")!=="point",_e=oe&&!le&&!de,me=!s.layout.get("symbol-sort-key").isConstant();let xe=!1;const Te=_.getDepthModeForSublayer(0,Sn.ReadOnly),ge=s._unevaluatedLayout.hasValue("text-variable-anchor")||s._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ze=[],$e=se.getCircleRadiusCorrection();for(const Ne of f){const je=n.getTile(Ne),We=je.getBucket(s);if(!We)continue;const zt=m?We.text:We.icon;if(!zt||!zt.segments.get().length||!zt.hasVisibleVertices)continue;const Ct=zt.programConfigurations.get(s.id),ft=m||We.sdfIcons,Wt=m?We.textSizeData:We.iconSizeData,Mn=le||se.pitch!==0,ii=_.useProgram(Jp(ft,m,We),Ct),Li=a.am(Wt,se.zoom),hi=_.style.map.terrain&&_.style.map.terrain.getTerrainData(Ne);let Bi,vi,fi,bi,gr=[0,0],Wn=null;if(m)vi=je.glyphAtlasTexture,fi=Q.LINEAR,Bi=je.glyphAtlasTexture.size,We.iconsInText&&(gr=je.imageAtlasTexture.size,Wn=je.imageAtlasTexture,bi=Mn||_.options.rotating||_.options.zooming||Wt.kind==="composite"||Wt.kind==="camera"?Q.LINEAR:Q.NEAREST);else{const Vi=s.layout.get("icon-size").constantOr(0)!==1||We.iconsNeedLinear;vi=je.imageAtlasTexture,fi=ft||_.options.rotating||_.options.zooming||Vi||Mn?Q.LINEAR:Q.NEAREST,Bi=je.imageAtlasTexture.size}const or=a.aB(je,1,_.transform.zoom),_r=en(oe,_.transform,or),ko=a.L();a.ap(ko,_r);const Do=ti(le,oe,_.transform,or),zo=a.aC(se,je,y,x),Ua=se.getProjectionData({overscaledTileID:Ne,applyGlobeMatrix:!N,applyTerrainMatrix:!0}),sc=ge&&We.hasTextData(),lc=s.layout.get("icon-text-fit")!=="none"&&sc&&We.hasIconData();if(de){const Vi=_.style.map.terrain?(Fr,Ji)=>_.style.map.terrain.getElevation(Ne,Fr,Ji):null,Ii=s.layout.get("text-rotation-alignment")==="map";li(We,_,m,_r,ko,le,z,Ii,Ne.toUnwrapped(),se.width,se.height,zo,Vi)}const sl=m&&ge||lc,Wr=de||sl?Kp:le?_r:_.transform.clipSpaceToPixelsMatrix,Ta=ft&&s.paint.get(m?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Ro;Ro=ft?We.iconsInText?Ey(Wt.kind,Li,_e,le,de,sl,_,Wr,Do,zo,Bi,gr,$e):Zs(Wt.kind,Li,_e,le,de,sl,_,Wr,Do,zo,m,Bi,0,$e):of(Wt.kind,Li,_e,le,de,sl,_,Wr,Do,zo,m,Bi,$e);const hs={program:ii,buffers:zt,uniformValues:Ro,projectionData:Ua,atlasTexture:vi,atlasTextureIcon:Wn,atlasInterpolation:fi,atlasInterpolationIcon:bi,isSDF:ft,hasHalo:Ta};if(me&&We.canOverlap){xe=!0;const Vi=zt.segments.get();for(const Ii of Vi)ze.push({segments:new a.aL([Ii]),sortKey:Ii.sortKey,state:hs,terrainData:hi})}else ze.push({segments:zt.segments,sortKey:0,state:hs,terrainData:hi})}xe&&ze.sort((Ne,je)=>Ne.sortKey-je.sortKey);for(const Ne of ze){const je=Ne.state;if(V.activeTexture.set(Q.TEXTURE0),je.atlasTexture.bind(je.atlasInterpolation,Q.CLAMP_TO_EDGE),je.atlasTextureIcon&&(V.activeTexture.set(Q.TEXTURE1),je.atlasTextureIcon&&je.atlasTextureIcon.bind(je.atlasInterpolationIcon,Q.CLAMP_TO_EDGE)),je.isSDF){const We=je.uniformValues;je.hasHalo&&(We.u_is_halo=1,_u(je.buffers,Ne.segments,s,_,je.program,Te,B,j,We,je.projectionData,Ne.terrainData)),We.u_is_halo=0}_u(je.buffers,Ne.segments,s,_,je.program,Te,B,j,je.uniformValues,je.projectionData,Ne.terrainData)}}function _u(_,n,s,f,m,y,x,M,E,z,B){const j=f.context;m.draw(j,j.gl.TRIANGLES,y,x,M,xn.backCCW,E,B,z,s.id,_.layoutVertexBuffer,_.indexBuffer,n,s.paint,f.transform.zoom,_.programConfigurations.get(s.id),_.dynamicLayoutVertexBuffer,_.opacityVertexBuffer)}function yu(_,n,s,f,m){const y=_.context,x=y.gl,M=dn.disabled,E=new Hn([x.ONE,x.ONE],a.be.transparent,[!0,!0,!0,!0]),z=n.getBucket(s);if(!z)return;const B=f.key;let j=s.heatmapFbos.get(B);j||(j=Wl(y,n.tileSize,n.tileSize),s.heatmapFbos.set(B,j)),y.bindFramebuffer.set(j.framebuffer),y.viewport.set([0,0,n.tileSize,n.tileSize]),y.clear({color:a.be.transparent});const N=z.programConfigurations.get(s.id),V=_.useProgram("heatmap",N,!m),Q=_.transform.getProjectionData({overscaledTileID:n.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),se=_.style.map.terrain.getTerrainData(f);V.draw(y,x.TRIANGLES,Sn.disabled,M,E,xn.disabled,ql(n,_.transform.zoom,s.paint.get("heatmap-intensity"),1),se,Q,s.id,z.layoutVertexBuffer,z.indexBuffer,z.segments,s.paint,_.transform.zoom,N)}function vu(_,n,s,f,m){const y=_.context,x=y.gl,M=_.transform;y.setColorMode(_.colorModeForRenderPass());const E=bu(y,n),z=s.key,B=n.heatmapFbos.get(z);if(!B)return;y.activeTexture.set(x.TEXTURE0),x.bindTexture(x.TEXTURE_2D,B.colorAttachment.get()),y.activeTexture.set(x.TEXTURE1),E.bind(x.LINEAR,x.CLAMP_TO_EDGE);const j=M.getProjectionData({overscaledTileID:s,applyTerrainMatrix:m,applyGlobeMatrix:!f});_.useProgram("heatmapTexture").draw(y,x.TRIANGLES,Sn.disabled,dn.disabled,_.colorModeForRenderPass(),xn.disabled,Bp(_,n,0,1),null,j,n.id,_.rasterBoundsBuffer,_.quadTriangleIndexBuffer,_.rasterBoundsSegments,n.paint,M.zoom),B.destroy(),n.heatmapFbos.delete(z)}function Wl(_,n,s){var f,m;const y=_.gl,x=y.createTexture();y.bindTexture(y.TEXTURE_2D,x),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,y.CLAMP_TO_EDGE),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,y.CLAMP_TO_EDGE),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,y.LINEAR),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,y.LINEAR);const M=(f=_.HALF_FLOAT)!==null&&f!==void 0?f:y.UNSIGNED_BYTE,E=(m=_.RGBA16F)!==null&&m!==void 0?m:y.RGBA;y.texImage2D(y.TEXTURE_2D,0,E,n,s,0,y.RGBA,M,null);const z=_.createFramebuffer(n,s,!1,!1);return z.colorAttachment.set(x),z}function bu(_,n){return n.colorRampTexture||(n.colorRampTexture=new a.T(_,n.colorRamp,_.gl.RGBA)),n.colorRampTexture}function _f(_,n,s,f,m){if(!s||!f||!f.imageAtlas)return;const y=f.imageAtlas.patternPositions;let x=y[s.to.toString()],M=y[s.from.toString()];if(!x&&M&&(x=M),!M&&x&&(M=x),!x||!M){const E=m.getPaintProperty(n);x=y[E],M=y[E]}x&&M&&_.setConstantPatternPositions(x,M)}function Yl(_,n,s,f,m,y,x,M){const E=_.context.gl,z="fill-pattern",B=s.paint.get(z),j=B&&B.constantOr(1),N=s.getCrossfadeParameters();let V,Q,se,oe,le;const de=_.transform,_e=s.paint.get("fill-translate"),me=s.paint.get("fill-translate-anchor");x?(Q=j&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",V=E.LINES):(Q=j?"fillPattern":"fill",V=E.TRIANGLES);const xe=B.constantOr(null);for(const Te of f){const ge=n.getTile(Te);if(j&&!ge.patternsLoaded())continue;const ze=ge.getBucket(s);if(!ze)continue;const $e=ze.programConfigurations.get(s.id),Ne=_.useProgram(Q,$e),je=_.style.map.terrain&&_.style.map.terrain.getTerrainData(Te);j&&(_.context.activeTexture.set(E.TEXTURE0),ge.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),$e.updatePaintBuffers(N)),_f($e,z,xe,ge,s);const We=de.getProjectionData({overscaledTileID:Te,applyGlobeMatrix:!M,applyTerrainMatrix:!0}),zt=a.aC(de,ge,_e,me);if(x){oe=ze.indexBuffer2,le=ze.segments2;const ft=[E.drawingBufferWidth,E.drawingBufferHeight];se=Q==="fillOutlinePattern"&&j?My(_,N,ge,ft,zt):Oa(ft,zt)}else oe=ze.indexBuffer,le=ze.segments,se=j?lu(_,N,ge,zt):{u_fill_translate:zt};const Ct=_.stencilModeForClipping(Te);Ne.draw(_.context,V,m,Ct,y,xn.backCCW,se,je,We,s.id,ze.layoutVertexBuffer,oe,le,s.paint,_.transform.zoom,$e)}}function Xs(_,n,s,f,m,y,x,M){const E=_.context,z=E.gl,B="fill-extrusion-pattern",j=s.paint.get(B),N=j.constantOr(1),V=s.getCrossfadeParameters(),Q=s.paint.get("fill-extrusion-opacity"),se=j.constantOr(null),oe=_.transform;for(const le of f){const de=n.getTile(le),_e=de.getBucket(s);if(!_e)continue;const me=_.style.map.terrain&&_.style.map.terrain.getTerrainData(le),xe=_e.programConfigurations.get(s.id),Te=_.useProgram(N?"fillExtrusionPattern":"fillExtrusion",xe);N&&(_.context.activeTexture.set(z.TEXTURE0),de.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),xe.updatePaintBuffers(V));const ge=oe.getProjectionData({overscaledTileID:le,applyGlobeMatrix:!M,applyTerrainMatrix:!0});_f(xe,B,se,de,s);const ze=a.aC(oe,de,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),$e=s.paint.get("fill-extrusion-vertical-gradient"),Ne=N?ef(_,$e,Q,ze,le,V,de):Ul(_,$e,Q,ze);Te.draw(E,E.gl.TRIANGLES,m,y,x,xn.backCCW,Ne,me,ge,s.id,_e.layoutVertexBuffer,_e.indexBuffer,_e.segments,s.paint,_.transform.zoom,xe,_.style.map.terrain&&_e.centroidVertexBuffer)}}function Qs(_,n,s,f,m,y,x,M,E){var z;const B=_.style.projection,j=_.context,N=_.transform,V=j.gl,Q=[`#define NUM_ILLUMINATION_SOURCES ${s.paint.get("hillshade-highlight-color").values.length}`],se=_.useProgram("hillshade",null,!1,Q),oe=!_.options.moving;for(const le of f){const de=n.getTile(le),_e=de.fbo;if(!_e)continue;const me=B.getMeshFromTileID(j,le.canonical,M,!0,"raster"),xe=(z=_.style.map.terrain)===null||z===void 0?void 0:z.getTerrainData(le);j.activeTexture.set(V.TEXTURE0),V.bindTexture(V.TEXTURE_2D,_e.colorAttachment.get());const Te=N.getProjectionData({overscaledTileID:le,aligned:oe,applyGlobeMatrix:!E,applyTerrainMatrix:!0});se.draw(j,V.TRIANGLES,y,m[le.overscaledZ],x,xn.backCCW,qs(_,de,s),xe,Te,s.id,me.vertexBuffer,me.indexBuffer,me.segments)}}function Xl(_,n,s,f,m,y,x,M,E){var z;const B=_.style.projection,j=_.context,N=_.transform,V=j.gl,Q=_.useProgram("colorRelief"),se=!_.options.moving;let oe=!0,le=0;for(const de of f){const _e=n.getTile(de),me=_e.dem;if(oe){const Ne=V.getParameter(V.MAX_TEXTURE_SIZE),{elevationTexture:je,colorTexture:We}=s.getColorRampTextures(j,Ne,me.getUnpackVector());j.activeTexture.set(V.TEXTURE1),je.bind(V.NEAREST,V.CLAMP_TO_EDGE),j.activeTexture.set(V.TEXTURE4),We.bind(V.LINEAR,V.CLAMP_TO_EDGE),oe=!1,le=je.size[0]}if(!me||!me.data)continue;const xe=me.stride,Te=me.getPixels();if(j.activeTexture.set(V.TEXTURE0),j.pixelStoreUnpackPremultiplyAlpha.set(!1),_e.demTexture=_e.demTexture||_.getTileTexture(xe),_e.demTexture){const Ne=_e.demTexture;Ne.update(Te,{premultiply:!1}),Ne.bind(V.LINEAR,V.CLAMP_TO_EDGE)}else _e.demTexture=new a.T(j,Te,V.RGBA,{premultiply:!1}),_e.demTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE);const ge=B.getMeshFromTileID(j,de.canonical,M,!0,"raster"),ze=(z=_.style.map.terrain)===null||z===void 0?void 0:z.getTerrainData(de),$e=N.getProjectionData({overscaledTileID:de,aligned:se,applyGlobeMatrix:!E,applyTerrainMatrix:!0});Q.draw(j,V.TRIANGLES,y,m[de.overscaledZ],x,xn.backCCW,Iy(s,_e.dem,le),ze,$e,s.id,ge.vertexBuffer,ge.indexBuffer,ge.segments)}}const yf=[new a.P(0,0),new a.P(a.$,0),new a.P(a.$,a.$),new a.P(0,a.$)];function Mo(_,n,s,f,m,y,x,M,E=!1,z=!1){const B=f[f.length-1].overscaledZ,j=_.context,N=j.gl,V=_.useProgram("raster"),Q=_.transform,se=_.style.projection,oe=_.colorModeForRenderPass(),le=!_.options.moving;for(const de of f){const _e=_.getDepthModeForSublayer(de.overscaledZ-B,s.paint.get("raster-opacity")===1?Sn.ReadWrite:Sn.ReadOnly,N.LESS),me=n.getTile(de);me.registerFadeDuration(s.paint.get("raster-fade-duration"));const xe=n.findLoadedParent(de,0),Te=n.findLoadedSibling(de),ge=Oy(me,xe||Te||null,n,s,_.transform,_.style.map.terrain);let ze,$e;const Ne=s.paint.get("raster-resampling")==="nearest"?N.NEAREST:N.LINEAR;j.activeTexture.set(N.TEXTURE0),me.texture.bind(Ne,N.CLAMP_TO_EDGE,N.LINEAR_MIPMAP_NEAREST),j.activeTexture.set(N.TEXTURE1),xe?(xe.texture.bind(Ne,N.CLAMP_TO_EDGE,N.LINEAR_MIPMAP_NEAREST),ze=Math.pow(2,xe.tileID.overscaledZ-me.tileID.overscaledZ),$e=[me.tileID.canonical.x*ze%1,me.tileID.canonical.y*ze%1]):me.texture.bind(Ne,N.CLAMP_TO_EDGE,N.LINEAR_MIPMAP_NEAREST),me.texture.useMipmap&&j.extTextureFilterAnisotropic&&_.transform.pitch>20&&N.texParameterf(N.TEXTURE_2D,j.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,j.extTextureFilterAnisotropicMax);const je=_.style.map.terrain&&_.style.map.terrain.getTerrainData(de),We=Q.getProjectionData({overscaledTileID:de,aligned:le,applyGlobeMatrix:!z,applyTerrainMatrix:!0}),zt=rs($e||[0,0],ze||1,ge,s,M),Ct=se.getMeshFromTileID(j,de.canonical,y,x,"raster");V.draw(j,N.TRIANGLES,_e,m?m[de.overscaledZ]:dn.disabled,oe,E?xn.frontCCW:xn.backCCW,zt,je,We,s.id,Ct.vertexBuffer,Ct.indexBuffer,Ct.segments)}}function Oy(_,n,s,f,m,y){const x=f.paint.get("raster-fade-duration");if(!y&&x>0){const M=I.now(),E=(M-_.timeAdded)/x,z=n?(M-n.timeAdded)/x:-1,B=s.getSource(),j=He(m,{tileSize:B.tileSize,roundZoom:B.roundZoom}),N=!n||Math.abs(n.tileID.overscaledZ-j)>Math.abs(_.tileID.overscaledZ-j),V=N&&_.refreshedUponExpiration?1:a.ag(N?E:1-z,0,1);return _.refreshedUponExpiration&&E>=1&&(_.refreshedUponExpiration=!1),n?{opacity:1,mix:1-V}:{opacity:V,mix:0}}return{opacity:1,mix:0}}const tm=new a.be(1,0,0,1),xu=new a.be(0,1,0,1),vf=new a.be(0,0,1,1),nm=new a.be(1,0,1,1),im=new a.be(0,1,1,1);function Ql(_,n,s,f){Au(_,0,n+s/2,_.transform.width,s,f)}function wu(_,n,s,f){Au(_,n-s/2,0,s,_.transform.height,f)}function Au(_,n,s,f,m,y){const x=_.context,M=x.gl;M.enable(M.SCISSOR_TEST),M.scissor(n*_.pixelRatio,s*_.pixelRatio,f*_.pixelRatio,m*_.pixelRatio),x.clear({color:y}),M.disable(M.SCISSOR_TEST)}function rm(_,n,s){const f=_.context,m=f.gl,y=_.useProgram("debug"),x=Sn.disabled,M=dn.disabled,E=_.colorModeForRenderPass(),z="$debug",B=_.style.map.terrain&&_.style.map.terrain.getTerrainData(s);f.activeTexture.set(m.TEXTURE0);const j=n.getTileByID(s.key).latestRawTileData,N=Math.floor((j&&j.byteLength||0)/1024),V=n.getTile(s).tileSize,Q=512/Math.min(V,512)*(s.overscaledZ/_.transform.zoom)*.5;let se=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(se+=` => ${s.overscaledZ}`),function(le,de){le.initDebugOverlayCanvas();const _e=le.debugOverlayCanvas,me=le.context.gl,xe=le.debugOverlayCanvas.getContext("2d");xe.clearRect(0,0,_e.width,_e.height),xe.shadowColor="white",xe.shadowBlur=2,xe.lineWidth=1.5,xe.strokeStyle="white",xe.textBaseline="top",xe.font="bold 36px Open Sans, sans-serif",xe.fillText(de,5,5),xe.strokeText(de,5,5),le.debugOverlayTexture.update(_e),le.debugOverlayTexture.bind(me.LINEAR,me.CLAMP_TO_EDGE)}(_,`${se} ${N}kB`);const oe=_.transform.getProjectionData({overscaledTileID:s,applyGlobeMatrix:!0,applyTerrainMatrix:!0});y.draw(f,m.TRIANGLES,x,M,Hn.alphaBlended,xn.disabled,Lp(a.be.transparent,Q),null,oe,z,_.debugBuffer,_.quadTriangleIndexBuffer,_.debugSegments),y.draw(f,m.LINE_STRIP,x,M,E,xn.disabled,Lp(a.be.red),B,oe,z,_.debugBuffer,_.tileBorderIndexBuffer,_.debugSegments)}function Oi(_,n,s,f){const{isRenderingGlobe:m}=f,y=_.context,x=y.gl,M=_.transform,E=_.colorModeForRenderPass(),z=_.getDepthModeFor3D(),B=_.useProgram("terrain");y.bindFramebuffer.set(null),y.viewport.set([0,0,_.width,_.height]);for(const j of s){const N=n.getTerrainMesh(j.tileID),V=_.renderToTexture.getTexture(j),Q=n.getTerrainData(j.tileID);y.activeTexture.set(x.TEXTURE0),x.bindTexture(x.TEXTURE_2D,V.texture);const se=n.getMeshFrameDelta(M.zoom),oe=M.calculateFogMatrix(j.tileID.toUnwrapped()),le=Ty(se,oe,_.style.sky,M.pitch,m),de=M.getProjectionData({overscaledTileID:j.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});B.draw(y,x.TRIANGLES,z,dn.disabled,E,xn.backCCW,le,Q,de,"terrain",N.vertexBuffer,N.indexBuffer,N.segments)}}function Co(_,n){if(!n.mesh){const s=new a.aK;s.emplaceBack(-1,-1),s.emplaceBack(1,-1),s.emplaceBack(1,1),s.emplaceBack(-1,1);const f=new a.aM;f.emplaceBack(0,1,2),f.emplaceBack(0,2,3),n.mesh=new to(_.createVertexBuffer(s,no.members),_.createIndexBuffer(f),a.aL.simpleSegment(0,0,s.length,f.length))}return n.mesh}class ma{constructor(n,s){this.context=new Rn(n),this.transform=s,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:a.af(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Je.maxUnderzooming+Je.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Bs}resize(n,s,f){if(this.width=Math.floor(n*f),this.height=Math.floor(s*f),this.pixelRatio=f,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style._order)this.style._layers[m].resize()}setup(){const n=this.context,s=new a.aK;s.emplaceBack(0,0),s.emplaceBack(a.$,0),s.emplaceBack(0,a.$),s.emplaceBack(a.$,a.$),this.tileExtentBuffer=n.createVertexBuffer(s,no.members),this.tileExtentSegments=a.aL.simpleSegment(0,0,4,2);const f=new a.aK;f.emplaceBack(0,0),f.emplaceBack(a.$,0),f.emplaceBack(0,a.$),f.emplaceBack(a.$,a.$),this.debugBuffer=n.createVertexBuffer(f,no.members),this.debugSegments=a.aL.simpleSegment(0,0,4,5);const m=new a.c5;m.emplaceBack(0,0,0,0),m.emplaceBack(a.$,0,a.$,0),m.emplaceBack(0,a.$,0,a.$),m.emplaceBack(a.$,a.$,a.$,a.$),this.rasterBoundsBuffer=n.createVertexBuffer(m,wy.members),this.rasterBoundsSegments=a.aL.simpleSegment(0,0,4,2);const y=new a.aK;y.emplaceBack(0,0),y.emplaceBack(a.$,0),y.emplaceBack(0,a.$),y.emplaceBack(a.$,a.$),this.rasterBoundsBufferPosOnly=n.createVertexBuffer(y,no.members),this.rasterBoundsSegmentsPosOnly=a.aL.simpleSegment(0,0,4,5);const x=new a.aK;x.emplaceBack(0,0),x.emplaceBack(1,0),x.emplaceBack(0,1),x.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(x,no.members),this.viewportSegments=a.aL.simpleSegment(0,0,4,2);const M=new a.c6;M.emplaceBack(0),M.emplaceBack(1),M.emplaceBack(3),M.emplaceBack(2),M.emplaceBack(0),this.tileBorderIndexBuffer=n.createIndexBuffer(M);const E=new a.aM;E.emplaceBack(1,0,2),E.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(E);const z=this.context.gl;this.stencilClearMode=new dn({func:z.ALWAYS,mask:0},0,255,z.ZERO,z.ZERO,z.ZERO),this.tileExtentMesh=new to(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const n=this.context,s=n.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const f=a.L();a.bX(f,0,this.width,this.height,0,0,1),a.N(f,f,[s.drawingBufferWidth,s.drawingBufferHeight,0]);const m={mainMatrix:f,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:f};this.useProgram("clippingMask",null,!0).draw(n,s.TRIANGLES,Sn.disabled,this.stencilClearMode,Hn.disabled,xn.disabled,null,null,m,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(n,s,f){if(this.currentStencilSource===n.source||!n.isTileClipped()||!s||!s.length)return;this.currentStencilSource=n.source,this.nextStencilID+s.length>256&&this.clearStencil();const m=this.context;m.setColorMode(Hn.disabled),m.setDepthMode(Sn.disabled);const y={};for(const x of s)y[x.key]=this.nextStencilID++;this._renderTileMasks(y,s,f,!0),this._renderTileMasks(y,s,f,!1),this._tileClippingMaskIDs=y}_renderTileMasks(n,s,f,m){const y=this.context,x=y.gl,M=this.style.projection,E=this.transform,z=this.useProgram("clippingMask");for(const B of s){const j=n[B.key],N=this.style.map.terrain&&this.style.map.terrain.getTerrainData(B),V=M.getMeshFromTileID(this.context,B.canonical,m,!0,"stencil"),Q=E.getProjectionData({overscaledTileID:B,applyGlobeMatrix:!f,applyTerrainMatrix:!0});z.draw(y,x.TRIANGLES,Sn.disabled,new dn({func:x.ALWAYS,mask:0},j,255,x.KEEP,x.KEEP,x.REPLACE),Hn.disabled,f?xn.disabled:xn.backCCW,null,N,Q,"$clipping",V.vertexBuffer,V.indexBuffer,V.segments)}}_renderTilesDepthBuffer(){const n=this.context,s=n.gl,f=this.style.projection,m=this.transform,y=this.useProgram("depth"),x=this.getDepthModeFor3D(),M=Ge(m,{tileSize:m.tileSize});for(const E of M){const z=this.style.map.terrain&&this.style.map.terrain.getTerrainData(E),B=f.getMeshFromTileID(this.context,E.canonical,!0,!0,"raster"),j=m.getProjectionData({overscaledTileID:E,applyGlobeMatrix:!0,applyTerrainMatrix:!0});y.draw(n,s.TRIANGLES,x,dn.disabled,Hn.disabled,xn.backCCW,null,z,j,"$clipping",B.vertexBuffer,B.indexBuffer,B.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,s=this.context.gl;return new dn({func:s.NOTEQUAL,mask:255},n,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(n){const s=this.context.gl;return new dn({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,s.KEEP,s.KEEP,s.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(n){const s=this.context.gl,f=n.sort((x,M)=>M.overscaledZ-x.overscaledZ),m=f[f.length-1].overscaledZ,y=f[0].overscaledZ-m+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();const x={};for(let M=0;M<y;M++)x[M+m]=new dn({func:s.GEQUAL,mask:255},M+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=y,[x,f]}return[{[m]:dn.disabled},f]}stencilConfigForOverlapTwoPass(n){const s=this.context.gl,f=n.sort((x,M)=>M.overscaledZ-x.overscaledZ),m=f[f.length-1].overscaledZ,y=f[0].overscaledZ-m+1;if(this.clearStencil(),y>1){const x={},M={};for(let E=0;E<y;E++)x[E+m]=new dn({func:s.GREATER,mask:255},y+1+E,255,s.KEEP,s.KEEP,s.REPLACE),M[E+m]=new dn({func:s.GREATER,mask:255},1+E,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID=2*y+1,[x,M,f]}return this.nextStencilID=3,[{[m]:new dn({func:s.GREATER,mask:255},2,255,s.KEEP,s.KEEP,s.REPLACE)},{[m]:new dn({func:s.GREATER,mask:255},1,255,s.KEEP,s.KEEP,s.REPLACE)},f]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new Hn([n.CONSTANT_COLOR,n.ONE],new a.be(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Hn.unblended:Hn.alphaBlended}getDepthModeForSublayer(n,s,f){if(!this.opaquePassEnabledForLayer())return Sn.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new Sn(f||this.context.gl.LEQUAL,s,[m,m])}getDepthModeFor3D(){return new Sn(this.context.gl.LEQUAL,Sn.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(n,s){var f,m;this.style=n,this.options=s,this.lineAtlas=n.lineAtlas,this.imageManager=n.imageManager,this.glyphManager=n.glyphManager,this.symbolFadeChange=n.placement.symbolFadeChange(I.now()),this.imageManager.beginFrame();const y=this.style._order,x=this.style.sourceCaches,M={},E={},z={},B={isRenderingToTexture:!1,isRenderingGlobe:((f=n.projection)===null||f===void 0?void 0:f.transitionState)>0};for(const N in x){const V=x[N];V.used&&V.prepare(this.context),M[N]=V.getVisibleCoordinates(!1),E[N]=M[N].slice().reverse(),z[N]=V.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let N=0;N<y.length;N++)if(this.style._layers[y[N]].is3D()){this.opaquePassCutoff=N;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const N of y){const V=this.style._layers[N];if(!V.hasOffscreenPass()||V.isHidden(this.transform.zoom))continue;const Q=E[V.source];(V.type==="custom"||Q.length)&&this.renderLayer(this,x[V.source],V,Q,B)}if((m=this.style.projection)===null||m===void 0||m.updateGPUdependent({context:this.context,useProgram:N=>this.useProgram(N)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:s.showOverdrawInspector?a.be.black:a.be.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(N,V){const Q=N.context,se=Q.gl,oe=((Te,ge,ze)=>{const $e=Math.cos(ge.rollInRadians),Ne=Math.sin(ge.rollInRadians),je=K(ge),We=ge.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:Te.properties.get("sky-color"),u_horizon_color:Te.properties.get("horizon-color"),u_horizon:[(ge.width/2-je*Ne)*ze,(ge.height/2+je*$e)*ze],u_horizon_normal:[-Ne,$e],u_sky_horizon_blend:Te.properties.get("sky-horizon-blend")*ge.height/2*ze,u_sky_blend:We}})(V,N.style.map.transform,N.pixelRatio),le=new Sn(se.LEQUAL,Sn.ReadWrite,[0,1]),de=dn.disabled,_e=N.colorModeForRenderPass(),me=N.useProgram("sky"),xe=Co(Q,V);me.draw(Q,se.TRIANGLES,le,de,_e,xn.disabled,oe,null,void 0,"sky",xe.vertexBuffer,xe.indexBuffer,xe.segments)}(this,this.style.sky),this._showOverdrawInspector=s.showOverdrawInspector,this.depthRangeFor3D=[0,1-(n._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=y.length-1;this.currentLayer>=0;this.currentLayer--){const N=this.style._layers[y[this.currentLayer]],V=x[N.source],Q=M[N.source];this._renderTileClippingMasks(N,Q,!1),this.renderLayer(this,V,N,Q,B)}this.renderPass="translucent";let j=!1;for(this.currentLayer=0;this.currentLayer<y.length;this.currentLayer++){const N=this.style._layers[y[this.currentLayer]],V=x[N.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(N,B))continue;this.opaquePassEnabledForLayer()||j||(j=!0,B.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const Q=(N.type==="symbol"?z:E)[N.source];this._renderTileClippingMasks(N,M[N.source],!!this.renderToTexture),this.renderLayer(this,V,N,Q,B)}if(B.isRenderingGlobe&&function(N,V,Q){const se=N.context,oe=se.gl,le=N.useProgram("atmosphere"),de=new Sn(oe.LEQUAL,Sn.ReadOnly,[0,1]),_e=N.transform,me=function(We,zt){const Ct=We.properties.get("position"),ft=[-Ct.x,-Ct.y,-Ct.z],Wt=a.af(new Float64Array(16));return We.properties.get("anchor")==="map"&&(a.b5(Wt,Wt,zt.rollInRadians),a.b6(Wt,Wt,-zt.pitchInRadians),a.b5(Wt,Wt,zt.bearingInRadians),a.b6(Wt,Wt,zt.center.lat*Math.PI/180),a.by(Wt,Wt,-zt.center.lng*Math.PI/180)),a.c4(ft,ft,Wt),ft}(Q,N.transform),xe=_e.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Te=V.properties.get("atmosphere-blend")*xe.projectionTransition;if(Te===0)return;const ge=Os(_e.worldSize,_e.center.lat),ze=_e.inverseProjectionMatrix,$e=new Float64Array(4);$e[3]=1,a.av($e,$e,_e.modelViewProjectionMatrix),$e[0]/=$e[3],$e[1]/=$e[3],$e[2]/=$e[3],$e[3]=1,a.av($e,$e,ze),$e[0]/=$e[3],$e[1]/=$e[3],$e[2]/=$e[3],$e[3]=1;const Ne=((We,zt,Ct,ft,Wt)=>({u_sun_pos:We,u_atmosphere_blend:zt,u_globe_position:Ct,u_globe_radius:ft,u_inv_proj_matrix:Wt}))(me,Te,[$e[0],$e[1],$e[2]],ge,ze),je=Co(se,V);le.draw(se,oe.TRIANGLES,de,dn.disabled,Hn.alphaBlended,xn.disabled,Ne,null,null,"atmosphere",je.vertexBuffer,je.indexBuffer,je.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const N=function(V,Q){let se=null;const oe=Object.values(V._layers).flatMap(me=>me.source&&!me.isHidden(Q)?[V.sourceCaches[me.source]]:[]),le=oe.filter(me=>me.getSource().type==="vector"),de=oe.filter(me=>me.getSource().type!=="vector"),_e=me=>{(!se||se.getSource().maxzoom<me.getSource().maxzoom)&&(se=me)};return le.forEach(me=>_e(me)),se||de.forEach(me=>_e(me)),se}(this.style,this.transform.zoom);N&&function(V,Q,se){for(let oe=0;oe<se.length;oe++)rm(V,Q,se[oe])}(this,N,N.getVisibleCoordinates())}this.options.showPadding&&function(N){const V=N.transform.padding;Ql(N,N.transform.height-(V.top||0),3,tm),Ql(N,V.bottom||0,3,xu),wu(N,V.left||0,3,vf),wu(N,N.transform.width-(V.right||0),3,nm);const Q=N.transform.centerPoint;(function(se,oe,le,de){Au(se,oe-1,le-10,2,20,de),Au(se,oe-10,le-1,20,2,de)})(N,Q.x,N.transform.height-Q.y,im)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(n){if(!this.style||!this.style.map||!this.style.map.terrain)return;const s=this.terrainFacilitator.matrix,f=this.transform.modelViewProjectionMatrix;let m=this.terrainFacilitator.dirty;m||(m=n?!a.c7(s,f):!a.c8(s,f)),m||(m=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),m&&(a.c9(s,f),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(y,x){const M=y.context,E=M.gl,z=y.transform,B=Hn.unblended,j=new Sn(E.LEQUAL,Sn.ReadWrite,[0,1]),N=x.sourceCache.getRenderableTiles(),V=y.useProgram("terrainDepth");M.bindFramebuffer.set(x.getFramebuffer("depth").framebuffer),M.viewport.set([0,0,y.width/devicePixelRatio,y.height/devicePixelRatio]),M.clear({color:a.be.transparent,depth:1});for(const Q of N){const se=x.getTerrainMesh(Q.tileID),oe=x.getTerrainData(Q.tileID),le=z.getProjectionData({overscaledTileID:Q.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),de={u_ele_delta:x.getMeshFrameDelta(z.zoom)};V.draw(M,E.TRIANGLES,j,dn.disabled,B,xn.backCCW,de,oe,le,"terrain",se.vertexBuffer,se.indexBuffer,se.segments)}M.bindFramebuffer.set(null),M.viewport.set([0,0,y.width,y.height])}(this,this.style.map.terrain),function(y,x){const M=y.context,E=M.gl,z=y.transform,B=Hn.unblended,j=new Sn(E.LEQUAL,Sn.ReadWrite,[0,1]),N=x.getCoordsTexture(),V=x.sourceCache.getRenderableTiles(),Q=y.useProgram("terrainCoords");M.bindFramebuffer.set(x.getFramebuffer("coords").framebuffer),M.viewport.set([0,0,y.width/devicePixelRatio,y.height/devicePixelRatio]),M.clear({color:a.be.transparent,depth:1}),x.coordsIndex=[];for(const se of V){const oe=x.getTerrainMesh(se.tileID),le=x.getTerrainData(se.tileID);M.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,N.texture);const de={u_terrain_coords_id:(255-x.coordsIndex.length)/255,u_texture:0,u_ele_delta:x.getMeshFrameDelta(z.zoom)},_e=z.getProjectionData({overscaledTileID:se.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});Q.draw(M,E.TRIANGLES,j,dn.disabled,B,xn.backCCW,de,le,_e,"terrain",oe.vertexBuffer,oe.indexBuffer,oe.segments),x.coordsIndex.push(se.tileID.key)}M.bindFramebuffer.set(null),M.viewport.set([0,0,y.width,y.height])}(this,this.style.map.terrain))}renderLayer(n,s,f,m,y){f.isHidden(this.transform.zoom)||(f.type==="background"||f.type==="custom"||(m||[]).length)&&(this.id=f.id,a.ca(f)?function(x,M,E,z,B,j){if(x.renderPass!=="translucent")return;const{isRenderingToTexture:N}=j,V=dn.disabled,Q=x.colorModeForRenderPass();(E._unevaluatedLayout.hasValue("text-variable-anchor")||E._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(se,oe,le,de,_e,me,xe,Te,ge){const ze=oe.transform,$e=oe.style.map.terrain,Ne=_e==="map",je=me==="map";for(const We of se){const zt=de.getTile(We),Ct=zt.getBucket(le);if(!Ct||!Ct.text||!Ct.text.segments.get().length)continue;const ft=a.am(Ct.textSizeData,ze.zoom),Wt=a.aB(zt,1,oe.transform.zoom),Mn=en(Ne,oe.transform,Wt),ii=le.layout.get("icon-text-fit")!=="none"&&Ct.hasIconData();if(ft){const Li=Math.pow(2,ze.zoom-zt.tileID.overscaledZ),hi=$e?(Bi,vi)=>$e.getElevation(We,Bi,vi):null;Fy(Ct,Ne,je,ge,ze,Mn,Li,ft,ii,a.aC(ze,zt,xe,Te),We.toUnwrapped(),hi)}}}(z,x,E,M,E.layout.get("text-rotation-alignment"),E.layout.get("text-pitch-alignment"),E.paint.get("text-translate"),E.paint.get("text-translate-anchor"),B),E.paint.get("icon-opacity").constantOr(1)!==0&&em(x,M,E,z,!1,E.paint.get("icon-translate"),E.paint.get("icon-translate-anchor"),E.layout.get("icon-rotation-alignment"),E.layout.get("icon-pitch-alignment"),E.layout.get("icon-keep-upright"),V,Q,N),E.paint.get("text-opacity").constantOr(1)!==0&&em(x,M,E,z,!0,E.paint.get("text-translate"),E.paint.get("text-translate-anchor"),E.layout.get("text-rotation-alignment"),E.layout.get("text-pitch-alignment"),E.layout.get("text-keep-upright"),V,Q,N),M.map.showCollisionBoxes&&(Qp(x,M,E,z,!0),Qp(x,M,E,z,!1))}(n,s,f,m,this.style.placement.variableOffsets,y):a.cb(f)?function(x,M,E,z,B){if(x.renderPass!=="translucent")return;const{isRenderingToTexture:j}=B,N=E.paint.get("circle-opacity"),V=E.paint.get("circle-stroke-width"),Q=E.paint.get("circle-stroke-opacity"),se=!E.layout.get("circle-sort-key").isConstant();if(N.constantOr(1)===0&&(V.constantOr(1)===0||Q.constantOr(1)===0))return;const oe=x.context,le=oe.gl,de=x.transform,_e=x.getDepthModeForSublayer(0,Sn.ReadOnly),me=dn.disabled,xe=x.colorModeForRenderPass(),Te=[],ge=de.getCircleRadiusCorrection();for(let ze=0;ze<z.length;ze++){const $e=z[ze],Ne=M.getTile($e),je=Ne.getBucket(E);if(!je)continue;const We=E.paint.get("circle-translate"),zt=E.paint.get("circle-translate-anchor"),Ct=a.aC(de,Ne,We,zt),ft=je.programConfigurations.get(E.id),Wt=x.useProgram("circle",ft),Mn=je.layoutVertexBuffer,ii=je.indexBuffer,Li=x.style.map.terrain&&x.style.map.terrain.getTerrainData($e),hi={programConfiguration:ft,program:Wt,layoutVertexBuffer:Mn,indexBuffer:ii,uniformValues:tf(x,Ne,E,Ct,ge),terrainData:Li,projectionData:de.getProjectionData({overscaledTileID:$e,applyGlobeMatrix:!j,applyTerrainMatrix:!0})};if(se){const Bi=je.segments.get();for(const vi of Bi)Te.push({segments:new a.aL([vi]),sortKey:vi.sortKey,state:hi})}else Te.push({segments:je.segments,sortKey:0,state:hi})}se&&Te.sort((ze,$e)=>ze.sortKey-$e.sortKey);for(const ze of Te){const{programConfiguration:$e,program:Ne,layoutVertexBuffer:je,indexBuffer:We,uniformValues:zt,terrainData:Ct,projectionData:ft}=ze.state;Ne.draw(oe,le.TRIANGLES,_e,me,xe,xn.backCCW,zt,Ct,ft,E.id,je,We,ze.segments,E.paint,x.transform.zoom,$e)}}(n,s,f,m,y):a.cc(f)?function(x,M,E,z,B){if(E.paint.get("heatmap-opacity")===0)return;const j=x.context,{isRenderingToTexture:N,isRenderingGlobe:V}=B;if(x.style.map.terrain){for(const Q of z){const se=M.getTile(Q);M.hasRenderableParent(Q)||(x.renderPass==="offscreen"?yu(x,se,E,Q,V):x.renderPass==="translucent"&&vu(x,E,Q,N,V))}j.viewport.set([0,0,x.width,x.height])}else x.renderPass==="offscreen"?function(Q,se,oe,le){const de=Q.context,_e=de.gl,me=Q.transform,xe=dn.disabled,Te=new Hn([_e.ONE,_e.ONE],a.be.transparent,[!0,!0,!0,!0]);(function(ge,ze,$e){const Ne=ge.gl;ge.activeTexture.set(Ne.TEXTURE1),ge.viewport.set([0,0,ze.width/4,ze.height/4]);let je=$e.heatmapFbos.get(a.c1);je?(Ne.bindTexture(Ne.TEXTURE_2D,je.colorAttachment.get()),ge.bindFramebuffer.set(je.framebuffer)):(je=Wl(ge,ze.width/4,ze.height/4),$e.heatmapFbos.set(a.c1,je))})(de,Q,oe),de.clear({color:a.be.transparent});for(let ge=0;ge<le.length;ge++){const ze=le[ge];if(se.hasRenderableParent(ze))continue;const $e=se.getTile(ze),Ne=$e.getBucket(oe);if(!Ne)continue;const je=Ne.programConfigurations.get(oe.id),We=Q.useProgram("heatmap",je),zt=me.getProjectionData({overscaledTileID:ze,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),Ct=me.getCircleRadiusCorrection();We.draw(de,_e.TRIANGLES,Sn.disabled,xe,Te,xn.backCCW,ql($e,me.zoom,oe.paint.get("heatmap-intensity"),Ct),null,zt,oe.id,Ne.layoutVertexBuffer,Ne.indexBuffer,Ne.segments,oe.paint,me.zoom,je)}de.viewport.set([0,0,Q.width,Q.height])}(x,M,E,z):x.renderPass==="translucent"&&function(Q,se){const oe=Q.context,le=oe.gl;oe.setColorMode(Q.colorModeForRenderPass());const de=se.heatmapFbos.get(a.c1);de&&(oe.activeTexture.set(le.TEXTURE0),le.bindTexture(le.TEXTURE_2D,de.colorAttachment.get()),oe.activeTexture.set(le.TEXTURE1),bu(oe,se).bind(le.LINEAR,le.CLAMP_TO_EDGE),Q.useProgram("heatmapTexture").draw(oe,le.TRIANGLES,Sn.disabled,dn.disabled,Q.colorModeForRenderPass(),xn.disabled,Bp(Q,se,0,1),null,null,se.id,Q.viewportBuffer,Q.quadTriangleIndexBuffer,Q.viewportSegments,se.paint,Q.transform.zoom))}(x,E)}(n,s,f,m,y):a.cd(f)?function(x,M,E,z,B){if(x.renderPass!=="translucent")return;const{isRenderingToTexture:j}=B,N=E.paint.get("line-opacity"),V=E.paint.get("line-width");if(N.constantOr(1)===0||V.constantOr(1)===0)return;const Q=x.getDepthModeForSublayer(0,Sn.ReadOnly),se=x.colorModeForRenderPass(),oe=E.paint.get("line-dasharray"),le=E.paint.get("line-pattern"),de=le.constantOr(1),_e=E.paint.get("line-gradient"),me=E.getCrossfadeParameters(),xe=de?"linePattern":oe?"lineSDF":_e?"lineGradient":"line",Te=x.context,ge=Te.gl,ze=x.transform;let $e=!0;for(const Ne of z){const je=M.getTile(Ne);if(de&&!je.patternsLoaded())continue;const We=je.getBucket(E);if(!We)continue;const zt=We.programConfigurations.get(E.id),Ct=x.context.program.get(),ft=x.useProgram(xe,zt),Wt=$e||ft.program!==Ct,Mn=x.style.map.terrain&&x.style.map.terrain.getTerrainData(Ne),ii=le.constantOr(null);if(ii&&je.imageAtlas){const fi=je.imageAtlas,bi=fi.patternPositions[ii.to.toString()],gr=fi.patternPositions[ii.from.toString()];bi&&gr&&zt.setConstantPatternPositions(bi,gr)}const Li=ze.getProjectionData({overscaledTileID:Ne,applyGlobeMatrix:!j,applyTerrainMatrix:!0}),hi=ze.getPixelScale(),Bi=de?Op(x,je,E,hi,me):oe?Np(x,je,E,hi,oe,me):_e?nf(x,je,E,hi,We.lineClipsArray.length):cu(x,je,E,hi);if(de)Te.activeTexture.set(ge.TEXTURE0),je.imageAtlasTexture.bind(ge.LINEAR,ge.CLAMP_TO_EDGE),zt.updatePaintBuffers(me);else if(oe&&(Wt||x.lineAtlas.dirty))Te.activeTexture.set(ge.TEXTURE0),x.lineAtlas.bind(Te);else if(_e){const fi=We.gradients[E.id];let bi=fi.texture;if(E.gradientVersion!==fi.version){let gr=256;if(E.stepInterpolant){const Wn=M.getSource().maxzoom,or=Ne.canonical.z===Wn?Math.ceil(1<<x.transform.maxZoom-Ne.canonical.z):1;gr=a.ag(a.c2(We.maxLineLength/a.$*1024*or),256,Te.maxTextureSize)}fi.gradient=a.c3({expression:E.gradientExpression(),evaluationKey:"lineProgress",resolution:gr,image:fi.gradient||void 0,clips:We.lineClipsArray}),fi.texture?fi.texture.update(fi.gradient):fi.texture=new a.T(Te,fi.gradient,ge.RGBA),fi.version=E.gradientVersion,bi=fi.texture}Te.activeTexture.set(ge.TEXTURE0),bi.bind(E.stepInterpolant?ge.NEAREST:ge.LINEAR,ge.CLAMP_TO_EDGE)}const vi=x.stencilModeForClipping(Ne);ft.draw(Te,ge.TRIANGLES,Q,vi,se,xn.disabled,Bi,Mn,Li,E.id,We.layoutVertexBuffer,We.indexBuffer,We.segments,E.paint,x.transform.zoom,zt,We.layoutVertexBuffer2),$e=!1}}(n,s,f,m,y):a.ce(f)?function(x,M,E,z,B){const j=E.paint.get("fill-color"),N=E.paint.get("fill-opacity");if(N.constantOr(1)===0)return;const{isRenderingToTexture:V}=B,Q=x.colorModeForRenderPass(),se=E.paint.get("fill-pattern"),oe=x.opaquePassEnabledForLayer()&&!se.constantOr(1)&&j.constantOr(a.be.transparent).a===1&&N.constantOr(0)===1?"opaque":"translucent";if(x.renderPass===oe){const le=x.getDepthModeForSublayer(1,x.renderPass==="opaque"?Sn.ReadWrite:Sn.ReadOnly);Yl(x,M,E,z,le,Q,!1,V)}if(x.renderPass==="translucent"&&E.paint.get("fill-antialias")){const le=x.getDepthModeForSublayer(E.getPaintProperty("fill-outline-color")?2:0,Sn.ReadOnly);Yl(x,M,E,z,le,Q,!0,V)}}(n,s,f,m,y):a.cf(f)?function(x,M,E,z,B){const j=E.paint.get("fill-extrusion-opacity");if(j===0)return;const{isRenderingToTexture:N}=B;if(x.renderPass==="translucent"){const V=new Sn(x.context.gl.LEQUAL,Sn.ReadWrite,x.depthRangeFor3D);if(j!==1||E.paint.get("fill-extrusion-pattern").constantOr(1))Xs(x,M,E,z,V,dn.disabled,Hn.disabled,N),Xs(x,M,E,z,V,x.stencilModeFor3D(),x.colorModeForRenderPass(),N);else{const Q=x.colorModeForRenderPass();Xs(x,M,E,z,V,dn.disabled,Q,N)}}}(n,s,f,m,y):a.cg(f)?function(x,M,E,z,B){if(x.renderPass!=="offscreen"&&x.renderPass!=="translucent")return;const{isRenderingToTexture:j}=B,N=x.context,V=x.style.projection.useSubdivision,Q=x.getDepthModeForSublayer(0,Sn.ReadOnly),se=x.colorModeForRenderPass();if(x.renderPass==="offscreen")(function(oe,le,de,_e,me,xe,Te){const ge=oe.context,ze=ge.gl;for(const $e of de){const Ne=le.getTile($e),je=Ne.dem;if(!je||!je.data||!Ne.needsHillshadePrepare)continue;const We=je.dim,zt=je.stride,Ct=je.getPixels();if(ge.activeTexture.set(ze.TEXTURE1),ge.pixelStoreUnpackPremultiplyAlpha.set(!1),Ne.demTexture=Ne.demTexture||oe.getTileTexture(zt),Ne.demTexture){const Wt=Ne.demTexture;Wt.update(Ct,{premultiply:!1}),Wt.bind(ze.NEAREST,ze.CLAMP_TO_EDGE)}else Ne.demTexture=new a.T(ge,Ct,ze.RGBA,{premultiply:!1}),Ne.demTexture.bind(ze.NEAREST,ze.CLAMP_TO_EDGE);ge.activeTexture.set(ze.TEXTURE0);let ft=Ne.fbo;if(!ft){const Wt=new a.T(ge,{width:We,height:We,data:null},ze.RGBA);Wt.bind(ze.LINEAR,ze.CLAMP_TO_EDGE),ft=Ne.fbo=ge.createFramebuffer(We,We,!0,!1),ft.colorAttachment.set(Wt.texture)}ge.bindFramebuffer.set(ft.framebuffer),ge.viewport.set([0,0,We,We]),oe.useProgram("hillshadePrepare").draw(ge,ze.TRIANGLES,me,xe,Te,xn.disabled,Cy(Ne.tileID,je),null,null,_e.id,oe.rasterBoundsBuffer,oe.quadTriangleIndexBuffer,oe.rasterBoundsSegments),Ne.needsHillshadePrepare=!1}})(x,M,z,E,Q,dn.disabled,se),N.viewport.set([0,0,x.width,x.height]);else if(x.renderPass==="translucent")if(V){const[oe,le,de]=x.stencilConfigForOverlapTwoPass(z);Qs(x,M,E,de,oe,Q,se,!1,j),Qs(x,M,E,de,le,Q,se,!0,j)}else{const[oe,le]=x.getStencilConfigForOverlapAndUpdateStencilID(z);Qs(x,M,E,le,oe,Q,se,!1,j)}}(n,s,f,m,y):a.ch(f)?function(x,M,E,z,B){if(x.renderPass!=="translucent"||!z.length)return;const{isRenderingToTexture:j}=B,N=x.style.projection.useSubdivision,V=x.getDepthModeForSublayer(0,Sn.ReadOnly),Q=x.colorModeForRenderPass();if(N){const[se,oe,le]=x.stencilConfigForOverlapTwoPass(z);Xl(x,M,E,le,se,V,Q,!1,j),Xl(x,M,E,le,oe,V,Q,!0,j)}else{const[se,oe]=x.getStencilConfigForOverlapAndUpdateStencilID(z);Xl(x,M,E,oe,se,V,Q,!1,j)}}(n,s,f,m,y):a.ci(f)?function(x,M,E,z,B){if(x.renderPass!=="translucent"||E.paint.get("raster-opacity")===0||!z.length)return;const{isRenderingToTexture:j}=B,N=M.getSource(),V=x.style.projection.useSubdivision;if(N instanceof Mt)Mo(x,M,E,z,null,!1,!1,N.tileCoords,N.flippedWindingOrder,j);else if(V){const[Q,se,oe]=x.stencilConfigForOverlapTwoPass(z);Mo(x,M,E,oe,Q,!1,!0,yf,!1,j),Mo(x,M,E,oe,se,!0,!0,yf,!1,j)}else{const[Q,se]=x.getStencilConfigForOverlapAndUpdateStencilID(z);Mo(x,M,E,se,Q,!1,!0,yf,!1,j)}}(n,s,f,m,y):a.cj(f)?function(x,M,E,z,B){const j=E.paint.get("background-color"),N=E.paint.get("background-opacity");if(N===0)return;const{isRenderingToTexture:V}=B,Q=x.context,se=Q.gl,oe=x.style.projection,le=x.transform,de=le.tileSize,_e=E.paint.get("background-pattern");if(x.isPatternMissing(_e))return;const me=!_e&&j.a===1&&N===1&&x.opaquePassEnabledForLayer()?"opaque":"translucent";if(x.renderPass!==me)return;const xe=dn.disabled,Te=x.getDepthModeForSublayer(0,me==="opaque"?Sn.ReadWrite:Sn.ReadOnly),ge=x.colorModeForRenderPass(),ze=x.useProgram(_e?"backgroundPattern":"background"),$e=z||Ge(le,{tileSize:de,terrain:x.style.map.terrain});_e&&(Q.activeTexture.set(se.TEXTURE0),x.imageManager.bind(x.context));const Ne=E.getCrossfadeParameters();for(const je of $e){const We=le.getProjectionData({overscaledTileID:je,applyGlobeMatrix:!V,applyTerrainMatrix:!0}),zt=_e?Py(N,x,_e,{tileID:je,tileSize:de},Ne):uu(N,j),Ct=x.style.map.terrain&&x.style.map.terrain.getTerrainData(je),ft=oe.getMeshFromTileID(Q,je.canonical,!1,!0,"raster");ze.draw(Q,se.TRIANGLES,Te,xe,ge,xn.backCCW,zt,Ct,We,E.id,ft.vertexBuffer,ft.indexBuffer,ft.segments)}}(n,0,f,m,y):a.ck(f)&&function(x,M,E,z){const{isRenderingGlobe:B}=z,j=x.context,N=E.implementation,V=x.style.projection,Q=x.transform,se=Q.getProjectionDataForCustomLayer(B),oe={farZ:Q.farZ,nearZ:Q.nearZ,fov:Q.fov*Math.PI/180,modelViewProjectionMatrix:Q.modelViewProjectionMatrix,projectionMatrix:Q.projectionMatrix,shaderData:{variantName:V.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${V.shaderPreludeCode.vertexSource}`,define:V.shaderDefine},defaultProjectionData:se},le=N.renderingMode?N.renderingMode:"2d";if(x.renderPass==="offscreen"){const de=N.prerender;de&&(x.setCustomLayerDefaults(),j.setColorMode(x.colorModeForRenderPass()),de.call(N,j.gl,oe),j.setDirty(),x.setBaseState())}else if(x.renderPass==="translucent"){x.setCustomLayerDefaults(),j.setColorMode(x.colorModeForRenderPass()),j.setStencilMode(dn.disabled);const de=le==="3d"?x.getDepthModeFor3D():x.getDepthModeForSublayer(0,Sn.ReadOnly);j.setDepthMode(de),N.render(j.gl,oe),j.setDirty(),x.setBaseState(),j.bindFramebuffer.set(null)}}(n,0,f,y))}saveTileTexture(n){const s=this._tileTextures[n.size[0]];s?s.push(n):this._tileTextures[n.size[0]]=[n]}getTileTexture(n){const s=this._tileTextures[n];return s&&s.length>0?s.pop():null}isPatternMissing(n){if(!n)return!1;if(!n.from||!n.to)return!0;const s=this.imageManager.getPattern(n.from.toString()),f=this.imageManager.getPattern(n.to.toString());return!s||!f}useProgram(n,s,f=!1,m=[]){this.cache=this.cache||{};const y=!!this.style.map.terrain,x=this.style.projection,M=f?Tr.projectionMercator:x.shaderPreludeCode,E=f?ts:x.shaderDefine,z=n+(s?s.cacheKey:"")+`/${f?$h:x.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(y?"/terrain":"")+(m?`/${m.join("/")}`:"");return this.cache[z]||(this.cache[z]=new ou(this.context,Tr[n],s,Vp[n],this._showOverdrawInspector,y,M,E,m)),this.cache[z]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new a.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:n,drawingBufferHeight:s}=this.context.gl;return this.width!==n||this.height!==s}}function Tu(_,n){let s,f=!1,m=null,y=null;const x=()=>{m=null,f&&(_.apply(y,s),m=setTimeout(x,n),f=!1)};return(...M)=>(f=!0,y=this,s=M,m||x(),m)}class Kl{constructor(n){this._getCurrentHash=()=>{const s=window.location.hash.replace("#","");if(this._hashName){let f;return s.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(f=m)}),(f&&f[1]||"").split("/")}return s.split("/")},this._onHashChange=()=>{const s=this._getCurrentHash();if(!this._isValidHash(s))return!1;const f=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(s[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:f,pitch:+(s[4]||0)}),!0},this._updateHashUnthrottled=()=>{const s=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,s)},this._removeHash=()=>{const s=this._getCurrentHash();if(s.length===0)return;const f=s.join("/");let m=f;m.split("&").length>0&&(m=m.split("&")[0]),this._hashName&&(m=`${this._hashName}=${f}`);let y=window.location.hash.replace(m,"");y.startsWith("#&")?y=y.slice(0,1)+y.slice(2):y==="#"&&(y="");let x=window.location.href.replace(/(#.+)?$/,y);x=x.replace("&&","&"),window.history.replaceState(window.history.state,null,x)},this._updateHash=Tu(this._updateHashUnthrottled,300),this._hashName=n&&encodeURIComponent(n)}addTo(n){return this._map=n,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(n){const s=this._map.getCenter(),f=Math.round(100*this._map.getZoom())/100,m=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,m),x=Math.round(s.lng*y)/y,M=Math.round(s.lat*y)/y,E=this._map.getBearing(),z=this._map.getPitch();let B="";if(B+=n?`/${x}/${M}/${f}`:`${f}/${M}/${x}`,(E||z)&&(B+="/"+Math.round(10*E)/10),z&&(B+=`/${Math.round(z)}`),this._hashName){const j=this._hashName;let N=!1;const V=window.location.hash.slice(1).split("&").map(Q=>{const se=Q.split("=")[0];return se===j?(N=!0,`${se}=${B}`):Q}).filter(Q=>Q);return N||V.push(`${j}=${B}`),`#${V.join("&")}`}return`#${B}`}_isValidHash(n){if(n.length<3||n.some(isNaN))return!1;try{new a.S(+n[2],+n[1])}catch{return!1}const s=+n[0],f=+(n[3]||0),m=+(n[4]||0);return s>=this._map.getMinZoom()&&s<=this._map.getMaxZoom()&&f>=-180&&f<=180&&m>=this._map.getMinPitch()&&m<=this._map.getMaxPitch()}}const Ks={linearity:.3,easing:a.cl(0,0,.3,1)},Js=a.e({deceleration:2500,maxSpeed:1400},Ks),bf=a.e({deceleration:20,maxSpeed:1400},Ks),Jl=a.e({deceleration:1e3,maxSpeed:360},Ks),xf=a.e({deceleration:1e3,maxSpeed:90},Ks),am=a.e({deceleration:1e3,maxSpeed:360},Ks);class om{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:I.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,s=I.now();for(;n.length>0&&s-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,roll:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:y}of this._inertiaBuffer)s.zoom+=y.zoomDelta||0,s.bearing+=y.bearingDelta||0,s.pitch+=y.pitchDelta||0,s.roll+=y.rollDelta||0,y.panDelta&&s.pan._add(y.panDelta),y.around&&(s.around=y.around),y.pinchAround&&(s.pinchAround=y.pinchAround);const f=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(s.pan.mag()){const y=tl(s.pan.mag(),f,a.e({},Js,n||{})),x=s.pan.mult(y.amount/s.pan.mag()),M=this._map.cameraHelper.handlePanInertia(x,this._map.transform);m.center=M.easingCenter,m.offset=M.easingOffset,el(m,y)}if(s.zoom){const y=tl(s.zoom,f,bf);m.zoom=this._map.transform.zoom+y.amount,el(m,y)}if(s.bearing){const y=tl(s.bearing,f,Jl);m.bearing=this._map.transform.bearing+a.ag(y.amount,-179,179),el(m,y)}if(s.pitch){const y=tl(s.pitch,f,xf);m.pitch=this._map.transform.pitch+y.amount,el(m,y)}if(s.roll){const y=tl(s.roll,f,am);m.roll=this._map.transform.roll+a.ag(y.amount,-179,179),el(m,y)}if(m.zoom||m.bearing){const y=s.pinchAround===void 0?s.around:s.pinchAround;m.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),a.e(m,{noMoveStart:!0})}}function el(_,n){(!_.duration||_.duration<n.duration)&&(_.duration=n.duration,_.easing=n.easing)}function tl(_,n,s){const{maxSpeed:f,linearity:m,deceleration:y}=s,x=a.ag(_*m/(n/1e3),-f,f),M=Math.abs(x)/(y*m);return{easing:s.easing,duration:1e3*M,amount:x*(M/2)}}class $r extends a.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,s,f,m={}){f=f instanceof MouseEvent?f:new MouseEvent(n,f);const y=P.mousePos(s.getCanvas(),f),x=s.unproject(y);super(n,a.e({point:y,lngLat:x,originalEvent:f},m)),this._defaultPrevented=!1,this.target=s}}class wa extends a.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,s,f){const m=n==="touchend"?f.changedTouches:f.touches,y=P.touchPos(s.getCanvasContainer(),m),x=y.map(E=>s.unproject(E)),M=y.reduce((E,z,B,j)=>E.add(z.div(j.length)),new a.P(0,0));super(n,{points:y,point:M,lngLats:x,lngLat:s.unproject(M),originalEvent:f}),this._defaultPrevented=!1}}class wf extends a.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,s,f){super(n,{originalEvent:f}),this._defaultPrevented=!1}}class sm{constructor(n,s){this._map=n,this._clickTolerance=s.clickTolerance}reset(){delete this._mousedownPos}wheel(n){return this._firePreventable(new wf(n.type,this._map,n))}mousedown(n,s){return this._mousedownPos=s,this._firePreventable(new $r(n.type,this._map,n))}mouseup(n){this._map.fire(new $r(n.type,this._map,n))}click(n,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||this._map.fire(new $r(n.type,this._map,n))}dblclick(n){return this._firePreventable(new $r(n.type,this._map,n))}mouseover(n){this._map.fire(new $r(n.type,this._map,n))}mouseout(n){this._map.fire(new $r(n.type,this._map,n))}touchstart(n){return this._firePreventable(new wa(n.type,this._map,n))}touchmove(n){this._map.fire(new wa(n.type,this._map,n))}touchend(n){this._map.fire(new wa(n.type,this._map,n))}touchcancel(n){this._map.fire(new wa(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class lm{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(n){this._map.fire(new $r(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new $r("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._ignoreContextMenu||this._map.fire(new $r(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class nl{constructor(n){this._map=n}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(n){return this.transform.screenPointToLocation(a.P.convert(n),this._map.terrain)}}class Af{constructor(n,s){this._map=n,this._tr=new nl(n),this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,s){this.isEnabled()&&n.shiftKey&&n.button===0&&(P.disableDrag(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(n,s){if(!this._active)return;const f=s;if(this._lastPos.equals(f)||!this._box&&f.dist(this._startPos)<this._clickTolerance)return;const m=this._startPos;this._lastPos=f,this._box||(this._box=P.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",n));const y=Math.min(m.x,f.x),x=Math.max(m.x,f.x),M=Math.min(m.y,f.y),E=Math.max(m.y,f.y);P.setTransform(this._box,`translate(${y}px,${M}px)`),this._box.style.width=x-y+"px",this._box.style.height=E-M+"px"}mouseupWindow(n,s){if(!this._active||n.button!==0)return;const f=this._startPos,m=s;if(this.reset(),P.suppressClick(),f.x!==m.x||f.y!==m.y)return this._map.fire(new a.l("boxzoomend",{originalEvent:n})),{cameraAnimation:y=>y.fitScreenCoordinates(f,m,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",n)}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(P.remove(this._box),this._box=null),P.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(n,s){return this._map.fire(new a.l(n,{originalEvent:s}))}}function Su(_,n){if(_.length!==n.length)throw new Error(`The number of touches and points are not equal - touches ${_.length}, points ${n.length}`);const s={};for(let f=0;f<_.length;f++)s[_[f].identifier]=n[f];return s}class cm{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(n,s,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=n.timeStamp),f.length===this.numTouches&&(this.centroid=function(m){const y=new a.P(0,0);for(const x of m)y._add(x);return y.div(m.length)}(s),this.touches=Su(f,s)))}touchmove(n,s,f){if(this.aborted||!this.centroid)return;const m=Su(f,s);for(const y in this.touches){const x=m[y];(!x||x.dist(this.touches[y])>30)&&(this.aborted=!0)}}touchend(n,s,f){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class Mu{constructor(n){this.singleTap=new cm(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(n,s,f){this.singleTap.touchstart(n,s,f)}touchmove(n,s,f){this.singleTap.touchmove(n,s,f)}touchend(n,s,f){const m=this.singleTap.touchend(n,s,f);if(m){const y=n.timeStamp-this.lastTime<500,x=!this.lastTap||this.lastTap.dist(m)<30;if(y&&x||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class Cu{constructor(n){this._tr=new nl(n),this._zoomIn=new Mu({numTouches:1,numTaps:2}),this._zoomOut=new Mu({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,s,f){this._zoomIn.touchstart(n,s,f),this._zoomOut.touchstart(n,s,f)}touchmove(n,s,f){this._zoomIn.touchmove(n,s,f),this._zoomOut.touchmove(n,s,f)}touchend(n,s,f){const m=this._zoomIn.touchend(n,s,f),y=this._zoomOut.touchend(n,s,f),x=this._tr;return m?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:x.zoom+1,around:x.unproject(m)},{originalEvent:n})}):y?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:x.zoom-1,around:x.unproject(y)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class il{constructor(n){this._enabled=!!n.enable,this._moveStateManager=n.moveStateManager,this._clickTolerance=n.clickTolerance||1,this._moveFunction=n.move,this._activateOnStart=!!n.activateOnStart,n.assignEvents(this),this.reset()}reset(n){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(n)}_move(...n){const s=this._moveFunction(...n);if(s.bearingDelta||s.pitchDelta||s.rollDelta||s.around||s.panDelta)return this._active=!0,s}dragStart(n,s){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(n)&&(this._moveStateManager.startMove(n),this._lastPoint=Array.isArray(s)?s[0]:s,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(n,s){if(!this.isEnabled())return;const f=this._lastPoint;if(!f)return;if(n.preventDefault(),!this._moveStateManager.isValidMoveEvent(n))return void this.reset(n);const m=Array.isArray(s)?s[0]:s;return!this._moved&&m.dist(f)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=m,this._move(f,m))}dragEnd(n){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(n)&&(this._moved&&P.suppressClick(),this.reset(n))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const ga=0,Aa=2,um={[ga]:1,[Aa]:2};class Lr{constructor(n){this._correctEvent=n.checkCorrectEvent}startMove(n){const s=P.mouseButton(n);this._eventButton=s}endMove(n){delete this._eventButton}isValidStartEvent(n){return this._correctEvent(n)}isValidMoveEvent(n){return!function(s,f){const m=um[f];return s.buttons===void 0||(s.buttons&m)!==m}(n,this._eventButton)}isValidEndEvent(n){return P.mouseButton(n)===this._eventButton}}class rl{constructor(){this._firstTouch=void 0}_isOneFingerTouch(n){return n.targetTouches.length===1}_isSameTouchEvent(n){return n.targetTouches[0].identifier===this._firstTouch}startMove(n){this._firstTouch=n.targetTouches[0].identifier}endMove(n){delete this._firstTouch}isValidStartEvent(n){return this._isOneFingerTouch(n)}isValidMoveEvent(n){return this._isOneFingerTouch(n)&&this._isSameTouchEvent(n)}isValidEndEvent(n){return this._isOneFingerTouch(n)&&this._isSameTouchEvent(n)}}class Ny{constructor(n=new Lr({checkCorrectEvent:()=>!0}),s=new rl){this.mouseMoveStateManager=n,this.oneFingerTouchMoveStateManager=s}_executeRelevantHandler(n,s,f){return n instanceof MouseEvent?s(n):typeof TouchEvent<"u"&&n instanceof TouchEvent?f(n):void 0}startMove(n){this._executeRelevantHandler(n,s=>this.mouseMoveStateManager.startMove(s),s=>this.oneFingerTouchMoveStateManager.startMove(s))}endMove(n){this._executeRelevantHandler(n,s=>this.mouseMoveStateManager.endMove(s),s=>this.oneFingerTouchMoveStateManager.endMove(s))}isValidStartEvent(n){return this._executeRelevantHandler(n,s=>this.mouseMoveStateManager.isValidStartEvent(s),s=>this.oneFingerTouchMoveStateManager.isValidStartEvent(s))}isValidMoveEvent(n){return this._executeRelevantHandler(n,s=>this.mouseMoveStateManager.isValidMoveEvent(s),s=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(s))}isValidEndEvent(n){return this._executeRelevantHandler(n,s=>this.mouseMoveStateManager.isValidEndEvent(s),s=>this.oneFingerTouchMoveStateManager.isValidEndEvent(s))}}const Iu=_=>{_.mousedown=_.dragStart,_.mousemoveWindow=_.dragMove,_.mouseup=_.dragEnd,_.contextmenu=n=>{n.preventDefault()}};class jy{constructor(n,s){this._clickTolerance=n.clickTolerance||1,this._map=s,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0)}_shouldBePrevented(n){return n<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(n,s,f){return this._calculateTransform(n,s,f)}touchmove(n,s,f){if(this._active){if(!this._shouldBePrevented(f.length))return n.preventDefault(),this._calculateTransform(n,s,f);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",n)}}touchend(n,s,f){this._calculateTransform(n,s,f),this._active&&this._shouldBePrevented(f.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,s,f){f.length>0&&(this._active=!0);const m=Su(f,s),y=new a.P(0,0),x=new a.P(0,0);let M=0;for(const z in m){const B=m[z],j=this._touches[z];j&&(y._add(B),x._add(B.sub(j)),M++,m[z]=B)}if(this._touches=m,this._shouldBePrevented(M)||!x.mag())return;const E=x.div(M);return this._sum._add(E),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(M),panDelta:E}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Tf{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(n,s,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([s[0],s[1]]))}touchmove(n,s,f){if(!this._firstTwoTouches)return;n.preventDefault();const[m,y]=this._firstTwoTouches,x=ec(f,s,m),M=ec(f,s,y);if(!x||!M)return;const E=this._aroundCenter?null:x.add(M).div(2);return this._move([x,M],E,n)}touchend(n,s,f){if(!this._firstTwoTouches)return;const[m,y]=this._firstTwoTouches,x=ec(f,s,m),M=ec(f,s,y);x&&M||(this._active&&P.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function ec(_,n,s){for(let f=0;f<_.length;f++)if(_[f].identifier===s)return n[f]}function al(_,n){return Math.log(_/n)/Math.LN2}class Na extends Tf{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,s){const f=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(al(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:al(this._distance,f),pinchAround:s}}}function Gt(_,n){return 180*_.angleWith(n)/Math.PI}class Sf extends Tf{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,s,f){const m=this._vector;if(this._vector=n[0].sub(n[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Gt(this._vector,m),pinchAround:s}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const s=25/(Math.PI*this._minDiameter)*360,f=Gt(n,this._startVector);return Math.abs(f)<s}}function tc(_){return Math.abs(_.y)>Math.abs(_.x)}class Mf extends Tf{constructor(n){super(),this._currentTouchCount=0,this._map=n}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(n,s,f){super.touchstart(n,s,f),this._currentTouchCount=f.length}_start(n){this._lastPoints=n,tc(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,s,f){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const m=n[0].sub(this._lastPoints[0]),y=n[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(m,y,f.timeStamp),this._valid?(this._lastPoints=n,this._active=!0,{pitchDelta:(m.y+y.y)/2*-.5}):void 0}gestureBeginsVertically(n,s,f){if(this._valid!==void 0)return this._valid;const m=n.mag()>=2,y=s.mag()>=2;if(!m&&!y)return;if(!m||!y)return this._firstMove===void 0&&(this._firstMove=f),f-this._firstMove<100&&void 0;const x=n.y>0==s.y>0;return tc(n)&&tc(s)&&x}}const nc={panStep:100,bearingStep:15,pitchStep:10};class ol{constructor(n){this._tr=new nl(n);const s=nc;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let s=0,f=0,m=0,y=0,x=0;switch(n.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:n.shiftKey?f=-1:(n.preventDefault(),y=-1);break;case 39:n.shiftKey?f=1:(n.preventDefault(),y=1);break;case 38:n.shiftKey?m=1:(n.preventDefault(),x=-1);break;case 40:n.shiftKey?m=-1:(n.preventDefault(),x=1);break;default:return}return this._rotationDisabled&&(f=0,m=0),{cameraAnimation:M=>{const E=this._tr;M.easeTo({duration:300,easeId:"keyboardHandler",easing:Cf,zoom:s?Math.round(E.zoom)+s*(n.shiftKey?2:1):E.zoom,bearing:E.bearing+f*this._bearingStep,pitch:E.pitch+m*this._pitchStep,offset:[-y*this._panStep,-x*this._panStep],center:E.center},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Cf(_){return _*(2-_)}const Ln=4.000244140625,If=1/450;class hm{constructor(n,s){this._onTimeout=f=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(f)},this._map=n,this._tr=new nl(n),this._triggerRenderFrame=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=If}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&n.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(n){return!!this._map.cooperativeGestures.isEnabled()&&!(n.ctrlKey||this._map.cooperativeGestures.isBypassed(n))}wheel(n){if(!this.isEnabled())return;if(this._shouldBePrevented(n))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",n);let s=n.deltaMode===WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const f=I.now(),m=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,s!==0&&s%Ln==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(m*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),n.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=n,this._delta-=s,this._active||this._start(n)),n.preventDefault()}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=P.mousePos(this._map.getCanvas(),n),f=this._tr;this._aroundPoint=this._aroundCenter?f.transform.locationToScreenPoint(a.S.convert(f.center)):s,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const M=n.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=M),typeof this._targetZoom=="number"&&(this._targetZoom+=M)}if(this._delta!==0){const M=this._type==="wheel"&&Math.abs(this._delta)>Ln?this._wheelZoomRate:this._defaultZoomRate;let E=2/(1+Math.exp(-Math.abs(this._delta*M)));this._delta<0&&E!==0&&(E=1/E);const z=typeof this._targetZoom!="number"?n.scale:a.ae(this._targetZoom);this._targetZoom=n.getConstrained(n.getCameraLngLat(),a.aj(z*E)).zoom,this._type==="wheel"&&(this._startZoom=n.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const s=typeof this._targetZoom!="number"?n.zoom:this._targetZoom,f=this._startZoom,m=this._easing;let y,x=!1;if(this._type==="wheel"&&f&&m){const M=I.now()-this._lastWheelEventTime,E=Math.min((M+5)/200,1),z=m(E);y=a.C.number(f,s,z),E<1?this._frameId||(this._frameId=!0):x=!0}else y=s,x=!0;return this._active=!0,x&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=y,{noInertia:!0,needsRenderFrame:!x,zoomDelta:y-n.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let s=a.cn;if(this._prevEase){const f=this._prevEase,m=(I.now()-f.start)/f.duration,y=f.easing(m+.01)-f.easing(m),x=.27/Math.sqrt(y*y+1e-4)*.01,M=Math.sqrt(.0729-x*x);s=a.cl(x,M,.25,1)}return this._prevEase={start:I.now(),duration:n,easing:s},s}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Eu{constructor(n,s){this._clickZoom=n,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Uy{constructor(n){this._tr=new nl(n),this.reset()}reset(){this._active=!1}dblclick(n,s){return n.preventDefault(),{cameraAnimation:f=>{f.easeTo({duration:300,zoom:this._tr.zoom+(n.shiftKey?-1:1),around:this._tr.unproject(s)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Vy{constructor(){this._tap=new Mu({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(n,s,f){if(!this._swipePoint)if(this._tapTime){const m=s[0],y=n.timeStamp-this._tapTime<500,x=this._tapPoint.dist(m)<30;y&&x?f.length>0&&(this._swipePoint=m,this._swipeTouch=f[0].identifier):this.reset()}else this._tap.touchstart(n,s,f)}touchmove(n,s,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;const m=s[0],y=m.y-this._swipePoint.y;return this._swipePoint=m,n.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(n,s,f)}touchend(n,s,f){if(this._tapTime)this._swipePoint&&f.length===0&&this.reset();else{const m=this._tap.touchend(n,s,f);m&&(this._tapTime=n.timeStamp,this._tapPoint=m)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ef{constructor(n,s,f){this._el=n,this._mousePan=s,this._touchPan=f}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Pu{constructor(n,s,f,m){this._pitchWithRotate=n.pitchWithRotate,this._rollEnabled=n.rollEnabled,this._mouseRotate=s,this._mousePitch=f,this._mouseRoll=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Pf{constructor(n,s,f,m){this._el=n,this._touchZoom=s,this._touchRotate=f,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class fm{constructor(n,s){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=n,this._options=s,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const n=this._map.getCanvasContainer();n.classList.add("maplibregl-cooperative-gestures"),this._container=P.create("div","maplibregl-cooperative-gesture-screen",n);let s=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(s=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const f=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),m=document.createElement("div");m.className="maplibregl-desktop-message",m.textContent=s,this._container.appendChild(m);const y=document.createElement("div");y.className="maplibregl-mobile-message",y.textContent=f,this._container.appendChild(y),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(P.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(n){return n[this._bypassKey]}notifyGestureBlocked(n,s){this._enabled&&(this._map.fire(new a.l("cooperativegestureprevented",{gestureType:n,originalEvent:s})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const ic=_=>_.zoom||_.drag||_.roll||_.pitch||_.rotate;class Gy extends a.l{}function kf(_){return _.panDelta&&_.panDelta.mag()||_.zoomDelta||_.bearingDelta||_.pitchDelta||_.rollDelta}class Io{constructor(n,s){this.handleWindowEvent=m=>{this.handleEvent(m,`${m.type}Window`)},this.handleEvent=(m,y)=>{if(m.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const x=m.type==="renderFrame"?void 0:m,M={needsRenderFrame:!1},E={},z={};for(const{handlerName:N,handler:V,allowed:Q}of this._handlers){if(!V.isEnabled())continue;let se;if(this._blockedByActive(z,Q,N))V.reset();else if(V[y||m.type]){if(a.co(m,y||m.type)){const oe=P.mousePos(this._map.getCanvas(),m);se=V[y||m.type](m,oe)}else if(a.cp(m,y||m.type)){const oe=this._getMapTouches(m.touches),le=P.touchPos(this._map.getCanvas(),oe);se=V[y||m.type](m,le,oe)}else a.cq(y||m.type)||(se=V[y||m.type](m));this.mergeHandlerResult(M,E,se,N,x),se&&se.needsRenderFrame&&this._triggerRenderFrame()}(se||V.isActive())&&(z[N]=V)}const B={};for(const N in this._previousActiveHandlers)z[N]||(B[N]=x);this._previousActiveHandlers=z,(Object.keys(B).length||kf(M))&&(this._changes.push([M,E,B]),this._triggerRenderFrame()),(Object.keys(z).length||kf(M))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:j}=M;j&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],j(this._map))},this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new om(n),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(s);const f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[window,"blur",void 0]];for(const[m,y,x]of this._listeners)P.addEventListener(m,y,m===document?this.handleWindowEvent:this.handleEvent,x)}destroy(){for(const[n,s,f]of this._listeners)P.removeEventListener(n,s,n===document?this.handleWindowEvent:this.handleEvent,f)}_addDefaultHandlers(n){const s=this._map,f=s.getCanvasContainer();this._add("mapEvent",new sm(s,n));const m=s.boxZoom=new Af(s,n);this._add("boxZoom",m),n.interactive&&n.boxZoom&&m.enable();const y=s.cooperativeGestures=new fm(s,n.cooperativeGestures);this._add("cooperativeGestures",y),n.cooperativeGestures&&y.enable();const x=new Cu(s),M=new Uy(s);s.doubleClickZoom=new Eu(M,x),this._add("tapZoom",x),this._add("clickZoom",M),n.interactive&&n.doubleClickZoom&&s.doubleClickZoom.enable();const E=new Vy;this._add("tapDragZoom",E);const z=s.touchPitch=new Mf(s);this._add("touchPitch",z),n.interactive&&n.touchPitch&&s.touchPitch.enable(n.touchPitch);const B=()=>s.project(s.getCenter()),j=function({enable:me,clickTolerance:xe,aroundCenter:Te=!0,minPixelCenterThreshold:ge=100,rotateDegreesPerPixelMoved:ze=.8},$e){const Ne=new Lr({checkCorrectEvent:je=>P.mouseButton(je)===0&&je.ctrlKey||P.mouseButton(je)===2&&!je.ctrlKey});return new il({clickTolerance:xe,move:(je,We)=>{const zt=$e();if(Te&&Math.abs(zt.y-je.y)>ge)return{bearingDelta:a.cm(new a.P(je.x,We.y),We,zt)};let Ct=(We.x-je.x)*ze;return Te&&We.y<zt.y&&(Ct=-Ct),{bearingDelta:Ct}},moveStateManager:Ne,enable:me,assignEvents:Iu})}(n,B),N=function({enable:me,clickTolerance:xe,pitchDegreesPerPixelMoved:Te=-.5}){const ge=new Lr({checkCorrectEvent:ze=>P.mouseButton(ze)===0&&ze.ctrlKey||P.mouseButton(ze)===2});return new il({clickTolerance:xe,move:(ze,$e)=>({pitchDelta:($e.y-ze.y)*Te}),moveStateManager:ge,enable:me,assignEvents:Iu})}(n),V=function({enable:me,clickTolerance:xe,rollDegreesPerPixelMoved:Te=.3},ge){const ze=new Lr({checkCorrectEvent:$e=>P.mouseButton($e)===2&&$e.ctrlKey});return new il({clickTolerance:xe,move:($e,Ne)=>{const je=ge();let We=(Ne.x-$e.x)*Te;return Ne.y<je.y&&(We=-We),{rollDelta:We}},moveStateManager:ze,enable:me,assignEvents:Iu})}(n,B);s.dragRotate=new Pu(n,j,N,V),this._add("mouseRotate",j,["mousePitch"]),this._add("mousePitch",N,["mouseRotate","mouseRoll"]),this._add("mouseRoll",V,["mousePitch"]),n.interactive&&n.dragRotate&&s.dragRotate.enable();const Q=function({enable:me,clickTolerance:xe}){const Te=new Lr({checkCorrectEvent:ge=>P.mouseButton(ge)===0&&!ge.ctrlKey});return new il({clickTolerance:xe,move:(ge,ze)=>({around:ze,panDelta:ze.sub(ge)}),activateOnStart:!0,moveStateManager:Te,enable:me,assignEvents:Iu})}(n),se=new jy(n,s);s.dragPan=new Ef(f,Q,se),this._add("mousePan",Q),this._add("touchPan",se,["touchZoom","touchRotate"]),n.interactive&&n.dragPan&&s.dragPan.enable(n.dragPan);const oe=new Sf,le=new Na;s.touchZoomRotate=new Pf(f,le,oe,E),this._add("touchRotate",oe,["touchPan","touchZoom"]),this._add("touchZoom",le,["touchPan","touchRotate"]),n.interactive&&n.touchZoomRotate&&s.touchZoomRotate.enable(n.touchZoomRotate);const de=s.scrollZoom=new hm(s,()=>this._triggerRenderFrame());this._add("scrollZoom",de,["mousePan"]),n.interactive&&n.scrollZoom&&s.scrollZoom.enable(n.scrollZoom);const _e=s.keyboard=new ol(s);this._add("keyboard",_e),n.interactive&&n.keyboard&&s.keyboard.enable(),this._add("blockableMapEvent",new lm(s))}_add(n,s,f){this._handlers.push({handlerName:n,handler:s,allowed:f}),this._handlersById[n]=s}stop(n){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[]}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ic(this._eventsInProgress)||this.isZooming()}_blockedByActive(n,s,f){for(const m in n)if(m!==f&&(!s||s.indexOf(m)<0))return!0;return!1}_getMapTouches(n){const s=[];for(const f of n)this._el.contains(f.target)&&s.push(f);return s}mergeHandlerResult(n,s,f,m,y){if(!f)return;a.e(n,f);const x={handlerName:m,originalEvent:f.originalEvent||y};f.zoomDelta!==void 0&&(s.zoom=x),f.panDelta!==void 0&&(s.drag=x),f.rollDelta!==void 0&&(s.roll=x),f.pitchDelta!==void 0&&(s.pitch=x),f.bearingDelta!==void 0&&(s.rotate=x)}_applyChanges(){const n={},s={},f={};for(const[m,y,x]of this._changes)m.panDelta&&(n.panDelta=(n.panDelta||new a.P(0,0))._add(m.panDelta)),m.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+m.pitchDelta),m.rollDelta&&(n.rollDelta=(n.rollDelta||0)+m.rollDelta),m.around!==void 0&&(n.around=m.around),m.pinchAround!==void 0&&(n.pinchAround=m.pinchAround),m.noInertia&&(n.noInertia=m.noInertia),a.e(s,y),a.e(f,x);this._updateMapTransform(n,s,f),this._changes=[]}_updateMapTransform(n,s,f){const m=this._map,y=m._getTransformForUpdate(),x=m.terrain;if(!(kf(n)||x&&this._terrainMovement))return this._fireEvents(s,f,!0);m._stop(!0);let{panDelta:M,zoomDelta:E,bearingDelta:z,pitchDelta:B,rollDelta:j,around:N,pinchAround:V}=n;V!==void 0&&(N=V),N=N||m.transform.centerPoint,x&&!y.isPointOnMapSurface(N)&&(N=y.centerPoint);const Q={panDelta:M,zoomDelta:E,rollDelta:j,pitchDelta:B,bearingDelta:z,around:N};this._map.cameraHelper.useGlobeControls&&!y.isPointOnMapSurface(N)&&(N=y.centerPoint);const se=N.distSqr(y.centerPoint)<.01?y.center:y.screenPointToLocation(M?N.sub(M):N);x?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(Q,y),this._terrainMovement||!s.drag&&!s.zoom?s.drag&&this._terrainMovement?y.setCenter(y.screenPointToLocation(y.centerPoint.sub(M))):this._map.cameraHelper.handleMapControlsPan(Q,y,se):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(Q,y,se))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(Q,y),this._map.cameraHelper.handleMapControlsPan(Q,y,se)),m._applyUpdatedTransform(y),this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(s,f,!0)}_fireEvents(n,s,f){const m=ic(this._eventsInProgress),y=ic(n),x={};for(const j in n){const{originalEvent:N}=n[j];this._eventsInProgress[j]||(x[`${j}start`]=N),this._eventsInProgress[j]=n[j]}!m&&y&&this._fireEvent("movestart",y.originalEvent);for(const j in x)this._fireEvent(j,x[j]);y&&this._fireEvent("move",y.originalEvent);for(const j in n){const{originalEvent:N}=n[j];this._fireEvent(j,N)}const M={};let E;for(const j in this._eventsInProgress){const{handlerName:N,originalEvent:V}=this._eventsInProgress[j];this._handlersById[N].isActive()||(delete this._eventsInProgress[j],E=s[N]||V,M[`${j}end`]=E)}for(const j in M)this._fireEvent(j,M[j]);const z=ic(this._eventsInProgress),B=(m||y)&&!z;if(B&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const j=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&j.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(j)}if(f&&B){this._updatingCamera=!0;const j=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),N=V=>V!==0&&-this._bearingSnap<V&&V<this._bearingSnap;!j||!j.essential&&I.prefersReducedMotion?(this._map.fire(new a.l("moveend",{originalEvent:E})),N(this._map.getBearing())&&this._map.resetNorth()):(N(j.bearing||this._map.getBearing())&&(j.bearing=0),j.freezeElevation=!0,this._map.easeTo(j,{originalEvent:E})),this._updatingCamera=!1}}_fireEvent(n,s){this._map.fire(new a.l(n,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{delete this._frameId,this.handleEvent(new Gy("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Pi extends a.E{constructor(n,s,f){super(),this._renderFrameCallback=()=>{const m=Math.min((I.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(m)),m<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=f.bearingSnap,this.cameraHelper=s,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(n,s){n.apply(this.transform),this.transform=n,this.cameraHelper=s}getCenter(){return new a.S(this.transform.center.lng,this.transform.center.lat)}setCenter(n,s){return this.jumpTo({center:n},s)}getCenterElevation(){return this.transform.elevation}setCenterElevation(n,s){return this.jumpTo({elevation:n},s),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(n){this._centerClampedToGround=n}panBy(n,s,f){return n=a.P.convert(n).mult(-1),this.panTo(this.transform.center,a.e({offset:n},s),f)}panTo(n,s,f){return this.easeTo(a.e({center:n},s),f)}getZoom(){return this.transform.zoom}setZoom(n,s){return this.jumpTo({zoom:n},s),this}zoomTo(n,s,f){return this.easeTo(a.e({zoom:n},s),f)}zoomIn(n,s){return this.zoomTo(this.getZoom()+1,n,s),this}zoomOut(n,s){return this.zoomTo(this.getZoom()-1,n,s),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(n,s){return n!=this.transform.fov&&(this.transform.setFov(n),this.fire(new a.l("movestart",s)).fire(new a.l("move",s)).fire(new a.l("moveend",s))),this}getBearing(){return this.transform.bearing}setBearing(n,s){return this.jumpTo({bearing:n},s),this}getPadding(){return this.transform.padding}setPadding(n,s){return this.jumpTo({padding:n},s),this}rotateTo(n,s,f){return this.easeTo(a.e({bearing:n},s),f)}resetNorth(n,s){return this.rotateTo(0,a.e({duration:1e3},n),s),this}resetNorthPitch(n,s){return this.easeTo(a.e({bearing:0,pitch:0,roll:0,duration:1e3},n),s),this}snapToNorth(n,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,s):this}getPitch(){return this.transform.pitch}setPitch(n,s){return this.jumpTo({pitch:n},s),this}getRoll(){return this.transform.roll}setRoll(n,s){return this.jumpTo({roll:n},s),this}cameraForBounds(n,s){n=wt.convert(n).adjustAntiMeridian();const f=s&&s.bearing||0;return this._cameraForBoxAndBearing(n.getNorthWest(),n.getSouthEast(),f,s)}_cameraForBoxAndBearing(n,s,f,m){const y={top:0,bottom:0,right:0,left:0};if(typeof(m=a.e({padding:y,offset:[0,0],maxZoom:this.transform.maxZoom},m)).padding=="number"){const z=m.padding;m.padding={top:z,bottom:z,right:z,left:z}}const x=a.e(y,m.padding);m.padding=x;const M=this.transform,E=new wt(n,s);return this.cameraHelper.cameraForBoxAndBearing(m,x,E,f,M)}fitBounds(n,s,f){return this._fitInternal(this.cameraForBounds(n,s),s,f)}fitScreenCoordinates(n,s,f,m,y){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(a.P.convert(n)),this.transform.screenPointToLocation(a.P.convert(s)),f,m),m,y)}_fitInternal(n,s,f){return n?(delete(s=a.e(n,s)).padding,s.linear?this.easeTo(s,f):this.flyTo(s,f)):this}jumpTo(n,s){this.stop();const f=this._getTransformForUpdate();let m=!1,y=!1,x=!1;const M=f.zoom;this.cameraHelper.handleJumpToCenterZoom(f,n);const E=f.zoom!==M;return"elevation"in n&&f.elevation!==+n.elevation&&f.setElevation(+n.elevation),"bearing"in n&&f.bearing!==+n.bearing&&(m=!0,f.setBearing(+n.bearing)),"pitch"in n&&f.pitch!==+n.pitch&&(y=!0,f.setPitch(+n.pitch)),"roll"in n&&f.roll!==+n.roll&&(x=!0,f.setRoll(+n.roll)),n.padding==null||f.isPaddingEqual(n.padding)||f.setPadding(n.padding),this._applyUpdatedTransform(f),this.fire(new a.l("movestart",s)).fire(new a.l("move",s)),E&&this.fire(new a.l("zoomstart",s)).fire(new a.l("zoom",s)).fire(new a.l("zoomend",s)),m&&this.fire(new a.l("rotatestart",s)).fire(new a.l("rotate",s)).fire(new a.l("rotateend",s)),y&&this.fire(new a.l("pitchstart",s)).fire(new a.l("pitch",s)).fire(new a.l("pitchend",s)),x&&this.fire(new a.l("rollstart",s)).fire(new a.l("roll",s)).fire(new a.l("rollend",s)),this.fire(new a.l("moveend",s))}calculateCameraOptionsFromTo(n,s,f,m=0){const y=a.a0.fromLngLat(n,s),x=a.a0.fromLngLat(f,m),M=x.x-y.x,E=x.y-y.y,z=x.z-y.z,B=Math.hypot(M,E,z);if(B===0)throw new Error("Can't calculate camera options with same From and To");const j=Math.hypot(M,E),N=a.aj(this.transform.cameraToCenterDistance/B/this.transform.tileSize),V=180*Math.atan2(M,-E)/Math.PI;let Q=180*Math.acos(j/B)/Math.PI;return Q=z<0?90-Q:90+Q,{center:x.toLngLat(),elevation:m,zoom:N,pitch:Q,bearing:V}}calculateCameraOptionsFromCameraLngLatAltRotation(n,s,f,m,y){const x=this.transform.calculateCenterFromCameraLngLatAlt(n,s,f,m);return{center:x.center,elevation:x.elevation,zoom:x.zoom,bearing:f,pitch:m,roll:y}}easeTo(n,s){this._stop(!1,n.easeId),((n=a.e({offset:[0,0],duration:500,easing:a.cn},n)).animate===!1||!n.essential&&I.prefersReducedMotion)&&(n.duration=0);const f=this._getTransformForUpdate(),m=this.getBearing(),y=f.pitch,x=f.roll,M="bearing"in n?this._normalizeBearing(n.bearing,m):m,E="pitch"in n?+n.pitch:y,z="roll"in n?this._normalizeBearing(n.roll,x):x,B="padding"in n?n.padding:f.padding,j=a.P.convert(n.offset);let N,V;n.around&&(N=a.S.convert(n.around),V=f.locationToScreenPoint(N));const Q={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},se=this.cameraHelper.handleEaseTo(f,{bearing:M,pitch:E,roll:z,padding:B,around:N,aroundPoint:V,offsetAsPoint:j,offset:n.offset,zoom:n.zoom,center:n.center});return this._rotating=this._rotating||m!==M,this._pitching=this._pitching||E!==y,this._rolling=this._rolling||z!==x,this._padding=!f.isPaddingEqual(B),this._zooming=this._zooming||se.isZooming,this._easeId=n.easeId,this._prepareEase(s,n.noMoveStart,Q),this.terrain&&this._prepareElevation(se.elevationCenter),this._ease(oe=>{se.easeFunc(oe),this.terrain&&!n.freezeElevation&&this._updateElevation(oe),this._applyUpdatedTransform(f),this._fireMoveEvents(s)},oe=>{this.terrain&&n.freezeElevation&&this._finalizeElevation(),this._afterEase(s,oe)},n),this}_prepareEase(n,s,f={}){this._moving=!0,s||f.moving||this.fire(new a.l("movestart",n)),this._zooming&&!f.zooming&&this.fire(new a.l("zoomstart",n)),this._rotating&&!f.rotating&&this.fire(new a.l("rotatestart",n)),this._pitching&&!f.pitching&&this.fire(new a.l("pitchstart",n)),this._rolling&&!f.rolling&&this.fire(new a.l("rollstart",n))}_prepareElevation(n){this._elevationCenter=n,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(n,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(n){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const s=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(n<1&&s!==this._elevationTarget){const f=this._elevationTarget-this._elevationStart;this._elevationStart+=n*(f-(s-(f*n+this._elevationStart))/(1-n)),this._elevationTarget=s}this.transform.setElevation(a.C.number(this._elevationStart,this._elevationTarget,n))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(n){if(!this.terrain&&n.elevation>=0&&n.pitch<=90)return{};const s=n.getCameraLngLat(),f=n.getCameraAltitude(),m=this.terrain?this.terrain.getElevationForLngLatZoom(s,n.zoom):0;if(f<m){const y=this.calculateCameraOptionsFromTo(s,m,n.center,n.elevation);return{pitch:y.pitch,zoom:y.zoom}}return{}}_applyUpdatedTransform(n){const s=[];if(s.push(m=>this._elevateCameraIfInsideTerrain(m)),this.transformCameraUpdate&&s.push(m=>this.transformCameraUpdate(m)),!s.length)return;const f=n.clone();for(const m of s){const y=f.clone(),{center:x,zoom:M,roll:E,pitch:z,bearing:B,elevation:j}=m(y);x&&y.setCenter(x),j!==void 0&&y.setElevation(j),M!==void 0&&y.setZoom(M),E!==void 0&&y.setRoll(E),z!==void 0&&y.setPitch(z),B!==void 0&&y.setBearing(B),f.apply(y)}this.transform.apply(f)}_fireMoveEvents(n){this.fire(new a.l("move",n)),this._zooming&&this.fire(new a.l("zoom",n)),this._rotating&&this.fire(new a.l("rotate",n)),this._pitching&&this.fire(new a.l("pitch",n)),this._rolling&&this.fire(new a.l("roll",n))}_afterEase(n,s){if(this._easeId&&s&&this._easeId===s)return;delete this._easeId;const f=this._zooming,m=this._rotating,y=this._pitching,x=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,f&&this.fire(new a.l("zoomend",n)),m&&this.fire(new a.l("rotateend",n)),y&&this.fire(new a.l("pitchend",n)),x&&this.fire(new a.l("rollend",n)),this.fire(new a.l("moveend",n))}flyTo(n,s){if(!n.essential&&I.prefersReducedMotion){const We=a.Q(n,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(We,s)}this.stop(),n=a.e({offset:[0,0],speed:1.2,curve:1.42,easing:a.cn},n);const f=this._getTransformForUpdate(),m=f.bearing,y=f.pitch,x=f.roll,M=f.padding,E="bearing"in n?this._normalizeBearing(n.bearing,m):m,z="pitch"in n?+n.pitch:y,B="roll"in n?this._normalizeBearing(n.roll,x):x,j="padding"in n?n.padding:f.padding,N=a.P.convert(n.offset);let V=f.centerPoint.add(N);const Q=f.screenPointToLocation(V),se=this.cameraHelper.handleFlyTo(f,{bearing:E,pitch:z,roll:B,padding:j,locationAtOffset:Q,offsetAsPoint:N,center:n.center,minZoom:n.minZoom,zoom:n.zoom});let oe=n.curve;const le=Math.max(f.width,f.height),de=le/se.scaleOfZoom,_e=se.pixelPathLength;typeof se.scaleOfMinZoom=="number"&&(oe=Math.sqrt(le/se.scaleOfMinZoom/_e*2));const me=oe*oe;function xe(We){const zt=(de*de-le*le+(We?-1:1)*me*me*_e*_e)/(2*(We?de:le)*me*_e);return Math.log(Math.sqrt(zt*zt+1)-zt)}function Te(We){return(Math.exp(We)-Math.exp(-We))/2}function ge(We){return(Math.exp(We)+Math.exp(-We))/2}const ze=xe(!1);let $e=function(We){return ge(ze)/ge(ze+oe*We)},Ne=function(We){return le*((ge(ze)*(Te(zt=ze+oe*We)/ge(zt))-Te(ze))/me)/_e;var zt},je=(xe(!0)-ze)/oe;if(Math.abs(_e)<2e-6||!isFinite(je)){if(Math.abs(le-de)<1e-6)return this.easeTo(n,s);const We=de<le?-1:1;je=Math.abs(Math.log(de/le))/oe,Ne=()=>0,$e=zt=>Math.exp(We*oe*zt)}return n.duration="duration"in n?+n.duration:1e3*je/("screenSpeed"in n?+n.screenSpeed/oe:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0),this._zooming=!0,this._rotating=m!==E,this._pitching=z!==y,this._rolling=B!==x,this._padding=!f.isPaddingEqual(j),this._prepareEase(s,!1),this.terrain&&this._prepareElevation(se.targetCenter),this._ease(We=>{const zt=We*je,Ct=1/$e(zt),ft=Ne(zt);this._rotating&&f.setBearing(a.C.number(m,E,We)),this._pitching&&f.setPitch(a.C.number(y,z,We)),this._rolling&&f.setRoll(a.C.number(x,B,We)),this._padding&&(f.interpolatePadding(M,j,We),V=f.centerPoint.add(N)),se.easeFunc(We,Ct,ft,V),this.terrain&&!n.freezeElevation&&this._updateElevation(We),this._applyUpdatedTransform(f),this._fireMoveEvents(s)},()=>{this.terrain&&n.freezeElevation&&this._finalizeElevation(),this._afterEase(s)},n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(n,s){var f;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const m=this._onEaseEnd;delete this._onEaseEnd,m.call(this,s)}return n||(f=this.handlers)===null||f===void 0||f.stop(!1),this}_ease(n,s,f){f.animate===!1||f.duration===0?(n(1),s()):(this._easeStart=I.now(),this._easeOptions=f,this._onEaseFrame=n,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(n,s){n=a.aN(n,-180,180);const f=Math.abs(n-s);return Math.abs(n-360-s)<f&&(n-=360),Math.abs(n+360-s)<f&&(n+=360),n}queryTerrainElevation(n){return this.terrain?this.terrain.getElevationForLngLatZoom(a.S.convert(n),this.transform.tileZoom):null}}const rc={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class ku{constructor(n=rc){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=s=>{!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"&&s.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=n}getDefaultPosition(){return"bottom-right"}onAdd(n){return this._map=n,this._compact=this.options.compact,this._container=P.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=P.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=P.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){P.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(n,s){const f=this._map._getUIString(`AttributionControl.${s}`);n.title=f,n.setAttribute("aria-label",f)}_updateAttributions(){if(!this._map.style)return;let n=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=n.concat(this.options.customAttribution.map(m=>typeof m!="string"?"":m)):typeof this.options.customAttribution=="string"&&n.push(this.options.customAttribution)),this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const s=this._map.style.sourceCaches;for(const m in s){const y=s[m];if(y.used||y.usedForTerrain){const x=y.getSource();x.attribution&&n.indexOf(x.attribution)<0&&n.push(x.attribution)}}n=n.filter(m=>String(m).trim()),n.sort((m,y)=>m.length-y.length),n=n.filter((m,y)=>{for(let x=y+1;x<n.length;x++)if(n[x].indexOf(m)>=0)return!1;return!0});const f=n.join(" | ");f!==this._attribHTML&&(this._attribHTML=f,n.length?(this._innerContainer.innerHTML=P.sanitize(f),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Df{constructor(n={}){this._updateCompact=()=>{const s=this._container.children;if(s.length){const f=s[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&f.classList.add("maplibregl-compact"):f.classList.remove("maplibregl-compact")}},this.options=n}getDefaultPosition(){return"bottom-left"}onAdd(n){this._map=n,this._compact=this.options&&this.options.compact,this._container=P.create("div","maplibregl-ctrl");const s=P.create("a","maplibregl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://maplibre.org/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){P.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class dm{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const s=++this._id;return this._queue.push({callback:n,id:s,cancelled:!1}),s}remove(n){const s=this._currentlyRunning,f=s?this._queue.concat(s):this._queue;for(const m of f)if(m.id===n)return void(m.cancelled=!0)}run(n=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const s=this._currentlyRunning=this._queue;this._queue=[];for(const f of s)if(!f.cancelled&&(f.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var pm=a.aI([{name:"a_pos3d",type:"Int16",components:3}]);class qy extends a.E{constructor(n){super(),this._lastTilesetChange=I.now(),this.sourceCache=n,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=n._source.tileSize*2**this.deltaZoom,n.usedForTerrain=!0,n.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(n,s){this.sourceCache.update(n,s),this._renderableTilesKeys=[];const f={};for(const m of Ge(n,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:s,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))f[m.key]=!0,this._renderableTilesKeys.push(m.key),this._tiles[m.key]||(m.terrainRttPosMatrix32f=new Float64Array(16),a.bX(m.terrainRttPosMatrix32f,0,a.$,a.$,0,0,1),this._tiles[m.key]=new On(m,this.tileSize),this._lastTilesetChange=I.now());for(const m in this._tiles)f[m]||delete this._tiles[m]}freeRtt(n){for(const s in this._tiles){const f=this._tiles[s];(!n||f.tileID.equals(n)||f.tileID.isChildOf(n)||n.isChildOf(f.tileID))&&(f.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(n=>this.getTileByID(n))}getTileByID(n){return this._tiles[n]}getTerrainCoords(n,s){return s?this._getTerrainCoordsForTileRanges(n,s):this._getTerrainCoordsForRegularTile(n)}_getTerrainCoordsForRegularTile(n){const s={};for(const f of this._renderableTilesKeys){const m=this._tiles[f].tileID,y=n.clone(),x=a.b9();if(m.canonical.equals(n.canonical))a.bX(x,0,a.$,a.$,0,0,1);else if(m.canonical.isChildOf(n.canonical)){const M=m.canonical.z-n.canonical.z,E=m.canonical.x-(m.canonical.x>>M<<M),z=m.canonical.y-(m.canonical.y>>M<<M),B=a.$>>M;a.bX(x,0,B,B,0,0,1),a.M(x,x,[-E*B,-z*B,0])}else{if(!n.canonical.isChildOf(m.canonical))continue;{const M=n.canonical.z-m.canonical.z,E=n.canonical.x-(n.canonical.x>>M<<M),z=n.canonical.y-(n.canonical.y>>M<<M),B=a.$>>M;a.bX(x,0,a.$,a.$,0,0,1),a.M(x,x,[E*B,z*B,0]),a.N(x,x,[1/2**M,1/2**M,0])}}y.terrainRttPosMatrix32f=new Float32Array(x),s[f]=y}return s}_getTerrainCoordsForTileRanges(n,s){const f={};for(const m of this._renderableTilesKeys){const y=this._tiles[m].tileID;if(!this._isWithinTileRanges(y,s))continue;const x=n.clone(),M=a.b9();if(y.canonical.z===n.canonical.z){const E=n.canonical.x-y.canonical.x,z=n.canonical.y-y.canonical.y;a.bX(M,0,a.$,a.$,0,0,1),a.M(M,M,[E*a.$,z*a.$,0])}else if(y.canonical.z>n.canonical.z){const E=y.canonical.z-n.canonical.z,z=y.canonical.x-(y.canonical.x>>E<<E),B=y.canonical.y-(y.canonical.y>>E<<E),j=n.canonical.x-(y.canonical.x>>E),N=n.canonical.y-(y.canonical.y>>E),V=a.$>>E;a.bX(M,0,V,V,0,0,1),a.M(M,M,[-z*V+j*a.$,-B*V+N*a.$,0])}else{const E=n.canonical.z-y.canonical.z,z=n.canonical.x-(n.canonical.x>>E<<E),B=n.canonical.y-(n.canonical.y>>E<<E),j=(n.canonical.x>>E)-y.canonical.x,N=(n.canonical.y>>E)-y.canonical.y,V=a.$<<E;a.bX(M,0,V,V,0,0,1),a.M(M,M,[z*a.$+j*V,B*a.$+N*V,0])}x.terrainRttPosMatrix32f=new Float32Array(M),f[m]=x}return f}getSourceTile(n,s){const f=this.sourceCache._source;let m=n.overscaledZ-this.deltaZoom;if(m>f.maxzoom&&(m=f.maxzoom),m<f.minzoom)return null;this._sourceTileCache[n.key]||(this._sourceTileCache[n.key]=n.scaledTo(m).key);let y=this.sourceCache.getTileByID(this._sourceTileCache[n.key]);if((!y||!y.dem)&&s)for(;m>=f.minzoom&&(!y||!y.dem);)y=this.sourceCache.getTileByID(n.scaledTo(m--).key);return y}anyTilesAfterTime(n=Date.now()){return this._lastTilesetChange>=n}_isWithinTileRanges(n,s){return s[n.canonical.z]&&n.canonical.x>=s[n.canonical.z].minTileX&&n.canonical.x<=s[n.canonical.z].maxTileX&&n.canonical.y>=s[n.canonical.z].minTileY&&n.canonical.y<=s[n.canonical.z].maxTileY}}class ja{constructor(n,s,f){this._meshCache={},this.painter=n,this.sourceCache=new qy(s),this.options=f,this.exaggeration=typeof f.exaggeration=="number"?f.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(n,s,f,m=a.$){var y;if(!(s>=0&&s<m&&f>=0&&f<m))return 0;const x=this.getTerrainData(n),M=(y=x.tile)===null||y===void 0?void 0:y.dem;if(!M)return 0;const E=a.cr([],[s/m*a.$,f/m*a.$],x.u_terrain_matrix),z=[E[0]*M.dim,E[1]*M.dim],B=Math.floor(z[0]),j=Math.floor(z[1]),N=z[0]-B,V=z[1]-j;return M.get(B,j)*(1-N)*(1-V)+M.get(B+1,j)*N*(1-V)+M.get(B,j+1)*(1-N)*V+M.get(B+1,j+1)*N*V}getElevationForLngLatZoom(n,s){if(!a.cs(s,n.wrap()))return 0;const{tileID:f,mercatorX:m,mercatorY:y}=this._getOverscaledTileIDFromLngLatZoom(n,s);return this.getElevation(f,m%a.$,y%a.$,a.$)}getElevation(n,s,f,m=a.$){return this.getDEMElevation(n,s,f,m)*this.exaggeration}getTerrainData(n){if(!this._emptyDemTexture){const m=this.painter.context,y=new a.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new a.T(m,y,m.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new a.T(m,new a.R({width:1,height:1}),m.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=a.af([])}const s=this.sourceCache.getSourceTile(n,!0);if(s&&s.dem&&(!s.demTexture||s.needsTerrainPrepare)){const m=this.painter.context;s.demTexture=this.painter.getTileTexture(s.dem.stride),s.demTexture?s.demTexture.update(s.dem.getPixels(),{premultiply:!1}):s.demTexture=new a.T(m,s.dem.getPixels(),m.gl.RGBA,{premultiply:!1}),s.demTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),s.needsTerrainPrepare=!1}const f=s&&s+s.tileID.key+n.key;if(f&&!this._demMatrixCache[f]){const m=this.sourceCache.sourceCache._source.maxzoom;let y=n.canonical.z-s.tileID.canonical.z;n.overscaledZ>n.canonical.z&&(n.canonical.z>=m?y=n.canonical.z-m:a.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const x=n.canonical.x-(n.canonical.x>>y<<y),M=n.canonical.y-(n.canonical.y>>y<<y),E=a.ct(new Float64Array(16),[1/(a.$<<y),1/(a.$<<y),0]);a.M(E,E,[x*a.$,M*a.$,0]),this._demMatrixCache[n.key]={matrix:E,coord:n}}return{u_depth:2,u_terrain:3,u_terrain_dim:s&&s.dem&&s.dem.dim||1,u_terrain_matrix:f?this._demMatrixCache[n.key].matrix:this._emptyDemMatrix,u_terrain_unpack:s&&s.dem&&s.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(s&&s.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:s}}getFramebuffer(n){const s=this.painter,f=s.width/devicePixelRatio,m=s.height/devicePixelRatio;return!this._fbo||this._fbo.width===f&&this._fbo.height===m||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new a.T(s.context,{width:f,height:m,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new a.T(s.context,{width:f,height:m,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=s.context.createFramebuffer(f,m,!0,!1),this._fbo.depthAttachment.set(s.context.createRenderbuffer(s.context.gl.DEPTH_COMPONENT16,f,m))),this._fbo.colorAttachment.set(n==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const n=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const s=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let y=0,x=0;y<this._coordsTextureSize;y++)for(let M=0;M<this._coordsTextureSize;M++,x+=4)s[x+0]=255&M,s[x+1]=255&y,s[x+2]=M>>8<<4|y>>8,s[x+3]=0;const f=new a.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(s.buffer)),m=new a.T(n,f,n.gl.RGBA,{premultiply:!1});return m.bind(n.gl.NEAREST,n.gl.CLAMP_TO_EDGE),this._coordsTexture=m,m}pointCoordinate(n){this.painter.maybeDrawDepthAndCoords(!0);const s=new Uint8Array(4),f=this.painter.context,m=f.gl,y=Math.round(n.x*this.painter.pixelRatio/devicePixelRatio),x=Math.round(n.y*this.painter.pixelRatio/devicePixelRatio),M=Math.round(this.painter.height/devicePixelRatio);f.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),m.readPixels(y,M-x-1,1,1,m.RGBA,m.UNSIGNED_BYTE,s),f.bindFramebuffer.set(null);const E=s[0]+(s[2]>>4<<8),z=s[1]+((15&s[2])<<8),B=this.coordsIndex[255-s[3]],j=B&&this.sourceCache.getTileByID(B);if(!j)return null;const N=this._coordsTextureSize,V=(1<<j.tileID.canonical.z)*N;return new a.a0((j.tileID.canonical.x*N+E)/V+j.tileID.wrap,(j.tileID.canonical.y*N+z)/V,this.getElevation(j.tileID,E,z,N))}depthAtPoint(n){const s=new Uint8Array(4),f=this.painter.context,m=f.gl;return f.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),m.readPixels(n.x,this.painter.height/devicePixelRatio-n.y-1,1,1,m.RGBA,m.UNSIGNED_BYTE,s),f.bindFramebuffer.set(null),(s[0]/16777216+s[1]/65536+s[2]/256+s[3])/256}getTerrainMesh(n){var s;const f=((s=this.painter.style.projection)===null||s===void 0?void 0:s.transitionState)>0,m=f&&n.canonical.y===0,y=f&&n.canonical.y===(1<<n.canonical.z)-1,x=`m_${m?"n":""}_${y?"s":""}`;if(this._meshCache[x])return this._meshCache[x];const M=this.painter.context,E=new a.cu,z=new a.aM,B=this.meshSize,j=a.$/B,N=B*B;for(let ge=0;ge<=B;ge++)for(let ze=0;ze<=B;ze++)E.emplaceBack(ze*j,ge*j,0);for(let ge=0;ge<N;ge+=B+1)for(let ze=0;ze<B;ze++)z.emplaceBack(ze+ge,B+ze+ge+1,B+ze+ge+2),z.emplaceBack(ze+ge,B+ze+ge+2,ze+ge+1);const V=E.length,Q=V+(B+1),se=(B+1)*B,oe=m?a.bg:0,le=m?0:1,de=y?a.bh:a.$,_e=y?0:1;for(let ge=0;ge<=B;ge++)E.emplaceBack(ge*j,oe,le);for(let ge=0;ge<=B;ge++)E.emplaceBack(ge*j,de,_e);for(let ge=0;ge<B;ge++)z.emplaceBack(se+ge,Q+ge,Q+ge+1),z.emplaceBack(se+ge,Q+ge+1,se+ge+1),z.emplaceBack(0+ge,V+ge+1,V+ge),z.emplaceBack(0+ge,0+ge+1,V+ge+1);const me=E.length,xe=me+2*(B+1);for(const ge of[0,1])for(let ze=0;ze<=B;ze++)for(const $e of[0,1])E.emplaceBack(ge*a.$,ze*j,$e);for(let ge=0;ge<2*B;ge+=2)z.emplaceBack(me+ge,me+ge+1,me+ge+3),z.emplaceBack(me+ge,me+ge+3,me+ge+2),z.emplaceBack(xe+ge,xe+ge+3,xe+ge+1),z.emplaceBack(xe+ge,xe+ge+2,xe+ge+3);const Te=new to(M.createVertexBuffer(E,pm.members),M.createIndexBuffer(z),a.aL.simpleSegment(0,0,E.length,z.length));return this._meshCache[x]=Te,Te}getMeshFrameDelta(n){return 2*Math.PI*a.bt/Math.pow(2,Math.max(n,0))/5}getMinTileElevationForLngLatZoom(n,s){var f;const{tileID:m}=this._getOverscaledTileIDFromLngLatZoom(n,s);return(f=this.getMinMaxElevation(m).minElevation)!==null&&f!==void 0?f:0}getMinMaxElevation(n){const s=this.getTerrainData(n).tile,f={minElevation:null,maxElevation:null};return s&&s.dem&&(f.minElevation=s.dem.min*this.exaggeration,f.maxElevation=s.dem.max*this.exaggeration),f}_getOverscaledTileIDFromLngLatZoom(n,s){const f=a.a0.fromLngLat(n.wrap()),m=(1<<s)*a.$,y=f.x*m,x=f.y*m,M=Math.floor(y/a.$),E=Math.floor(x/a.$);return{tileID:new a.Z(s,0,s,M,E),mercatorX:y,mercatorY:x}}}class Du{constructor(n,s,f){this._context=n,this._size=s,this._tileSize=f,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const n of this._objects)n.texture.destroy(),n.fbo.destroy()}_createObject(n){const s=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),f=new a.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return f.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),s.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),s.colorAttachment.set(f.texture),{id:n,fbo:s,texture:f,stamp:-1,inUse:!1}}getObjectForId(n){return this._objects[n]}useObject(n){n.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(s=>n.id!==s),this._recentlyUsed.push(n.id)}stampObject(n){n.stamp=++this._stamp}getOrCreateFreeObject(){for(const s of this._recentlyUsed)if(!this._objects[s].inUse)return this._objects[s];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const n=this._createObject(this._objects.length);return this._objects.push(n),n}freeObject(n){n.inUse=!1}freeAllObjects(){for(const n of this._objects)this.freeObject(n)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(n=>!n.inUse)===!1}}const Qt={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class un{constructor(n,s){this.painter=n,this.terrain=s,this.pool=new Du(n.context,30,s.sourceCache.tileSize*s.qualityFactor)}destruct(){this.pool.destruct()}getTexture(n){return this.pool.getObjectForId(n.rtt[this._stacks.length-1].id).texture}prepareForRender(n,s){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=n._order.filter(f=>!n._layers[f].isHidden(s)),this._coordsAscending={};for(const f in n.sourceCaches){this._coordsAscending[f]={};const m=n.sourceCaches[f].getVisibleCoordinates(),y=n.sourceCaches[f].getSource(),x=y instanceof Mt?y.terrainTileRanges:null;for(const M of m){const E=this.terrain.sourceCache.getTerrainCoords(M,x);for(const z in E)this._coordsAscending[f][z]||(this._coordsAscending[f][z]=[]),this._coordsAscending[f][z].push(E[z])}}this._coordsAscendingStr={};for(const f of n._order){const m=n._layers[f],y=m.source;if(Qt[m.type]&&!this._coordsAscendingStr[y]){this._coordsAscendingStr[y]={};for(const x in this._coordsAscending[y])this._coordsAscendingStr[y][x]=this._coordsAscending[y][x].map(M=>M.key).sort().join()}}for(const f of this._renderableTiles)for(const m in this._coordsAscendingStr){const y=this._coordsAscendingStr[m][f.tileID.key];y&&y!==f.rttCoords[m]&&(f.rtt=[])}}renderLayer(n,s){if(n.isHidden(this.painter.transform.zoom))return!1;const f=Object.assign(Object.assign({},s),{isRenderingToTexture:!0}),m=n.type,y=this.painter,x=this._renderableLayerIds[this._renderableLayerIds.length-1]===n.id;if(Qt[m]&&(this._prevType&&Qt[this._prevType]||this._stacks.push([]),this._prevType=m,this._stacks[this._stacks.length-1].push(n.id),!x))return!0;if(Qt[this._prevType]||Qt[m]&&x){this._prevType=m;const M=this._stacks.length-1,E=this._stacks[M]||[];for(const z of this._renderableTiles){if(this.pool.isFull()&&(Oi(this.painter,this.terrain,this._rttTiles,f),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(z),z.rtt[M]){const j=this.pool.getObjectForId(z.rtt[M].id);if(j.stamp===z.rtt[M].stamp){this.pool.useObject(j);continue}}const B=this.pool.getOrCreateFreeObject();this.pool.useObject(B),this.pool.stampObject(B),z.rtt[M]={id:B.id,stamp:B.stamp},y.context.bindFramebuffer.set(B.fbo.framebuffer),y.context.clear({color:a.be.transparent,stencil:0}),y.currentStencilSource=void 0;for(let j=0;j<E.length;j++){const N=y.style._layers[E[j]],V=N.source?this._coordsAscending[N.source][z.tileID.key]:[z.tileID];y.context.viewport.set([0,0,B.fbo.width,B.fbo.height]),y._renderTileClippingMasks(N,V,!0),y.renderLayer(y,y.style.sourceCaches[N.source],N,V,f),N.source&&(z.rttCoords[N.source]=this._coordsAscendingStr[N.source][z.tileID.key])}}return Oi(this.painter,this.terrain,this._rttTiles,f),this._rttTiles=[],this.pool.freeAllObjects(),Qt[m]}return!1}}const zu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use â + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},zf=w,ac={hash:!1,interactive:!0,bearingSnap:7,attributionControl:rc,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:a.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},Br={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class mm{constructor(n,s,f=!1){this.mousedown=y=>{this.startMove(y,P.mousePos(this.element,y)),P.addEventListener(window,"mousemove",this.mousemove),P.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=y=>{this.move(y,P.mousePos(this.element,y))},this.mouseup=y=>{this._rotatePitchHanlder.dragEnd(y),this.offTemp()},this.touchstart=y=>{y.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=P.touchPos(this.element,y.targetTouches)[0],this.startMove(y,this._startPos),P.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),P.addEventListener(window,"touchend",this.touchend))},this.touchmove=y=>{y.targetTouches.length!==1?this.reset():(this._lastPos=P.touchPos(this.element,y.targetTouches)[0],this.move(y,this._lastPos))},this.touchend=y=>{y.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHanlder.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=s;const m=new Ny;this._rotatePitchHanlder=new il({clickTolerance:3,move:(y,x)=>{const M=s.getBoundingClientRect(),E=new a.P((M.bottom-M.top)/2,(M.right-M.left)/2);return{bearingDelta:a.cm(new a.P(y.x,x.y),x,E),pitchDelta:f?-.5*(x.y-y.y):void 0}},moveStateManager:m,enable:!0,assignEvents:()=>{}}),this.map=n,P.addEventListener(s,"mousedown",this.mousedown),P.addEventListener(s,"touchstart",this.touchstart,{passive:!1}),P.addEventListener(s,"touchcancel",this.reset)}startMove(n,s){this._rotatePitchHanlder.dragStart(n,s),P.disableDrag()}move(n,s){const f=this.map,{bearingDelta:m,pitchDelta:y}=this._rotatePitchHanlder.dragMove(n,s)||{};m&&f.setBearing(f.getBearing()+m),y&&f.setPitch(f.getPitch()+y)}off(){const n=this.element;P.removeEventListener(n,"mousedown",this.mousedown),P.removeEventListener(n,"touchstart",this.touchstart,{passive:!1}),P.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),P.removeEventListener(window,"touchend",this.touchend),P.removeEventListener(n,"touchcancel",this.reset),this.offTemp()}offTemp(){P.enableDrag(),P.removeEventListener(window,"mousemove",this.mousemove),P.removeEventListener(window,"mouseup",this.mouseup),P.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),P.removeEventListener(window,"touchend",this.touchend)}}let mr;function gm(_,n,s,f=!1){if(f||!s.getCoveringTilesDetailsProvider().allowWorldCopies())return _==null?void 0:_.wrap();const m=new a.S(_.lng,_.lat);if(_=new a.S(_.lng,_.lat),n){const y=new a.S(_.lng-360,_.lat),x=new a.S(_.lng+360,_.lat),M=s.locationToScreenPoint(_).distSqr(n);s.locationToScreenPoint(y).distSqr(n)<M?_=y:s.locationToScreenPoint(x).distSqr(n)<M&&(_=x)}for(;Math.abs(_.lng-s.center.lng)>180;){const y=s.locationToScreenPoint(_);if(y.x>=0&&y.y>=0&&y.x<=s.width&&y.y<=s.height)break;_.lng>s.center.lng?_.lng-=360:_.lng+=360}return _.lng!==m.lng&&s.isPointOnMapSurface(s.locationToScreenPoint(_))?_:m}const cs={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ri(_,n,s){const f=_.classList;for(const m in cs)f.remove(`maplibregl-${s}-anchor-${m}`);f.add(`maplibregl-${s}-anchor-${n}`)}class Ni extends a.E{constructor(n){if(super(),this._onKeyPress=s=>{const f=s.code,m=s.charCode||s.keyCode;f!=="Space"&&f!=="Enter"&&m!==32&&m!==13||this.togglePopup()},this._onMapClick=s=>{const f=s.originalEvent.target,m=this._element;this._popup&&(f===m||m.contains(f))&&this.togglePopup()},this._update=s=>{if(!this._map)return;const f=this._map.loaded()&&!this._map.isMoving();((s==null?void 0:s.type)==="terrain"||(s==null?void 0:s.type)==="render"&&!f)&&this._map.once("render",this._update),this._lngLat=gm(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let m="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?m=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(m=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let y="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?y="rotateX(0deg)":this._pitchAlignment==="map"&&(y=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||s&&s.type!=="moveend"||(this._pos=this._pos.round()),P.setTransform(this._element,`${cs[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${y} ${m}`),I.frameAsync(new AbortController).then(()=>{this._updateOpacity(s&&s.type==="moveend")}).catch(()=>{})},this._onMove=s=>{if(!this._isDragging){const f=this._clickTolerance||this._map._clickTolerance;this._isDragging=s.point.dist(this._pointerdownPos)>=f}this._isDragging&&(this._pos=s.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.l("dragstart"))),this.fire(new a.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.l("dragend")),this._state="inactive"},this._addDragHandler=s=>{this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(this._pos).add(this._offset),this._pointerdownPos=s.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._subpixelPositioning=n&&n.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&n.pitchAlignment!=="auto"?n.pitchAlignment:this._rotationAlignment,this.setOpacity(n==null?void 0:n.opacity,n==null?void 0:n.opacityWhenCovered),n&&n.element)this._element=n.element,this._offset=a.P.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=P.create("div");const s=P.createNS("http://www.w3.org/2000/svg","svg"),f=41,m=27;s.setAttributeNS(null,"display","block"),s.setAttributeNS(null,"height",`${f}px`),s.setAttributeNS(null,"width",`${m}px`),s.setAttributeNS(null,"viewBox",`0 0 ${m} ${f}`);const y=P.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"stroke","none"),y.setAttributeNS(null,"stroke-width","1"),y.setAttributeNS(null,"fill","none"),y.setAttributeNS(null,"fill-rule","evenodd");const x=P.createNS("http://www.w3.org/2000/svg","g");x.setAttributeNS(null,"fill-rule","nonzero");const M=P.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"transform","translate(3.0, 29.0)"),M.setAttributeNS(null,"fill","#000000");const E=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const le of E){const de=P.createNS("http://www.w3.org/2000/svg","ellipse");de.setAttributeNS(null,"opacity","0.04"),de.setAttributeNS(null,"cx","10.5"),de.setAttributeNS(null,"cy","5.80029008"),de.setAttributeNS(null,"rx",le.rx),de.setAttributeNS(null,"ry",le.ry),M.appendChild(de)}const z=P.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"fill",this._color);const B=P.createNS("http://www.w3.org/2000/svg","path");B.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),z.appendChild(B);const j=P.createNS("http://www.w3.org/2000/svg","g");j.setAttributeNS(null,"opacity","0.25"),j.setAttributeNS(null,"fill","#000000");const N=P.createNS("http://www.w3.org/2000/svg","path");N.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),j.appendChild(N);const V=P.createNS("http://www.w3.org/2000/svg","g");V.setAttributeNS(null,"transform","translate(6.0, 7.0)"),V.setAttributeNS(null,"fill","#FFFFFF");const Q=P.createNS("http://www.w3.org/2000/svg","g");Q.setAttributeNS(null,"transform","translate(8.0, 8.0)");const se=P.createNS("http://www.w3.org/2000/svg","circle");se.setAttributeNS(null,"fill","#000000"),se.setAttributeNS(null,"opacity","0.25"),se.setAttributeNS(null,"cx","5.5"),se.setAttributeNS(null,"cy","5.5"),se.setAttributeNS(null,"r","5.4999962");const oe=P.createNS("http://www.w3.org/2000/svg","circle");oe.setAttributeNS(null,"fill","#FFFFFF"),oe.setAttributeNS(null,"cx","5.5"),oe.setAttributeNS(null,"cy","5.5"),oe.setAttributeNS(null,"r","5.4999962"),Q.appendChild(se),Q.appendChild(oe),x.appendChild(M),x.appendChild(z),x.appendChild(j),x.appendChild(V),x.appendChild(Q),s.appendChild(x),s.setAttributeNS(null,"height",f*this._scale+"px"),s.setAttributeNS(null,"width",m*this._scale+"px"),this._element.appendChild(s),this._offset=a.P.convert(n&&n.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",s=>{s.preventDefault()}),this._element.addEventListener("mousedown",s=>{s.preventDefault()}),Ri(this._element,this._anchor,"marker"),n&&n.className)for(const s of n.className.split(" "))this._element.classList.add(s);this._popup=null}addTo(n){return this.remove(),this._map=n,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",n._getUIString("Marker.Title")),n.getCanvasContainer().appendChild(this._element),n.on("move",this._update),n.on("moveend",this._update),n.on("terrain",this._update),n.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),P.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=a.S.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const m=Math.abs(13.5)/Math.SQRT2;n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=n,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(n){return this._subpixelPositioning=n,this}getPopup(){return this._popup}togglePopup(){const n=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:n?(n.isOpen()?n.remove():(n.setLngLat(this._lngLat),n.addTo(this._map)),this):this}_updateOpacity(n=!1){var s,f;const m=(s=this._map)===null||s===void 0?void 0:s.terrain,y=this._map.transform.isLocationOccluded(this._lngLat);if(!m||y){const V=y?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==V&&(this._element.style.opacity=V))}if(n)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const x=this._map,M=x.terrain.depthAtPoint(this._pos),E=x.terrain.getElevationForLngLatZoom(this._lngLat,x.transform.tileZoom);if(x.transform.lngLatToCameraDepth(this._lngLat,E)-M<.006)return void(this._element.style.opacity=this._opacity);const z=-this._offset.y/x.transform.pixelsPerMeter,B=Math.sin(x.getPitch()*Math.PI/180)*z,j=x.terrain.depthAtPoint(new a.P(this._pos.x,this._pos.y-this._offset.y)),N=x.transform.lngLatToCameraDepth(this._lngLat,E+B)-j>.006;!((f=this._popup)===null||f===void 0)&&f.isOpen()&&N&&this._popup.remove(),this._element.style.opacity=N?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(n){return this._offset=a.P.convert(n),this._update(),this}addClassName(n){this._element.classList.add(n)}removeClassName(n){this._element.classList.remove(n)}toggleClassName(n){return this._element.classList.toggle(n)}setDraggable(n){return this._draggable=!!n,this._map&&(n?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n&&n!=="auto"?n:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(n,s){return(this._opacity===void 0||n===void 0&&s===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),n!==void 0&&(this._opacity=n),s!==void 0&&(this._opacityWhenCovered=s),this._map&&this._updateOpacity(!0),this}}const _m={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Eo=0,Po=!1;const Rf={maxWidth:100,unit:"metric"};function Ru(_,n,s){const f=s&&s.maxWidth||100,m=_._container.clientHeight/2,y=_._container.clientWidth/2,x=_.unproject([y-f/2,m]),M=_.unproject([y+f/2,m]),E=Math.round(_.project(M).x-_.project(x).x),z=Math.min(f,E,_._container.clientWidth),B=x.distanceTo(M);if(s&&s.unit==="imperial"){const j=3.2808*B;j>5280?us(n,z,j/5280,_._getUIString("ScaleControl.Miles")):us(n,z,j,_._getUIString("ScaleControl.Feet"))}else s&&s.unit==="nautical"?us(n,z,B/1852,_._getUIString("ScaleControl.NauticalMiles")):B>=1e3?us(n,z,B/1e3,_._getUIString("ScaleControl.Kilometers")):us(n,z,B,_._getUIString("ScaleControl.Meters"))}function us(_,n,s,f){const m=function(y){const x=Math.pow(10,`${Math.floor(y)}`.length-1);let M=y/x;return M=M>=10?10:M>=5?5:M>=3?3:M>=2?2:M>=1?1:function(E){const z=Math.pow(10,Math.ceil(-Math.log(E)/Math.LN10));return Math.round(E*z)/z}(M),x*M}(s);_.style.width=n*(m/s)+"px",_.innerHTML=`${m}&nbsp;${f}`}const oc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},Lf=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Lu(_){if(_){if(typeof _=="number"){const n=Math.round(Math.abs(_)/Math.SQRT2);return{center:new a.P(0,0),top:new a.P(0,_),"top-left":new a.P(n,n),"top-right":new a.P(-n,n),bottom:new a.P(0,-_),"bottom-left":new a.P(n,-n),"bottom-right":new a.P(-n,-n),left:new a.P(_,0),right:new a.P(-_,0)}}if(_ instanceof a.P||Array.isArray(_)){const n=a.P.convert(_);return{center:n,top:n,"top-left":n,"top-right":n,bottom:n,"bottom-left":n,"bottom-right":n,left:n,right:n}}return{center:a.P.convert(_.center||[0,0]),top:a.P.convert(_.top||[0,0]),"top-left":a.P.convert(_["top-left"]||[0,0]),"top-right":a.P.convert(_["top-right"]||[0,0]),bottom:a.P.convert(_.bottom||[0,0]),"bottom-left":a.P.convert(_["bottom-left"]||[0,0]),"bottom-right":a.P.convert(_["bottom-right"]||[0,0]),left:a.P.convert(_.left||[0,0]),right:a.P.convert(_.right||[0,0])}}return Lu(new a.P(0,0))}const Bf=w;p.AJAXError=a.cy,p.Event=a.l,p.Evented=a.E,p.LngLat=a.S,p.MercatorCoordinate=a.a0,p.Point=a.P,p.addProtocol=a.cz,p.config=a.a,p.removeProtocol=a.cA,p.AttributionControl=ku,p.BoxZoomHandler=Af,p.CanvasSource=_n,p.CooperativeGesturesHandler=fm,p.DoubleClickZoomHandler=Eu,p.DragPanHandler=Ef,p.DragRotateHandler=Pu,p.EdgeInsets=da,p.FullscreenControl=class extends a.E{constructor(_={}){super(),this._onFullscreenChange=()=>{var n;let s=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((n=s==null?void 0:s.shadowRoot)===null||n===void 0)&&n.fullscreenElement;)s=s.shadowRoot.fullscreenElement;s===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,_&&_.container&&(_.container instanceof HTMLElement?this._container=_.container:a.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(_){return this._map=_,this._container||(this._container=this._map.getContainer()),this._controlContainer=P.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){P.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const _=this._fullscreenButton=P.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);P.create("span","maplibregl-ctrl-icon",_).setAttribute("aria-hidden","true"),_.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const _=this._getTitle();this._fullscreenButton.setAttribute("aria-label",_),this._fullscreenButton.title=_}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new a.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new a.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},p.GeoJSONSource=qe,p.GeolocateControl=class extends a.E{constructor(_){super(),this._onSuccess=n=>{if(this._map){if(this._isOutOfMapMaxBounds(n))return this._setErrorState(),this.fire(new a.l("outofmaxbounds",n)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=n,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(n),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(n),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new a.l("geolocate",n)),this._finish()}},this._updateCamera=n=>{const s=new a.S(n.coords.longitude,n.coords.latitude),f=n.coords.accuracy,m=this._map.getBearing(),y=a.e({bearing:m},this.options.fitBoundsOptions),x=wt.fromLngLat(s,f);this._map.fitBounds(x,y,{geolocateSource:!0})},this._updateMarker=n=>{if(n){const s=new a.S(n.coords.longitude,n.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=n.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=n=>{if(this._map){if(n.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(n.code===3&&Po)return;this.options.trackUserLocation&&this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new a.l("error",n)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=P.create("button","maplibregl-ctrl-geolocate",this._container),P.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=n=>{if(this._map){if(n===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=P.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Ni({element:this._dotElement}),this._circleElement=P.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ni({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||s.originalEvent&&s.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new a.l("trackuserlocationend")),this.fire(new a.l("userlocationlostfocus")))})}},this.options=a.e({},_m,_)}onAdd(_){return this._map=_,this._container=P.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return a._(this,arguments,void 0,function*(n=!1){if(mr!==void 0&&!n)return mr;if(window.navigator.permissions===void 0)return mr=!!window.navigator.geolocation,mr;try{mr=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{mr=!!window.navigator.geolocation}return mr})}().then(n=>this._finishSetupUI(n)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),P.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Eo=0,Po=!1}_isOutOfMapMaxBounds(_){const n=this._map.getMaxBounds(),s=_.coords;return n&&(s.longitude<n.getWest()||s.longitude>n.getEast()||s.latitude<n.getSouth()||s.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const _=this._map.getBounds(),n=_.getSouthEast(),s=_.getNorthEast(),f=n.distanceTo(s),m=Math.ceil(this._accuracy/(f/this._map._container.clientHeight)*2);this._circleElement.style.width=`${m}px`,this._circleElement.style.height=`${m}px`}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Eo--,Po=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new a.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.l("trackuserlocationstart")),this.fire(new a.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let _;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Eo++,Eo>1?(_={maximumAge:6e5,timeout:0},Po=!0):(_=this.options.positionOptions,Po=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,_)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},p.GlobeControl=class{constructor(){this._toggleProjection=()=>{var _;const n=(_=this._map.getProjection())===null||_===void 0?void 0:_.type;this._map.setProjection(n!=="mercator"&&n?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var _;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((_=this._map.getProjection())===null||_===void 0?void 0:_.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(_){return this._map=_,this._container=P.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=P.create("button","maplibregl-ctrl-globe",this._container),P.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){P.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},p.Hash=Kl,p.ImageSource=Mt,p.KeyboardHandler=ol,p.LngLatBounds=wt,p.LogoControl=Df,p.Map=class extends Pi{constructor(_){var n,s;a.cv.mark(a.cw.create);const f=Object.assign(Object.assign(Object.assign({},ac),_),{canvasContextAttributes:Object.assign(Object.assign({},ac.canvasContextAttributes),_.canvasContextAttributes)});if(f.minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const m=new Zi,y=new ru;if(f.minZoom!==void 0&&m.setMinZoom(f.minZoom),f.maxZoom!==void 0&&m.setMaxZoom(f.maxZoom),f.minPitch!==void 0&&m.setMinPitch(f.minPitch),f.maxPitch!==void 0&&m.setMaxPitch(f.maxPitch),f.renderWorldCopies!==void 0&&m.setRenderWorldCopies(f.renderWorldCopies),super(m,y,{bearingSnap:f.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new dm,this._controls=[],this._mapId=a.a6(),this._contextLost=M=>{M.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new a.l("webglcontextlost",{originalEvent:M}))},this._contextRestored=M=>{this._setupPainter(),this.resize(),this._update(),this.fire(new a.l("webglcontextrestored",{originalEvent:M}))},this._onMapScroll=M=>{if(M.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=f.interactive,this._maxTileCacheSize=f.maxTileCacheSize,this._maxTileCacheZoomLevels=f.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},f.canvasContextAttributes),this._trackResize=f.trackResize===!0,this._bearingSnap=f.bearingSnap,this._centerClampedToGround=f.centerClampedToGround,this._refreshExpiredTiles=f.refreshExpiredTiles===!0,this._fadeDuration=f.fadeDuration,this._crossSourceCollisions=f.crossSourceCollisions===!0,this._collectResourceTiming=f.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},zu),f.locale),this._clickTolerance=f.clickTolerance,this._overridePixelRatio=f.pixelRatio,this._maxCanvasSize=f.maxCanvasSize,this.transformCameraUpdate=f.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=f.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=ee.addThrottleControl(()=>this.isMoving()),this._requestManager=new ce(f.transformRequest),typeof f.container=="string"){if(this._container=document.getElementById(f.container),!this._container)throw new Error(`Container '${f.container}' not found.`)}else{if(!(f.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(f.maxBounds&&this.setMaxBounds(f.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let M=!1;const E=Tu(z=>{this._trackResize&&!this._removed&&(this.resize(z),this.redraw())},50);this._resizeObserver=new ResizeObserver(z=>{M?E(z):M=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Io(this,f),this._hash=f.hash&&new Kl(typeof f.hash=="string"&&f.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:f.center,elevation:f.elevation,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch,roll:f.roll}),f.bounds&&(this.resize(),this.fitBounds(f.bounds,a.e({},f.fitBoundsOptions,{duration:0}))));const x=typeof f.style=="string"||((s=(n=f.style)===null||n===void 0?void 0:n.projection)===null||s===void 0?void 0:s.type)!=="globe";this.resize(null,x),this._localIdeographFontFamily=f.localIdeographFontFamily,this._validateStyle=f.validateStyle,f.style&&this.setStyle(f.style,{localIdeographFontFamily:f.localIdeographFontFamily}),f.attributionControl&&this.addControl(new ku(typeof f.attributionControl=="boolean"?void 0:f.attributionControl)),f.maplibreLogo&&this.addControl(new Df,f.logoPosition),this.on("style.load",()=>{if(x||this._resizeTransform(),this.transform.unmodified){const M=a.Q(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(M)}}),this.on("data",M=>{this._update(M.dataType==="style"),this.fire(new a.l(`${M.dataType}data`,M))}),this.on("dataloading",M=>{this.fire(new a.l(`${M.dataType}dataloading`,M))}),this.on("dataabort",M=>{this.fire(new a.l("sourcedataabort",M))})}_getMapId(){return this._mapId}setGlobalStateProperty(_,n){return this.style.setGlobalStateProperty(_,n),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(_,n){if(n===void 0&&(n=_.getDefaultPosition?_.getDefaultPosition():"top-right"),!_||!_.onAdd)return this.fire(new a.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=_.onAdd(this);this._controls.push(_);const f=this._controlPositions[n];return n.indexOf("bottom")!==-1?f.insertBefore(s,f.firstChild):f.appendChild(s),this}removeControl(_){if(!_||!_.onRemove)return this.fire(new a.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(_);return n>-1&&this._controls.splice(n,1),_.onRemove(this),this}hasControl(_){return this._controls.indexOf(_)>-1}calculateCameraOptionsFromTo(_,n,s,f){return f==null&&this.terrain&&(f=this.terrain.getElevationForLngLatZoom(s,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(_,n,s,f)}resize(_,n=!0){const[s,f]=this._containerDimensions(),m=this._getClampedPixelRatio(s,f);if(this._resizeCanvas(s,f,m),this.painter.resize(s,f,m),this.painter.overLimit()){const x=this.painter.context.gl;this._maxCanvasSize=[x.drawingBufferWidth,x.drawingBufferHeight];const M=this._getClampedPixelRatio(s,f);this._resizeCanvas(s,f,M),this.painter.resize(s,f,M)}this._resizeTransform(n);const y=!this._moving;return y&&(this.stop(),this.fire(new a.l("movestart",_)).fire(new a.l("move",_))),this.fire(new a.l("resize",_)),y&&this.fire(new a.l("moveend",_)),this}_resizeTransform(_=!0){var n;const[s,f]=this._containerDimensions();this.transform.resize(s,f,_),(n=this._requestedCameraState)===null||n===void 0||n.resize(s,f,_)}_getClampedPixelRatio(_,n){const{0:s,1:f}=this._maxCanvasSize,m=this.getPixelRatio(),y=_*m,x=n*m;return Math.min(y>s?s/y:1,x>f?f/x:1)*m}getPixelRatio(){var _;return(_=this._overridePixelRatio)!==null&&_!==void 0?_:devicePixelRatio}setPixelRatio(_){this._overridePixelRatio=_,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(_){return this.transform.setMaxBounds(wt.convert(_)),this._update()}setMinZoom(_){if((_=_??-2)>=-2&&_<=this.transform.maxZoom)return this.transform.setMinZoom(_),this._update(),this.getZoom()<_&&this.setZoom(_),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(_){if((_=_??22)>=this.transform.minZoom)return this.transform.setMaxZoom(_),this._update(),this.getZoom()>_&&this.setZoom(_),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(_){if((_=_??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(_>=0&&_<=this.transform.maxPitch)return this.transform.setMinPitch(_),this._update(),this.getPitch()<_&&this.setPitch(_),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(_){if((_=_??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(_>=this.transform.minPitch)return this.transform.setMaxPitch(_),this._update(),this.getPitch()>_&&this.setPitch(_),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(_){return this.transform.setRenderWorldCopies(_),this._update()}project(_){return this.transform.locationToScreenPoint(a.S.convert(_),this.style&&this.terrain)}unproject(_){return this.transform.screenPointToLocation(a.P.convert(_),this.terrain)}isMoving(){var _;return this._moving||((_=this.handlers)===null||_===void 0?void 0:_.isMoving())}isZooming(){var _;return this._zooming||((_=this.handlers)===null||_===void 0?void 0:_.isZooming())}isRotating(){var _;return this._rotating||((_=this.handlers)===null||_===void 0?void 0:_.isRotating())}_createDelegatedListener(_,n,s){if(_==="mouseenter"||_==="mouseover"){let f=!1;return{layers:n,listener:s,delegates:{mousemove:y=>{const x=n.filter(E=>this.getLayer(E)),M=x.length!==0?this.queryRenderedFeatures(y.point,{layers:x}):[];M.length?f||(f=!0,s.call(this,new $r(_,this,y.originalEvent,{features:M}))):f=!1},mouseout:()=>{f=!1}}}}if(_==="mouseleave"||_==="mouseout"){let f=!1;return{layers:n,listener:s,delegates:{mousemove:x=>{const M=n.filter(E=>this.getLayer(E));(M.length!==0?this.queryRenderedFeatures(x.point,{layers:M}):[]).length?f=!0:f&&(f=!1,s.call(this,new $r(_,this,x.originalEvent)))},mouseout:x=>{f&&(f=!1,s.call(this,new $r(_,this,x.originalEvent)))}}}}{const f=m=>{const y=n.filter(M=>this.getLayer(M)),x=y.length!==0?this.queryRenderedFeatures(m.point,{layers:y}):[];x.length&&(m.features=x,s.call(this,m),delete m.features)};return{layers:n,listener:s,delegates:{[_]:f}}}}_saveDelegatedListener(_,n){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[_]=this._delegatedListeners[_]||[],this._delegatedListeners[_].push(n)}_removeDelegatedListener(_,n,s){if(!this._delegatedListeners||!this._delegatedListeners[_])return;const f=this._delegatedListeners[_];for(let m=0;m<f.length;m++){const y=f[m];if(y.listener===s&&y.layers.length===n.length&&y.layers.every(x=>n.includes(x))){for(const x in y.delegates)this.off(x,y.delegates[x]);return void f.splice(m,1)}}}on(_,n,s){if(s===void 0)return super.on(_,n);const f=typeof n=="string"?[n]:n,m=this._createDelegatedListener(_,f,s);this._saveDelegatedListener(_,m);for(const y in m.delegates)this.on(y,m.delegates[y]);return{unsubscribe:()=>{this._removeDelegatedListener(_,f,s)}}}once(_,n,s){if(s===void 0)return super.once(_,n);const f=typeof n=="string"?[n]:n,m=this._createDelegatedListener(_,f,s);for(const y in m.delegates){const x=m.delegates[y];m.delegates[y]=(...M)=>{this._removeDelegatedListener(_,f,s),x(...M)}}this._saveDelegatedListener(_,m);for(const y in m.delegates)this.once(y,m.delegates[y]);return this}off(_,n,s){return s===void 0?super.off(_,n):(this._removeDelegatedListener(_,typeof n=="string"?[n]:n,s),this)}queryRenderedFeatures(_,n){if(!this.style)return[];let s;const f=_ instanceof a.P||Array.isArray(_),m=f?_:[[0,0],[this.transform.width,this.transform.height]];if(n=n||(f?{}:_)||{},m instanceof a.P||typeof m[0]=="number")s=[a.P.convert(m)];else{const y=a.P.convert(m[0]),x=a.P.convert(m[1]);s=[y,new a.P(x.x,y.y),x,new a.P(y.x,x.y),y]}return this.style.queryRenderedFeatures(s,n,this.transform)}querySourceFeatures(_,n){return this.style.querySourceFeatures(_,n)}setStyle(_,n){return(n=a.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},n)).diff!==!1&&n.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&_?(this._diffStyle(_,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._updateStyle(_,n))}setTransformRequest(_){return this._requestManager.setTransformRequest(_),this}_getUIString(_){const n=this._locale[_];if(n==null)throw new Error(`Missing UI string '${_}'`);return n}_updateStyle(_,n){var s,f;if(n.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(_,n));const m=this.style&&n.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!_)),_?(this.style=new Jh(this,n||{}),this.style.setEventedParent(this,{style:this.style}),typeof _=="string"?this.style.loadURL(_,n,m):this.style.loadJSON(_,n,m),this):((f=(s=this.style)===null||s===void 0?void 0:s.projection)===null||f===void 0||f.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Jh(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(_,n){if(typeof _=="string"){const s=this._requestManager.transformRequest(_,"Style");a.j(s,new AbortController).then(f=>{this._updateDiff(f.data,n)}).catch(f=>{f&&this.fire(new a.k(f))})}else typeof _=="object"&&this._updateDiff(_,n)}_updateDiff(_,n){try{this.style.setState(_,n)&&this._update(!0)}catch(s){a.w(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(_,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.w("There is no style added to the map.")}addSource(_,n){return this._lazyInitEmptyStyle(),this.style.addSource(_,n),this._update(!0)}isSourceLoaded(_){const n=this.style&&this.style.sourceCaches[_];if(n!==void 0)return n.loaded();this.fire(new a.k(new Error(`There is no source with ID '${_}'`)))}setTerrain(_){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),_){const n=this.style.sourceCaches[_.source];if(!n)throw new Error(`cannot load terrain, because there exists no source with ID: ${_.source}`);this.terrain===null&&n.reload();for(const s in this.style._layers){const f=this.style._layers[s];f.type==="hillshade"&&f.source===_.source&&a.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),f.type==="color-relief"&&f.source===_.source&&a.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new ja(this.painter,n,_),this.painter.renderToTexture=new un(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=s=>{var f;s.dataType==="style"?this.terrain.sourceCache.freeRtt():s.dataType==="source"&&s.tile&&(s.sourceId!==_.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((f=s.source)===null||f===void 0?void 0:f.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(s.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new a.l("terrain",{terrain:_})),this}getTerrain(){var _,n;return(n=(_=this.terrain)===null||_===void 0?void 0:_.options)!==null&&n!==void 0?n:null}areTilesLoaded(){const _=this.style&&this.style.sourceCaches;for(const n in _){const s=_[n]._tiles;for(const f in s){const m=s[f];if(m.state!=="loaded"&&m.state!=="errored")return!1}}return!0}removeSource(_){return this.style.removeSource(_),this._update(!0)}getSource(_){return this.style.getSource(_)}setSourceTileLodParams(_,n,s){if(s){const f=this.getSource(s);if(!f)throw new Error(`There is no source with ID "${s}", cannot set LOD parameters`);f.calculateTileZoom=Fe(Math.max(1,_),Math.max(1,n))}else for(const f in this.style.sourceCaches)this.style.sourceCaches[f].getSource().calculateTileZoom=Fe(Math.max(1,_),Math.max(1,n));return this._update(!0),this}refreshTiles(_,n){const s=this.style.sourceCaches[_];if(!s)throw new Error(`There is no source cache with ID "${_}", cannot refresh tile`);n===void 0?s.reload(!0):s.refreshTiles(n.map(f=>new a.a3(f.z,f.x,f.y)))}addImage(_,n,s={}){const{pixelRatio:f=1,sdf:m=!1,stretchX:y,stretchY:x,content:M,textFitWidth:E,textFitHeight:z}=s;if(this._lazyInitEmptyStyle(),!(n instanceof HTMLImageElement||a.b(n))){if(n.width===void 0||n.height===void 0)return this.fire(new a.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:B,height:j,data:N}=n,V=n;return this.style.addImage(_,{data:new a.R({width:B,height:j},new Uint8Array(N)),pixelRatio:f,stretchX:y,stretchY:x,content:M,textFitWidth:E,textFitHeight:z,sdf:m,version:0,userImage:V}),V.onAdd&&V.onAdd(this,_),this}}{const{width:B,height:j,data:N}=I.getImageData(n);this.style.addImage(_,{data:new a.R({width:B,height:j},N),pixelRatio:f,stretchX:y,stretchY:x,content:M,textFitWidth:E,textFitHeight:z,sdf:m,version:0})}}updateImage(_,n){const s=this.style.getImage(_);if(!s)return this.fire(new a.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const f=n instanceof HTMLImageElement||a.b(n)?I.getImageData(n):n,{width:m,height:y,data:x}=f;if(m===void 0||y===void 0)return this.fire(new a.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(m!==s.data.width||y!==s.data.height)return this.fire(new a.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const M=!(n instanceof HTMLImageElement||a.b(n));return s.data.replace(x,M),this.style.updateImage(_,s),this}getImage(_){return this.style.getImage(_)}hasImage(_){return _?!!this.style.getImage(_):(this.fire(new a.k(new Error("Missing required image id"))),!1)}removeImage(_){this.style.removeImage(_)}loadImage(_){return ee.getImage(this._requestManager.transformRequest(_,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(_,n){return this._lazyInitEmptyStyle(),this.style.addLayer(_,n),this._update(!0)}moveLayer(_,n){return this.style.moveLayer(_,n),this._update(!0)}removeLayer(_){return this.style.removeLayer(_),this._update(!0)}getLayer(_){return this.style.getLayer(_)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(_,n,s){return this.style.setLayerZoomRange(_,n,s),this._update(!0)}setFilter(_,n,s={}){return this.style.setFilter(_,n,s),this._update(!0)}getFilter(_){return this.style.getFilter(_)}setPaintProperty(_,n,s,f={}){return this.style.setPaintProperty(_,n,s,f),this._update(!0)}getPaintProperty(_,n){return this.style.getPaintProperty(_,n)}setLayoutProperty(_,n,s,f={}){return this.style.setLayoutProperty(_,n,s,f),this._update(!0)}getLayoutProperty(_,n){return this.style.getLayoutProperty(_,n)}setGlyphs(_,n={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(_,n),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(_,n,s={}){return this._lazyInitEmptyStyle(),this.style.addSprite(_,n,s,f=>{f||this._update(!0)}),this}removeSprite(_){return this._lazyInitEmptyStyle(),this.style.removeSprite(_),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(_,n={}){return this._lazyInitEmptyStyle(),this.style.setSprite(_,n,s=>{s||this._update(!0)}),this}setLight(_,n={}){return this._lazyInitEmptyStyle(),this.style.setLight(_,n),this._update(!0)}getLight(){return this.style.getLight()}setSky(_,n={}){return this._lazyInitEmptyStyle(),this.style.setSky(_,n),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(_,n){return this.style.setFeatureState(_,n),this._update()}removeFeatureState(_,n){return this.style.removeFeatureState(_,n),this._update()}getFeatureState(_){return this.style.getFeatureState(_)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let _=0,n=0;return this._container&&(_=this._container.clientWidth||400,n=this._container.clientHeight||300),[_,n]}_setupContainer(){const _=this._container;_.classList.add("maplibregl-map");const n=this._canvasContainer=P.create("div","maplibregl-canvas-container",_);this._interactive&&n.classList.add("maplibregl-interactive"),this._canvas=P.create("canvas","maplibregl-canvas",n),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const s=this._containerDimensions(),f=this._getClampedPixelRatio(s[0],s[1]);this._resizeCanvas(s[0],s[1],f);const m=this._controlContainer=P.create("div","maplibregl-control-container",_),y=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{y[x]=P.create("div",`maplibregl-ctrl-${x} `,m)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(_,n,s){this._canvas.width=Math.floor(s*_),this._canvas.height=Math.floor(s*n),this._canvas.style.width=`${_}px`,this._canvas.style.height=`${n}px`}_setupPainter(){const _=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let n=null;this._canvas.addEventListener("webglcontextcreationerror",f=>{n={requestedAttributes:_},f&&(n.statusMessage=f.statusMessage,n.type=f.type)},{once:!0});let s=null;if(s=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,_):this._canvas.getContext("webgl2",_)||this._canvas.getContext("webgl",_),!s){const f="Failed to initialize WebGL";throw n?(n.message=f,new Error(JSON.stringify(n))):new Error(f)}this.painter=new ma(s,this.transform),F.testSupport(s)}migrateProjection(_,n){super.migrateProjection(_,n),this.painter.transform=_,this.fire(new a.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(_){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||_,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(_){return this._update(),this._renderTaskQueue.add(_)}_cancelRenderFrame(_){this._renderTaskQueue.remove(_)}_render(_){var n,s,f,m,y;const x=this._idleTriggered?this._fadeDuration:0,M=((n=this.style.projection)===null||n===void 0?void 0:n.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(_),this._removed)return;let E=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const j=this.transform.zoom,N=I.now();this.style.zoomHistory.update(j,N);const V=new a.F(j,{now:N,fadeDuration:x,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition(),globalState:this.style.getGlobalState()}),Q=V.crossFadingFactor();Q===1&&Q===this._crossFadingFactor||(E=!0,this._crossFadingFactor=Q),this.style.update(V)}const z=((s=this.style.projection)===null||s===void 0?void 0:s.transitionState)>0!==M;(f=this.style.projection)===null||f===void 0||f.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((m=this.style.projection)===null||m===void 0?void 0:m.transitionState,(y=this.style.projection)===null||y===void 0?void 0:y.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||z)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,x,this._crossSourceCollisions,z),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:x,showPadding:this.showPadding}),this.fire(new a.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.cv.mark(a.cw.load),this.fire(new a.l("load"))),this.style&&(this.style.hasTransitions()||E)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const B=this._sourcesDirty||this._styleDirty||this._placementDirty;return B||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new a.l("idle")),!this._loaded||this._fullyLoaded||B||(this._fullyLoaded=!0,a.cv.mark(a.cw.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var _;this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),ee.removeThrottleControl(this._imageQueueHandle),(_=this._resizeObserver)===null||_===void 0||_.disconnect();const n=this.painter.context.gl.getExtension("WEBGL_lose_context");n!=null&&n.loseContext&&n.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),P.remove(this._canvasContainer),P.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),a.cv.clearMetrics(),this._removed=!0,this.fire(new a.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,I.frame(this._frameRequest,_=>{a.cv.frame(_),this._frameRequest=null;try{this._render(_)}catch(n){if(!a.cx(n)&&!function(s){return s.message===mf}(n))throw n}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(_){this._showTileBoundaries!==_&&(this._showTileBoundaries=_,this._update())}get showPadding(){return!!this._showPadding}set showPadding(_){this._showPadding!==_&&(this._showPadding=_,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(_){this._showCollisionBoxes!==_&&(this._showCollisionBoxes=_,_?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(_){this._showOverdrawInspector!==_&&(this._showOverdrawInspector=_,this._update())}get repaint(){return!!this._repaint}set repaint(_){this._repaint!==_&&(this._repaint=_,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(_){this._vertices=_,this._update()}get version(){return zf}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(_){return this._lazyInitEmptyStyle(),this.style.setProjection(_),this._update(!0)}},p.MapMouseEvent=$r,p.MapTouchEvent=wa,p.MapWheelEvent=wf,p.Marker=Ni,p.NavigationControl=class{constructor(_){this._updateZoomButtons=()=>{const n=this._map.getZoom(),s=n===this._map.getMaxZoom(),f=n===this._map.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=f,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",f.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(n,s)=>{const f=this._map._getUIString(`NavigationControl.${s}`);n.title=f,n.setAttribute("aria-label",f)},this.options=a.e({},Br,_),this._container=P.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",n=>this._map.zoomIn({},{originalEvent:n})),P.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",n=>this._map.zoomOut({},{originalEvent:n})),P.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",n=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:n}):this._map.resetNorth({},{originalEvent:n})}),this._compassIcon=P.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(_){return this._map=_,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new mm(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){P.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(_,n){const s=P.create("button",_,this._container);return s.type="button",s.addEventListener("click",n),s}},p.Popup=class extends a.E{constructor(_){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&P.remove(this._content),this._container&&(P.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new a.l("close"))),this),this._onMouseUp=n=>{this._update(n.point)},this._onMouseMove=n=>{this._update(n.point)},this._onDrag=n=>{this._update(n.point)},this._update=n=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=P.create("div","maplibregl-popup",this._map.getContainer()),this._tip=P.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const x of this.options.className.split(" "))this._container.classList.add(x);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=gm(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!n)return;const s=this._flatPos=this._pos=this._trackPointer&&n?n:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&n?n:this._map.transform.locationToScreenPoint(this._lngLat));let f=this.options.anchor;const m=Lu(this.options.offset);if(!f){const x=this._container.offsetWidth,M=this._container.offsetHeight;let E;E=s.y+m.bottom.y<M?["top"]:s.y>this._map.transform.height-M?["bottom"]:[],s.x<x/2?E.push("left"):s.x>this._map.transform.width-x/2&&E.push("right"),f=E.length===0?"bottom":E.join("-")}let y=s.add(m[f]);this.options.subpixelPositioning||(y=y.round()),P.setTransform(this._container,`${cs[f]} translate(${y.x}px,${y.y}px)`),Ri(this._container,f,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=a.e(Object.create(oc),_)}addTo(_){return this._map&&this.remove(),this._map=_,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new a.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(_){return this._lngLat=a.S.convert(_),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(_){return this.setDOMContent(document.createTextNode(_))}setHTML(_){const n=document.createDocumentFragment(),s=document.createElement("body");let f;for(s.innerHTML=_;f=s.firstChild,f;)n.appendChild(f);return this.setDOMContent(n)}getMaxWidth(){var _;return(_=this._container)===null||_===void 0?void 0:_.style.maxWidth}setMaxWidth(_){return this.options.maxWidth=_,this._update(),this}setDOMContent(_){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=P.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(_),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(_){return this._container&&this._container.classList.add(_),this}removeClassName(_){return this._container&&this._container.classList.remove(_),this}setOffset(_){return this.options.offset=_,this._update(),this}toggleClassName(_){if(this._container)return this._container.classList.toggle(_)}setSubpixelPositioning(_){this.options.subpixelPositioning=_}_createCloseButton(){this.options.closeButton&&(this._closeButton=P.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const _=this._container.querySelector(Lf);_&&_.focus()}},p.RasterDEMTileSource=ht,p.RasterTileSource=st,p.ScaleControl=class{constructor(_){this._onMove=()=>{Ru(this._map,this._container,this.options)},this.setUnit=n=>{this.options.unit=n,Ru(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Rf),_)}getDefaultPosition(){return"bottom-left"}onAdd(_){return this._map=_,this._container=P.create("div","maplibregl-ctrl maplibregl-ctrl-scale",_.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){P.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},p.ScrollZoomHandler=hm,p.Style=Jh,p.TerrainControl=class{constructor(_){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=_}onAdd(_){return this._map=_,this._container=P.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=P.create("button","maplibregl-ctrl-terrain",this._container),P.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){P.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},p.TwoFingersTouchPitchHandler=Mf,p.TwoFingersTouchRotateHandler=Sf,p.TwoFingersTouchZoomHandler=Na,p.TwoFingersTouchZoomRotateHandler=Pf,p.VectorTileSource=Rt,p.VideoSource=Ht,p.addSourceType=(_,n)=>a._(void 0,void 0,void 0,function*(){if(yt(_))throw new Error(`A source type called "${_}" already exists.`);((s,f)=>{In[s]=f})(_,n)}),p.clearPrewarmedResources=function(){const _=mt;_&&(_.isPreloaded()&&_.numActive()===1?(_.release(tt),mt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},p.createTileMesh=Xh,p.getMaxParallelImageRequests=function(){return a.a.MAX_PARALLEL_IMAGE_REQUESTS},p.getRTLTextPluginStatus=function(){return yn().getRTLTextPluginStatus()},p.getVersion=function(){return Bf},p.getWorkerCount=function(){return Tt.workerCount},p.getWorkerUrl=function(){return a.a.WORKER_URL},p.importScriptInWorkers=function(_){return pt().broadcast("IS",_)},p.prewarm=function(){Ut().acquire(tt)},p.setMaxParallelImageRequests=function(_){a.a.MAX_PARALLEL_IMAGE_REQUESTS=_},p.setRTLTextPlugin=function(_,n){return yn().setRTLTextPlugin(_,n)},p.setWorkerCount=function(_){Tt.workerCount=_},p.setWorkerUrl=function(_){a.a.WORKER_URL=_}});var d=r;return d})}(fg)),fg.exports}var WD=$D();const Ea=ZD(WD);function YD(e){return Object.fromEntries(Object.entries(e).filter(([t,r])=>r!=null))}La(["click"]);function XD(e,t){nr(t,!0);const r=Vt(Oh),o=Vt(()=>L(r).map),u=Vt(()=>L(r).loaded);let d=Se(t,"position",3,"top-left"),p=Se(t,"container",3,void 0),a=$t(void 0),w=Vt(()=>typeof p()=="string"?document.querySelector(p())??void 0:p());ei(()=>{L(a)||(L(w)?Qe(a,new Ea.FullscreenControl({container:L(w)}),!0):Qe(a,new Ea.FullscreenControl,!0),L(o).addControl(L(a),d()))}),Fh(()=>{L(u)&&L(a)&&L(o).removeControl(L(a))}),ir()}function QD(e,t){nr(t,!0);const r=Vt(Oh),o=Vt(()=>L(r).map),u=Vt(()=>L(r).loaded);let d=Se(t,"position",3,"top-left"),p=Se(t,"positionOptions",3,void 0),a=Se(t,"fitBoundsOptions",3,void 0),w=Se(t,"trackUserLocation",3,!1),T=Se(t,"showAccuracyCircle",3,!0),S=Se(t,"showUserLocation",3,!0),k=Se(t,"control",15);ei(()=>{L(o)&&!k()&&(k(new Ea.GeolocateControl({positionOptions:p(),fitBoundsOptions:a(),trackUserLocation:w(),showAccuracyCircle:T(),showUserLocation:S()})),L(o).addControl(k(),d()))}),Fh(()=>{L(u)&&k()&&L(o).removeControl(k())}),ir()}function KD(e){let t=e.getCenter(),r=Math.round(e.getZoom()*100)/100,o=Math.ceil((r*Math.LN2+Math.log(512/360/.5))/Math.LN10),u=Math.pow(10,o),d=Math.round(t.lat*u)/u,p=Math.round(t.lng*u)/u,a=`${r}/${d}/${p}`,w=e.getBearing(),T=e.getPitch();return(w||T)&&(a+=`/${Math.round(w*10)/10}`),T&&(a+=`/${Math.round(T)}`),`#${a}`}function JD(e){return e.replace("#","").split("/").map(parseFloat)}var sd=m1;function m1(e,t){return e===t||e!==e&&t!==t?!0:typeof e!=typeof t||{}.toString.call(e)!={}.toString.call(t)||e!==Object(e)||!e?!1:Array.isArray(e)?K2(e,t):{}.toString.call(e)=="[object Set]"?K2(Array.from(e),Array.from(t)):{}.toString.call(e)=="[object Object]"?tz(e,t):ez(e,t)}function ez(e,t){return e.toString()===t.toString()}function K2(e,t){var r=e.length;if(r!=t.length)return!1;for(var o=0;o<r;o++)if(!m1(e[o],t[o]))return!1;return!0}function tz(e,t){var r=Object.keys(e),o=r.length;if(o!=Object.keys(t).length)return!1;for(var u=0;u<o;u++){var d=r[u];if(!(t.hasOwnProperty(d)&&m1(e[d],t[d])))return!1}return!0}const{LngLatBounds:nz,LngLat:iz}=Ea;function Fm(e,t){return Math.abs(e-t)<1e-6}function rz(e,t){let r=nz.convert(e);if(!t)return{equal:!1,bounds:r};let o=r.getNorthEast(),u=t.getNorthEast();if(!Fm(o.lat,u.lat)||!Fm(o.wrap().lng,u.wrap().lng))return{equal:!1,bounds:r};let d=r.getSouthWest(),p=t.getSouthWest();return!Fm(d.lat,p.lat)||!Fm(d.wrap().lng,p.wrap().lng)?{equal:!1,bounds:r}:{equal:!0,bounds:r}}function az(e,t){const r=e.getSouthWest(),o=e.getNorthEast();if(Array.isArray(t)){if(t.length===4)return[r.lng,r.lat,o.lng,o.lat];if(t.length===2)return t[0]instanceof iz?[r,o]:[[r.lng,r.lat],[o.lng,o.lat]]}return e}function oz(e,t){nr(t,!0);const r=Vt(Oh),o=Vt(()=>L(r).map),u=Vt(()=>L(r).loaded);let d=Se(t,"position",3,"top-left"),p=Se(t,"showCompass",3,!0),a=Se(t,"showZoom",3,!0),w=Se(t,"visualizePitch",3,!1),T=$t(void 0);ei(()=>{L(o)&&!L(T)&&(Qe(T,new Ea.NavigationControl({showCompass:p(),showZoom:a(),visualizePitch:w()}),!0),L(o).addControl(L(T),d()))}),Fh(()=>{L(u)&&L(T)&&L(o).removeControl(L(T))}),ir()}function sz(e,t){nr(t,!0);const r=Vt(Oh),o=Vt(()=>L(r).map),u=Vt(()=>L(r).loaded);let d=Se(t,"position",3,"bottom-left"),p=Se(t,"maxWidth",3,void 0),a=Se(t,"unit",3,"metric"),w=$t(void 0);ei(()=>{L(o)&&!L(w)&&(Qe(w,new Ea.ScaleControl({maxWidth:p(),unit:a()}),!0),L(o).addControl(L(w),d()))}),Fh(()=>{L(u)&&L(w)&&L(o).removeControl(L(w))}),ir()}var lz=tn("<!> <!> <!> <!>",1),cz=tn("<!> <!>",1),uz=tn('<div data-testid="map-container"><!></div>');function hz(e,t){nr(t,!0);let r=Se(t,"map",15,void 0),o=Se(t,"mapContainer",15,void 0),u=Se(t,"class",3,void 0),d=Se(t,"diffStyleUpdates",3,!1),p=Se(t,"center",15,void 0),a=Se(t,"zoom",15,void 0),w=Se(t,"pitch",15,0),T=Se(t,"bearing",15,0),S=Se(t,"bearingSnap",3,7),k=Se(t,"bounds",15,void 0),I=Se(t,"fitBoundsOptions",19,()=>({})),P=Se(t,"hash",3,!1),F=Se(t,"projection",3,void 0),G=Se(t,"updateHash",3,qe=>{window.history.replaceState(window.history.state,"",qe)}),H=Se(t,"loaded",15,!1),Y=Se(t,"minZoom",3,0),$=Se(t,"maxZoom",3,22),ae=Se(t,"minPitch",3,0),ee=Se(t,"maxPitch",3,60),ce=Se(t,"renderWorldCopies",3,void 0),re=Se(t,"dragPan",3,void 0),he=Se(t,"dragRotate",3,void 0),be=Se(t,"pitchWithRotate",3,void 0),ke=Se(t,"antialias",3,void 0),Ie=Se(t,"zoomOnDoubleClick",3,!0),ue=Se(t,"locale",3,void 0),Ve=Se(t,"interactive",3,!0),Ze=Se(t,"attributionControl",3,void 0),Xe=Se(t,"cooperativeGestures",3,!1),Re=Se(t,"preserveDrawingBuffer",3,!1),ot=Se(t,"maxBounds",3,void 0),Pt=Se(t,"images",19,()=>[]),bt=Se(t,"standardControls",3,!1),_t=Se(t,"filterLayers",3,void 0),tt=Se(t,"transformRequest",3,void 0),Tt=Vt(()=>typeof bt()=="boolean"?void 0:bt());const ct=UD();nM(new Eg(void 0));let mt=$t(Ui(new Set));async function Xt(qe,Mt=!1){var Ht;if(r()&&!(!((Ht=r())!=null&&Ht.loaded())&&!Mt))if("url"in qe){L(mt).add(qe.id);try{let _n=await r().loadImage(qe.url);r().addImage(qe.id,_n.data,qe.options),ct.loadedImages.add(qe.id)}catch(_n){t.onerror?t.onerror({error:_n}):console.error(_n)}finally{L(mt).delete(qe.id)}}else r().addImage(qe.id,qe.data,qe.options),ct.loadedImages.add(qe.id)}ei(()=>{var qe;if(H()&&((qe=r())!=null&&qe.loaded()))for(let Mt of Pt())!ct.loadedImages.has(Mt.id)&&!L(mt).has(Mt.id)&&!r().hasImage(Mt.id)&&Xt(Mt)});let Ut=Vt(()=>Pt().every(qe=>ct.loadedImages.has(qe.id))),St=$t(void 0),pt=$t(void 0),Ft=$t(void 0),nt=$t(void 0);function De(qe){t.onerror?t.onerror(qe):qe.error.name!=="AbortError"&&console.error(qe.error)}function Ke(qe){return wt(),r(ct.map=new Ea.Map(YD({container:qe,style:t.style,locale:ue(),center:p(),zoom:a(),pitch:w(),bearing:T(),bearingSnap:S(),minZoom:Y(),maxZoom:$(),minPitch:ae(),maxPitch:ee(),renderWorldCopies:ce(),dragPan:re(),dragRotate:he(),pitchWithRotate:be(),antialias:ke(),interactive:Ve(),preserveDrawingBuffer:Re(),maxBounds:ot(),bounds:k(),attributionControl:Ze(),transformRequest:tt(),cooperativeGestures:Xe()}))),r().on("load",Mt=>{Mt.target.getContainer().setAttribute("data-testid","map"),Mt.target.getCanvas().setAttribute("data-testid","map-canvas"),t.onload&&t.onload(r()),ct.loaded=!0,H(!0)}),r().on("error",De),t.onmovestart&&r().on("movestart",t.onmovestart),r().on("moveend",Mt=>{var Ht;if(p(Mt.target.getCenter()),a(Mt.target.getZoom()),w(Mt.target.getPitch()),T(Mt.target.getBearing()),k(az(Mt.target.getBounds(),k())),(Ht=t.onmoveend)==null||Ht.call(t,Mt),P()){let _n=new URL(window.location.href.replace(/(#.+)?$/,KD(Mt.target)));G()(_n)}}),t.onclick&&r().on("click",t.onclick),t.ondblclick&&r().on("dblclick",t.ondblclick),t.oncontextmenu&&r().on("contextmenu",t.oncontextmenu),t.onmousemove&&r().on("mousemove",t.onmousemove),t.onzoomstart&&r().on("zoomstart",t.onzoomstart),t.onzoom&&r().on("zoom",t.onzoom),t.onzoomend&&r().on("zoomend",t.onzoomend),t.onpitch&&r().on("pitch",t.onpitch),t.onrotate&&r().on("rotate",t.onrotate),t.onwheel&&r().on("wheel",t.onwheel),t.ondata&&r().on("data",t.ondata),t.onidle&&r().on("idle",t.onidle),r().on("style.load",Mt=>{var Ht;if(r()){F()&&r().setProjection(F()),ct.loaded=!0,H(!0);const _n=r().getStyle();if(Qe(St,_n.layers.map(In=>In.id),!0),Qe(pt,Object.keys(_n.sources),!0),L(nt))for(const[In,yt]of Object.entries(L(nt)))r().addSource(In,yt);if(L(Ft))for(const In of L(Ft))r().addLayer(In);for(const In of Pt())Xt(In,!0);(Ht=t.onstyleload)==null||Ht.call(t,Mt)}}),r().on("styledata",Mt=>{var Ht;if(r()&&_t()){const _n=r().getStyle().layers;if(_n)for(let In of _n)_t()(In)||r().setLayoutProperty(In.id,"visibility","none")}(Ht=t.onstyledata)==null||Ht.call(t,Mt)}),{destroy(){var Mt;H(!1),ct.loaded=!1,(Mt=r())==null||Mt.remove()}}}let Be=$t(Ui(t.style));ei(()=>{if(r()&&!sd(t.style,L(Be))){const qe=r().getStyle();if(L(St)&&Qe(Ft,qe.layers.filter(Mt=>!L(St).includes(Mt.id)),!0),L(pt)){const Mt=Object.keys(qe.sources).filter(Ht=>!L(pt).includes(Ht));Qe(nt,{},!0);for(const Ht of Mt)L(nt)[Ht]=qe.sources[Ht]}Qe(Be,t.style,!0),r().setStyle(t.style,{diff:d()}),ct.loadedImages.clear(),Qe(mt,new Set,!0)}}),ei(()=>{if(r()){let qe={};p()!=null&&!sd(p(),r().getCenter())&&(qe.center=p()),a()!=null&&!sd(a(),r().getZoom())&&(qe.zoom=a()),T()!=null&&!sd(T(),r().getBearing())&&(qe.bearing=T()),w()!=null&&!sd(w(),r().getPitch())&&(qe.pitch=w()),Object.keys(qe).length&&r().easeTo(qe)}}),ei(()=>{var qe;F()&&H()&&((qe=r())==null||qe.setProjection(F()))}),ei(()=>{var qe,Mt;if(k()){const{equal:Ht,bounds:_n}=rz(k(),(qe=r())==null?void 0:qe.getBounds());Ht||(Mt=r())==null||Mt.fitBounds(_n,I())}}),ei(()=>{var qe,Mt;Ie()?(qe=r())==null||qe.doubleClickZoom.enable():(Mt=r())==null||Mt.doubleClickZoom.disable()});function wt(){if(P()){let qe=JD(window.location.hash);qe.length>=3&&(a(qe[0]),p([qe[2],qe[1]])),qe.length==5&&(T(qe[3]),w(qe[4]))}}var gt=uz();fr("hashchange",Bv,wt);let Rt;var st=Bt(gt);{var ht=qe=>{var Mt=cz(),Ht=Kn(Mt);{var _n=yt=>{var qt=lz(),Nt=Kn(qt);oz(Nt,{get position(){return L(Tt)}});var fn=an(Nt,2);{let Mi=Vt(()=>({...I(),maxZoom:12}));QD(fn,{get position(){return L(Tt)},get fitBoundsOptions(){return L(Mi)}})}var yn=an(fn,2);XD(yn,{get position(){return L(Tt)}});var On=an(yn,2);sz(On,{get position(){return L(Tt)}}),It(yt,qt)};pn(Ht,yt=>{bt()&&yt(_n)})}var In=an(Ht,2);jr(In,()=>t.children??Ha,()=>({map:r(),loaded:H(),loadedImages:ct.loadedImages,allImagesLoaded:L(Ut)})),It(qe,Mt)};pn(st,qe=>{r()&&qe(ht)})}Et(gt),Go(gt,qe=>o(qe),()=>o()),_h(gt,qe=>Ke==null?void 0:Ke(qe)),wn(qe=>Rt=ai(gt,1,_l(u()),"svelte-p00lfq",Rt,qe),[()=>({"expand-map":!u()})]),It(e,gt),ir()}function fz(e,t){e.key===" "&&(e.preventDefault(),e.stopPropagation(),t("click"))}var dz=(e,t)=>{e.stopPropagation(),t("click")},pz=(e,t)=>{e.stopPropagation(),t("dblclick")},mz=(e,t)=>{e.stopPropagation(),e.preventDefault(),t("contextmenu")},gz=(e,t)=>t("mousemove"),_z=tn("<div><!></div>");function yz(e,t){nr(t,!0);let r=Se(t,"marker",15,void 0),o=Se(t,"lngLat",15),u=Se(t,"class",3,void 0),d=Se(t,"interactive",3,!0),p=Se(t,"asButton",3,!1),a=Se(t,"draggable",3,!1),w=Se(t,"feature",3,void 0),T=Se(t,"offset",3,void 0),S=Se(t,"zIndex",3,void 0),k=Se(t,"rotation",3,0),I=Se(t,"opacity",3,1),P=I_(t,["$$slots","$$events","$$legacy","marker","lngLat","class","interactive","asButton","draggable","feature","offset","zIndex","rotation","opacity","anchor","children"]);const F=Vt(Oh),G=Vt(()=>L(F).map),H=Vt(()=>L(F).markerClickManager),{layerEvent:Y,marker:$}=VD();function ae(ue){$.value=new Ea.Marker({element:ue,rotation:k(),draggable:a(),offset:T(),anchor:t.anchor,opacity:I().toString()}).setLngLat(o()).addTo(L(G)),r($.value);const Ve=()=>he("dragstart"),Ze=()=>{re(),he("drag")},Xe=()=>{re(),he("dragend")};return a()&&($.value.on("dragstart",Ve),$.value.on("drag",Ze),$.value.on("dragend",Xe)),{destroy(){var Re,ot,Pt,bt;a()&&((Re=$.value)==null||Re.off("dragstart",Ve),(ot=$.value)==null||ot.off("drag",Ze),(Pt=$.value)==null||Pt.off("dragend",Xe)),r(void 0),(bt=$.value)==null||bt.remove()}}}function ee(ue,Ve){const Ze=ue.className;function Xe(Re){Re?ue.className=`${Ze} ${Re}`:ue.className=Ze}return Xe(Ve),{update:Xe}}let ce=new Eg(o());OD(ce),ei(()=>{var ue;(ue=$.value)==null||ue.setLngLat(o()),ce.value=o()}),ei(()=>{var ue;T()&&((ue=$.value)==null||ue.setOffset(T()))}),ei(()=>{var ue;(ue=$.value)==null||ue.setRotation(k())}),ei(()=>{var ue;(ue=$.value)==null||ue.setOpacity(I().toString())});function re(){var Ve;let ue=(Ve=$.value)==null?void 0:Ve.getLngLat();ue&&(Array.isArray(o())?o([ue.lng,ue.lat]):o()&&"lon"in o()?o({lon:ue.lng,lat:ue.lat}):o(ue))}function he(ue){var ot,Pt;if(!d())return;let Ve=(ot=$.value)==null?void 0:ot.getLngLat();if(!Ve)return;const Ze=[Ve.lng,Ve.lat];let Xe={map:L(G),marker:$.value,lngLat:Ze,features:[{type:"Feature",properties:((Pt=w())==null?void 0:Pt.properties)??{},geometry:{type:"Point",coordinates:Ze}}]};(ue==="click"||ue==="contextmenu")&&L(H).handleClick(Xe),Y.value={...Xe,layerType:"marker",type:ue};const Re=P["on"+ue];Re==null||Re(Xe)}var be=_z();be.__click=[dz,he],be.__dblclick=[pz,he],be.__contextmenu=[mz,he],be.__mousemove=[gz,he],be.__keydown=[fz,he];let ke;var Ie=Bt(be);jr(Ie,()=>t.children??Ha,()=>({marker:$.value})),Et(be),_h(be,ue=>ae==null?void 0:ae(ue)),_h(be,(ue,Ve)=>ee==null?void 0:ee(ue,Ve),u),wn(ue=>{ri(be,"tabindex",p()?0:void 0),ri(be,"role",p()?"button":void 0),ke=ca(be,"",ke,ue)},[()=>({"z-index":S()})]),fr("mouseenter",be,()=>{he("mouseenter")}),fr("mouseleave",be,()=>{he("mouseleave")}),It(e,be),ir()}La(["click","dblclick","contextmenu","mousemove","keydown"]);function _o(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function cp(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function k_(e){let t,r,o;e.length!==2?(t=_o,r=(a,w)=>_o(e(a),w),o=(a,w)=>e(a)-w):(t=e===_o||e===cp?e:vz,r=e,o=e);function u(a,w,T=0,S=a.length){if(T<S){if(t(w,w)!==0)return S;do{const k=T+S>>>1;r(a[k],w)<0?T=k+1:S=k}while(T<S)}return T}function d(a,w,T=0,S=a.length){if(T<S){if(t(w,w)!==0)return S;do{const k=T+S>>>1;r(a[k],w)<=0?T=k+1:S=k}while(T<S)}return T}function p(a,w,T=0,S=a.length){const k=u(a,w,T,S-1);return k>T&&o(a[k-1],w)>-o(a[k],w)?k-1:k}return{left:u,center:p,right:d}}function vz(){return 0}function lM(e){return e===null?NaN:+e}function*bz(e,t){if(t===void 0)for(let r of e)r!=null&&(r=+r)>=r&&(yield r);else{let r=-1;for(let o of e)(o=t(o,++r,e))!=null&&(o=+o)>=o&&(yield o)}}const xz=k_(_o),D_=xz.right;k_(lM).center;function z_(e,t){let r=0;if(t===void 0)for(let o of e)o!=null&&(o=+o)>=o&&++r;else{let o=-1;for(let u of e)(u=t(u,++o,e))!=null&&(u=+u)>=u&&++r}return r}function wz(e){return e.length|0}function Az(e){return!(e>0)}function Tz(e){return typeof e!="object"||"length"in e?e:Array.from(e)}function Sz(e){return t=>e(...t)}function Mz(...e){const t=typeof e[e.length-1]=="function"&&Sz(e.pop());e=e.map(Tz);const r=e.map(wz),o=e.length-1,u=new Array(o+1).fill(0),d=[];if(o<0||r.some(Az))return d;for(;;){d.push(u.map((a,w)=>e[w][a]));let p=o;for(;++u[p]===r[p];){if(p===0)return t?d.map(t):d;u[p--]=0}}}function cM(e,t){let r=0,o,u=0,d=0;if(t===void 0)for(let p of e)p!=null&&(p=+p)>=p&&(o=p-u,u+=o/++r,d+=o*(p-u));else{let p=-1;for(let a of e)(a=t(a,++p,e))!=null&&(a=+a)>=a&&(o=a-u,u+=o/++r,d+=o*(a-u))}if(r>1)return d/(r-1)}function uM(e,t){const r=cM(e,t);return r&&Math.sqrt(r)}function Wa(e,t){let r,o;if(t===void 0)for(const u of e)u!=null&&(r===void 0?u>=u&&(r=o=u):(r>u&&(r=u),o<u&&(o=u)));else{let u=-1;for(let d of e)(d=t(d,++u,e))!=null&&(r===void 0?d>=d&&(r=o=d):(r>d&&(r=d),o<d&&(o=d)))}return[r,o]}class Fc{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const r=this._partials;let o=0;for(let u=0;u<this._n&&u<32;u++){const d=r[u],p=t+d,a=Math.abs(t)<Math.abs(d)?t-(p-d):d-(p-t);a&&(r[o++]=a),t=p}return r[o]=t,this._n=o+1,this}valueOf(){const t=this._partials;let r=this._n,o,u,d,p=0;if(r>0){for(p=t[--r];r>0&&(o=p,u=t[--r],p=o+u,d=u-(p-o),!d););r>0&&(d<0&&t[r-1]<0||d>0&&t[r-1]>0)&&(u=d*2,o=p+u,u==o-p&&(p=o))}return p}}class Bd extends Map{constructor(t,r=dM){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:r}}),t!=null)for(const[o,u]of t)this.set(o,u)}get(t){return super.get($v(this,t))}has(t){return super.has($v(this,t))}set(t,r){return super.set(hM(this,t),r)}delete(t){return super.delete(fM(this,t))}}class R_ extends Set{constructor(t,r=dM){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:r}}),t!=null)for(const o of t)this.add(o)}has(t){return super.has($v(this,t))}add(t){return super.add(hM(this,t))}delete(t){return super.delete(fM(this,t))}}function $v({_intern:e,_key:t},r){const o=t(r);return e.has(o)?e.get(o):r}function hM({_intern:e,_key:t},r){const o=t(r);return e.has(o)?e.get(o):(e.set(o,r),r)}function fM({_intern:e,_key:t},r){const o=t(r);return e.has(o)&&(r=e.get(o),e.delete(o)),r}function dM(e){return e!==null&&typeof e=="object"?e.valueOf():e}function Wv(e){return e}function g1(e,...t){return _1(e,Wv,Wv,t)}function dg(e,t,...r){return _1(e,Wv,t,r)}function Cz(e,t,...r){return _1(e,Array.from,t,r)}function _1(e,t,r,o){return function u(d,p){if(p>=o.length)return r(d);const a=new Bd,w=o[p++];let T=-1;for(const S of d){const k=w(S,++T,d),I=a.get(k);I?I.push(S):a.set(k,[S])}for(const[S,k]of a)a.set(S,u(k,p));return t(a)}(e,0)}function Iz(e,t){return Array.from(t,r=>e[r])}function pM(e,...t){if(typeof e[Symbol.iterator]!="function")throw new TypeError("values is not iterable");e=Array.from(e);let[r]=t;if(r&&r.length!==2||t.length>1){const o=Uint32Array.from(e,(u,d)=>d);return t.length>1?(t=t.map(u=>e.map(u)),o.sort((u,d)=>{for(const p of t){const a=Fd(p[u],p[d]);if(a)return a}})):(r=e.map(r),o.sort((u,d)=>Fd(r[u],r[d]))),Iz(e,o)}return e.sort(y1(r))}function y1(e=_o){if(e===_o)return Fd;if(typeof e!="function")throw new TypeError("compare is not a function");return(t,r)=>{const o=e(t,r);return o||o===0?o:(e(r,r)===0)-(e(t,t)===0)}}function Fd(e,t){return(e==null||!(e>=e))-(t==null||!(t>=t))||(e<t?-1:e>t?1:0)}const Ez=Math.sqrt(50),Pz=Math.sqrt(10),kz=Math.sqrt(2);function Pg(e,t,r){const o=(t-e)/Math.max(0,r),u=Math.floor(Math.log10(o)),d=o/Math.pow(10,u),p=d>=Ez?10:d>=Pz?5:d>=kz?2:1;let a,w,T;return u<0?(T=Math.pow(10,-u)/p,a=Math.round(e*T),w=Math.round(t*T),a/T<e&&++a,w/T>t&&--w,T=-T):(T=Math.pow(10,u)*p,a=Math.round(e/T),w=Math.round(t/T),a*T<e&&++a,w*T>t&&--w),w<a&&.5<=r&&r<2?Pg(e,t,r*2):[a,w,T]}function Od(e,t,r){if(t=+t,e=+e,r=+r,!(r>0))return[];if(e===t)return[e];const o=t<e,[u,d,p]=o?Pg(t,e,r):Pg(e,t,r);if(!(d>=u))return[];const a=d-u+1,w=new Array(a);if(o)if(p<0)for(let T=0;T<a;++T)w[T]=(d-T)/-p;else for(let T=0;T<a;++T)w[T]=(d-T)*p;else if(p<0)for(let T=0;T<a;++T)w[T]=(u+T)/-p;else for(let T=0;T<a;++T)w[T]=(u+T)*p;return w}function kg(e,t,r){return t=+t,e=+e,r=+r,Pg(e,t,r)[2]}function Yv(e,t,r){t=+t,e=+e,r=+r;const o=t<e,u=o?kg(t,e,r):kg(e,t,r);return(o?-1:1)*(u<0?1/-u:u)}function Dz(e){return Math.max(1,Math.ceil(Math.log(z_(e))/Math.LN2)+1)}function Ja(e,t){let r;if(t===void 0)for(const o of e)o!=null&&(r<o||r===void 0&&o>=o)&&(r=o);else{let o=-1;for(let u of e)(u=t(u,++o,e))!=null&&(r<u||r===void 0&&u>=u)&&(r=u)}return r}function zz(e,t){let r,o=-1,u=-1;if(t===void 0)for(const d of e)++u,d!=null&&(r<d||r===void 0&&d>=d)&&(r=d,o=u);else for(let d of e)(d=t(d,++u,e))!=null&&(r<d||r===void 0&&d>=d)&&(r=d,o=u);return o}function Oc(e,t){let r;if(t===void 0)for(const o of e)o!=null&&(r>o||r===void 0&&o>=o)&&(r=o);else{let o=-1;for(let u of e)(u=t(u,++o,e))!=null&&(r>u||r===void 0&&u>=u)&&(r=u)}return r}function Rz(e,t){let r,o=-1,u=-1;if(t===void 0)for(const d of e)++u,d!=null&&(r>d||r===void 0&&d>=d)&&(r=d,o=u);else for(let d of e)(d=t(d,++u,e))!=null&&(r>d||r===void 0&&d>=d)&&(r=d,o=u);return o}function mM(e,t,r=0,o=1/0,u){if(t=Math.floor(t),r=Math.floor(Math.max(0,r)),o=Math.floor(Math.min(e.length-1,o)),!(r<=t&&t<=o))return e;for(u=u===void 0?Fd:y1(u);o>r;){if(o-r>600){const w=o-r+1,T=t-r+1,S=Math.log(w),k=.5*Math.exp(2*S/3),I=.5*Math.sqrt(S*k*(w-k)/w)*(T-w/2<0?-1:1),P=Math.max(r,Math.floor(t-T*k/w+I)),F=Math.min(o,Math.floor(t+(w-T)*k/w+I));mM(e,t,P,F,u)}const d=e[t];let p=r,a=o;for(ld(e,r,t),u(e[o],d)>0&&ld(e,r,o);p<a;){for(ld(e,p,a),++p,--a;u(e[p],d)<0;)++p;for(;u(e[a],d)>0;)--a}u(e[r],d)===0?ld(e,r,a):(++a,ld(e,a,o)),a<=t&&(r=a+1),t<=a&&(o=a-1)}return e}function ld(e,t,r){const o=e[t];e[t]=e[r],e[r]=o}function vh(e,t,r){if(e=Float64Array.from(bz(e,r)),!(!(o=e.length)||isNaN(t=+t))){if(t<=0||o<2)return Oc(e);if(t>=1)return Ja(e);var o,u=(o-1)*t,d=Math.floor(u),p=Ja(mM(e,d).subarray(0,d+1)),a=Oc(e.subarray(d+1));return p+(a-p)*(u-d)}}function Lz(e,t,r=lM){if(!(!(o=e.length)||isNaN(t=+t))){if(t<=0||o<2)return+r(e[0],0,e);if(t>=1)return+r(e[o-1],o-1,e);var o,u=(o-1)*t,d=Math.floor(u),p=+r(e[d],d,e),a=+r(e[d+1],d+1,e);return p+(a-p)*(u-d)}}function Bz(e,t,r){const o=z_(e),u=vh(e,.75)-vh(e,.25);return o&&u?Math.ceil((r-t)/(2*u*Math.pow(o,-1/3))):1}function gM(e,t,r){const o=z_(e),u=uM(e);return o&&u?Math.ceil((r-t)*Math.cbrt(o)/(3.49*u)):1}function Fz(e,t){let r=0,o=0;if(t===void 0)for(let u of e)u!=null&&(u=+u)>=u&&(++r,o+=u);else{let u=-1;for(let d of e)(d=t(d,++u,e))!=null&&(d=+d)>=d&&(++r,o+=d)}if(r)return o/r}function Xv(e,t){return vh(e,.5,t)}function*Oz(e){for(const t of e)yield*t}function _M(e){return Array.from(Oz(e))}function Nz(e,t){const r=new Bd;if(t===void 0)for(let d of e)d!=null&&d>=d&&r.set(d,(r.get(d)||0)+1);else{let d=-1;for(let p of e)(p=t(p,++d,e))!=null&&p>=p&&r.set(p,(r.get(p)||0)+1)}let o,u=0;for(const[d,p]of r)p>u&&(u=p,o=d);return o}function jz(e,t=Uz){const r=[];let o,u=!1;for(const d of e)u&&r.push(t(o,d)),o=d,u=!0;return r}function Uz(e,t){return[e,t]}function Qv(e,t,r){e=+e,t=+t,r=(u=arguments.length)<2?(t=e,e=0,1):u<3?1:+r;for(var o=-1,u=Math.max(0,Math.ceil((t-e)/r))|0,d=new Array(u);++o<u;)d[o]=e+o*r;return d}function yM(e,t=_o){if(typeof e[Symbol.iterator]!="function")throw new TypeError("values is not iterable");let r=Array.from(e);const o=new Float64Array(r.length);t.length!==2&&(r=r.map(t),t=_o);const u=(a,w)=>t(r[a],r[w]);let d,p;return e=Uint32Array.from(r,(a,w)=>w),e.sort(t===_o?(a,w)=>Fd(r[a],r[w]):y1(u)),e.forEach((a,w)=>{const T=u(a,d===void 0?a:d);T>=0?((d===void 0||T>0)&&(d=a,p=w),o[a]=p):o[a]=NaN}),o}function L_(e,t){let r=0;if(t===void 0)for(let o of e)(o=+o)&&(r+=o);else{let o=-1;for(let u of e)(u=+t(u,++o,e))&&(r+=u)}return r}function Dg(e){if(typeof e[Symbol.iterator]!="function")throw new TypeError("values is not iterable");return Array.from(e).reverse()}var Zn=1e-6,vM=1e-12,Xn=Math.PI,Yi=Xn/2,J2=Xn/4,za=Xn*2,sa=180/Xn,Wi=Xn/180,Si=Math.abs,Nh=Math.atan,Ps=Math.atan2,Yn=Math.cos,bM=Math.exp,zg=Math.log,$0=Math.pow,Bn=Math.sin,Ya=Math.sign||function(e){return e>0?1:e<0?-1:0},ya=Math.sqrt,v1=Math.tan;function xM(e){return e>1?0:e<-1?Xn:Math.acos(e)}function eo(e){return e>1?Yi:e<-1?-Yi:Math.asin(e)}function Xa(){}function Rg(e,t){e&&tA.hasOwnProperty(e.type)&&tA[e.type](e,t)}var eA={Feature:function(e,t){Rg(e.geometry,t)},FeatureCollection:function(e,t){for(var r=e.features,o=-1,u=r.length;++o<u;)Rg(r[o].geometry,t)}},tA={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var r=e.coordinates,o=-1,u=r.length;++o<u;)e=r[o],t.point(e[0],e[1],e[2])},LineString:function(e,t){Kv(e.coordinates,t,0)},MultiLineString:function(e,t){for(var r=e.coordinates,o=-1,u=r.length;++o<u;)Kv(r[o],t,0)},Polygon:function(e,t){nA(e.coordinates,t)},MultiPolygon:function(e,t){for(var r=e.coordinates,o=-1,u=r.length;++o<u;)nA(r[o],t)},GeometryCollection:function(e,t){for(var r=e.geometries,o=-1,u=r.length;++o<u;)Rg(r[o],t)}};function Kv(e,t,r){var o=-1,u=e.length-r,d;for(t.lineStart();++o<u;)d=e[o],t.point(d[0],d[1],d[2]);t.lineEnd()}function nA(e,t){var r=-1,o=e.length;for(t.polygonStart();++r<o;)Kv(e[r],t,1);t.polygonEnd()}function xc(e,t){e&&eA.hasOwnProperty(e.type)?eA[e.type](e,t):Rg(e,t)}function Jv(e){return[Ps(e[1],e[0]),eo(e[2])]}function bh(e){var t=e[0],r=e[1],o=Yn(r);return[o*Yn(t),o*Bn(t),Bn(r)]}function Om(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Lg(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function W0(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function Nm(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function eb(e){var t=ya(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}function tb(e,t){function r(o,u){return o=e(o,u),t(o[0],o[1])}return e.invert&&t.invert&&(r.invert=function(o,u){return o=t.invert(o,u),o&&e.invert(o[0],o[1])}),r}function nb(e,t){return Si(e)>Xn&&(e-=Math.round(e/za)*za),[e,t]}nb.invert=nb;function wM(e,t,r){return(e%=za)?t||r?tb(rA(e),aA(t,r)):rA(e):t||r?aA(t,r):nb}function iA(e){return function(t,r){return t+=e,Si(t)>Xn&&(t-=Math.round(t/za)*za),[t,r]}}function rA(e){var t=iA(e);return t.invert=iA(-e),t}function aA(e,t){var r=Yn(e),o=Bn(e),u=Yn(t),d=Bn(t);function p(a,w){var T=Yn(w),S=Yn(a)*T,k=Bn(a)*T,I=Bn(w),P=I*r+S*o;return[Ps(k*u-P*d,S*r-I*o),eo(P*u+k*d)]}return p.invert=function(a,w){var T=Yn(w),S=Yn(a)*T,k=Bn(a)*T,I=Bn(w),P=I*u-k*d;return[Ps(k*u+I*d,S*r+P*o),eo(P*r-S*o)]},p}function Vz(e){e=wM(e[0]*Wi,e[1]*Wi,e.length>2?e[2]*Wi:0);function t(r){return r=e(r[0]*Wi,r[1]*Wi),r[0]*=sa,r[1]*=sa,r}return t.invert=function(r){return r=e.invert(r[0]*Wi,r[1]*Wi),r[0]*=sa,r[1]*=sa,r},t}function Gz(e,t,r,o,u,d){if(r){var p=Yn(t),a=Bn(t),w=o*r;u==null?(u=t+o*za,d=t-w/2):(u=oA(p,u),d=oA(p,d),(o>0?u<d:u>d)&&(u+=o*za));for(var T,S=u;o>0?S>d:S<d;S-=w)T=Jv([p,-a*Yn(S),-a*Bn(S)]),e.point(T[0],T[1])}}function oA(e,t){t=bh(t),t[0]-=e,eb(t);var r=xM(-t[1]);return((-t[2]<0?-r:r)+za-Zn)%za}function AM(){var e=[],t;return{point:function(r,o,u){t.push([r,o,u])},lineStart:function(){e.push(t=[])},lineEnd:Xa,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var r=e;return e=[],t=null,r}}}function pg(e,t){return Si(e[0]-t[0])<Zn&&Si(e[1]-t[1])<Zn}function jm(e,t,r,o){this.x=e,this.z=t,this.o=r,this.e=o,this.v=!1,this.n=this.p=null}function TM(e,t,r,o,u){var d=[],p=[],a,w;if(e.forEach(function(F){if(!((G=F.length-1)<=0)){var G,H=F[0],Y=F[G],$;if(pg(H,Y)){if(!H[2]&&!Y[2]){for(u.lineStart(),a=0;a<G;++a)u.point((H=F[a])[0],H[1]);u.lineEnd();return}Y[0]+=2*Zn}d.push($=new jm(H,F,null,!0)),p.push($.o=new jm(H,null,$,!1)),d.push($=new jm(Y,F,null,!1)),p.push($.o=new jm(Y,null,$,!0))}}),!!d.length){for(p.sort(t),sA(d),sA(p),a=0,w=p.length;a<w;++a)p[a].e=r=!r;for(var T=d[0],S,k;;){for(var I=T,P=!0;I.v;)if((I=I.n)===T)return;S=I.z,u.lineStart();do{if(I.v=I.o.v=!0,I.e){if(P)for(a=0,w=S.length;a<w;++a)u.point((k=S[a])[0],k[1]);else o(I.x,I.n.x,1,u);I=I.n}else{if(P)for(S=I.p.z,a=S.length-1;a>=0;--a)u.point((k=S[a])[0],k[1]);else o(I.x,I.p.x,-1,u);I=I.p}I=I.o,S=I.z,P=!P}while(!I.v);u.lineEnd()}}}function sA(e){if(t=e.length){for(var t,r=0,o=e[0],u;++r<t;)o.n=u=e[r],u.p=o,o=u;o.n=u=e[0],u.p=o}}function Y0(e){return Si(e[0])<=Xn?e[0]:Ya(e[0])*((Si(e[0])+Xn)%za-Xn)}function qz(e,t){var r=Y0(t),o=t[1],u=Bn(o),d=[Bn(r),-Yn(r),0],p=0,a=0,w=new Fc;u===1?o=Yi+Zn:u===-1&&(o=-Yi-Zn);for(var T=0,S=e.length;T<S;++T)if(I=(k=e[T]).length)for(var k,I,P=k[I-1],F=Y0(P),G=P[1]/2+J2,H=Bn(G),Y=Yn(G),$=0;$<I;++$,F=ee,H=re,Y=he,P=ae){var ae=k[$],ee=Y0(ae),ce=ae[1]/2+J2,re=Bn(ce),he=Yn(ce),be=ee-F,ke=be>=0?1:-1,Ie=ke*be,ue=Ie>Xn,Ve=H*re;if(w.add(Ps(Ve*ke*Bn(Ie),Y*he+Ve*Yn(Ie))),p+=ue?be+ke*za:be,ue^F>=r^ee>=r){var Ze=Lg(bh(P),bh(ae));eb(Ze);var Xe=Lg(d,Ze);eb(Xe);var Re=(ue^be>=0?-1:1)*eo(Xe[2]);(o>Re||o===Re&&(Ze[0]||Ze[1]))&&(a+=ue^be>=0?1:-1)}}return(p<-Zn||p<Zn&&w<-vM)^a&1}function SM(e,t,r,o){return function(u){var d=t(u),p=AM(),a=t(p),w=!1,T,S,k,I={point:P,lineStart:G,lineEnd:H,polygonStart:function(){I.point=Y,I.lineStart=$,I.lineEnd=ae,S=[],T=[]},polygonEnd:function(){I.point=P,I.lineStart=G,I.lineEnd=H,S=_M(S);var ee=qz(T,o);S.length?(w||(u.polygonStart(),w=!0),TM(S,Hz,ee,r,u)):ee&&(w||(u.polygonStart(),w=!0),u.lineStart(),r(null,null,1,u),u.lineEnd()),w&&(u.polygonEnd(),w=!1),S=T=null},sphere:function(){u.polygonStart(),u.lineStart(),r(null,null,1,u),u.lineEnd(),u.polygonEnd()}};function P(ee,ce){e(ee,ce)&&u.point(ee,ce)}function F(ee,ce){d.point(ee,ce)}function G(){I.point=F,d.lineStart()}function H(){I.point=P,d.lineEnd()}function Y(ee,ce){k.push([ee,ce]),a.point(ee,ce)}function $(){a.lineStart(),k=[]}function ae(){Y(k[0][0],k[0][1]),a.lineEnd();var ee=a.clean(),ce=p.result(),re,he=ce.length,be,ke,Ie;if(k.pop(),T.push(k),k=null,!!he){if(ee&1){if(ke=ce[0],(be=ke.length-1)>0){for(w||(u.polygonStart(),w=!0),u.lineStart(),re=0;re<be;++re)u.point((Ie=ke[re])[0],Ie[1]);u.lineEnd()}return}he>1&&ee&2&&ce.push(ce.pop().concat(ce.shift())),S.push(ce.filter(Zz))}}return I}}function Zz(e){return e.length>1}function Hz(e,t){return((e=e.x)[0]<0?e[1]-Yi-Zn:Yi-e[1])-((t=t.x)[0]<0?t[1]-Yi-Zn:Yi-t[1])}const lA=SM(function(){return!0},$z,Yz,[-Xn,-Yi]);function $z(e){var t=NaN,r=NaN,o=NaN,u;return{lineStart:function(){e.lineStart(),u=1},point:function(d,p){var a=d>0?Xn:-Xn,w=Si(d-t);Si(w-Xn)<Zn?(e.point(t,r=(r+p)/2>0?Yi:-Yi),e.point(o,r),e.lineEnd(),e.lineStart(),e.point(a,r),e.point(d,r),u=0):o!==a&&w>=Xn&&(Si(t-o)<Zn&&(t-=o*Zn),Si(d-a)<Zn&&(d-=a*Zn),r=Wz(t,r,d,p),e.point(o,r),e.lineEnd(),e.lineStart(),e.point(a,r),u=0),e.point(t=d,r=p),o=a},lineEnd:function(){e.lineEnd(),t=r=NaN},clean:function(){return 2-u}}}function Wz(e,t,r,o){var u,d,p=Bn(e-r);return Si(p)>Zn?Nh((Bn(t)*(d=Yn(o))*Bn(r)-Bn(o)*(u=Yn(t))*Bn(e))/(u*d*p)):(t+o)/2}function Yz(e,t,r,o){var u;if(e==null)u=r*Yi,o.point(-Xn,u),o.point(0,u),o.point(Xn,u),o.point(Xn,0),o.point(Xn,-u),o.point(0,-u),o.point(-Xn,-u),o.point(-Xn,0),o.point(-Xn,u);else if(Si(e[0]-t[0])>Zn){var d=e[0]<t[0]?Xn:-Xn;u=r*d/2,o.point(-d,u),o.point(0,u),o.point(d,u)}else o.point(t[0],t[1])}function Xz(e){var t=Yn(e),r=2*Wi,o=t>0,u=Si(t)>Zn;function d(S,k,I,P){Gz(P,e,r,I,S,k)}function p(S,k){return Yn(S)*Yn(k)>t}function a(S){var k,I,P,F,G;return{lineStart:function(){F=P=!1,G=1},point:function(H,Y){var $=[H,Y],ae,ee=p(H,Y),ce=o?ee?0:T(H,Y):ee?T(H+(H<0?Xn:-Xn),Y):0;if(!k&&(F=P=ee)&&S.lineStart(),ee!==P&&(ae=w(k,$),(!ae||pg(k,ae)||pg($,ae))&&($[2]=1)),ee!==P)G=0,ee?(S.lineStart(),ae=w($,k),S.point(ae[0],ae[1])):(ae=w(k,$),S.point(ae[0],ae[1],2),S.lineEnd()),k=ae;else if(u&&k&&o^ee){var re;!(ce&I)&&(re=w($,k,!0))&&(G=0,o?(S.lineStart(),S.point(re[0][0],re[0][1]),S.point(re[1][0],re[1][1]),S.lineEnd()):(S.point(re[1][0],re[1][1]),S.lineEnd(),S.lineStart(),S.point(re[0][0],re[0][1],3)))}ee&&(!k||!pg(k,$))&&S.point($[0],$[1]),k=$,P=ee,I=ce},lineEnd:function(){P&&S.lineEnd(),k=null},clean:function(){return G|(F&&P)<<1}}}function w(S,k,I){var P=bh(S),F=bh(k),G=[1,0,0],H=Lg(P,F),Y=Om(H,H),$=H[0],ae=Y-$*$;if(!ae)return!I&&S;var ee=t*Y/ae,ce=-t*$/ae,re=Lg(G,H),he=Nm(G,ee),be=Nm(H,ce);W0(he,be);var ke=re,Ie=Om(he,ke),ue=Om(ke,ke),Ve=Ie*Ie-ue*(Om(he,he)-1);if(!(Ve<0)){var Ze=ya(Ve),Xe=Nm(ke,(-Ie-Ze)/ue);if(W0(Xe,he),Xe=Jv(Xe),!I)return Xe;var Re=S[0],ot=k[0],Pt=S[1],bt=k[1],_t;ot<Re&&(_t=Re,Re=ot,ot=_t);var tt=ot-Re,Tt=Si(tt-Xn)<Zn,ct=Tt||tt<Zn;if(!Tt&&bt<Pt&&(_t=Pt,Pt=bt,bt=_t),ct?Tt?Pt+bt>0^Xe[1]<(Si(Xe[0]-Re)<Zn?Pt:bt):Pt<=Xe[1]&&Xe[1]<=bt:tt>Xn^(Re<=Xe[0]&&Xe[0]<=ot)){var mt=Nm(ke,(-Ie+Ze)/ue);return W0(mt,he),[Xe,Jv(mt)]}}}function T(S,k){var I=o?e:Xn-e,P=0;return S<-I?P|=1:S>I&&(P|=2),k<-I?P|=4:k>I&&(P|=8),P}return SM(p,a,d,o?[0,-e]:[-Xn,e-Xn])}function Qz(e,t,r,o,u,d){var p=e[0],a=e[1],w=t[0],T=t[1],S=0,k=1,I=w-p,P=T-a,F;if(F=r-p,!(!I&&F>0)){if(F/=I,I<0){if(F<S)return;F<k&&(k=F)}else if(I>0){if(F>k)return;F>S&&(S=F)}if(F=u-p,!(!I&&F<0)){if(F/=I,I<0){if(F>k)return;F>S&&(S=F)}else if(I>0){if(F<S)return;F<k&&(k=F)}if(F=o-a,!(!P&&F>0)){if(F/=P,P<0){if(F<S)return;F<k&&(k=F)}else if(P>0){if(F>k)return;F>S&&(S=F)}if(F=d-a,!(!P&&F<0)){if(F/=P,P<0){if(F>k)return;F>S&&(S=F)}else if(P>0){if(F<S)return;F<k&&(k=F)}return S>0&&(e[0]=p+S*I,e[1]=a+S*P),k<1&&(t[0]=p+k*I,t[1]=a+k*P),!0}}}}}var _d=1e9,Um=-_d;function MM(e,t,r,o){function u(T,S){return e<=T&&T<=r&&t<=S&&S<=o}function d(T,S,k,I){var P=0,F=0;if(T==null||(P=p(T,k))!==(F=p(S,k))||w(T,S)<0^k>0)do I.point(P===0||P===3?e:r,P>1?o:t);while((P=(P+k+4)%4)!==F);else I.point(S[0],S[1])}function p(T,S){return Si(T[0]-e)<Zn?S>0?0:3:Si(T[0]-r)<Zn?S>0?2:1:Si(T[1]-t)<Zn?S>0?1:0:S>0?3:2}function a(T,S){return w(T.x,S.x)}function w(T,S){var k=p(T,1),I=p(S,1);return k!==I?k-I:k===0?S[1]-T[1]:k===1?T[0]-S[0]:k===2?T[1]-S[1]:S[0]-T[0]}return function(T){var S=T,k=AM(),I,P,F,G,H,Y,$,ae,ee,ce,re,he={point:be,lineStart:Ve,lineEnd:Ze,polygonStart:Ie,polygonEnd:ue};function be(Re,ot){u(Re,ot)&&S.point(Re,ot)}function ke(){for(var Re=0,ot=0,Pt=P.length;ot<Pt;++ot)for(var bt=P[ot],_t=1,tt=bt.length,Tt=bt[0],ct,mt,Xt=Tt[0],Ut=Tt[1];_t<tt;++_t)ct=Xt,mt=Ut,Tt=bt[_t],Xt=Tt[0],Ut=Tt[1],mt<=o?Ut>o&&(Xt-ct)*(o-mt)>(Ut-mt)*(e-ct)&&++Re:Ut<=o&&(Xt-ct)*(o-mt)<(Ut-mt)*(e-ct)&&--Re;return Re}function Ie(){S=k,I=[],P=[],re=!0}function ue(){var Re=ke(),ot=re&&Re,Pt=(I=_M(I)).length;(ot||Pt)&&(T.polygonStart(),ot&&(T.lineStart(),d(null,null,1,T),T.lineEnd()),Pt&&TM(I,a,Re,d,T),T.polygonEnd()),S=T,I=P=F=null}function Ve(){he.point=Xe,P&&P.push(F=[]),ce=!0,ee=!1,$=ae=NaN}function Ze(){I&&(Xe(G,H),Y&&ee&&k.rejoin(),I.push(k.result())),he.point=be,ee&&S.lineEnd()}function Xe(Re,ot){var Pt=u(Re,ot);if(P&&F.push([Re,ot]),ce)G=Re,H=ot,Y=Pt,ce=!1,Pt&&(S.lineStart(),S.point(Re,ot));else if(Pt&&ee)S.point(Re,ot);else{var bt=[$=Math.max(Um,Math.min(_d,$)),ae=Math.max(Um,Math.min(_d,ae))],_t=[Re=Math.max(Um,Math.min(_d,Re)),ot=Math.max(Um,Math.min(_d,ot))];Qz(bt,_t,e,t,r,o)?(ee||(S.lineStart(),S.point(bt[0],bt[1])),S.point(_t[0],_t[1]),Pt||S.lineEnd(),re=!1):Pt&&(S.lineStart(),S.point(Re,ot),re=!1)}$=Re,ae=ot,ee=Pt}return he}}const ib=e=>e;var X0=new Fc,rb=new Fc,CM,IM,ab,ob,As={point:Xa,lineStart:Xa,lineEnd:Xa,polygonStart:function(){As.lineStart=Kz,As.lineEnd=eR},polygonEnd:function(){As.lineStart=As.lineEnd=As.point=Xa,X0.add(Si(rb)),rb=new Fc},result:function(){var e=X0/2;return X0=new Fc,e}};function Kz(){As.point=Jz}function Jz(e,t){As.point=EM,CM=ab=e,IM=ob=t}function EM(e,t){rb.add(ob*e-ab*t),ab=e,ob=t}function eR(){EM(CM,IM)}var xh=1/0,Bg=xh,Nd=-xh,Fg=Nd,Og={point:tR,lineStart:Xa,lineEnd:Xa,polygonStart:Xa,polygonEnd:Xa,result:function(){var e=[[xh,Bg],[Nd,Fg]];return Nd=Fg=-(Bg=xh=1/0),e}};function tR(e,t){e<xh&&(xh=e),e>Nd&&(Nd=e),t<Bg&&(Bg=t),t>Fg&&(Fg=t)}var sb=0,lb=0,yd=0,Ng=0,jg=0,ih=0,cb=0,ub=0,vd=0,PM,kM,Uo,Vo,$a={point:Nc,lineStart:cA,lineEnd:uA,polygonStart:function(){$a.lineStart=rR,$a.lineEnd=aR},polygonEnd:function(){$a.point=Nc,$a.lineStart=cA,$a.lineEnd=uA},result:function(){var e=vd?[cb/vd,ub/vd]:ih?[Ng/ih,jg/ih]:yd?[sb/yd,lb/yd]:[NaN,NaN];return sb=lb=yd=Ng=jg=ih=cb=ub=vd=0,e}};function Nc(e,t){sb+=e,lb+=t,++yd}function cA(){$a.point=nR}function nR(e,t){$a.point=iR,Nc(Uo=e,Vo=t)}function iR(e,t){var r=e-Uo,o=t-Vo,u=ya(r*r+o*o);Ng+=u*(Uo+e)/2,jg+=u*(Vo+t)/2,ih+=u,Nc(Uo=e,Vo=t)}function uA(){$a.point=Nc}function rR(){$a.point=oR}function aR(){DM(PM,kM)}function oR(e,t){$a.point=DM,Nc(PM=Uo=e,kM=Vo=t)}function DM(e,t){var r=e-Uo,o=t-Vo,u=ya(r*r+o*o);Ng+=u*(Uo+e)/2,jg+=u*(Vo+t)/2,ih+=u,u=Vo*e-Uo*t,cb+=u*(Uo+e),ub+=u*(Vo+t),vd+=u*3,Nc(Uo=e,Vo=t)}function zM(e){this._context=e}zM.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(e,t){switch(this._point){case 0:{this._context.moveTo(e,t),this._point=1;break}case 1:{this._context.lineTo(e,t);break}default:{this._context.moveTo(e+this._radius,t),this._context.arc(e,t,this._radius,0,za);break}}},result:Xa};var hb=new Fc,Q0,RM,LM,bd,xd,jd={point:Xa,lineStart:function(){jd.point=sR},lineEnd:function(){Q0&&BM(RM,LM),jd.point=Xa},polygonStart:function(){Q0=!0},polygonEnd:function(){Q0=null},result:function(){var e=+hb;return hb=new Fc,e}};function sR(e,t){jd.point=BM,RM=bd=e,LM=xd=t}function BM(e,t){bd-=e,xd-=t,hb.add(ya(bd*bd+xd*xd)),bd=e,xd=t}let hA,Ug,fA,dA;class pA{constructor(t){this._append=t==null?FM:lR(t),this._radius=4.5,this._=""}pointRadius(t){return this._radius=+t,this}polygonStart(){this._line=0}polygonEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){this._line===0&&(this._+="Z"),this._point=NaN}point(t,r){switch(this._point){case 0:{this._append`M${t},${r}`,this._point=1;break}case 1:{this._append`L${t},${r}`;break}default:{if(this._append`M${t},${r}`,this._radius!==fA||this._append!==Ug){const o=this._radius,u=this._;this._="",this._append`m0,${o}a${o},${o} 0 1,1 0,${-2*o}a${o},${o} 0 1,1 0,${2*o}z`,fA=o,Ug=this._append,dA=this._,this._=u}this._+=dA;break}}}result(){const t=this._;return this._="",t.length?t:null}}function FM(e){let t=1;this._+=e[0];for(const r=e.length;t<r;++t)this._+=arguments[t]+e[t]}function lR(e){const t=Math.floor(e);if(!(t>=0))throw new RangeError(`invalid digits: ${e}`);if(t>15)return FM;if(t!==hA){const r=10**t;hA=t,Ug=function(u){let d=1;this._+=u[0];for(const p=u.length;d<p;++d)this._+=Math.round(arguments[d]*r)/r+u[d]}}return Ug}function b1(e,t){let r=3,o=4.5,u,d;function p(a){return a&&(typeof o=="function"&&d.pointRadius(+o.apply(this,arguments)),xc(a,u(d))),d.result()}return p.area=function(a){return xc(a,u(As)),As.result()},p.measure=function(a){return xc(a,u(jd)),jd.result()},p.bounds=function(a){return xc(a,u(Og)),Og.result()},p.centroid=function(a){return xc(a,u($a)),$a.result()},p.projection=function(a){return arguments.length?(u=a==null?(e=null,ib):(e=a).stream,p):e},p.context=function(a){return arguments.length?(d=a==null?(t=null,new pA(r)):new zM(t=a),typeof o!="function"&&d.pointRadius(o),p):t},p.pointRadius=function(a){return arguments.length?(o=typeof a=="function"?a:(d.pointRadius(+a),+a),p):o},p.digits=function(a){if(!arguments.length)return r;if(a==null)r=null;else{const w=Math.floor(a);if(!(w>=0))throw new RangeError(`invalid digits: ${a}`);r=w}return t===null&&(d=new pA(r)),p},p.projection(e).digits(r).context(t)}function Vg(e){return{stream:B_(e)}}function B_(e){return function(t){var r=new fb;for(var o in e)r[o]=e[o];return r.stream=t,r}}function fb(){}fb.prototype={constructor:fb,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function x1(e,t,r){var o=e.clipExtent&&e.clipExtent();return e.scale(150).translate([0,0]),o!=null&&e.clipExtent(null),xc(r,e.stream(Og)),t(Og.result()),o!=null&&e.clipExtent(o),e}function w1(e,t,r){return x1(e,function(o){var u=t[1][0]-t[0][0],d=t[1][1]-t[0][1],p=Math.min(u/(o[1][0]-o[0][0]),d/(o[1][1]-o[0][1])),a=+t[0][0]+(u-p*(o[1][0]+o[0][0]))/2,w=+t[0][1]+(d-p*(o[1][1]+o[0][1]))/2;e.scale(150*p).translate([a,w])},r)}function OM(e,t,r){return w1(e,[[0,0],t],r)}function NM(e,t,r){return x1(e,function(o){var u=+t,d=u/(o[1][0]-o[0][0]),p=(u-d*(o[1][0]+o[0][0]))/2,a=-d*o[0][1];e.scale(150*d).translate([p,a])},r)}function jM(e,t,r){return x1(e,function(o){var u=+t,d=u/(o[1][1]-o[0][1]),p=-d*o[0][0],a=(u-d*(o[1][1]+o[0][1]))/2;e.scale(150*d).translate([p,a])},r)}var mA=16,cR=Yn(30*Wi);function gA(e,t){return+t?hR(e,t):uR(e)}function uR(e){return B_({point:function(t,r){t=e(t,r),this.stream.point(t[0],t[1])}})}function hR(e,t){function r(o,u,d,p,a,w,T,S,k,I,P,F,G,H){var Y=T-o,$=S-u,ae=Y*Y+$*$;if(ae>4*t&&G--){var ee=p+I,ce=a+P,re=w+F,he=ya(ee*ee+ce*ce+re*re),be=eo(re/=he),ke=Si(Si(re)-1)<Zn||Si(d-k)<Zn?(d+k)/2:Ps(ce,ee),Ie=e(ke,be),ue=Ie[0],Ve=Ie[1],Ze=ue-o,Xe=Ve-u,Re=$*Ze-Y*Xe;(Re*Re/ae>t||Si((Y*Ze+$*Xe)/ae-.5)>.3||p*I+a*P+w*F<cR)&&(r(o,u,d,p,a,w,ue,Ve,ke,ee/=he,ce/=he,re,G,H),H.point(ue,Ve),r(ue,Ve,ke,ee,ce,re,T,S,k,I,P,F,G,H))}}return function(o){var u,d,p,a,w,T,S,k,I,P,F,G,H={point:Y,lineStart:$,lineEnd:ee,polygonStart:function(){o.polygonStart(),H.lineStart=ce},polygonEnd:function(){o.polygonEnd(),H.lineStart=$}};function Y(be,ke){be=e(be,ke),o.point(be[0],be[1])}function $(){k=NaN,H.point=ae,o.lineStart()}function ae(be,ke){var Ie=bh([be,ke]),ue=e(be,ke);r(k,I,S,P,F,G,k=ue[0],I=ue[1],S=be,P=Ie[0],F=Ie[1],G=Ie[2],mA,o),o.point(k,I)}function ee(){H.point=Y,o.lineEnd()}function ce(){$(),H.point=re,H.lineEnd=he}function re(be,ke){ae(u=be,ke),d=k,p=I,a=P,w=F,T=G,H.point=ae}function he(){r(k,I,S,P,F,G,d,p,u,a,w,T,mA,o),H.lineEnd=ee,ee()}return H}}var fR=B_({point:function(e,t){this.stream.point(e*Wi,t*Wi)}});function dR(e){return B_({point:function(t,r){var o=e(t,r);return this.stream.point(o[0],o[1])}})}function pR(e,t,r,o,u){function d(p,a){return p*=o,a*=u,[t+e*p,r-e*a]}return d.invert=function(p,a){return[(p-t)/e*o,(r-a)/e*u]},d}function _A(e,t,r,o,u,d){if(!d)return pR(e,t,r,o,u);var p=Yn(d),a=Bn(d),w=p*e,T=a*e,S=p/e,k=a/e,I=(a*r-p*t)/e,P=(a*t+p*r)/e;function F(G,H){return G*=o,H*=u,[w*G-T*H+t,r-T*G-w*H]}return F.invert=function(G,H){return[o*(S*G-k*H+I),u*(P-k*G-S*H)]},F}function El(e){return UM(function(){return e})()}function UM(e){var t,r=150,o=480,u=250,d=0,p=0,a=0,w=0,T=0,S,k=0,I=1,P=1,F=null,G=lA,H=null,Y,$,ae,ee=ib,ce=.5,re,he,be,ke,Ie;function ue(Re){return be(Re[0]*Wi,Re[1]*Wi)}function Ve(Re){return Re=be.invert(Re[0],Re[1]),Re&&[Re[0]*sa,Re[1]*sa]}ue.stream=function(Re){return ke&&Ie===Re?ke:ke=fR(dR(S)(G(re(ee(Ie=Re)))))},ue.preclip=function(Re){return arguments.length?(G=Re,F=void 0,Xe()):G},ue.postclip=function(Re){return arguments.length?(ee=Re,H=Y=$=ae=null,Xe()):ee},ue.clipAngle=function(Re){return arguments.length?(G=+Re?Xz(F=Re*Wi):(F=null,lA),Xe()):F*sa},ue.clipExtent=function(Re){return arguments.length?(ee=Re==null?(H=Y=$=ae=null,ib):MM(H=+Re[0][0],Y=+Re[0][1],$=+Re[1][0],ae=+Re[1][1]),Xe()):H==null?null:[[H,Y],[$,ae]]},ue.scale=function(Re){return arguments.length?(r=+Re,Ze()):r},ue.translate=function(Re){return arguments.length?(o=+Re[0],u=+Re[1],Ze()):[o,u]},ue.center=function(Re){return arguments.length?(d=Re[0]%360*Wi,p=Re[1]%360*Wi,Ze()):[d*sa,p*sa]},ue.rotate=function(Re){return arguments.length?(a=Re[0]%360*Wi,w=Re[1]%360*Wi,T=Re.length>2?Re[2]%360*Wi:0,Ze()):[a*sa,w*sa,T*sa]},ue.angle=function(Re){return arguments.length?(k=Re%360*Wi,Ze()):k*sa},ue.reflectX=function(Re){return arguments.length?(I=Re?-1:1,Ze()):I<0},ue.reflectY=function(Re){return arguments.length?(P=Re?-1:1,Ze()):P<0},ue.precision=function(Re){return arguments.length?(re=gA(he,ce=Re*Re),Xe()):ya(ce)},ue.fitExtent=function(Re,ot){return w1(ue,Re,ot)},ue.fitSize=function(Re,ot){return OM(ue,Re,ot)},ue.fitWidth=function(Re,ot){return NM(ue,Re,ot)},ue.fitHeight=function(Re,ot){return jM(ue,Re,ot)};function Ze(){var Re=_A(r,0,0,I,P,k).apply(null,t(d,p)),ot=_A(r,o-Re[0],u-Re[1],I,P,k);return S=wM(a,w,T),he=tb(t,ot),be=tb(S,he),re=gA(he,ce),Xe()}function Xe(){return ke=Ie=null,ue}return function(){return t=e.apply(this,arguments),ue.invert=t.invert&&Ve,Ze()}}function A1(e){var t=0,r=Xn/3,o=UM(e),u=o(t,r);return u.parallels=function(d){return arguments.length?o(t=d[0]*Wi,r=d[1]*Wi):[t*sa,r*sa]},u}function mR(e){var t=Yn(e);function r(o,u){return[o*t,Bn(u)/t]}return r.invert=function(o,u){return[o/t,eo(u*t)]},r}function gR(e,t){var r=Bn(e),o=(r+Bn(t))/2;if(Si(o)<Zn)return mR(e);var u=1+r*(2*o-r),d=ya(u)/o;function p(a,w){var T=ya(u-2*o*Bn(w))/o;return[T*Bn(a*=o),d-T*Yn(a)]}return p.invert=function(a,w){var T=d-w,S=Ps(a,Si(T))*Ya(T);return T*o<0&&(S-=Xn*Ya(a)*Ya(T)),[S/o,eo((u-(a*a+T*T)*o*o)/(2*o))]},p}function Gg(){return A1(gR).scale(155.424).center([0,33.6442])}function VM(){return Gg().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function _R(e){var t=e.length;return{point:function(r,o){for(var u=-1;++u<t;)e[u].point(r,o)},sphere:function(){for(var r=-1;++r<t;)e[r].sphere()},lineStart:function(){for(var r=-1;++r<t;)e[r].lineStart()},lineEnd:function(){for(var r=-1;++r<t;)e[r].lineEnd()},polygonStart:function(){for(var r=-1;++r<t;)e[r].polygonStart()},polygonEnd:function(){for(var r=-1;++r<t;)e[r].polygonEnd()}}}function yR(){var e,t,r=VM(),o,u=Gg().rotate([154,0]).center([-2,58.5]).parallels([55,65]),d,p=Gg().rotate([157,0]).center([-3,19.9]).parallels([8,18]),a,w,T={point:function(I,P){w=[I,P]}};function S(I){var P=I[0],F=I[1];return w=null,o.point(P,F),w||(d.point(P,F),w)||(a.point(P,F),w)}S.invert=function(I){var P=r.scale(),F=r.translate(),G=(I[0]-F[0])/P,H=(I[1]-F[1])/P;return(H>=.12&&H<.234&&G>=-.425&&G<-.214?u:H>=.166&&H<.234&&G>=-.214&&G<-.115?p:r).invert(I)},S.stream=function(I){return e&&t===I?e:e=_R([r.stream(t=I),u.stream(I),p.stream(I)])},S.precision=function(I){return arguments.length?(r.precision(I),u.precision(I),p.precision(I),k()):r.precision()},S.scale=function(I){return arguments.length?(r.scale(I),u.scale(I*.35),p.scale(I),S.translate(r.translate())):r.scale()},S.translate=function(I){if(!arguments.length)return r.translate();var P=r.scale(),F=+I[0],G=+I[1];return o=r.translate(I).clipExtent([[F-.455*P,G-.238*P],[F+.455*P,G+.238*P]]).stream(T),d=u.translate([F-.307*P,G+.201*P]).clipExtent([[F-.425*P+Zn,G+.12*P+Zn],[F-.214*P-Zn,G+.234*P-Zn]]).stream(T),a=p.translate([F-.205*P,G+.212*P]).clipExtent([[F-.214*P+Zn,G+.166*P+Zn],[F-.115*P-Zn,G+.234*P-Zn]]).stream(T),k()},S.fitExtent=function(I,P){return w1(S,I,P)},S.fitSize=function(I,P){return OM(S,I,P)},S.fitWidth=function(I,P){return NM(S,I,P)},S.fitHeight=function(I,P){return jM(S,I,P)};function k(){return e=t=null,S}return S.scale(1070)}function GM(e){return function(t,r){var o=Yn(t),u=Yn(r),d=e(o*u);return d===1/0?[2,0]:[d*u*Bn(t),d*Bn(r)]}}function up(e){return function(t,r){var o=ya(t*t+r*r),u=e(o),d=Bn(u),p=Yn(u);return[Ps(t*d,o*p),eo(o&&r*d/o)]}}var qM=GM(function(e){return ya(2/(1+e))});qM.invert=up(function(e){return 2*eo(e/2)});function vR(){return El(qM).scale(124.75).clipAngle(180-.001)}var ZM=GM(function(e){return(e=xM(e))&&e/Bn(e)});ZM.invert=up(function(e){return e});function bR(){return El(ZM).scale(79.4188).clipAngle(180-.001)}function F_(e,t){return[e,zg(v1((Yi+t)/2))]}F_.invert=function(e,t){return[e,2*Nh(bM(t))-Yi]};function xR(){return HM(F_).scale(961/za)}function HM(e){var t=El(e),r=t.center,o=t.scale,u=t.translate,d=t.clipExtent,p=null,a,w,T;t.scale=function(k){return arguments.length?(o(k),S()):o()},t.translate=function(k){return arguments.length?(u(k),S()):u()},t.center=function(k){return arguments.length?(r(k),S()):r()},t.clipExtent=function(k){return arguments.length?(k==null?p=a=w=T=null:(p=+k[0][0],a=+k[0][1],w=+k[1][0],T=+k[1][1]),S()):p==null?null:[[p,a],[w,T]]};function S(){var k=Xn*o(),I=t(Vz(t.rotate()).invert([0,0]));return d(p==null?[[I[0]-k,I[1]-k],[I[0]+k,I[1]+k]]:e===F_?[[Math.max(I[0]-k,p),a],[Math.min(I[0]+k,w),T]]:[[p,Math.max(I[1]-k,a)],[w,Math.min(I[1]+k,T)]])}return S()}function Vm(e){return v1((Yi+e)/2)}function wR(e,t){var r=Yn(e),o=e===t?Bn(e):zg(r/Yn(t))/zg(Vm(t)/Vm(e)),u=r*$0(Vm(e),o)/o;if(!o)return F_;function d(p,a){u>0?a<-Yi+Zn&&(a=-Yi+Zn):a>Yi-Zn&&(a=Yi-Zn);var w=u/$0(Vm(a),o);return[w*Bn(o*p),u-w*Yn(o*p)]}return d.invert=function(p,a){var w=u-a,T=Ya(o)*ya(p*p+w*w),S=Ps(p,Si(w))*Ya(w);return w*o<0&&(S-=Xn*Ya(p)*Ya(w)),[S/o,2*Nh($0(u/T,1/o))-Yi]},d}function AR(){return A1(wR).scale(109.5).parallels([30,30])}function qg(e,t){return[e,t]}qg.invert=qg;function TR(){return El(qg).scale(152.63)}function SR(e,t){var r=Yn(e),o=e===t?Bn(e):(r-Yn(t))/(t-e),u=r/o+e;if(Si(o)<Zn)return qg;function d(p,a){var w=u-a,T=o*p;return[w*Bn(T),u-w*Yn(T)]}return d.invert=function(p,a){var w=u-a,T=Ps(p,Si(w))*Ya(w);return w*o<0&&(T-=Xn*Ya(p)*Ya(w)),[T/o,u-Ya(o)*ya(p*p+w*w)]},d}function MR(){return A1(SR).scale(131.154).center([0,13.9389])}var Id=1.340264,Ed=-.081106,Pd=893e-6,kd=.003796,Zg=ya(3)/2,CR=12;function $M(e,t){var r=eo(Zg*Bn(t)),o=r*r,u=o*o*o;return[e*Yn(r)/(Zg*(Id+3*Ed*o+u*(7*Pd+9*kd*o))),r*(Id+Ed*o+u*(Pd+kd*o))]}$M.invert=function(e,t){for(var r=t,o=r*r,u=o*o*o,d=0,p,a,w;d<CR&&(a=r*(Id+Ed*o+u*(Pd+kd*o))-t,w=Id+3*Ed*o+u*(7*Pd+9*kd*o),r-=p=a/w,o=r*r,u=o*o*o,!(Si(p)<vM));++d);return[Zg*e*(Id+3*Ed*o+u*(7*Pd+9*kd*o))/Yn(r),eo(Bn(r)/Zg)]};function IR(){return El($M).scale(177.158)}function WM(e,t){var r=Yn(t),o=Yn(e)*r;return[r*Bn(e)/o,Bn(t)/o]}WM.invert=up(Nh);function ER(){return El(WM).scale(144.049).clipAngle(60)}function YM(e,t){return[Yn(t)*Bn(e),Bn(t)]}YM.invert=up(eo);function PR(){return El(YM).scale(249.5).clipAngle(90+Zn)}function XM(e,t){var r=Yn(t),o=1+Yn(e)*r;return[r*Bn(e)/o,Bn(t)/o]}XM.invert=up(function(e){return 2*Nh(e)});function kR(){return El(XM).scale(250).clipAngle(142)}function QM(e,t){return[zg(v1((Yi+t)/2)),-e]}QM.invert=function(e,t){return[-t,2*Nh(bM(e))-Yi]};function DR(){var e=HM(QM),t=e.center,r=e.rotate;return e.center=function(o){return arguments.length?t([-o[1],o[0]]):(o=t(),[o[1],-o[0]])},e.rotate=function(o){return arguments.length?r([o[0],o[1],o.length>2?o[2]+90:90]):(o=r(),[o[0],o[1],o[2]-90])},r([0,0,90]).scale(159.155)}var zR=tn('<div class="sv-popup"><!></div>');function RR(e,t){nr(t,!0);let r=Se(t,"closeButton",3,void 0),o=Se(t,"closeOnClickOutside",3,!0),u=Se(t,"closeOnClickInside",3,!1),d=Se(t,"closeOnMove",3,!1),p=Se(t,"openOn",3,"click"),a=Se(t,"openIfTopMost",3,!0),w=Se(t,"focusAfterOpen",3,!0),T=Se(t,"anchor",3,void 0),S=Se(t,"offset",3,void 0),k=Se(t,"popupClass",3,void 0),I=Se(t,"maxWidth",3,void 0),P=Se(t,"lngLat",15,void 0),F=Se(t,"html",3,void 0),G=Se(t,"open",15,!1),H=Se(t,"onopen",3,void 0),Y=Se(t,"onclose",3,void 0),$=Se(t,"onhover",3,void 0),ae=ND();const ee=Vt(Oh),ce=Vt(()=>L(ee).map),re=Vt(()=>L(ee).eventTopMost),he=Vt(()=>L(ee).markerClickManager),be=Vt(()=>L(ee).loaded),ke=RD(),Ie=FD(),ue=BD(),Ve=["click","dblclick","contextmenu"];let Ze=$t(void 0),Xe=$t(!1),Re=$t(void 0);function ot(){if(!L(Ze))return;let st=L(Ze).getElement();!st||st===L(Re)||(Qe(Re,st,!0),p()==="hover"&&(L(Re).style.pointerEvents="none"),L(Re).addEventListener("mouseenter",()=>{Qe(Xe,!0)},{passive:!0}),L(Re).addEventListener("mouseleave",()=>{Qe(Xe,!1)},{passive:!0}),L(Re).addEventListener("click",()=>{u()&&G(!1)},{passive:!0}))}u1(()=>{if(L(ce))return L(ce).on("click",Ft),L(ce).on("contextmenu",Ft),L(he).add(nt),typeof(ue==null?void 0:ue.value)=="string"&&(L(ce).on("click",ue.value,ct),L(ce).on("dblclick",ue.value,ct),L(ce).on("contextmenu",ue.value,ct),L(ce).on("mousemove",ue.value,pt),L(ce).on("mouseleave",ue.value,St),L(ce).on("touchstart",ue.value,Xt),L(ce).on("touchend",ue.value,Ut)),()=>{var st;L(be)&&((st=L(Ze))==null||st.remove(),L(ce).off("click",Ft),L(ce).off("contextmenu",Ft),L(he).remove(nt),(ue==null?void 0:ue.value)instanceof Ea.Marker?ue.value.getPopup()===L(Ze)&&ue.value.setPopup(void 0):typeof(ue==null?void 0:ue.value)=="string"&&(L(ce).off("click",ue.value,ct),L(ce).off("dblclick",ue.value,ct),L(ce).off("contextmenu",ue.value,ct),L(ce).off("mousemove",ue.value,pt),L(ce).off("mouseleave",ue.value,St),L(ce).off("touchstart",ue.value,Xt),L(ce).off("touchend",ue.value,Ut)))}});function Pt(){if(t.canOpen&&!t.canOpen(L(_t))){G(!1);return}G(!0)}function bt(st){return a()?!("marker"in st)&&!GD(st)&&L(re)(st)!==(ke==null?void 0:ke.value):!1}let _t=$t(void 0),tt=$t("normal");function Tt(st){"layerType"in st&&st.layerType==="deckgl"?(P(st.coordinate),Qe(_t,st.object?[st.object]:void 0,!0)):(P(st.lngLat),Qe(_t,st.features??[],!0))}function ct(st){st.type!==p()||bt(st)||(Tt(st),setTimeout(Pt))}let mt;function Xt(st){mt=st.point}function Ut(st){var qe;if(!mt||p()!=="hover")return;let ht=mt.dist(st.point);mt=void 0,ht<3&&(P(st.lngLat),Qe(_t,st.features??[],!0),(qe=L(Ze))!=null&&qe.isOpen()?Qe(tt,"justOpened"):(Qe(tt,"opening"),Pt()))}function St(st){p()!=="hover"||mt||L(tt)!=="normal"||(G(!1),Qe(_t,void 0))}function pt(st){if(!(p()!=="hover"||mt||L(tt)!=="normal")){if(bt(st)){G(!1),Qe(_t,void 0);return}Qe(_t,st.features??[],!0),P(st.lngLat),Pt()}}function Ft(st){var qe,Mt;if(L(tt)==="justOpened"){Qe(tt,"normal");return}if(!o())return;let ht=[L(Re),(ue==null?void 0:ue.value)instanceof Ea.Marker?(qe=ue.value)==null?void 0:qe.getElement():void 0];G()&&((Mt=L(Ze))!=null&&Mt.isOpen())&&!ht.some(Ht=>Ht==null?void 0:Ht.contains(st.originalEvent.target))&&(st.type==="contextmenu"&&p()==="contextmenu"||st.type!=="contextmenu")&&G(!1)}function nt(st){var ht;o()&&G()&&((ht=L(Ze))!=null&&ht.isOpen())&&st.marker!==(ue==null?void 0:ue.value)&&G(!1)}Fh(()=>{var st;L(be)&&((st=L(Ze))!=null&&st.isOpen())&&L(Ze).remove()});let De=$t(void 0),Ke=Vt(()=>r()??(!o()&&!u()));ei(()=>{if(!L(Ze)){let st=k()?`${k()} sv-maplibregl-popup`:"sv-maplibregl-popup";Qe(Ze,new Ea.Popup({closeButton:L(Ke),closeOnClick:!1,closeOnMove:d(),focusAfterOpen:w(),maxWidth:I(),className:st,anchor:T(),offset:S()}),!0),Qe(Re,L(Ze).getElement(),!0),L(Ze).on("open",()=>{var ht;Pt(),G()&&(ot(),(ht=H())==null||ht(L(Ze)))}),L(Ze).on("close",()=>{var ht;G(!1),(ht=Y())==null||ht(L(Ze))}),$()&&L(Ze).on("hover",()=>{var ht;(ht=$())==null||ht(L(Ze))})}}),ei(()=>{L(Ze)&&(ue==null?void 0:ue.value)instanceof Ea.Marker&&(p()==="click"?ue.value.setPopup(L(Ze)):ue.value.getPopup()===L(Ze)&&ue.value.setPopup(void 0))}),ei(()=>{var st;Ve.includes(p())&&((st=Ie.value)==null?void 0:st.type)===p()&&(ct(Ie.value),Ie.value=void 0)});let Be=Vt(()=>{var st,ht;return p()==="hover"&&(((st=Ie.value)==null?void 0:st.type)==="mousemove"||((ht=Ie.value)==null?void 0:ht.type)==="mouseenter")});ei(()=>{p()==="hover"&&Ie&&(L(Be)&&Ie.value&&Tt(Ie.value),L(Be)||L(Xe)?Pt():G(!1))}),ei(()=>{var st,ht;L(De)?(st=L(Ze))==null||st.setDOMContent(L(De)):F()&&((ht=L(Ze))==null||ht.setHTML(F()))}),ei(()=>{var ht;let st=P()??(ae==null?void 0:ae.value)??void 0;st&&((ht=L(Ze))==null||ht.setLngLat(st))}),ei(()=>{if(L(ce)&&L(Ze)){let st=L(Ze).isOpen();G()&&!st?(L(Ze).addTo(L(ce)),L(tt)==="opening"&&Qe(tt,"justOpened")):!G()&&st&&L(Ze).remove()}});var wt=Ti(),gt=Kn(wt);{var Rt=st=>{var ht=zR(),qe=Bt(ht);{var Mt=Ht=>{var _n=Ti(),In=Kn(_n);jr(In,()=>t.children??Ha,()=>{var yt;return{features:L(_t),data:((yt=L(_t))==null?void 0:yt[0])??void 0,map:L(ce),close:()=>G(!1),isOpen:G()}}),It(Ht,_n)};pn(qe,Ht=>{var _n;((_n=L(_t))!=null&&_n.length||(ue==null?void 0:ue.value)instanceof Ea.Marker||!ue&&G())&&Ht(Mt)})}Et(ht),Go(ht,Ht=>Qe(De,Ht),()=>L(De)),It(st,ht)};pn(gt,st=>{t.children&&st(Rt)})}It(e,wt),ir()}var hp=Uint8Array,KM=Uint16Array,LR=Int32Array,BR=new hp([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),FR=new hp([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),JM=function(e,t){for(var r=new KM(31),o=0;o<31;++o)r[o]=t+=1<<e[o-1];for(var u=new LR(r[30]),o=1;o<30;++o)for(var d=r[o];d<r[o+1];++d)u[d]=d-r[o]<<5|o;return{b:r,r:u}},eC=JM(BR,2),OR=eC.b,NR=eC.r;OR[28]=258,NR[258]=28;JM(FR,0);var jR=new KM(32768);for(pi=0;pi<32768;++pi)ps=(pi&43690)>>1|(pi&21845)<<1,ps=(ps&52428)>>2|(ps&13107)<<2,ps=(ps&61680)>>4|(ps&3855)<<4,jR[pi]=((ps&65280)>>8|(ps&255)<<8)>>1;var ps,pi,O_=new hp(288);for(pi=0;pi<144;++pi)O_[pi]=8;var pi;for(pi=144;pi<256;++pi)O_[pi]=9;var pi;for(pi=256;pi<280;++pi)O_[pi]=7;var pi;for(pi=280;pi<288;++pi)O_[pi]=8;var pi,UR=new hp(32);for(pi=0;pi<32;++pi)UR[pi]=5;var pi,VR=new hp(0),GR=typeof TextDecoder<"u"&&new TextDecoder,qR=0;try{GR.decode(VR,{stream:!0}),qR=1}catch{}var ZR=tn('<div class="flex flex-col items-start"><p class="text-[0.67rem] whitespace-nowrap uppercase leading-none text-gray-300"> </p> <p class="text-base leading-tight"> </p></div>'),HR=tn('<div class="flex flex-col gap-2 w-40"></div>');function $R(e,t){nr(t,!0);const r={station_id:"Station ID",station_type:"Type",site_name:"Site Name"};var o=HR();Pr(o,21,()=>Object.keys(r),la,(u,d)=>{var p=Ti(),a=Kn(p);{var w=T=>{var S=ZR(),k=Bt(S),I=Bt(k,!0);Et(k);var P=an(k,2),F=Bt(P,!0);Et(P),Et(S),wn(()=>{var G;xi(I,r[L(d)]),xi(F,(G=t.properties)==null?void 0:G[L(d)])}),It(T,S)};pn(a,T=>{var S;(S=t.properties)!=null&&S[L(d)]&&T(w)})}It(u,p)}),Et(o),It(e,o),ir()}const WR=["#4053d3","#ddb310","#bf1d14","#00beff","#fb49b0","#00b25d"],tC=["bg-[#4053d3] hover:bg-[#4053d3]/75","bg-[#ddb310] hover:bg-[#ddb310]/75","bg-[#bf1d14] hover:bg-[#bf1d14]/75","bg-[#00beff] hover:bg-[#00beff]/75","bg-[#fb49b0] hover:bg-[#fb49b0]/75","bg-[#00b25d] hover:bg-[#00b25d]/75"],K0={AWS:"bg-[#44AA99] hover:bg-[#88CCEE]",OTT:"bg-[#AA4499] hover:bg-[#CC6677]"};var YR=(e,t,r)=>{Qe(t,r.satellite,!0)},XR=(e,t,r)=>{Qe(t,r.light,!0)},QR=tn('<div class="flex flex-row items-center gap-1"><div></div> <span> </span></div>'),KR=tn(`<div class="w-full h-full min-h-96 relative flex flex-col items-center"><!> <div class="
            absolute bottom-12
            bg-white border-gray-300 border p-2 flex flex-row items-center gap-4
        "><div class="flex flex-row items-center gap-2"><span>Base map:</span> <button><!></button> <button><!></button></div> <div class="flex flex-row items-center gap-2"><span>Station Type:</span> <!></div></div></div>`);function JR(e,t){nr(t,!0);const r={light:"https://basemaps.cartocdn.com/gl/positron-gl-style/style.json",satellite:`${z2}/satellite.json`};let o=Se(t,"selectedStations",19,()=>[]),u=Se(t,"selectedStationsColorIndex",19,()=>[]),d=Se(t,"toggleStation",3,()=>{}),p=$t(void 0),a=$t(Ui(r.light));ei(()=>{fetch(`${z2}/data/station_locations.json`).then($=>$.json()).then($=>{Qe(p,$,!0)})});var w=KR(),T=Bt(w);hz(T,{center:[-76.6,39.3],zoom:11,standardControls:!0,get style(){return L(a)},class:"w-full h-full min-h-96 overflow-hidden",cooperativeGestures:!0,children:($,ae)=>{var ee=Ti(),ce=Kn(ee);Pr(ce,17,()=>{var re;return(re=L(p))==null?void 0:re.features},la,(re,he)=>{let be=()=>L(he).properties,ke=()=>L(he).geometry;{let Ie=Vt(()=>{var Ve;return(Ve=ke())==null?void 0:Ve.coordinates}),ue=Vt(()=>o().includes(be().station_id)?`w-5 h-5 ${tC[u()[o().indexOf(be().station_id)]]}`:`w-3 h-3 ${K0[be().station_type]}`);yz(re,{get id(){return be().station_id},get lngLat(){return L(Ie)},get class(){return`
                    rounded-full cursor-pointer border border-black
                    ${L(ue)??""}
                `},onclick:()=>{d()(be().station_id)},children:(Ve,Ze)=>{RR(Ve,{openOn:"hover",children:(Xe,Re)=>{$R(Xe,{get properties(){return be()}})},$$slots:{default:!0}})},$$slots:{default:!0}})}}),It($,ee)},$$slots:{default:!0}});var S=an(T,2),k=Bt(S),I=an(Bt(k),2);I.__click=[YR,a,r];var P=Bt(I);Ig(P,{class:"",icon:"gis:satellite-earth",width:"24",height:"24"}),Et(I);var F=an(I,2);F.__click=[XR,a,r];var G=Bt(F);Ig(G,{class:"",icon:"emojione-monotone:world-map",width:"24",height:"24"}),Et(F),Et(k);var H=an(k,2),Y=an(Bt(H),2);Pr(Y,17,()=>Object.keys(K0),la,($,ae)=>{var ee=QR(),ce=Bt(ee),re=an(ce,2),he=Bt(re,!0);Et(re),Et(ee),wn(()=>{ai(ce,1,`w-3 h-3 rounded-full border border-black ${K0[L(ae)]??""}`),xi(he,L(ae))}),It($,ee)}),Et(H),Et(S),Et(w),wn(()=>{I.disabled=L(a)===r.satellite,ai(I,1,`
                    border rounded-sm p-1
                    ${L(a)===r.satellite?"border-gray-400 text-gray-400 cursor-not-allowed":"border-blue-400 text-blue-400 shadow cursor-pointer"}
                `),F.disabled=L(a)===r.light,ai(F,1,`
                    border rounded-sm p-1
                    ${L(a)===r.light?"border-gray-400 text-gray-400 cursor-not-allowed":"border-blue-400 text-blue-400 shadow cursor-pointer"}
                `)}),It(e,w),ir()}La(["click"]);const db={days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa","Su"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],meridiem:["am","pm"],suffix:["st","nd","rd","th"],todayBtn:"Today",clearBtn:"Clear",okBtn:"Ok",cancelBtn:"Cancel",timeView:"Show time view",backToDate:"Back to calendar view"},eL={theme:"sdt-calendar-colors",format:"yyyy-mm-dd",formatType:"standard",displayFormat:null,displayFormatType:null,minuteIncrement:1,weekStart:1,inputClasses:"",todayBtnClasses:"sdt-action-btn sdt-today-btn",clearBtnClasses:"sdt-action-btn sdt-clear-btn",hourOnly:!1,todayBtn:!0,clearBtn:!0,clearToggle:!0,autocommit:!0,i18n:db},tL=e=>e;function Dd(e,{delay:t=0,duration:r=400,easing:o=tL}={}){const u=+getComputedStyle(e).opacity;return{delay:t,duration:r,easing:o,css:d=>`opacity: ${d*u}`}}const bs=0,nh=1,fo=2;function Ac(e,t,r,o){var H,Y;if(e instanceof Date)return e;const u=o==="php"?{date:"Y-m-d",datetime:"Y-m-d H:i",datetime_s:"Y-m-d H:i:s"}:{date:"yyyy-mm-dd",datetime:"yyyy-mm-dd hh:ii",datetime_s:"yyyy-mm-dd hh:ii:ss"};let d,p;/^\d{4}\-\d{1,2}\-\d{1,2}$/.test(e)?d=ml.parseFormat(u.date,o):/^\d{4}\-\d{1,2}\-\d{1,2}[T ]\d{1,2}\:\d{1,2}$/.test(e)?d=ml.parseFormat(u.datetime,o):/^\d{4}\-\d{1,2}\-\d{1,2}[T ]\d{1,2}\:\d{1,2}\:\d{1,2}[Z]{0,1}$/.test(e)?d=ml.parseFormat(u.datetime_s,o):(/^([01]*\d|2[0-3])([0-5]\d)(?:[ ]([ap][m]|[AP][M]))?$/.test(e)&&(p=(H=e.match(/^([01]*\d|2[0-3])([0-5]\d)(?:[ ]([ap][m]|[AP][M]))?$/))==null?void 0:H.slice(1).filter($=>$)),d=ml.parseFormat(t,o));const a=p||e&&e.toString().match(ml.nonpunctuation)||[];e=new Date,e.setHours(0,0,0,0);const w={},{setters_order:T,setters_map:S}=ml.setters(o);let k,I;if(a.length!==d.parts.length&&d.parts.includes("S")){const $=(Y=a[d.parts.indexOf("S")-1].match(/(\d+)([a-zA-Z]+)/))==null?void 0:Y.slice(1,3);a.splice(d.parts.indexOf("S")-1,1,...$)}if(a.length===d.parts.length){for(var P=0,F=d.parts.length;P<F;P++){if(k=parseInt(a[P],10),I=d.parts[P],isNaN(k))if(o==="standard")switch(I){case"MM":k=r.months.indexOf(a[P])+1;break;case"M":k=r.monthsShort.indexOf(a[P])+1;break;case"p":case"P":k=r.meridiem.indexOf(a[P].toLowerCase());break}else switch(I){case"D":k=r.daysShort.indexOf(a[P])+1;break;case"l":k=r.days.indexOf(a[P])+1;break;case"F":k=r.months.indexOf(a[P])+1;break;case"M":k=r.monthsShort.indexOf(a[P])+1;break;case"a":case"A":k=r.meridiem.indexOf(a[P].toLowerCase());break}w[I]=k}for(var P=0,G;P<T.length;P++)G=T[P],G in w&&!isNaN(w[G])&&S[`${G}`]&&S[`${G}`](e,w[G])}return e}function cd(e,t,r,o){var S;if(e===null)return"";const u=e.getDate();let d;if(o==="standard")d={t:e.getTime(),yy:e.getFullYear().toString().substring(2),yyyy:e.getFullYear(),m:e.getMonth()+1,M:r.monthsShort[e.getMonth()],MM:r.months[e.getMonth()],d:u,D:r.daysShort[e.getDay()],DD:r.days[e.getDay()],S:u%10&&u%10<4&&(u<10||u>14)?r.suffix[u%10-1]:r.suffix[r.suffix.length-1],p:r.meridiem.length===2?r.meridiem[e.getHours()<12?0:1]:"",h:e.getHours(),ii:(e.getMinutes()<10?"0":"")+e.getMinutes(),ss:(e.getUTCSeconds()<10?"0":"")+e.getUTCSeconds()},r.meridiem.length===2?d.H=d.h%12===0?12:d.h%12:d.H=d.h,d.HH=(d.H<10?"0":"")+d.H,d.P=d.p.toUpperCase(),d.hh=(d.h<10?"0":"")+d.h,d.i=d.ii,d.s=d.ss,d.dd=(d.d<10?"0":"")+d.d,d.mm=(d.m<10?"0":"")+d.m;else if(o==="php")d={y:e.getFullYear().toString().substring(2),Y:e.getFullYear(),F:r.months[e.getMonth()],M:r.monthsShort[e.getMonth()],n:e.getMonth()+1,t:nC(e.getFullYear(),e.getMonth()),j:e.getDate(),l:r.days[e.getDay()],D:r.daysShort[e.getDay()],w:e.getDay(),N:e.getDay()===0?7:e.getDay(),S:u%10&&u%10<4&&(u<10||u>14)?r.suffix[u%10-1]:r.suffix[r.suffix.length-1],a:r.meridiem.length===2?r.meridiem[e.getHours()<12?0:1]:"",g:e.getHours()%12===0?12:e.getHours()%12,G:e.getHours(),i:e.getMinutes(),s:e.getSeconds(),U:Math.floor(e.getTime()/1e3)},d.m=(d.n<10?"0":"")+d.n,d.d=(d.j<10?"0":"")+d.j,d.A=d.a.toString().toUpperCase(),d.h=(d.g<10?"0":"")+d.g,d.H=(d.G<10?"0":"")+d.G,d.i=(d.i<10?"0":"")+d.i,d.s=(d.s<10?"0":"")+d.s;else throw new Error("Invalid format type.");let p=[];const a=ml.parseFormat(t,o);for(var w=0,T=((S=a.parts)==null?void 0:S.length)||0;w<T;w++)a.separators.length&&p.push(a.separators.shift()),p.push(d[a.parts[w]]);return a.separators.length&&p.push(a.separators.shift()),p.join("")}function nC(e,t){return[31,e%4===0&&e%100!==0||e%400===0?29:28,31,30,31,30,31,31,30,31,30,31][t]}const ml={validParts:function(e){if(e==="standard")return/t|hh?|HH?|p|P|z|ii?|ss?|dd?|DD?|S|mm?|MM?|yy(?:yy)?/g;if(e==="php")return/[dDjlNwzFmMnStyYaABgGhHisU]/g;throw new Error("Invalid format type.")},nonpunctuation:/[^ -\/:-@\[-`{-~\t\n\rTZ]+/g,parseFormat:function(e,t){var r=e.replace(this.validParts(t),"\0").split("\0"),o=e.match(this.validParts(t))||[];return(!r||!r.length||!o||o.length===0)&&console.warn("invalid date format",r,o),{separators:r,parts:o}},setters:function(e){let t,r={};return e==="standard"?(t=["yyyy","yy","m","mm","M","MM","d","dd","D","DD","hh","h","HH","H","ii","i","ss","s","S","p","P","t"],r={hh:(o,u)=>o.setHours(u),h:(o,u)=>o.setHours(u),HH:(o,u)=>o.setHours(u===12?0:u),H:(o,u)=>o.setHours(u===12?0:u),i:(o,u)=>o.setMinutes(u),s:(o,u)=>o.setSeconds(u),yyyy:(o,u)=>o.setFullYear(u),yy:(o,u)=>o.setFullYear((u<50?2e3:1900)+u),m:(o,u)=>{for(u-=1;u<0;)u+=12;for(u%=12,o.setMonth(u);o.getMonth()!==u;){if(isNaN(o.getMonth()))return o;o.setDate(o.getDate()-1)}return o},d:(o,u)=>o.setDate(u),p:(o,u)=>o.setHours(u===1&&o.getHours()<12?o.getHours()+12:o.getHours()),t:(o,u)=>o.setTime(u),mm:()=>{},M:()=>{},MM:()=>{},ii:()=>{},ss:()=>{},dd:()=>{},D:()=>{},DD:()=>{},P:()=>{}},r.mm=r.M=r.MM=r.m,r.ii=r.i,r.ss=r.s,r.dd=r.D=r.DD=r.d,r.P=r.p):(t=["Y","yy","m","M","F","n","d","D","j","l","N","S","H","G","h","g","i","s","p","P","U"],r={H:(o,u)=>o.setHours(u),G:(o,u)=>o.setHours(u),h:(o,u)=>o.setHours(u===12?0:u),g:(o,u)=>o.setHours(u===12?0:u),i:(o,u)=>o.setMinutes(u),s:(o,u)=>o.setSeconds(u),Y:(o,u)=>o.setFullYear(u),yy:(o,u)=>o.setFullYear((u<50?2e3:1900)+u),m:(o,u)=>{for(u-=1;u<0;)u+=12;for(u%=12,o.setMonth(u);o.getMonth()!==u;){if(isNaN(o.getMonth()))return o;o.setDate(o.getDate()-1)}return o},n:(o,u)=>o.setMonth(u-1),d:(o,u)=>o.setDate(u),a:(o,u)=>o.setHours(u===1?o.getHours()+12:o.getHours()),U:(o,u)=>o.setTime(u*1e3)},r.F=r.M=r.m,r.D=r.j=r.l=r.N=r.d,r.A=r.a),{setters_order:t,setters_map:r}}};function nL(e,t,r,o,u){if(r===bs){let ee=10,ce=20;const re=-1,he=[];let be=[],ke=e.getFullYear()-e.getFullYear()%10;ke-=ke%20?12:10,ke%10&&(ee=12,ce=22);for(let ue=0;ue<32;ue++)be.push(ke+ue),be.length===4&&(he.push(be),be=[]);let Ie=[];return t[0]||(t[0]=new Date),t[0].getFullYear()>=ke&&Ie.push(t[0].getFullYear()%ke),{years:he,todayMark:re,nextFrom:ce,prevTo:ee,selectionMark:Ie}}if(r===nh){let ee=[],ce=[],re=12,he=24;const be=e.toISOString().split("T")[0].substring(0,8),ke=new Date(be+"01 00:00:00"),Ie=ke.getFullYear()-1;ke.setFullYear(Ie);let ue=0;for(let Ze=0;Ze<3;Ze++){for(let Xe=0;Xe<12;Xe++)ke.setMonth(Xe),ce.push(o.monthsShort[Xe%12]),ce.length===4&&(ee.push(ce),ce=[]);ke.setFullYear(ke.getFullYear()+1)}let Ve=[];return t[0]||(t[0]=new Date),t[0].getFullYear()-Ie>=0&&t[0].getFullYear()-Ie<=2&&Ve.push(t[0].getMonth()+(t[0].getFullYear()-Ie||0)*12),{months:ee,todayMark:ue,nextFrom:he,prevTo:re,selectionMark:Ve}}let d=e||new Date,p=d.getFullYear(),a=d.getMonth();d.getDate(),d.getHours();let w=new Date,T=new Date(p,a-1,28,0,0,0,0),S=nC(T.getFullYear(),T.getMonth());T.setDate(S),T.setDate(S-(T.getDay()-u+7)%7);let k=new Date(T);k.setDate(k.getDate()+42);let I=k.valueOf(),P=[],F=[],G=-1,H=[],Y=0,$=42,ae=0;for(;T.valueOf()<I;)ae++,F.push(new Date(T)),T.getFullYear()<p||T.getFullYear()===p&&T.getMonth()<a?Y=ae:$===42&&(T.getFullYear()>p||T.getFullYear()===p&&T.getMonth()>a)&&($=ae-1),T.setDate(T.getDate()+1),T.getFullYear()===w.getFullYear()&&T.getMonth()===w.getMonth()&&T.getDate()===w.getDate()&&(G=ae),H.length!==t.length&&t.map(ee=>{T.getFullYear()===ee.getFullYear()&&T.getMonth()===ee.getMonth()&&T.getDate()===ee.getDate()&&H.push(ae)}),F.length===7&&(P.push(F),F=[]);return{grid:P,days:P,todayMark:G,prevTo:Y,nextFrom:$,selectionMark:H}}function iC(e){const t=e-1;return t*t*t+1}function iL(e,{duration:t=400,start:r=0,end:o=1,opacity:u=0}){const d=getComputedStyle(e),p=+d.opacity,a=d.transform==="none"?"":d.transform,w=1-r,T=p*(1-u);return o=o||1,{delay:0,duration:t,easing:iC,css:(S,k)=>`
        transform: ${a} scale(${o!==1?r+o*k:1-w*k});
        opacity: ${p-T*k};
      `}}function rL(e,t,r,o,u,d,p,a){if(Qe(t,-1),Qe(r,!0),L(o)&&l1(o,-1),L(o)===bs){const w=Math.floor(L(u).getFullYear()/10)*10%20===0;Qe(d,w?p:a,!0)}}function aL(e,t){var r;(r=t.onswitch)==null||r.call(t,"time")}var oL=tn('<button type="button" class="std-btn std-btn-header icon-btn sdt-time-icon svelte-s6uyff"><svg class="sdt-svg svelte-s6uyff" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M1.5 8a6.5 6.5 0 1113 0 6.5 6.5 0 01-13 0zM8 0a8 8 0 100 16A8 8 0 008 0zm.5 4.75a.75.75 0 00-1.5 0v3.5a.75.75 0 00.471.696l2.5 1a.75.75 0 00.557-1.392L8.5 7.742V4.75z"></path></svg></button>'),sL=(e,t)=>t(-1),lL=(e,t)=>t(1),cL=(e,t,r)=>{t(L(r))},uL=tn('<td><button type="button"> </button></td>'),hL=tn('<tr class="sdt-cal-td svelte-s6uyff"></tr>'),fL=tn('<table class="sdt-table svelte-s6uyff" style="max-height: 221px; height: 221px"><tbody></tbody></table>'),dL=(e,t,r)=>{t(L(r))},pL=tn('<td><button type="button"> </button></td>'),mL=tn('<tr class="sdt-cal-td svelte-s6uyff"></tr>'),gL=tn('<table class="sdt-table svelte-s6uyff"><tbody></tbody></table>'),_L=tn('<th class="sdt-cal-th svelte-s6uyff"> </th>'),yL=(e,t,r)=>{t(L(r))},vL=tn('<td><button type="button"> </button></td>'),bL=tn("<tr></tr>"),xL=tn('<table class="sdt-table sdt-table-height svelte-s6uyff"><tbody><tr class="sdt-cal-td svelte-s6uyff"></tr><!></tbody></table>'),wL=tn('<div class="sdt-thead-nav svelte-s6uyff"><button type="button" class="std-btn std-btn-header sdt-toggle-btn svelte-s6uyff"> </button> <!> <button type="button" class="std-btn std-btn-header icon-btn svelte-s6uyff"><svg class="sdt-svg svelte-s6uyff" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="24" height="24"><path d="M4.427 9.573l3.396-3.396a.25.25 0 01.354 0l3.396 3.396a.25.25 0 01-.177.427H4.604a.25.25 0 01-.177-.427z"></path></svg></button> <button type="button" class="std-btn std-btn-header icon-btn svelte-s6uyff"><svg class="sdt-svg svelte-s6uyff" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="24" height="24"><path d="M4.427 7.427l3.396 3.396a.25.25 0 00.354 0l3.396-3.396A.25.25 0 0011.396 7H4.604a.25.25 0 00-.177.427z"></path></svg></button> <div class="sdt-nav-btns svelte-s6uyff"></div></div> <div><!> <!> <!></div>',1);function AL(e,t){var In;nr(t,!0);let r=Se(t,"wid",3,0),o=Se(t,"dates",19,()=>[]),u=Se(t,"startDate",3,null),d=Se(t,"endDate",3,null),p=Se(t,"weekStart",3,1),a=Se(t,"initialView",3,fo),w=Se(t,"enableTimeToggle",3,!1),T=Se(t,"isRange",3,!1),S=Se(t,"hoverDate",15,null);function k(yt,qt){if(L(H)!==fo){Qe(H,fo,!0),Qe(Y,1),Qe(F,new dr(P||new Date),!0);return}if(!P){tt(new Date,{keyboard:!0});return}let Nt=new Date(P);switch(yt){case"PageDown":qt=!0;case"ArrowDown":qt?Nt.setMonth(P.getMonth()+1):Nt.setDate(P.getDate()+7),qt&&Nt.getMonth()===P.getMonth()&&Nt.setDate(0),tt(Nt,{keyboard:!0});break;case"PageUp":qt=!0;case"ArrowUp":qt?Nt.setMonth(P.getMonth()-1):Nt.setDate(P.getDate()-7),qt&&Nt.getMonth()===P.getMonth()&&Nt.setDate(0),tt(Nt,{keyboard:!0});break;case"ArrowLeft":qt?Nt.setFullYear(P.getFullYear()-1):Nt.setDate(P.getDate()-1),tt(Nt,{keyboard:!0});break;case"ArrowRight":qt?Nt.setFullYear(P.getFullYear()+1):Nt.setDate(P.getDate()+1),tt(Nt,{keyboard:!0});break}}function I(yt){L(F).setTime(yt.getTime()),P=new Date(yt.getTime())}let P=o()[r()]||null,F=$t(Ui(r()===1?(()=>{if(o().length===2&&o()[1]&&(o()[0].getMonth()!=o()[1].getMonth()||o()[0].getFullYear()!=o()[1].getFullYear()))return new dr(o()[1]);const yt=new Date(o()[0]||new Date);return yt.setMonth(yt.getMonth()+1),new dr(yt)})():new dr(((In=o()[0])==null?void 0:In.valueOf())||new Date))),G=Vt(()=>u()?new dr(u().getFullYear(),u().getMonth(),u().getDate(),0,0,0,0):null),H=$t(Ui(a())),Y=$t(-2),$=$t(!1),ae=400,ee=Vt(()=>L(Y)<1?1.5:.5),ce=Vt(()=>L(Y)<1?1:1.5);const re=222,he=148;let be=$t(re),ke=$t(null),Ie=Vt(()=>L(Y)===-2?Dd:L(Y)!==null?iL:()=>({})),ue=Vt(()=>o().map(yt=>(yt=new Date(yt),yt.setHours(0,0,0,0),yt.getTime()))),Ve=Vt(()=>nL(L(F),c6(o()),L(H),t.i18n,p())),Ze=Vt(()=>t.i18n.daysMin.concat(...t.i18n.daysMin.slice(1)).slice(p(),7+p())),Xe=Vt(()=>t.i18n&&ct(L(H),L(F)));function Re(yt){return L(Ve).prevTo<=yt&&yt<L(Ve).nextFrom}function ot(yt){var qt,Nt;switch(L(H)){case fo:if(L(G)&&L(G)>yt||d()&&d()<=yt||t.additionalDisableFn&&t.additionalDisableFn(yt))return!0;break;case nh:const fn=yt.getFullYear(),yn=(qt=L(G))==null?void 0:qt.getFullYear(),On=(Nt=d())==null?void 0:Nt.getFullYear();if(yn&&L(G)&&(yn===fn&&L(G).getMonth()>yt.getMonth()||yn>fn)||On&&d()&&(On===fn&&d().getMonth()<yt.getMonth()||On<fn))return!0;break;case bs:if(L(G)&&L(G).getFullYear()>yt.getFullYear()||d()&&d().getFullYear()<yt.getFullYear())return!0;break}return!1}function Pt(yt,qt,Nt){const fn=qt===1,yn=fn?d():L(G);return yn?Nt===bs?fn?yt.getFullYear()+qt*10>yn.getFullYear():yt.getFullYear()+qt*10<yn.getFullYear():Nt===nh?fn?yt.getFullYear()+qt>yn.getFullYear():yt.getFullYear()+qt<yn.getFullYear():fn?yt.getFullYear()*100+yt.getMonth()+qt>yn.getFullYear()*100+yn.getMonth():yt.getFullYear()*100+yt.getMonth()+qt<yn.getFullYear()*100+yn.getMonth():!1}function bt(yt){const qt=L(H)===bs?120:L(H)===nh?12:1;L(F).getDate()>28&&L(F).setDate(L(F).getDate()-3),L(F).setMonth(L(F).getMonth()+yt*qt),Qe(ke,null),Qe(be,L(H)===bs?L(F).getFullYear()%20>=10?re:he:re,!0)}function _t(yt){if(L(H)===fo)return bt(yt);if(Qe(ke,()=>{bt(yt)}),L(H)===bs){Qe(be,L(be)===he?yt===-1?L(be)-re:re+he:yt===-1?L(be)-re:L(be)+he,!0);return}Qe(be,yt===-1?L(be)-re:L(be)+re,!0)}function tt(yt,{keyboard:qt}={}){var Nt;switch(Qe(Y,1),Qe($,!0),L(H)){case 0:L(F).setFullYear(yt),Qe(F,L(F),!0);break;case 1:L(F).setMonth(t.i18n.monthsShort.indexOf(yt)),Qe(F,L(F),!0);break;case 2:if(ot(yt)||t.additionalDisableFn&&t.additionalDisableFn(yt))return;const fn=new Date(yt.getFullYear(),yt.getMonth(),yt.getDate());P&&(fn.setMinutes(P.getMinutes()),fn.setHours(P.getHours())),P=fn,qt&&(L(F).getFullYear()!==fn.getFullYear()||L(F).getFullYear()===fn.getFullYear()&&L(F).getMonth()!==fn.getMonth())&&(L(F).setFullYear(fn.getFullYear()),L(F).getDate()>28&&L(F).setDate(28),L(F).setMonth(fn.getMonth()),Qe(F,L(F),!0)),(Nt=t.onupdate)==null||Nt.call(t,{type:"date",date:P,isKeyboard:qt});break}L(H)<fo&&l1(H),Qe(be,re)}ei(()=>{o().length===0&&(P=null)});function Tt(){Qe($,!1)}function ct(yt,qt){switch(yt){case bs:const Nt=L(Ve).years[Math.floor(L(Ve).prevTo/4)][L(Ve).prevTo%4],fn=L(Ve).years[Math.floor(L(Ve).nextFrom/4)][L(Ve).nextFrom%4];return`${Nt} - ${fn}`;case nh:return qt.getFullYear();case fo:return t.i18n.months[qt.getMonth()]+" "+qt.getFullYear()}}function mt(yt=null){return function(qt){var Nt;S((yt==null?void 0:yt.getTime())||null),(Nt=t.onhoverupdate)==null||Nt.call(t,S())}}function Xt(yt){return L(ue).length===2?yt>=L(ue)[0]&&yt<L(ue)[1]:!1}function Ut(yt,qt){return qt&&L(ue).length===1&&(yt<=qt&&L(ue)[0]<=yt||yt>=qt&&L(ue)[0]>=yt)}var St=wL(),pt=Kn(St),Ft=Bt(pt);Ft.__click=[rL,Y,$,H,F,be,he,re];var nt=Bt(Ft,!0);Et(Ft);var De=an(Ft,2);{var Ke=yt=>{var qt=oL();qt.__click=[aL,t],wn(()=>{ri(qt,"title",t.i18n.timeView),ri(qt,"aria-label",t.i18n.timeView)}),It(yt,qt)};pn(De,yt=>{w()&&o().length&&yt(Ke)})}var Be=an(De,2);Be.__click=[sL,_t];var wt=an(Be,2);wt.__click=[lL,_t],zS(2),Et(pt);var gt=an(pt,2);let Rt;var st=Bt(gt);{var ht=yt=>{var qt=fL(),Nt=Bt(qt);let fn;Pr(Nt,21,()=>L(Ve).years,la,(yn,On,Mi)=>{var $n=hL();Pr($n,21,()=>L(On),la,(wi,Ce,X)=>{var K=uL();const te=Vt(()=>Mi*4+X);let pe;var we=Bt(K);let Ee;we.__click=[cL,tt,Ce];var Fe=Bt(we,!0);Et(we),Et(K),wn((Pe,He,Ge)=>{pe=ai(K,1,"sdt-cal-td svelte-s6uyff",null,pe,Pe),Ee=ai(we,1,"std-btn svelte-s6uyff",null,Ee,He),we.disabled=Ge,xi(Fe,L(Ce))},[()=>({"is-selected":L(Ve).selectionMark.includes(L(te))}),()=>({"not-current":!Re(L(te))}),()=>ot(new Date(L(Ce),L(F).getMonth(),L(F).getDate()))]),It(wi,K)}),Et($n),It(yn,$n)}),Et(Nt),Et(qt),wn(yn=>{fn=ai(Nt,1,"sdt-tbody-lg svelte-s6uyff",null,fn,yn),ca(Nt,`transform: translateY(-${L(be)}px); color: red`)},[()=>({"animate-transition":!!L(ke)})]),fr("outroend",Nt,Tt),fr("transitionend",Nt,()=>L(ke)&&L(ke)()),No(1,Nt,()=>L(Ie),()=>({duration:ae,start:L(ee),opacity:1})),No(2,Nt,()=>L(Ie),()=>({duration:ae,end:L(ce),start:1})),It(yt,qt)};pn(st,yt=>{L(H)===bs&&yt(ht)})}var qe=an(st,2);{var Mt=yt=>{var qt=gL(),Nt=Bt(qt);let fn;Pr(Nt,21,()=>L(Ve).months,la,(yn,On,Mi)=>{var $n=mL();Pr($n,21,()=>L(On),la,(wi,Ce,X)=>{var K=pL();const te=Vt(()=>Mi*4+X);let pe;var we=Bt(K);let Ee;we.__click=[dL,tt,Ce];var Fe=Bt(we,!0);Et(we),Et(K),wn((Pe,He,Ge)=>{pe=ai(K,1,"sdt-cal-td svelte-s6uyff",null,pe,Pe),Ee=ai(we,1,"std-btn svelte-s6uyff",null,Ee,He),we.disabled=Ge,xi(Fe,L(Ce))},[()=>({"is-selected":L(te)===L(Ve).selectionMark[0]}),()=>({"not-current":!Re(L(te))}),()=>ot(new Date(L(F).getFullYear(),t.i18n.monthsShort.indexOf(L(Ce)),L(F).getDate()))]),It(wi,K)}),Et($n),It(yn,$n)}),Et(Nt),Et(qt),wn(yn=>{fn=ai(Nt,1,"sdt-tbody-lg svelte-s6uyff",null,fn,yn),ca(Nt,`transform: translateY(-${L(be)}px)`)},[()=>({"animate-transition":!!L(ke)})]),fr("outroend",Nt,Tt),fr("transitionend",Nt,()=>L(ke)&&L(ke)()),No(1,Nt,()=>L(Ie),()=>({duration:ae,start:L(ee),opacity:1})),No(2,Nt,()=>L(Ie),()=>({duration:ae,end:L(ce),start:1})),It(yt,qt)};pn(qe,yt=>{L(H)===nh&&yt(Mt)})}var Ht=an(qe,2);{var _n=yt=>{var qt=xL(),Nt=Bt(qt),fn=Bt(Nt);Pr(fn,21,()=>L(Ze),la,(On,Mi)=>{var $n=_L(),wi=Bt($n,!0);Et($n),wn(()=>xi(wi,L(Mi))),It(On,$n)}),Et(fn);var yn=an(fn);Pr(yn,17,()=>L(Ve).days,la,(On,Mi,$n)=>{var wi=bL();Pr(wi,21,()=>L(Mi),la,(Ce,X,K)=>{var te=vL();const pe=Vt(()=>$n*7+K),we=Vt(()=>L(X).getTime());let Ee;var Fe=Vt(()=>mt(L(X)));te.__mouseover=function(...Je){var Ae;(Ae=L(Fe))==null||Ae.apply(this,Je)};var Pe=Vt(mt);te.__mouseout=function(...Je){var Ae;(Ae=L(Pe))==null||Ae.apply(this,Je)};var He=Bt(te);He.__click=[yL,tt,X];let Ge;var Le=Bt(He,!0);Et(He),Et(te),wn((Je,Ae,Lt,nn)=>{Ee=ai(te,1,"sdt-cal-td svelte-s6uyff",null,Ee,Je),Ge=ai(He,1,"std-btn sdt-btn-day svelte-s6uyff",null,Ge,Ae),He.disabled=Lt,xi(Le,nn)},[()=>({"sdt-today":L(pe)===L(Ve).todayMark,"in-range":Xt(L(we)),"is-selected":L(ue).includes(L(we)),"in-range-hover":T()&&Ut(L(we),S())}),()=>({"not-current":!Re($n*7+K)}),()=>(L(G)||d()||t.additionalDisableFn)&&ot(L(X)),()=>L(X).getDate()]),It(Ce,te)}),Et(wi),It(On,wi)}),Et(Nt),Et(qt),fr("outroend",Nt,Tt),No(1,Nt,()=>L(Ie),()=>({duration:ae,start:.5,opacity:1})),No(2,Nt,()=>L(Ie),()=>({duration:ae,start:Math.abs(L(Y))})),It(yt,qt)};pn(Ht,yt=>{L(H)===fo&&yt(_n)})}return Et(gt),wn((yt,qt,Nt,fn,yn,On,Mi)=>{xi(nt,L(Xe)),ri(Be,"title",yt),ri(Be,"aria-label",qt),Be.disabled=Nt,ri(wt,"title",fn),ri(wt,"aria-label",yn),wt.disabled=On,Rt=ai(gt,1,"sdt-calendar svelte-s6uyff",null,Rt,Mi)},[()=>t.i18n.months[(L(F).getMonth()-1)%12],()=>t.i18n.months[(L(F).getMonth()-1)%12],()=>Pt(L(F),-1,L(H)),()=>t.i18n.months[(L(F).getMonth()+1)%12],()=>t.i18n.months[(L(F).getMonth()+1)%12],()=>Pt(L(F),1,L(H)),()=>({"is-grid":L($)})]),It(e,St),ir({handleGridNav:k,focusDate:I})}La(["click","mouseover","mouseout"]);function TL(e,t,r,o,u,d){var a;const p=parseInt(e.target.dataset.value);L(t).setHours(p),Qe(t,L(t),!0),(a=r.onupdate)==null||a.call(r,{type:L(o)?"minute":"hour",date:u(L(t)),isKeyboard:e.type==="keyboard",dateIndex:d()})}function yA(e,t){Qe(t,e.type==="mousedown")}function SL(e,t){t.onswitch("date")}var ML=tn('<button type="button" class="sdt-time-btn sdt-back-btn svelte-1piwi8e"><svg class="sdt-svg svelte-1piwi8e" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20"><path fill-rule="evenodd" d="M6.75 0a.75.75 0 01.75.75V3h9V.75a.75.75 0 011.5 0V3h2.75c.966 0 1.75.784 1.75 1.75v16a1.75 1.75 0 01-1.75 1.75H3.25a1.75 1.75 0 01-1.75-1.75v-16C1.5 3.784 2.284 3 3.25 3H6V.75A.75.75 0 016.75 0zm-3.5 4.5a.25.25 0 00-.25.25V8h18V4.75a.25.25 0 00-.25-.25H3.25zM21 9.5H3v11.25c0 .138.112.25.25.25h17.5a.25.25 0 00.25-.25V9.5z" class="svelte-1piwi8e"></path></svg></button>'),CL=(e,t)=>Qe(t,!1),IL=(e,t)=>Qe(t,!0),EL=tn('<button type="button"> </button> <span class="svelte-1piwi8e">:</span> <button type="button"> </button>',1),PL=tn('<span class="sdt-time-figure svelte-1piwi8e"> </span>'),kL=tn('<span class="svelte-1piwi8e">:</span> <span class="sdt-time-figure svelte-1piwi8e">00</span>',1),DL=tn('<span class="sdt-time-figure svelte-1piwi8e"> </span> <!>',1),zL=tn('<div class="sdt-meridian svelte-1piwi8e"><button type="button" class="sdt-time-btn sdt-time-figure is-active svelte-1piwi8e"> </button></div>'),RL=(e,t)=>{e.preventDefault(),t(e)},LL=(e,t,r)=>{L(t)&&r(e)},BL=tn('<button type="button"> </button>'),FL=tn('<button type="button"> </button>'),OL=tn('<div class="sdt-timer svelte-1piwi8e"><div class="sdt-time-head svelte-1piwi8e"><!> <!> <!></div>  <div><div class="sdt-middle-dot svelte-1piwi8e"></div> <div class="sdt-hand-pointer svelte-1piwi8e"><div class="sdt-hand-circle svelte-1piwi8e"></div></div> <!> <!></div></div>');function NL(e,t){nr(t,!0);let r=Se(t,"wid",3,0),o=Se(t,"date",27,()=>Ui(new dr)),u=Se(t,"startDate",3,void 0),d=Se(t,"endDate",3,void 0),p=Se(t,"hourOnly",3,!1),a=Se(t,"minuteIncrement",3,1),w=Se(t,"showMeridian",3,!1),T=Se(t,"hasDateComponent",3,!1);function S(){Qe(P,!0)}function k(De){L(P)?(De=De*5+L(ae),De%5!==0&&(De=De<L(ae)?De+(5-De%5):De-De%5)):De=L(Y)+De,Qe(G,!1),Re({type:"keyboard",target:{tagName:"BUTTON",dataset:{value:De}}}),Qe(G,!0)}let I,P=$t(!1),F=$t(!1),G=$t(!0),H=$t(Ui(function(){const De=new dr;return De.setHours(0,0),De}()));he(o());let Y=Vt(()=>{var De;return((De=L(H))==null?void 0:De.getHours())||0}),$=Vt(()=>w()?L(Y)>=12:!1),ae=Vt(()=>{var De;return((De=L(H))==null?void 0:De.getMinutes())||0}),ee=Vt(()=>{let De=L(P)?L(ae)*6:L(Y)%12*30;return L(P)||w()||L(Y)<12?`transform: rotateZ(${De}deg);`:`transform: rotateZ(${De}deg); height: calc(25% + 1px)`}),ce=Vt(()=>L(P)?5:1),re=Vt(()=>u()&&d()&&["getFullYear","getMonth","getDate"].every(De=>d()[De]()===u()[De]()));function he(De){var Ke;if(((Ke=L(H))==null?void 0:Ke.valueOf())!==(De==null?void 0:De.valueOf())&&De)Qe(H,new dr(De),!0);else if(!De)if(Qe(P,!1),L(H))L(H).setHours(0,0);else{const Be=new dr;Be.setHours(0,0),Qe(H,Be,!0)}}function be(De){return u()&&u().toDateString()===De.toDateString()&&(Xe(De.getHours())&&De.setHours(u().getHours()),Xe(De.getMinutes(),!0)&&De.setMinutes(u().getMinutes())),d()&&d().toDateString()===De.toDateString()&&(Xe(De.getHours())&&De.setHours(d().getHours()),Xe(De.getMinutes(),!0)&&De.setMinutes(d().getMinutes())),De}function ke(De,Ke,Be,wt,gt){const Rt=De/2;Ke=Ke||Rt;const st=[0,1-.5,1-.134,1,1-.134,1-.5],ht=st.concat(st),qe=st.slice(3).concat(st).concat(st.slice(0,3)),Mt=[];for(let Ht=0;Ht<12;Ht++)Mt.push({x:Math.abs(ht[Ht]*Rt+(Ht<=6?1:-1)*Ke),y:Math.abs(qe[Ht]*Rt+(Ht>=9||Ht<3?-1:1)*Ke),val:wt?Ht*5||Be:Ht?Ht+gt:Be});return Mt}let Ie=Vt(()=>ke(L(P)?220:180,110,"00",!1,0)),ue=Vt(()=>ke(L(P)?180:120,110,L(P)?"00":"12",L(P),12));function Ve(De,Ke){return Ke?L($)&&De===12?12:De<10||De%12<10?`0${De%12}`:De%12:De<10?`0${De}`:De}function Ze(De,Ke,Be){return L(P)?Ke===De||Be===0&&Be===De:w()?L($)&&Ke==12&&De===12||!L($)&&Ke==12&&De===0?!0:Ke===(De?De%12:12):+Ke>12?(Be?L(ce)*Be+12:0)===De:Ke==="00"||Ke==="12"?De===12&&parseInt(Ke)==12||Ke==="00"&&De===0:Ke===De}function Xe(De,Ke=!1){return typeof De=="string"&&(De=parseInt(De)),u()&&d()&&L(re)?L(P)||Ke?u().getHours()===L(H).getHours()&&u().getMinutes()>De||d().getHours()===L(H).getHours()&&d().getMinutes()<De:u().getHours()>De||d().getHours()<De:u()&&u().getDate()===L(H).getDate()&&u().getMonth()===L(H).getMonth()&&u().getFullYear()===L(H).getFullYear()?L(P)||Ke?u().getHours()===L(H).getHours()&&u().getMinutes()>De:u().getHours()>De:d()&&d().getDate()===L(H).getDate()&&d().getMonth()===L(H).getMonth()&&d().getFullYear()===L(H).getFullYear()?L(P)||Ke?d().getHours()===L(H).getHours()&&d().getMinutes()<De:d().getHours()<De:!1}function Re(De){var wt;if(!De.target)return;let Ke=0,Be=0;if(De.target.tagName==="BUTTON"){let gt=parseInt(De.target.dataset.value);if(!L(P)&&L($)&&(gt+=12),L(P)&&a()!==1){if(De.isKeyboard)gt=gt>L(ae)?L(ae)+a():L(ae)-a();else if(gt%a()!==0){const Rt=gt%a(),st=gt-Rt,ht=st+a();gt=ht-gt<gt-st?ht:st}}L(P)?L(H).setMinutes(gt):L(H).setHours(gt)}else if(L(P)){const gt=I.getBoundingClientRect(),Rt=De.clientX-gt.left,st=De.clientY-gt.top,ht=110,qe=110;let Mt=null;switch(Rt>ht?Mt=st>qe?2:1:Mt=st>qe?3:4,Mt){case 1:Ke=Rt-ht,Be=qe-st;break;case 2:Ke=Rt-ht,Be=st-qe;break;case 3:Ke=ht-Rt,Be=st-qe;break;case 4:Ke=ht-Rt,Be=qe-st;break}const Ht=Math.sqrt(Ke*Ke+Be*Be),_n=90-Math.asin(Ke/Ht)*(180/Math.PI);let In=0;switch(Mt){case 1:In=90-_n;break;case 2:In=_n+90;break;case 3:In=270-_n;break;case 4:In=_n+270;break}In=Math.round(In/6/a())*a(),In>=60&&(In=0),L(H).setMinutes(In)}else return;L(F)||((wt=t.onupdate)==null||wt.call(t,{type:L(P)?"minute":"hour",date:be(L(H)),isKeyboard:De.type==="keyboard",dateIndex:r()}),De.type!=="keyboard"&&!L(P)&&!p()&&Qe(P,!0))}ei(()=>{he(o())});var ot=OL(),Pt=Bt(ot),bt=Bt(Pt);{var _t=De=>{var Ke=ML();Ke.__click=[SL,t],wn(()=>{ri(Ke,"title",t.i18n.backToDate),ri(Ke,"aria-label",t.i18n.backToDate)}),It(De,Ke)};pn(bt,De=>{T()&&De(_t)})}var tt=an(bt,2);{var Tt=De=>{var Ke=EL(),Be=Kn(Ke);let wt;Be.__click=[CL,P];var gt=Bt(Be,!0);Et(Be);var Rt=an(Be,4);let st;Rt.__click=[IL,P];var ht=Bt(Rt,!0);Et(Rt),wn((qe,Mt,Ht,_n)=>{wt=ai(Be,1,"sdt-time-btn sdt-time-figure svelte-1piwi8e",null,wt,qe),xi(gt,Mt),st=ai(Rt,1,"sdt-time-btn sdt-time-figure svelte-1piwi8e",null,st,Ht),xi(ht,_n)},[()=>({"is-active":!L(P)}),()=>Ve(L(Y),w()),()=>({"is-active":L(P)}),()=>Ve(L(ae),!1)]),It(De,Ke)},ct=De=>{var Ke=DL(),Be=Kn(Ke),wt=Bt(Be,!0);Et(Be);var gt=an(Be,2);{var Rt=ht=>{var qe=PL(),Mt=Bt(qe,!0);Et(qe),wn(Ht=>xi(Mt,Ht),[()=>(L($)?t.i18n.meridiem[1]:t.i18n.meridiem[0]).toUpperCase()]),It(ht,qe)},st=ht=>{var qe=kL();zS(2),It(ht,qe)};pn(gt,ht=>{w()?ht(Rt):ht(st,!1)})}wn(ht=>xi(wt,ht),[()=>Ve(L(Y),w())]),It(De,Ke)};pn(tt,De=>{p()?De(ct,!1):De(Tt)})}var mt=an(tt,2);{var Xt=De=>{var Ke=zL(),Be=Bt(Ke);Be.__click=[TL,H,t,P,be,r];var wt=Bt(Be,!0);Et(Be),Et(Ke),wn(()=>{ri(Be,"data-value",L($)?L(Y)%12:L(Y)+12),xi(wt,L($)?t.i18n.meridiem[1]:t.i18n.meridiem[0])}),It(De,Ke)};pn(mt,De=>{w()&&De(Xt)})}Et(Pt);var Ut=an(Pt,2);let St;Ut.__click=[RL,Re],Ut.__mousedown=[yA,F],Ut.__mousemove=[LL,F,Re],Ut.__mouseup=[yA,F];var pt=an(Bt(Ut),2),Ft=an(pt,2);Pr(Ft,19,()=>L(Ie),De=>De.val,(De,Ke,Be)=>{var wt=BL();let gt;var Rt=Bt(wt,!0);Et(wt),wn((st,ht)=>{ca(wt,`left:${L(Ke).x}px; top:${L(Ke).y}px;`),gt=ai(wt,1,"sdt-tick svelte-1piwi8e",null,gt,st),ri(wt,"data-value",L(Ke).val),wt.disabled=ht,xi(Rt,L(Ke).val)},[()=>({"outer-tick":L(P),"is-selected":Ze(L(Y),L(Ke).val,L(Be))}),()=>(u()||d())&&L(H)&&Xe(L(Ke).val,!1)]),No(3,wt,()=>Dd,()=>({duration:200})),It(De,wt)});var nt=an(Ft,2);return Pr(nt,17,()=>L(ue),la,(De,Ke,Be)=>{var wt=FL();let gt;var Rt=Bt(wt,!0);Et(wt),wn((st,ht)=>{ca(wt,`left:${L(Ke).x}px; top:${L(Ke).y}px;`),gt=ai(wt,1,"sdt-tick svelte-1piwi8e",null,gt,st),ri(wt,"data-value",L(Ke).val),wt.disabled=ht,xi(Rt,L(Ke).val)},[()=>({"outer-tick":w()&&!L(P),"is-selected":Ze(L(P)?L(ae):L(Y),L(Ke).val,Be)}),()=>(u()||d())&&L(H)&&Xe(L(Ke).val,!1)]),No(3,wt,()=>Dd,()=>({duration:200})),It(De,wt)}),Et(Ut),Go(Ut,De=>I=De,()=>I),Et(ot),wn(De=>{St=ai(Ut,1,"sdt-clock svelte-1piwi8e",null,St,De),ca(pt,L(ee))},[()=>({"is-minute-view":L(P)})]),No(1,ot,()=>Dd,()=>({duration:200})),It(e,ot),ir({showMinuteView:S,makeTick:k})}La(["click","mousedown","mousemove","mouseup"]);const Hg=Math.min,kc=Math.max,$g=Math.round,Gm=Math.floor,Zo=e=>({x:e,y:e}),jL={left:"right",right:"left",bottom:"top",top:"bottom"},UL={start:"end",end:"start"};function vA(e,t,r){return kc(e,Hg(t,r))}function T1(e,t){return typeof e=="function"?e(t):e}function wh(e){return e.split("-")[0]}function S1(e){return e.split("-")[1]}function rC(e){return e==="x"?"y":"x"}function aC(e){return e==="y"?"height":"width"}const VL=new Set(["top","bottom"]);function Tc(e){return VL.has(wh(e))?"y":"x"}function oC(e){return rC(Tc(e))}function GL(e,t,r){r===void 0&&(r=!1);const o=S1(e),u=oC(e),d=aC(u);let p=u==="x"?o===(r?"end":"start")?"right":"left":o==="start"?"bottom":"top";return t.reference[d]>t.floating[d]&&(p=Wg(p)),[p,Wg(p)]}function qL(e){const t=Wg(e);return[pb(e),t,pb(t)]}function pb(e){return e.replace(/start|end/g,t=>UL[t])}const bA=["left","right"],xA=["right","left"],ZL=["top","bottom"],HL=["bottom","top"];function $L(e,t,r){switch(e){case"top":case"bottom":return r?t?xA:bA:t?bA:xA;case"left":case"right":return t?ZL:HL;default:return[]}}function WL(e,t,r,o){const u=S1(e);let d=$L(wh(e),r==="start",o);return u&&(d=d.map(p=>p+"-"+u),t&&(d=d.concat(d.map(pb)))),d}function Wg(e){return e.replace(/left|right|bottom|top/g,t=>jL[t])}function YL(e){return{top:0,right:0,bottom:0,left:0,...e}}function XL(e){return typeof e!="number"?YL(e):{top:e,right:e,bottom:e,left:e}}function Yg(e){const{x:t,y:r,width:o,height:u}=e;return{width:o,height:u,top:r,left:t,right:t+o,bottom:r+u,x:t,y:r}}function wA(e,t,r){let{reference:o,floating:u}=e;const d=Tc(t),p=oC(t),a=aC(p),w=wh(t),T=d==="y",S=o.x+o.width/2-u.width/2,k=o.y+o.height/2-u.height/2,I=o[a]/2-u[a]/2;let P;switch(w){case"top":P={x:S,y:o.y-u.height};break;case"bottom":P={x:S,y:o.y+o.height};break;case"right":P={x:o.x+o.width,y:k};break;case"left":P={x:o.x-u.width,y:k};break;default:P={x:o.x,y:o.y}}switch(S1(t)){case"start":P[p]-=I*(r&&T?-1:1);break;case"end":P[p]+=I*(r&&T?-1:1);break}return P}const QL=async(e,t,r)=>{const{placement:o="bottom",strategy:u="absolute",middleware:d=[],platform:p}=r,a=d.filter(Boolean),w=await(p.isRTL==null?void 0:p.isRTL(t));let T=await p.getElementRects({reference:e,floating:t,strategy:u}),{x:S,y:k}=wA(T,o,w),I=o,P={},F=0;for(let G=0;G<a.length;G++){const{name:H,fn:Y}=a[G],{x:$,y:ae,data:ee,reset:ce}=await Y({x:S,y:k,initialPlacement:o,placement:I,strategy:u,middlewareData:P,rects:T,platform:p,elements:{reference:e,floating:t}});S=$??S,k=ae??k,P={...P,[H]:{...P[H],...ee}},ce&&F<=50&&(F++,typeof ce=="object"&&(ce.placement&&(I=ce.placement),ce.rects&&(T=ce.rects===!0?await p.getElementRects({reference:e,floating:t,strategy:u}):ce.rects),{x:S,y:k}=wA(T,I,w)),G=-1)}return{x:S,y:k,placement:I,strategy:u,middlewareData:P}};async function sC(e,t){var r;t===void 0&&(t={});const{x:o,y:u,platform:d,rects:p,elements:a,strategy:w}=e,{boundary:T="clippingAncestors",rootBoundary:S="viewport",elementContext:k="floating",altBoundary:I=!1,padding:P=0}=T1(t,e),F=XL(P),H=a[I?k==="floating"?"reference":"floating":k],Y=Yg(await d.getClippingRect({element:(r=await(d.isElement==null?void 0:d.isElement(H)))==null||r?H:H.contextElement||await(d.getDocumentElement==null?void 0:d.getDocumentElement(a.floating)),boundary:T,rootBoundary:S,strategy:w})),$=k==="floating"?{x:o,y:u,width:p.floating.width,height:p.floating.height}:p.reference,ae=await(d.getOffsetParent==null?void 0:d.getOffsetParent(a.floating)),ee=await(d.isElement==null?void 0:d.isElement(ae))?await(d.getScale==null?void 0:d.getScale(ae))||{x:1,y:1}:{x:1,y:1},ce=Yg(d.convertOffsetParentRelativeRectToViewportRelativeRect?await d.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:$,offsetParent:ae,strategy:w}):$);return{top:(Y.top-ce.top+F.top)/ee.y,bottom:(ce.bottom-Y.bottom+F.bottom)/ee.y,left:(Y.left-ce.left+F.left)/ee.x,right:(ce.right-Y.right+F.right)/ee.x}}const KL=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(t){var r,o;const{placement:u,middlewareData:d,rects:p,initialPlacement:a,platform:w,elements:T}=t,{mainAxis:S=!0,crossAxis:k=!0,fallbackPlacements:I,fallbackStrategy:P="bestFit",fallbackAxisSideDirection:F="none",flipAlignment:G=!0,...H}=T1(e,t);if((r=d.arrow)!=null&&r.alignmentOffset)return{};const Y=wh(u),$=Tc(a),ae=wh(a)===a,ee=await(w.isRTL==null?void 0:w.isRTL(T.floating)),ce=I||(ae||!G?[Wg(a)]:qL(a)),re=F!=="none";!I&&re&&ce.push(...WL(a,G,F,ee));const he=[a,...ce],be=await sC(t,H),ke=[];let Ie=((o=d.flip)==null?void 0:o.overflows)||[];if(S&&ke.push(be[Y]),k){const Xe=GL(u,p,ee);ke.push(be[Xe[0]],be[Xe[1]])}if(Ie=[...Ie,{placement:u,overflows:ke}],!ke.every(Xe=>Xe<=0)){var ue,Ve;const Xe=(((ue=d.flip)==null?void 0:ue.index)||0)+1,Re=he[Xe];if(Re&&(!(k==="alignment"?$!==Tc(Re):!1)||Ie.every(bt=>bt.overflows[0]>0&&Tc(bt.placement)===$)))return{data:{index:Xe,overflows:Ie},reset:{placement:Re}};let ot=(Ve=Ie.filter(Pt=>Pt.overflows[0]<=0).sort((Pt,bt)=>Pt.overflows[1]-bt.overflows[1])[0])==null?void 0:Ve.placement;if(!ot)switch(P){case"bestFit":{var Ze;const Pt=(Ze=Ie.filter(bt=>{if(re){const _t=Tc(bt.placement);return _t===$||_t==="y"}return!0}).map(bt=>[bt.placement,bt.overflows.filter(_t=>_t>0).reduce((_t,tt)=>_t+tt,0)]).sort((bt,_t)=>bt[1]-_t[1])[0])==null?void 0:Ze[0];Pt&&(ot=Pt);break}case"initialPlacement":ot=a;break}if(u!==ot)return{reset:{placement:ot}}}return{}}}},JL=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(t){const{x:r,y:o,placement:u}=t,{mainAxis:d=!0,crossAxis:p=!1,limiter:a={fn:H=>{let{x:Y,y:$}=H;return{x:Y,y:$}}},...w}=T1(e,t),T={x:r,y:o},S=await sC(t,w),k=Tc(wh(u)),I=rC(k);let P=T[I],F=T[k];if(d){const H=I==="y"?"top":"left",Y=I==="y"?"bottom":"right",$=P+S[H],ae=P-S[Y];P=vA($,P,ae)}if(p){const H=k==="y"?"top":"left",Y=k==="y"?"bottom":"right",$=F+S[H],ae=F-S[Y];F=vA($,F,ae)}const G=a.fn({...t,[I]:P,[k]:F});return{...G,data:{x:G.x-r,y:G.y-o,enabled:{[I]:d,[k]:p}}}}}};function N_(){return typeof window<"u"}function jh(e){return lC(e)?(e.nodeName||"").toLowerCase():"#document"}function Da(e){var t;return(e==null||(t=e.ownerDocument)==null?void 0:t.defaultView)||window}function Qo(e){var t;return(t=(lC(e)?e.ownerDocument:e.document)||window.document)==null?void 0:t.documentElement}function lC(e){return N_()?e instanceof Node||e instanceof Da(e).Node:!1}function yo(e){return N_()?e instanceof Element||e instanceof Da(e).Element:!1}function Wo(e){return N_()?e instanceof HTMLElement||e instanceof Da(e).HTMLElement:!1}function AA(e){return!N_()||typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof Da(e).ShadowRoot}const e8=new Set(["inline","contents"]);function fp(e){const{overflow:t,overflowX:r,overflowY:o,display:u}=vo(e);return/auto|scroll|overlay|hidden|clip/.test(t+o+r)&&!e8.has(u)}const t8=new Set(["table","td","th"]);function n8(e){return t8.has(jh(e))}const i8=[":popover-open",":modal"];function j_(e){return i8.some(t=>{try{return e.matches(t)}catch{return!1}})}const r8=["transform","translate","scale","rotate","perspective"],a8=["transform","translate","scale","rotate","perspective","filter"],o8=["paint","layout","strict","content"];function M1(e){const t=C1(),r=yo(e)?vo(e):e;return r8.some(o=>r[o]?r[o]!=="none":!1)||(r.containerType?r.containerType!=="normal":!1)||!t&&(r.backdropFilter?r.backdropFilter!=="none":!1)||!t&&(r.filter?r.filter!=="none":!1)||a8.some(o=>(r.willChange||"").includes(o))||o8.some(o=>(r.contain||"").includes(o))}function s8(e){let t=Tl(e);for(;Wo(t)&&!Ah(t);){if(M1(t))return t;if(j_(t))return null;t=Tl(t)}return null}function C1(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const l8=new Set(["html","body","#document"]);function Ah(e){return l8.has(jh(e))}function vo(e){return Da(e).getComputedStyle(e)}function U_(e){return yo(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function Tl(e){if(jh(e)==="html")return e;const t=e.assignedSlot||e.parentNode||AA(e)&&e.host||Qo(e);return AA(t)?t.host:t}function cC(e){const t=Tl(e);return Ah(t)?e.ownerDocument?e.ownerDocument.body:e.body:Wo(t)&&fp(t)?t:cC(t)}function Ud(e,t,r){var o;t===void 0&&(t=[]),r===void 0&&(r=!0);const u=cC(e),d=u===((o=e.ownerDocument)==null?void 0:o.body),p=Da(u);if(d){const a=mb(p);return t.concat(p,p.visualViewport||[],fp(u)?u:[],a&&r?Ud(a):[])}return t.concat(u,Ud(u,[],r))}function mb(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function uC(e){const t=vo(e);let r=parseFloat(t.width)||0,o=parseFloat(t.height)||0;const u=Wo(e),d=u?e.offsetWidth:r,p=u?e.offsetHeight:o,a=$g(r)!==d||$g(o)!==p;return a&&(r=d,o=p),{width:r,height:o,$:a}}function I1(e){return yo(e)?e:e.contextElement}function sh(e){const t=I1(e);if(!Wo(t))return Zo(1);const r=t.getBoundingClientRect(),{width:o,height:u,$:d}=uC(t);let p=(d?$g(r.width):r.width)/o,a=(d?$g(r.height):r.height)/u;return(!p||!Number.isFinite(p))&&(p=1),(!a||!Number.isFinite(a))&&(a=1),{x:p,y:a}}const c8=Zo(0);function hC(e){const t=Da(e);return!C1()||!t.visualViewport?c8:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function u8(e,t,r){return t===void 0&&(t=!1),!r||t&&r!==Da(e)?!1:t}function jc(e,t,r,o){t===void 0&&(t=!1),r===void 0&&(r=!1);const u=e.getBoundingClientRect(),d=I1(e);let p=Zo(1);t&&(o?yo(o)&&(p=sh(o)):p=sh(e));const a=u8(d,r,o)?hC(d):Zo(0);let w=(u.left+a.x)/p.x,T=(u.top+a.y)/p.y,S=u.width/p.x,k=u.height/p.y;if(d){const I=Da(d),P=o&&yo(o)?Da(o):o;let F=I,G=mb(F);for(;G&&o&&P!==F;){const H=sh(G),Y=G.getBoundingClientRect(),$=vo(G),ae=Y.left+(G.clientLeft+parseFloat($.paddingLeft))*H.x,ee=Y.top+(G.clientTop+parseFloat($.paddingTop))*H.y;w*=H.x,T*=H.y,S*=H.x,k*=H.y,w+=ae,T+=ee,F=Da(G),G=mb(F)}}return Yg({width:S,height:k,x:w,y:T})}function E1(e,t){const r=U_(e).scrollLeft;return t?t.left+r:jc(Qo(e)).left+r}function fC(e,t,r){r===void 0&&(r=!1);const o=e.getBoundingClientRect(),u=o.left+t.scrollLeft-(r?0:E1(e,o)),d=o.top+t.scrollTop;return{x:u,y:d}}function h8(e){let{elements:t,rect:r,offsetParent:o,strategy:u}=e;const d=u==="fixed",p=Qo(o),a=t?j_(t.floating):!1;if(o===p||a&&d)return r;let w={scrollLeft:0,scrollTop:0},T=Zo(1);const S=Zo(0),k=Wo(o);if((k||!k&&!d)&&((jh(o)!=="body"||fp(p))&&(w=U_(o)),Wo(o))){const P=jc(o);T=sh(o),S.x=P.x+o.clientLeft,S.y=P.y+o.clientTop}const I=p&&!k&&!d?fC(p,w,!0):Zo(0);return{width:r.width*T.x,height:r.height*T.y,x:r.x*T.x-w.scrollLeft*T.x+S.x+I.x,y:r.y*T.y-w.scrollTop*T.y+S.y+I.y}}function f8(e){return Array.from(e.getClientRects())}function d8(e){const t=Qo(e),r=U_(e),o=e.ownerDocument.body,u=kc(t.scrollWidth,t.clientWidth,o.scrollWidth,o.clientWidth),d=kc(t.scrollHeight,t.clientHeight,o.scrollHeight,o.clientHeight);let p=-r.scrollLeft+E1(e);const a=-r.scrollTop;return vo(o).direction==="rtl"&&(p+=kc(t.clientWidth,o.clientWidth)-u),{width:u,height:d,x:p,y:a}}function p8(e,t){const r=Da(e),o=Qo(e),u=r.visualViewport;let d=o.clientWidth,p=o.clientHeight,a=0,w=0;if(u){d=u.width,p=u.height;const T=C1();(!T||T&&t==="fixed")&&(a=u.offsetLeft,w=u.offsetTop)}return{width:d,height:p,x:a,y:w}}const m8=new Set(["absolute","fixed"]);function g8(e,t){const r=jc(e,!0,t==="fixed"),o=r.top+e.clientTop,u=r.left+e.clientLeft,d=Wo(e)?sh(e):Zo(1),p=e.clientWidth*d.x,a=e.clientHeight*d.y,w=u*d.x,T=o*d.y;return{width:p,height:a,x:w,y:T}}function TA(e,t,r){let o;if(t==="viewport")o=p8(e,r);else if(t==="document")o=d8(Qo(e));else if(yo(t))o=g8(t,r);else{const u=hC(e);o={x:t.x-u.x,y:t.y-u.y,width:t.width,height:t.height}}return Yg(o)}function dC(e,t){const r=Tl(e);return r===t||!yo(r)||Ah(r)?!1:vo(r).position==="fixed"||dC(r,t)}function _8(e,t){const r=t.get(e);if(r)return r;let o=Ud(e,[],!1).filter(a=>yo(a)&&jh(a)!=="body"),u=null;const d=vo(e).position==="fixed";let p=d?Tl(e):e;for(;yo(p)&&!Ah(p);){const a=vo(p),w=M1(p);!w&&a.position==="fixed"&&(u=null),(d?!w&&!u:!w&&a.position==="static"&&!!u&&m8.has(u.position)||fp(p)&&!w&&dC(e,p))?o=o.filter(S=>S!==p):u=a,p=Tl(p)}return t.set(e,o),o}function y8(e){let{element:t,boundary:r,rootBoundary:o,strategy:u}=e;const p=[...r==="clippingAncestors"?j_(t)?[]:_8(t,this._c):[].concat(r),o],a=p[0],w=p.reduce((T,S)=>{const k=TA(t,S,u);return T.top=kc(k.top,T.top),T.right=Hg(k.right,T.right),T.bottom=Hg(k.bottom,T.bottom),T.left=kc(k.left,T.left),T},TA(t,a,u));return{width:w.right-w.left,height:w.bottom-w.top,x:w.left,y:w.top}}function v8(e){const{width:t,height:r}=uC(e);return{width:t,height:r}}function b8(e,t,r){const o=Wo(t),u=Qo(t),d=r==="fixed",p=jc(e,!0,d,t);let a={scrollLeft:0,scrollTop:0};const w=Zo(0);function T(){w.x=E1(u)}if(o||!o&&!d)if((jh(t)!=="body"||fp(u))&&(a=U_(t)),o){const P=jc(t,!0,d,t);w.x=P.x+t.clientLeft,w.y=P.y+t.clientTop}else u&&T();d&&!o&&u&&T();const S=u&&!o&&!d?fC(u,a):Zo(0),k=p.left+a.scrollLeft-w.x-S.x,I=p.top+a.scrollTop-w.y-S.y;return{x:k,y:I,width:p.width,height:p.height}}function J0(e){return vo(e).position==="static"}function SA(e,t){if(!Wo(e)||vo(e).position==="fixed")return null;if(t)return t(e);let r=e.offsetParent;return Qo(e)===r&&(r=r.ownerDocument.body),r}function pC(e,t){const r=Da(e);if(j_(e))return r;if(!Wo(e)){let u=Tl(e);for(;u&&!Ah(u);){if(yo(u)&&!J0(u))return u;u=Tl(u)}return r}let o=SA(e,t);for(;o&&n8(o)&&J0(o);)o=SA(o,t);return o&&Ah(o)&&J0(o)&&!M1(o)?r:o||s8(e)||r}const x8=async function(e){const t=this.getOffsetParent||pC,r=this.getDimensions,o=await r(e.floating);return{reference:b8(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:o.width,height:o.height}}};function w8(e){return vo(e).direction==="rtl"}const A8={convertOffsetParentRelativeRectToViewportRelativeRect:h8,getDocumentElement:Qo,getClippingRect:y8,getOffsetParent:pC,getElementRects:x8,getClientRects:f8,getDimensions:v8,getScale:sh,isElement:yo,isRTL:w8};function mC(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}function T8(e,t){let r=null,o;const u=Qo(e);function d(){var a;clearTimeout(o),(a=r)==null||a.disconnect(),r=null}function p(a,w){a===void 0&&(a=!1),w===void 0&&(w=1),d();const T=e.getBoundingClientRect(),{left:S,top:k,width:I,height:P}=T;if(a||t(),!I||!P)return;const F=Gm(k),G=Gm(u.clientWidth-(S+I)),H=Gm(u.clientHeight-(k+P)),Y=Gm(S),ae={rootMargin:-F+"px "+-G+"px "+-H+"px "+-Y+"px",threshold:kc(0,Hg(1,w))||1};let ee=!0;function ce(re){const he=re[0].intersectionRatio;if(he!==w){if(!ee)return p();he?p(!1,he):o=setTimeout(()=>{p(!1,1e-7)},1e3)}he===1&&!mC(T,e.getBoundingClientRect())&&p(),ee=!1}try{r=new IntersectionObserver(ce,{...ae,root:u.ownerDocument})}catch{r=new IntersectionObserver(ce,ae)}r.observe(e)}return p(!0),d}function S8(e,t,r,o){o===void 0&&(o={});const{ancestorScroll:u=!0,ancestorResize:d=!0,elementResize:p=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:w=!1}=o,T=I1(e),S=u||d?[...T?Ud(T):[],...Ud(t)]:[];S.forEach(Y=>{u&&Y.addEventListener("scroll",r,{passive:!0}),d&&Y.addEventListener("resize",r)});const k=T&&a?T8(T,r):null;let I=-1,P=null;p&&(P=new ResizeObserver(Y=>{let[$]=Y;$&&$.target===T&&P&&(P.unobserve(t),cancelAnimationFrame(I),I=requestAnimationFrame(()=>{var ae;(ae=P)==null||ae.observe(t)})),r()}),T&&!w&&P.observe(T),P.observe(t));let F,G=w?jc(e):null;w&&H();function H(){const Y=jc(e);G&&!mC(G,Y)&&r(),G=Y,F=requestAnimationFrame(H)}return r(),()=>{var Y;S.forEach($=>{u&&$.removeEventListener("scroll",r),d&&$.removeEventListener("resize",r)}),k==null||k(),(Y=P)==null||Y.disconnect(),P=null,w&&cancelAnimationFrame(F)}}const M8=JL,C8=KL,I8=(e,t,r)=>{const o=new Map,u={platform:A8,...r},d={...u.platform,_c:o};return QL(e,t,{...u,platform:d})};function E8(e){var o;const t=(o=e.parentElement)==null?void 0:o.querySelector("input[type=text]");if(!t)return;const r=S8(t,e,()=>I8(t,e,{placement:"bottom-start",middleware:[M8({padding:5}),C8()]}).then(({x:u,y:d})=>{Object.assign(e.style,{left:`${u}px`,top:`${d}px`})}));return{destroy(){r()}}}function P8(e,t,r,o){let u=e?Array.isArray(e)?e:e.split(","):[];return u=u.map(d=>d.replace(/(:\d+):\d+(.*)/,"$1$2")),{iValues:u,iValueCombined:u.length?u.join():null,iDates:u.map(d=>Ac(d,t,r,o))}}function k8(e,t){return e==="auto"?t.match(/g|hh?|ii?/i)&&t.match(/y|m|d/i)?"datetime":t.match(/g|hh?|ii?/i)?"time":"date":e}const Xr=eL;var D8=tn('<span><button type="button"> </button> <button type="button"> </button></span>'),z8=tn('<button type="button"> </button>'),R8=tn('<button type="button"> </button>'),L8=tn("<span><!> <!></span>"),B8=tn('<div class="sdt-btn-row svelte-yheoi9"><!> <!></div>'),F8=tn('<input type="text" tabindex="0" autocomplete="off"/>'),O8=tn('<input type="hidden"/> <!>',1),N8=e=>e.preventDefault(),j8=tn('<div class="sdt-widget svelte-yheoi9"><!></div>'),U8=tn('<div><div class="sdt-widget-wrap svelte-yheoi9"></div> <!></div>'),V8=tn('<div><div class="sdt-input-wrap svelte-yheoi9" style="border: 3px dashed orange; position: relative"><!> <!></div> <!></div>');function MA(e,t){nr(t,!0);const r=(rt,Dt)=>{let Ci=()=>Dt==null?void 0:Dt().autocloseSupported,gi=()=>Dt==null?void 0:Dt().todayBtnClasses,on=()=>Dt==null?void 0:Dt().clearBtnClasses,Oe=()=>Dt==null?void 0:Dt().onCancel,lt=()=>Dt==null?void 0:Dt().onConfirm,Ot=()=>Dt==null?void 0:Dt().onClear,cn=()=>Dt==null?void 0:Dt().onToday,gn=()=>Dt==null?void 0:Dt().isTodayDisabled,mn=()=>Dt==null?void 0:Dt().i18n,bn=()=>Dt==null?void 0:Dt().currentMode;var hn=Ti(),An=Kn(hn);{var Qi=kn=>{var jn=B8(),Qn=Bt(jn);{var Ai=Dn=>{var ui=D8(),oi=Bt(ui);oi.__click=function(...Di){var Cn;(Cn=Oe())==null||Cn.apply(this,Di)};var _i=Bt(oi,!0);Et(oi);var Vn=an(oi,2);Vn.__click=function(...Di){var Cn;(Cn=lt())==null||Cn.apply(this,Di)};var Gi=Bt(Vn,!0);Et(Vn),Et(ui),wn(()=>{ai(oi,1,_l(on()),"svelte-yheoi9"),xi(_i,mn().cancelBtn),ai(Vn,1,_l(gi()),"svelte-yheoi9"),xi(Gi,mn().okBtn)}),It(Dn,ui)};pn(Qn,Dn=>{Ci()||Dn(Ai)})}var Jn=an(Qn,2);{var Un=Dn=>{var ui=L8(),oi=Bt(ui);{var _i=Di=>{var Cn=z8();Cn.__click=function(...Ki){var Gr;(Gr=cn())==null||Gr.apply(this,Ki)};var yi=Bt(Cn,!0);Et(Cn),wn(()=>{ai(Cn,1,_l(gi()),"svelte-yheoi9"),Cn.disabled=gn(),xi(yi,mn().todayBtn)}),It(Di,Cn)};pn(oi,Di=>{ue()&&bn()==="date"&&Di(_i)})}var Vn=an(oi,2);{var Gi=Di=>{var Cn=R8();Cn.__click=function(...Ki){var Gr;(Gr=Ot())==null||Gr.apply(this,Ki)};var yi=Bt(Cn,!0);Et(Cn),wn(()=>{ai(Cn,1,_l(on()),"svelte-yheoi9"),xi(yi,mn().clearBtn)}),It(Di,Cn)};pn(Vn,Di=>{Ve()&&Di(Gi)})}Et(ui),It(Dn,ui)};pn(Jn,Dn=>{(ue()||Ve())&&Dn(Un)})}Et(jn),It(kn,jn)};pn(An,kn=>{Ci(),kn(Qi)})}It(rt,hn)};let o=Se(t,"inputId",3,""),u=Se(t,"name",3,"date"),d=Se(t,"disabled",3,!1),p=Se(t,"placeholder",3,null),a=Se(t,"required",3,!1),w=Se(t,"value",15,null),T=Se(t,"isRange",3,!1),S=Se(t,"startDate",3,null),k=Se(t,"endDate",3,null),I=Se(t,"pickerOnly",3,!1),P=Se(t,"startView",7,fo),F=Se(t,"mode",3,"auto"),G=Se(t,"disableDatesFn",3,null),H=Se(t,"manualInput",3,!1),Y=Se(t,"theme",19,()=>Xr.theme),$=Se(t,"format",19,()=>Xr.format),ae=Se(t,"formatType",19,()=>Xr.formatType),ee=Se(t,"displayFormat",19,()=>Xr.displayFormat),ce=Se(t,"displayFormatType",19,()=>Xr.displayFormatType),re=Se(t,"minuteIncrement",19,()=>Xr.minuteIncrement),he=Se(t,"weekStart",19,()=>Xr.weekStart),be=Se(t,"inputClasses",19,()=>Xr.inputClasses),ke=Se(t,"todayBtnClasses",19,()=>Xr.todayBtnClasses),Ie=Se(t,"clearBtnClasses",19,()=>Xr.clearBtnClasses),ue=Se(t,"todayBtn",19,()=>Xr.todayBtn),Ve=Se(t,"clearBtn",19,()=>Xr.clearBtn),Ze=Se(t,"clearToggle",19,()=>Xr.clearToggle),Xe=Se(t,"autocommit",19,()=>Xr.autocommit),Re=Se(t,"hourOnly",19,()=>Xr.hourOnly),ot=Se(t,"i18n",19,()=>Xr.i18n),Pt=Se(t,"validatorAction",3,null),bt=Se(t,"ce_valueElement",7,null),_t=Se(t,"ce_displayElement",7,null),tt=Se(t,"positionResolver",3,E8),Tt=Se(t,"actionRow",3,r);T()&&Array.isArray(w())===!1&&console.warn("[svelty-picker] value property must be an array for range picker");const{iDates:ct,iValues:mt,iValueCombined:Xt}=P8(w(),$(),ot(),ae());let Ut=Xt,St=$t(Ui(mt)),pt=$t(Ui(ct.map(rt=>new dr(rt)))),Ft=$t(Ui(mt)),nt=Vt(()=>L(St).length?L(St).join(","):null),De=$t(Ui(X())),Ke=$(),Be=ee(),wt=$t(null),gt=Vt(()=>S()?Ac(S(),$(),ot(),ae()):null),Rt=Vt(()=>k()?new Date(Ac(k(),$(),ot(),ae()).setSeconds(1)):null),st=Vt(()=>L(gt)&&L(gt)>new Date||L(Rt)&&L(Rt)<new Date),ht=Vt(()=>u().endsWith("]")?u().substring(0,u().length-1)+"_input]":u()+"_input"),qe=k8(F(),$()),Mt=$t(Ui(qe)),Ht=$t(Ui(qe==="time"?"time":"date")),_n=Ui(T()?[{ref:null},{ref:null}]:[{ref:null}]),In=$t("date"),yt=Vt(()=>Xe()&&(T()&&L(Mt)==="date"||!T())),qt=$t(Ui(I())),Nt=$t(Ui(I())),fn=I()?()=>({}):Dd,yn=Vt(()=>!!I()),On=Pt()?Pt().shift():()=>{},Mi=Pt()||[],$n=Vt(()=>I()?()=>{}:tt()),wi=Vt(()=>Xe()?!1:L(St).join()!==L(Ft).join()),Ce;function X(){return L(pt).sort((rt,Dt)=>rt.getTime()-Dt.getTime()).map(rt=>cd(rt,ee()||$(),ot(),ce()||ae())).join(" - ")}function K(){return T()?L(St).length===2?L(St):null:L(St)[0]||null}function te({type:rt,date:Dt,isKeyboard:Ci,dateIndex:gi=0}){if(Dt&&!T()&&L(pt).length&&L(pt)[0].getFullYear()===Dt.getFullYear()&&L(pt)[0].getMonth()===Dt.getMonth()&&L(pt)[0].getDate()===Dt.getDate()&&L(Mt)==="date"&&!a()&&Ze()&&(Dt=null),T()){if(rt==="date")Qe(pt,Dt?(L(pt).length===2?[new dr(Dt)]:L(pt).concat(new dr(Dt))).map(on=>on.getTime()).sort().map(on=>new dr(on)):[],!0);else if(Dt&&gi!==void 0)L(pt)[gi]=new dr(Dt);else if(rt==="datetime")L(pt)[0]=new dr(Dt),L(pt)[1]=new dr(Dt);else throw new Error(`Unhandled event type: '${rt}'`);Qe(St,L(pt).map(on=>cd(on,$(),ot(),ae())),!0)}else Qe(pt,Dt?[new dr(Dt)]:[],!0),Qe(St,Dt?[cd(Dt,$(),ot(),ae())]:[],!0);Qe(In,rt,!0),pe(rt)&&we(),Fe(rt,Ci,gi)}function pe(rt){return!Xe()||T()&&L(Mt).includes("time")||T()&&(L(Mt)==="datetime"||L(St).length!==2)?!1:rt==="minute"||rt===L(Mt)||rt==="hour"&&Re()||I()}function we(){var rt,Dt;Ut=L(St).join(),Qe(Ft,[...L(St)],!0),Qe(De,X(),!0),w(K()),Pn(),(rt=t.onChange)==null||rt.call(t,T()?L(St):L(St)[0]||null),(Dt=t.onDateChange)==null||Dt.call(t,{value:T()?L(St):L(St)[0]||null,dateValue:T()?L(pt):L(pt)[0]||null,displayValue:L(De),valueFormat:$(),displayFormat:ee(),event:L(In)})}function Ee(){P(fo),L(Mt)==="datetime"?setTimeout(()=>{I()||Qe(Nt,!1),Qe(Ht,"date")},Xe()?300:0):I()||Qe(Nt,!1)}function Fe(rt,Dt,Ci){if(Dt&&Je!=="Enter")return;if(rt==="hour"&&!Re()){_n[Ci].ref.showMinuteView();return}const gi=pe(rt);if(L(Mt)==="datetime"&&!(rt==="minute"&&!T()&&L(Mt)==="datetime"&&gi)){rt==="date"&&(T()&&L(St).length===2||!T())&&Qe(Ht,"time");return}gi&&!Dt&&Ee()}function Pe(){const rt=new Date;te({type:T()?"datetime":"date",dateIndex:0,date:new Date(rt.getFullYear(),rt.getMonth(),rt.getDate(),0,0,0),isKeyboard:!1}),T()&&te({type:T()?"datetime":"date",dateIndex:1,date:new Date(rt.getFullYear(),rt.getMonth(),rt.getDate(),23,59,59,999),isKeyboard:!1}),pe("date")===!1&&we(),L(Mt)==="date"&&Ee()}function He(){Qe(pt,[],!0),Qe(St,[],!0),Ut=null,we()}function Ge(){const rt=Array.isArray(w())?w().join():w()||null;(Ut!==rt||Xe()===!1||T())&&we(),Ee()}function Le(){var rt;Qe(St,[...L(Ft)],!0),Ee(),(rt=t.onCancel)==null||rt.call(t)}let Je=null;function Ae(rt){if(L(Nt)||(["Backspace","Delete"].includes(rt.key)&&!a()&&He(),rt.key==="Enter"&&en()),!L(Nt)&&rt.key!=="Tab"){Qe(Nt,rt.key!=="Shift"),rt.preventDefault();return}switch(Je=rt.key,rt.key){case"PageDown":case"PageUp":case"ArrowDown":case"ArrowUp":case"ArrowLeft":case"ArrowRight":if(rt.preventDefault(),T())return;L(Ht)==="date"?Ce.handleGridNav(rt.key,rt.shiftKey):_n[0].ref.makeTick(["ArrowDown","ArrowLeft","PageDown"].includes(rt.key)?-1:1);break;case"Escape":Xe()?He():Le();break;case"Backspace":if(H()&&!T())return;case"Delete":!a()&&He();break;case"Enter":if(L(qt)&&rt.preventDefault(),L(St).length===0){Qe(Nt,!1);return}if(L(Ht)==="time"&&L(In)==="hour")return _n[0].ref.showMinuteView();if(L(Mt)==="datetime"&&L(Ht)!=="time"){Qe(Ht,"time");return}Ge();break;case"Tab":L(Nt)&&(Qe(Nt,!1),rt.preventDefault());case"F5":break;default:!H()&&rt.preventDefault()}}function Lt(rt){rt.preventDefault(),rt.stopPropagation();const Dt=Ac(rt.target.value,ee()||$(),ot(),ce()||ae());cd(Dt,ee()||$(),ot(),ce()||ae())===rt.target.value&&(te({type:"date",date:Dt,isKeyboard:!0}),Ce.focusDate(Dt))}function nn(rt){P(fo),Qe(Ht,rt,!0)}let jt=$t(Ui(H()?"text":"none"));function Kt(){H()&&L(qt)&&Qe(jt,L(jt)==="text"?"none":"text",!0),!L(Nt)&&en()}function en(){Qe(qt,!0),Qe(Nt,!0)}function ti(){var rt;Qe(qt,!1),L(yt)?Ge():Le(),!_t()&&((rt=t.onBlur)==null||rt.call(t))}function Pn(rt){var Dt;bt()&&_t()&&(bt().value=L(St).join(",")||"",_t().value=L(De),bt().dispatchEvent(new Event("input")),_t().dispatchEvent(new Event("input"))),(Dt=t.onInput)==null||Dt.call(t,L(nt))}function Nn(rt){Qe(wt,rt,!0)}u1(()=>{_t()&&(_t().onfocus=en,_t().onblur=ti,_t().onclick=Kt,_t().onkeydown=Ae)});function ln(rt){const Dt=Array.isArray(rt)?rt.join():rt||null;Ut!==Dt&&(Qe(St,rt?Array.isArray(rt)?rt:[rt]:[],!0),Qe(pt,L(St).map(Ci=>new dr(Ac(Ci,$(),ot(),ae()))),!0),Qe(Ft,L(St),!0),Ut=Dt)}function En(rt,Dt){Be!==Dt&&(Be=Dt,Qe(De,X(),!0)),Ke!==rt&&L(pt).length&&(Ke=rt,Qe(St,L(pt).map(Ci=>cd(Ci,rt,ot(),ae())),!0),Ut=L(St).join(),Be===null&&Be===Dt&&Qe(De,X(),!0),F()==="auto"&&(Qe(Mt,rt.match(/g|hh?|ii?/i)&&rt.match(/y|m|d/i)?"datetime":rt.match(/g|hh?|ii?/i)?"time":"date",!0),L(Mt)==="time"&&L(Ht)!=="time"&&Qe(Ht,"time")),we())}ei(()=>ln(w())),ei(()=>En($(),ee()));var li=V8();let xt;var mi=Bt(li);mi.__click=Kt;var ci=Bt(mi);{var ha=rt=>{var Dt=O8(),Ci=Kn(Dt);Tg(Ci);var gi=an(Ci,2);{var on=Oe=>{var lt=F8();Tg(lt);let Ot;lt.__input=function(...cn){var gn;(gn=H()?Lt:()=>{})==null||gn.apply(this,cn)},lt.__keydown=Ae,_h(lt,(cn,gn)=>On==null?void 0:On(cn,gn),()=>Mi),wn(cn=>{ri(lt,"id",o()),ri(lt,"name",L(ht)),Ot=ai(lt,1,_l(be()),"svelte-yheoi9",Ot,cn),jv(lt,L(De)),ri(lt,"placeholder",p()),lt.disabled=d(),lt.required=a(),ri(lt,"inputmode",L(jt)),lt.readOnly=L(qt)&&!H()&&!T()},[()=>({"value-dirty":L(wi)})]),fr("focus",lt,en),fr("blur",lt,ti),It(Oe,lt)};pn(gi,Oe=>{I()||Oe(on)})}wn(()=>{ri(Ci,"name",u()),jv(Ci,w())}),It(rt,Dt)};pn(ci,rt=>{_t()||rt(ha)})}var fa=an(ci,2);jr(fa,()=>t.children??Ha),Et(mi);var kt=an(mi,2);{var vn=rt=>{var Dt=U8();let Ci;Dt.__mousedown=[N8];var gi=Bt(Dt);Pr(gi,21,()=>_n,la,(Oe,lt,Ot)=>{var cn=j8(),gn=Bt(cn);{var mn=hn=>{{let An=Vt(()=>{var kn;return(kn=L(Mt))==null?void 0:kn.includes("time")}),Qi=Vt(()=>P()>2?2:P());Go(AL(hn,{wid:Ot,get dates(){return L(pt)},get isRange(){return T()},get startDate(){return L(gt)},get endDate(){return L(Rt)},get enableTimeToggle(){return L(An)},get initialView(){return L(Qi)},get hoverDate(){return L(wt)},get additionalDisableFn(){return G()},get i18n(){return ot()},get weekStart(){return he()},onupdate:te,onswitch:nn,onhoverupdate:Nn}),kn=>Ce=kn,()=>Ce)}},bn=hn=>{{let An=Vt(()=>L(pt)[Ot]||null),Qi=Vt(()=>T()&&Ot===1?L(pt)[0]:L(gt)),kn=Vt(()=>L(Mt)!=="time"),jn=Vt(()=>$().match(ae()==="php"?"a|A":"p|P")!==null);Go(NL(hn,{wid:Ot,get date(){return L(An)},get startDate(){return L(Qi)},get endDate(){return L(Rt)},get hasDateComponent(){return L(kn)},get showMeridian(){return L(jn)},get i18n(){return ot()},get minuteIncrement(){return re()},get hourOnly(){return Re()},onupdate:te,onswitch:nn}),(Qn,Ai)=>Ai.ref=Qn,Qn=>Qn==null?void 0:Qn.ref,()=>[L(lt)])}};pn(gn,hn=>{L(Ht)==="date"?hn(mn):hn(bn,!1)})}Et(cn),It(Oe,cn)}),Et(gi);var on=an(gi,2);jr(on,Tt,()=>({autocloseSupported:L(yt),todayBtnClasses:ke(),clearBtnClasses:Ie(),onCancel:Le,onConfirm:Ge,onClear:He,onToday:Pe,isTodayDisabled:L(st),i18n:ot(),currentMode:L(Ht)})),Et(Dt),_h(Dt,Oe=>{var lt;return(lt=L($n))==null?void 0:lt(Oe)}),wn(Oe=>Ci=ai(Dt,1,`sdt-calendar-wrap ${Y()??""}`,"svelte-yheoi9",Ci,Oe),[()=>({"is-popup":!L(yn),"is-range-wrap":T()})]),No(3,Dt,()=>fn,()=>({duration:200})),It(rt,Dt)};pn(kt,rt=>{L(Nt)&&L(qt)&&rt(vn)})}Et(li),wn(rt=>xt=ai(li,1,"sdt-component-wrap svelte-yheoi9",null,xt,rt),[()=>({"picker-active":L(Nt)})]),It(e,li),ir()}La(["click","input","keydown","mousedown"]);var G8=tn('<div class="w-full flex flex-row flex-wrap gap-x-4 gap-y-1 items-center"><div class="flex flex-row items-center gap-2"><h3 class="text-xs font-semibold text-gray-700 py-2 w-36 text-end">START DATE:</h3> <div class="range-picker w-auto text-sm border border-gray-400 hover:border-blue-500 rounded-sm"><!></div></div> <div class="flex flex-row items-center gap-2"><h3 class="text-xs font-semibold text-gray-700 py-2 text-end w-36 sm:w-auto">END DATE:</h3> <div class="range-picker w-auto text-sm border border-gray-400 hover:border-blue-500 rounded-sm"><!></div></div></div>');function q8(e,t){nr(t,!0);let r=Se(t,"startDate",15),o=Se(t,"endDate",15);var u=G8(),d=Bt(u),p=an(Bt(d),2),a=Bt(p);MA(a,{required:!0,id:"startDate",clearBtn:!1,todayBtn:!1,startDate:"2023-01-01",endDate:"2025-12-31",mode:"date",inputClasses:"w-24 text-center cursor-pointer",get value(){return r()},set value(k){r(k)}}),Et(p),Et(d);var w=an(d,2),T=an(Bt(w),2),S=Bt(T);MA(S,{required:!0,id:"endDate",clearBtn:!1,todayBtn:!1,startDate:"2023-01-01",endDate:"2025-12-31",mode:"date",inputClasses:"w-24 text-center cursor-pointer",get value(){return o()},set value(k){o(k)}}),Et(T),Et(w),Et(u),It(e,u),ir()}function Z8(e){return e}var H8=3,CA=1e-6;function $8(e){return"translate("+e+",0)"}function W8(e){return t=>+e(t)}function Y8(e,t){return t=Math.max(0,e.bandwidth()-t*2)/2,e.round()&&(t=Math.round(t)),r=>+e(r)+t}function X8(){return!this.__axis}function Q8(e,t){var r=[],o=null,u=null,d=6,p=6,a=3,w=typeof window<"u"&&window.devicePixelRatio>1?0:.5,T=1,S="y",k=$8;function I(P){var F=o??(t.ticks?t.ticks.apply(t,r):t.domain()),G=u??(t.tickFormat?t.tickFormat.apply(t,r):Z8),H=Math.max(d,0)+a,Y=t.range(),$=+Y[0]+w,ae=+Y[Y.length-1]+w,ee=(t.bandwidth?Y8:W8)(t.copy(),w),ce=P.selection?P.selection():P,re=ce.selectAll(".domain").data([null]),he=ce.selectAll(".tick").data(F,t).order(),be=he.exit(),ke=he.enter().append("g").attr("class","tick"),Ie=he.select("line"),ue=he.select("text");re=re.merge(re.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),he=he.merge(ke),Ie=Ie.merge(ke.append("line").attr("stroke","currentColor").attr(S+"2",T*d)),ue=ue.merge(ke.append("text").attr("fill","currentColor").attr(S,T*H).attr("dy","0.71em")),P!==ce&&(re=re.transition(P),he=he.transition(P),Ie=Ie.transition(P),ue=ue.transition(P),be=be.transition(P).attr("opacity",CA).attr("transform",function(Ve){return isFinite(Ve=ee(Ve))?k(Ve+w):this.getAttribute("transform")}),ke.attr("opacity",CA).attr("transform",function(Ve){var Ze=this.parentNode.__axis;return k((Ze&&isFinite(Ze=Ze(Ve))?Ze:ee(Ve))+w)})),be.remove(),re.attr("d",p?"M"+$+","+T*p+"V"+w+"H"+ae+"V"+T*p:"M"+$+","+w+"H"+ae),he.attr("opacity",1).attr("transform",function(Ve){return k(ee(Ve)+w)}),Ie.attr(S+"2",T*d),ue.attr(S,T*H).text(G),ce.filter(X8).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor","middle"),ce.each(function(){this.__axis=ee})}return I.scale=function(P){return arguments.length?(t=P,I):t},I.ticks=function(){return r=Array.from(arguments),I},I.tickArguments=function(P){return arguments.length?(r=P==null?[]:Array.from(P),I):r.slice()},I.tickValues=function(P){return arguments.length?(o=P==null?null:Array.from(P),I):o&&o.slice()},I.tickFormat=function(P){return arguments.length?(u=P,I):u},I.tickSize=function(P){return arguments.length?(d=p=+P,I):d},I.tickSizeInner=function(P){return arguments.length?(d=+P,I):d},I.tickSizeOuter=function(P){return arguments.length?(p=+P,I):p},I.tickPadding=function(P){return arguments.length?(a=+P,I):a},I.offset=function(P){return arguments.length?(w=+P,I):w},I}function K8(e){return Q8(H8,e)}var J8={value:()=>{}};function gC(){for(var e=0,t=arguments.length,r={},o;e<t;++e){if(!(o=arguments[e]+"")||o in r||/[\s.]/.test(o))throw new Error("illegal type: "+o);r[o]=[]}return new mg(r)}function mg(e){this._=e}function eB(e,t){return e.trim().split(/^|\s+/).map(function(r){var o="",u=r.indexOf(".");if(u>=0&&(o=r.slice(u+1),r=r.slice(0,u)),r&&!t.hasOwnProperty(r))throw new Error("unknown type: "+r);return{type:r,name:o}})}mg.prototype=gC.prototype={constructor:mg,on:function(e,t){var r=this._,o=eB(e+"",r),u,d=-1,p=o.length;if(arguments.length<2){for(;++d<p;)if((u=(e=o[d]).type)&&(u=tB(r[u],e.name)))return u;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++d<p;)if(u=(e=o[d]).type)r[u]=IA(r[u],e.name,t);else if(t==null)for(u in r)r[u]=IA(r[u],e.name,null);return this},copy:function(){var e={},t=this._;for(var r in t)e[r]=t[r].slice();return new mg(e)},call:function(e,t){if((u=arguments.length-2)>0)for(var r=new Array(u),o=0,u,d;o<u;++o)r[o]=arguments[o+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(d=this._[e],o=0,u=d.length;o<u;++o)d[o].value.apply(t,r)},apply:function(e,t,r){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var o=this._[e],u=0,d=o.length;u<d;++u)o[u].value.apply(t,r)}};function tB(e,t){for(var r=0,o=e.length,u;r<o;++r)if((u=e[r]).name===t)return u.value}function IA(e,t,r){for(var o=0,u=e.length;o<u;++o)if(e[o].name===t){e[o]=J8,e=e.slice(0,o).concat(e.slice(o+1));break}return r!=null&&e.push({name:t,value:r}),e}var gb="http://www.w3.org/1999/xhtml";const Th={svg:"http://www.w3.org/2000/svg",xhtml:gb,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function V_(e){var t=e+="",r=t.indexOf(":");return r>=0&&(t=e.slice(0,r))!=="xmlns"&&(e=e.slice(r+1)),Th.hasOwnProperty(t)?{space:Th[t],local:e}:e}function nB(e){return function(){var t=this.ownerDocument,r=this.namespaceURI;return r===gb&&t.documentElement.namespaceURI===gb?t.createElement(e):t.createElementNS(r,e)}}function iB(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function G_(e){var t=V_(e);return(t.local?iB:nB)(t)}function rB(){}function P1(e){return e==null?rB:function(){return this.querySelector(e)}}function aB(e){typeof e!="function"&&(e=P1(e));for(var t=this._groups,r=t.length,o=new Array(r),u=0;u<r;++u)for(var d=t[u],p=d.length,a=o[u]=new Array(p),w,T,S=0;S<p;++S)(w=d[S])&&(T=e.call(w,w.__data__,S,d))&&("__data__"in w&&(T.__data__=w.__data__),a[S]=T);return new Ra(o,this._parents)}function oB(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function sB(){return[]}function _C(e){return e==null?sB:function(){return this.querySelectorAll(e)}}function lB(e){return function(){return oB(e.apply(this,arguments))}}function cB(e){typeof e=="function"?e=lB(e):e=_C(e);for(var t=this._groups,r=t.length,o=[],u=[],d=0;d<r;++d)for(var p=t[d],a=p.length,w,T=0;T<a;++T)(w=p[T])&&(o.push(e.call(w,w.__data__,T,p)),u.push(w));return new Ra(o,u)}function yC(e){return function(){return this.matches(e)}}function vC(e){return function(t){return t.matches(e)}}var uB=Array.prototype.find;function hB(e){return function(){return uB.call(this.children,e)}}function fB(){return this.firstElementChild}function dB(e){return this.select(e==null?fB:hB(typeof e=="function"?e:vC(e)))}var pB=Array.prototype.filter;function mB(){return Array.from(this.children)}function gB(e){return function(){return pB.call(this.children,e)}}function _B(e){return this.selectAll(e==null?mB:gB(typeof e=="function"?e:vC(e)))}function yB(e){typeof e!="function"&&(e=yC(e));for(var t=this._groups,r=t.length,o=new Array(r),u=0;u<r;++u)for(var d=t[u],p=d.length,a=o[u]=[],w,T=0;T<p;++T)(w=d[T])&&e.call(w,w.__data__,T,d)&&a.push(w);return new Ra(o,this._parents)}function bC(e){return new Array(e.length)}function vB(){return new Ra(this._enter||this._groups.map(bC),this._parents)}function Xg(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}Xg.prototype={constructor:Xg,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function bB(e){return function(){return e}}function xB(e,t,r,o,u,d){for(var p=0,a,w=t.length,T=d.length;p<T;++p)(a=t[p])?(a.__data__=d[p],o[p]=a):r[p]=new Xg(e,d[p]);for(;p<w;++p)(a=t[p])&&(u[p]=a)}function wB(e,t,r,o,u,d,p){var a,w,T=new Map,S=t.length,k=d.length,I=new Array(S),P;for(a=0;a<S;++a)(w=t[a])&&(I[a]=P=p.call(w,w.__data__,a,t)+"",T.has(P)?u[a]=w:T.set(P,w));for(a=0;a<k;++a)P=p.call(e,d[a],a,d)+"",(w=T.get(P))?(o[a]=w,w.__data__=d[a],T.delete(P)):r[a]=new Xg(e,d[a]);for(a=0;a<S;++a)(w=t[a])&&T.get(I[a])===w&&(u[a]=w)}function AB(e){return e.__data__}function TB(e,t){if(!arguments.length)return Array.from(this,AB);var r=t?wB:xB,o=this._parents,u=this._groups;typeof e!="function"&&(e=bB(e));for(var d=u.length,p=new Array(d),a=new Array(d),w=new Array(d),T=0;T<d;++T){var S=o[T],k=u[T],I=k.length,P=SB(e.call(S,S&&S.__data__,T,o)),F=P.length,G=a[T]=new Array(F),H=p[T]=new Array(F),Y=w[T]=new Array(I);r(S,k,G,H,Y,P,t);for(var $=0,ae=0,ee,ce;$<F;++$)if(ee=G[$]){for($>=ae&&(ae=$+1);!(ce=H[ae])&&++ae<F;);ee._next=ce||null}}return p=new Ra(p,o),p._enter=a,p._exit=w,p}function SB(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function MB(){return new Ra(this._exit||this._groups.map(bC),this._parents)}function CB(e,t,r){var o=this.enter(),u=this,d=this.exit();return typeof e=="function"?(o=e(o),o&&(o=o.selection())):o=o.append(e+""),t!=null&&(u=t(u),u&&(u=u.selection())),r==null?d.remove():r(d),o&&u?o.merge(u).order():u}function IB(e){for(var t=e.selection?e.selection():e,r=this._groups,o=t._groups,u=r.length,d=o.length,p=Math.min(u,d),a=new Array(u),w=0;w<p;++w)for(var T=r[w],S=o[w],k=T.length,I=a[w]=new Array(k),P,F=0;F<k;++F)(P=T[F]||S[F])&&(I[F]=P);for(;w<u;++w)a[w]=r[w];return new Ra(a,this._parents)}function EB(){for(var e=this._groups,t=-1,r=e.length;++t<r;)for(var o=e[t],u=o.length-1,d=o[u],p;--u>=0;)(p=o[u])&&(d&&p.compareDocumentPosition(d)^4&&d.parentNode.insertBefore(p,d),d=p);return this}function PB(e){e||(e=kB);function t(k,I){return k&&I?e(k.__data__,I.__data__):!k-!I}for(var r=this._groups,o=r.length,u=new Array(o),d=0;d<o;++d){for(var p=r[d],a=p.length,w=u[d]=new Array(a),T,S=0;S<a;++S)(T=p[S])&&(w[S]=T);w.sort(t)}return new Ra(u,this._parents).order()}function kB(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function DB(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function zB(){return Array.from(this)}function RB(){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var o=e[t],u=0,d=o.length;u<d;++u){var p=o[u];if(p)return p}return null}function LB(){let e=0;for(const t of this)++e;return e}function BB(){return!this.node()}function FB(e){for(var t=this._groups,r=0,o=t.length;r<o;++r)for(var u=t[r],d=0,p=u.length,a;d<p;++d)(a=u[d])&&e.call(a,a.__data__,d,u);return this}function OB(e){return function(){this.removeAttribute(e)}}function NB(e){return function(){this.removeAttributeNS(e.space,e.local)}}function jB(e,t){return function(){this.setAttribute(e,t)}}function UB(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function VB(e,t){return function(){var r=t.apply(this,arguments);r==null?this.removeAttribute(e):this.setAttribute(e,r)}}function GB(e,t){return function(){var r=t.apply(this,arguments);r==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,r)}}function qB(e,t){var r=V_(e);if(arguments.length<2){var o=this.node();return r.local?o.getAttributeNS(r.space,r.local):o.getAttribute(r)}return this.each((t==null?r.local?NB:OB:typeof t=="function"?r.local?GB:VB:r.local?UB:jB)(r,t))}function xC(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function ZB(e){return function(){this.style.removeProperty(e)}}function HB(e,t,r){return function(){this.style.setProperty(e,t,r)}}function $B(e,t,r){return function(){var o=t.apply(this,arguments);o==null?this.style.removeProperty(e):this.style.setProperty(e,o,r)}}function WB(e,t,r){return arguments.length>1?this.each((t==null?ZB:typeof t=="function"?$B:HB)(e,t,r??"")):Sh(this.node(),e)}function Sh(e,t){return e.style.getPropertyValue(t)||xC(e).getComputedStyle(e,null).getPropertyValue(t)}function YB(e){return function(){delete this[e]}}function XB(e,t){return function(){this[e]=t}}function QB(e,t){return function(){var r=t.apply(this,arguments);r==null?delete this[e]:this[e]=r}}function KB(e,t){return arguments.length>1?this.each((t==null?YB:typeof t=="function"?QB:XB)(e,t)):this.node()[e]}function wC(e){return e.trim().split(/^|\s+/)}function k1(e){return e.classList||new AC(e)}function AC(e){this._node=e,this._names=wC(e.getAttribute("class")||"")}AC.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function TC(e,t){for(var r=k1(e),o=-1,u=t.length;++o<u;)r.add(t[o])}function SC(e,t){for(var r=k1(e),o=-1,u=t.length;++o<u;)r.remove(t[o])}function JB(e){return function(){TC(this,e)}}function eF(e){return function(){SC(this,e)}}function tF(e,t){return function(){(t.apply(this,arguments)?TC:SC)(this,e)}}function nF(e,t){var r=wC(e+"");if(arguments.length<2){for(var o=k1(this.node()),u=-1,d=r.length;++u<d;)if(!o.contains(r[u]))return!1;return!0}return this.each((typeof t=="function"?tF:t?JB:eF)(r,t))}function iF(){this.textContent=""}function rF(e){return function(){this.textContent=e}}function aF(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function oF(e){return arguments.length?this.each(e==null?iF:(typeof e=="function"?aF:rF)(e)):this.node().textContent}function sF(){this.innerHTML=""}function lF(e){return function(){this.innerHTML=e}}function cF(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function uF(e){return arguments.length?this.each(e==null?sF:(typeof e=="function"?cF:lF)(e)):this.node().innerHTML}function hF(){this.nextSibling&&this.parentNode.appendChild(this)}function fF(){return this.each(hF)}function dF(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function pF(){return this.each(dF)}function mF(e){var t=typeof e=="function"?e:G_(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function gF(){return null}function _F(e,t){var r=typeof e=="function"?e:G_(e),o=t==null?gF:typeof t=="function"?t:P1(t);return this.select(function(){return this.insertBefore(r.apply(this,arguments),o.apply(this,arguments)||null)})}function yF(){var e=this.parentNode;e&&e.removeChild(this)}function vF(){return this.each(yF)}function bF(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function xF(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function wF(e){return this.select(e?xF:bF)}function AF(e){return arguments.length?this.property("__data__",e):this.node().__data__}function TF(e){return function(t){e.call(this,t,this.__data__)}}function SF(e){return e.trim().split(/^|\s+/).map(function(t){var r="",o=t.indexOf(".");return o>=0&&(r=t.slice(o+1),t=t.slice(0,o)),{type:t,name:r}})}function MF(e){return function(){var t=this.__on;if(t){for(var r=0,o=-1,u=t.length,d;r<u;++r)d=t[r],(!e.type||d.type===e.type)&&d.name===e.name?this.removeEventListener(d.type,d.listener,d.options):t[++o]=d;++o?t.length=o:delete this.__on}}}function CF(e,t,r){return function(){var o=this.__on,u,d=TF(t);if(o){for(var p=0,a=o.length;p<a;++p)if((u=o[p]).type===e.type&&u.name===e.name){this.removeEventListener(u.type,u.listener,u.options),this.addEventListener(u.type,u.listener=d,u.options=r),u.value=t;return}}this.addEventListener(e.type,d,r),u={type:e.type,name:e.name,value:t,listener:d,options:r},o?o.push(u):this.__on=[u]}}function IF(e,t,r){var o=SF(e+""),u,d=o.length,p;if(arguments.length<2){var a=this.node().__on;if(a){for(var w=0,T=a.length,S;w<T;++w)for(u=0,S=a[w];u<d;++u)if((p=o[u]).type===S.type&&p.name===S.name)return S.value}return}for(a=t?CF:MF,u=0;u<d;++u)this.each(a(o[u],t,r));return this}function MC(e,t,r){var o=xC(e),u=o.CustomEvent;typeof u=="function"?u=new u(t,r):(u=o.document.createEvent("Event"),r?(u.initEvent(t,r.bubbles,r.cancelable),u.detail=r.detail):u.initEvent(t,!1,!1)),e.dispatchEvent(u)}function EF(e,t){return function(){return MC(this,e,t)}}function PF(e,t){return function(){return MC(this,e,t.apply(this,arguments))}}function kF(e,t){return this.each((typeof t=="function"?PF:EF)(e,t))}function*DF(){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var o=e[t],u=0,d=o.length,p;u<d;++u)(p=o[u])&&(yield p)}var CC=[null];function Ra(e,t){this._groups=e,this._parents=t}function dp(){return new Ra([[document.documentElement]],CC)}function zF(){return this}Ra.prototype=dp.prototype={constructor:Ra,select:aB,selectAll:cB,selectChild:dB,selectChildren:_B,filter:yB,data:TB,enter:vB,exit:MB,join:CB,merge:IB,selection:zF,order:EB,sort:PB,call:DB,nodes:zB,node:RB,size:LB,empty:BB,each:FB,attr:qB,style:WB,property:KB,classed:nF,text:oF,html:uF,raise:fF,lower:pF,append:mF,insert:_F,remove:vF,clone:wF,datum:AF,on:IF,dispatch:kF,[Symbol.iterator]:DF};function Dc(e){return typeof e=="string"?new Ra([[document.querySelector(e)]],[document.documentElement]):new Ra([[e]],CC)}function RF(e){let t;for(;t=e.sourceEvent;)e=t;return e}function LF(e,t){if(e=RF(e),t===void 0&&(t=e.currentTarget),t){var r=t.ownerSVGElement||t;if(r.createSVGPoint){var o=r.createSVGPoint();return o.x=e.clientX,o.y=e.clientY,o=o.matrixTransform(t.getScreenCTM().inverse()),[o.x,o.y]}if(t.getBoundingClientRect){var u=t.getBoundingClientRect();return[e.clientX-u.left-t.clientLeft,e.clientY-u.top-t.clientTop]}}return[e.pageX,e.pageY]}function Uh(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function pp(e,t){var r=Object.create(e.prototype);for(var o in t)r[o]=t[o];return r}function Pl(){}var Uc=.7,Mh=1/Uc,lh="\\s*([+-]?\\d+)\\s*",Vd="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Ho="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",BF=/^#([0-9a-f]{3,8})$/,FF=new RegExp(`^rgb\\(${lh},${lh},${lh}\\)$`),OF=new RegExp(`^rgb\\(${Ho},${Ho},${Ho}\\)$`),NF=new RegExp(`^rgba\\(${lh},${lh},${lh},${Vd}\\)$`),jF=new RegExp(`^rgba\\(${Ho},${Ho},${Ho},${Vd}\\)$`),UF=new RegExp(`^hsl\\(${Vd},${Ho},${Ho}\\)$`),VF=new RegExp(`^hsla\\(${Vd},${Ho},${Ho},${Vd}\\)$`),EA={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Uh(Pl,Vc,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:PA,formatHex:PA,formatHex8:GF,formatHsl:qF,formatRgb:kA,toString:kA});function PA(){return this.rgb().formatHex()}function GF(){return this.rgb().formatHex8()}function qF(){return IC(this).formatHsl()}function kA(){return this.rgb().formatRgb()}function Vc(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=BF.exec(e))?(r=t[1].length,t=parseInt(t[1],16),r===6?DA(t):r===3?new kr(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):r===8?qm(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):r===4?qm(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=FF.exec(e))?new kr(t[1],t[2],t[3],1):(t=OF.exec(e))?new kr(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=NF.exec(e))?qm(t[1],t[2],t[3],t[4]):(t=jF.exec(e))?qm(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=UF.exec(e))?LA(t[1],t[2]/100,t[3]/100,1):(t=VF.exec(e))?LA(t[1],t[2]/100,t[3]/100,t[4]):EA.hasOwnProperty(e)?DA(EA[e]):e==="transparent"?new kr(NaN,NaN,NaN,0):null}function DA(e){return new kr(e>>16&255,e>>8&255,e&255,1)}function qm(e,t,r,o){return o<=0&&(e=t=r=NaN),new kr(e,t,r,o)}function D1(e){return e instanceof Pl||(e=Vc(e)),e?(e=e.rgb(),new kr(e.r,e.g,e.b,e.opacity)):new kr}function Sl(e,t,r,o){return arguments.length===1?D1(e):new kr(e,t,r,o??1)}function kr(e,t,r,o){this.r=+e,this.g=+t,this.b=+r,this.opacity=+o}Uh(kr,Sl,pp(Pl,{brighter(e){return e=e==null?Mh:Math.pow(Mh,e),new kr(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?Uc:Math.pow(Uc,e),new kr(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new kr(zc(this.r),zc(this.g),zc(this.b),Qg(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:zA,formatHex:zA,formatHex8:ZF,formatRgb:RA,toString:RA}));function zA(){return`#${Sc(this.r)}${Sc(this.g)}${Sc(this.b)}`}function ZF(){return`#${Sc(this.r)}${Sc(this.g)}${Sc(this.b)}${Sc((isNaN(this.opacity)?1:this.opacity)*255)}`}function RA(){const e=Qg(this.opacity);return`${e===1?"rgb(":"rgba("}${zc(this.r)}, ${zc(this.g)}, ${zc(this.b)}${e===1?")":`, ${e})`}`}function Qg(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function zc(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function Sc(e){return e=zc(e),(e<16?"0":"")+e.toString(16)}function LA(e,t,r,o){return o<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new mo(e,t,r,o)}function IC(e){if(e instanceof mo)return new mo(e.h,e.s,e.l,e.opacity);if(e instanceof Pl||(e=Vc(e)),!e)return new mo;if(e instanceof mo)return e;e=e.rgb();var t=e.r/255,r=e.g/255,o=e.b/255,u=Math.min(t,r,o),d=Math.max(t,r,o),p=NaN,a=d-u,w=(d+u)/2;return a?(t===d?p=(r-o)/a+(r<o)*6:r===d?p=(o-t)/a+2:p=(t-r)/a+4,a/=w<.5?d+u:2-d-u,p*=60):a=w>0&&w<1?0:p,new mo(p,a,w,e.opacity)}function _b(e,t,r,o){return arguments.length===1?IC(e):new mo(e,t,r,o??1)}function mo(e,t,r,o){this.h=+e,this.s=+t,this.l=+r,this.opacity=+o}Uh(mo,_b,pp(Pl,{brighter(e){return e=e==null?Mh:Math.pow(Mh,e),new mo(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?Uc:Math.pow(Uc,e),new mo(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,o=r+(r<.5?r:1-r)*t,u=2*r-o;return new kr(ev(e>=240?e-240:e+120,u,o),ev(e,u,o),ev(e<120?e+240:e-120,u,o),this.opacity)},clamp(){return new mo(BA(this.h),Zm(this.s),Zm(this.l),Qg(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=Qg(this.opacity);return`${e===1?"hsl(":"hsla("}${BA(this.h)}, ${Zm(this.s)*100}%, ${Zm(this.l)*100}%${e===1?")":`, ${e})`}`}}));function BA(e){return e=(e||0)%360,e<0?e+360:e}function Zm(e){return Math.max(0,Math.min(1,e||0))}function ev(e,t,r){return(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)*255}const EC=Math.PI/180,PC=180/Math.PI,Kg=18,kC=.96422,DC=1,zC=.82521,RC=4/29,ch=6/29,LC=3*ch*ch,HF=ch*ch*ch;function BC(e){if(e instanceof $o)return new $o(e.l,e.a,e.b,e.opacity);if(e instanceof Ts)return FC(e);e instanceof kr||(e=D1(e));var t=rv(e.r),r=rv(e.g),o=rv(e.b),u=tv((.2225045*t+.7168786*r+.0606169*o)/DC),d,p;return t===r&&r===o?d=p=u:(d=tv((.4360747*t+.3850649*r+.1430804*o)/kC),p=tv((.0139322*t+.0971045*r+.7141733*o)/zC)),new $o(116*u-16,500*(d-u),200*(u-p),e.opacity)}function yb(e,t,r,o){return arguments.length===1?BC(e):new $o(e,t,r,o??1)}function $o(e,t,r,o){this.l=+e,this.a=+t,this.b=+r,this.opacity=+o}Uh($o,yb,pp(Pl,{brighter(e){return new $o(this.l+Kg*(e??1),this.a,this.b,this.opacity)},darker(e){return new $o(this.l-Kg*(e??1),this.a,this.b,this.opacity)},rgb(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,r=isNaN(this.b)?e:e-this.b/200;return t=kC*nv(t),e=DC*nv(e),r=zC*nv(r),new kr(iv(3.1338561*t-1.6168667*e-.4906146*r),iv(-.9787684*t+1.9161415*e+.033454*r),iv(.0719453*t-.2289914*e+1.4052427*r),this.opacity)}}));function tv(e){return e>HF?Math.pow(e,1/3):e/LC+RC}function nv(e){return e>ch?e*e*e:LC*(e-RC)}function iv(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function rv(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function $F(e){if(e instanceof Ts)return new Ts(e.h,e.c,e.l,e.opacity);if(e instanceof $o||(e=BC(e)),e.a===0&&e.b===0)return new Ts(NaN,0<e.l&&e.l<100?0:NaN,e.l,e.opacity);var t=Math.atan2(e.b,e.a)*PC;return new Ts(t<0?t+360:t,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}function vb(e,t,r,o){return arguments.length===1?$F(e):new Ts(e,t,r,o??1)}function Ts(e,t,r,o){this.h=+e,this.c=+t,this.l=+r,this.opacity=+o}function FC(e){if(isNaN(e.h))return new $o(e.l,0,0,e.opacity);var t=e.h*EC;return new $o(e.l,Math.cos(t)*e.c,Math.sin(t)*e.c,e.opacity)}Uh(Ts,vb,pp(Pl,{brighter(e){return new Ts(this.h,this.c,this.l+Kg*(e??1),this.opacity)},darker(e){return new Ts(this.h,this.c,this.l-Kg*(e??1),this.opacity)},rgb(){return FC(this).rgb()}}));var OC=-.14861,z1=1.78277,R1=-.29227,q_=-.90649,Gd=1.97294,FA=Gd*q_,OA=Gd*z1,NA=z1*R1-q_*OC;function WF(e){if(e instanceof Rc)return new Rc(e.h,e.s,e.l,e.opacity);e instanceof kr||(e=D1(e));var t=e.r/255,r=e.g/255,o=e.b/255,u=(NA*o+FA*t-OA*r)/(NA+FA-OA),d=o-u,p=(Gd*(r-u)-R1*d)/q_,a=Math.sqrt(p*p+d*d)/(Gd*u*(1-u)),w=a?Math.atan2(p,d)*PC-120:NaN;return new Rc(w<0?w+360:w,a,u,e.opacity)}function Yo(e,t,r,o){return arguments.length===1?WF(e):new Rc(e,t,r,o??1)}function Rc(e,t,r,o){this.h=+e,this.s=+t,this.l=+r,this.opacity=+o}Uh(Rc,Yo,pp(Pl,{brighter(e){return e=e==null?Mh:Math.pow(Mh,e),new Rc(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?Uc:Math.pow(Uc,e),new Rc(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=isNaN(this.h)?0:(this.h+120)*EC,t=+this.l,r=isNaN(this.s)?0:this.s*t*(1-t),o=Math.cos(e),u=Math.sin(e);return new kr(255*(t+r*(OC*o+z1*u)),255*(t+r*(R1*o+q_*u)),255*(t+r*(Gd*o)),this.opacity)}}));function YF(e,t,r,o,u){var d=e*e,p=d*e;return((1-3*e+3*d-p)*t+(4-6*d+3*p)*r+(1+3*e+3*d-3*p)*o+p*u)/6}function XF(e){var t=e.length-1;return function(r){var o=r<=0?r=0:r>=1?(r=1,t-1):Math.floor(r*t),u=e[o],d=e[o+1],p=o>0?e[o-1]:2*u-d,a=o<t-1?e[o+2]:2*d-u;return YF((r-o/t)*t,p,u,d,a)}}const Z_=e=>()=>e;function NC(e,t){return function(r){return e+r*t}}function QF(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(o){return Math.pow(e+o*t,r)}}function L1(e,t){var r=t-e;return r?NC(e,r>180||r<-180?r-360*Math.round(r/360):r):Z_(isNaN(e)?t:e)}function KF(e){return(e=+e)==1?ea:function(t,r){return r-t?QF(t,r,e):Z_(isNaN(t)?r:t)}}function ea(e,t){var r=t-e;return r?NC(e,r):Z_(isNaN(e)?t:e)}const Gc=function e(t){var r=KF(t);function o(u,d){var p=r((u=Sl(u)).r,(d=Sl(d)).r),a=r(u.g,d.g),w=r(u.b,d.b),T=ea(u.opacity,d.opacity);return function(S){return u.r=p(S),u.g=a(S),u.b=w(S),u.opacity=T(S),u+""}}return o.gamma=e,o}(1);function JF(e){return function(t){var r=t.length,o=new Array(r),u=new Array(r),d=new Array(r),p,a;for(p=0;p<r;++p)a=Sl(t[p]),o[p]=a.r||0,u[p]=a.g||0,d[p]=a.b||0;return o=e(o),u=e(u),d=e(d),a.opacity=1,function(w){return a.r=o(w),a.g=u(w),a.b=d(w),a+""}}}var eO=JF(XF);function tO(e,t){t||(t=[]);var r=e?Math.min(t.length,e.length):0,o=t.slice(),u;return function(d){for(u=0;u<r;++u)o[u]=e[u]*(1-d)+t[u]*d;return o}}function nO(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function iO(e,t){var r=t?t.length:0,o=e?Math.min(r,e.length):0,u=new Array(o),d=new Array(r),p;for(p=0;p<o;++p)u[p]=mp(e[p],t[p]);for(;p<r;++p)d[p]=t[p];return function(a){for(p=0;p<o;++p)d[p]=u[p](a);return d}}function rO(e,t){var r=new Date;return e=+e,t=+t,function(o){return r.setTime(e*(1-o)+t*o),r}}function Kr(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}function aO(e,t){var r={},o={},u;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(u in t)u in e?r[u]=mp(e[u],t[u]):o[u]=t[u];return function(d){for(u in r)o[u]=r[u](d);return o}}var bb=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,av=new RegExp(bb.source,"g");function oO(e){return function(){return e}}function sO(e){return function(t){return e(t)+""}}function jC(e,t){var r=bb.lastIndex=av.lastIndex=0,o,u,d,p=-1,a=[],w=[];for(e=e+"",t=t+"";(o=bb.exec(e))&&(u=av.exec(t));)(d=u.index)>r&&(d=t.slice(r,d),a[p]?a[p]+=d:a[++p]=d),(o=o[0])===(u=u[0])?a[p]?a[p]+=u:a[++p]=u:(a[++p]=null,w.push({i:p,x:Kr(o,u)})),r=av.lastIndex;return r<t.length&&(d=t.slice(r),a[p]?a[p]+=d:a[++p]=d),a.length<2?w[0]?sO(w[0].x):oO(t):(t=w.length,function(T){for(var S=0,k;S<t;++S)a[(k=w[S]).i]=k.x(T);return a.join("")})}function mp(e,t){var r=typeof t,o;return t==null||r==="boolean"?Z_(t):(r==="number"?Kr:r==="string"?(o=Vc(t))?(t=o,Gc):jC:t instanceof Vc?Gc:t instanceof Date?rO:nO(t)?tO:Array.isArray(t)?iO:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?aO:Kr)(e,t)}function B1(e,t){return e=+e,t=+t,function(r){return Math.round(e*(1-r)+t*r)}}var jA=180/Math.PI,xb={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function UC(e,t,r,o,u,d){var p,a,w;return(p=Math.sqrt(e*e+t*t))&&(e/=p,t/=p),(w=e*r+t*o)&&(r-=e*w,o-=t*w),(a=Math.sqrt(r*r+o*o))&&(r/=a,o/=a,w/=a),e*o<t*r&&(e=-e,t=-t,w=-w,p=-p),{translateX:u,translateY:d,rotate:Math.atan2(t,e)*jA,skewX:Math.atan(w)*jA,scaleX:p,scaleY:a}}var Hm;function lO(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?xb:UC(t.a,t.b,t.c,t.d,t.e,t.f)}function cO(e){return e==null||(Hm||(Hm=document.createElementNS("http://www.w3.org/2000/svg","g")),Hm.setAttribute("transform",e),!(e=Hm.transform.baseVal.consolidate()))?xb:(e=e.matrix,UC(e.a,e.b,e.c,e.d,e.e,e.f))}function VC(e,t,r,o){function u(T){return T.length?T.pop()+" ":""}function d(T,S,k,I,P,F){if(T!==k||S!==I){var G=P.push("translate(",null,t,null,r);F.push({i:G-4,x:Kr(T,k)},{i:G-2,x:Kr(S,I)})}else(k||I)&&P.push("translate("+k+t+I+r)}function p(T,S,k,I){T!==S?(T-S>180?S+=360:S-T>180&&(T+=360),I.push({i:k.push(u(k)+"rotate(",null,o)-2,x:Kr(T,S)})):S&&k.push(u(k)+"rotate("+S+o)}function a(T,S,k,I){T!==S?I.push({i:k.push(u(k)+"skewX(",null,o)-2,x:Kr(T,S)}):S&&k.push(u(k)+"skewX("+S+o)}function w(T,S,k,I,P,F){if(T!==k||S!==I){var G=P.push(u(P)+"scale(",null,",",null,")");F.push({i:G-4,x:Kr(T,k)},{i:G-2,x:Kr(S,I)})}else(k!==1||I!==1)&&P.push(u(P)+"scale("+k+","+I+")")}return function(T,S){var k=[],I=[];return T=e(T),S=e(S),d(T.translateX,T.translateY,S.translateX,S.translateY,k,I),p(T.rotate,S.rotate,k,I),a(T.skewX,S.skewX,k,I),w(T.scaleX,T.scaleY,S.scaleX,S.scaleY,k,I),T=S=null,function(P){for(var F=-1,G=I.length,H;++F<G;)k[(H=I[F]).i]=H.x(P);return k.join("")}}}var uO=VC(lO,"px, ","px)","deg)"),hO=VC(cO,", ",")",")");function fO(e){return function(t,r){var o=e((t=_b(t)).h,(r=_b(r)).h),u=ea(t.s,r.s),d=ea(t.l,r.l),p=ea(t.opacity,r.opacity);return function(a){return t.h=o(a),t.s=u(a),t.l=d(a),t.opacity=p(a),t+""}}}const dO=fO(L1);function pO(e,t){var r=ea((e=yb(e)).l,(t=yb(t)).l),o=ea(e.a,t.a),u=ea(e.b,t.b),d=ea(e.opacity,t.opacity);return function(p){return e.l=r(p),e.a=o(p),e.b=u(p),e.opacity=d(p),e+""}}function mO(e){return function(t,r){var o=e((t=vb(t)).h,(r=vb(r)).h),u=ea(t.c,r.c),d=ea(t.l,r.l),p=ea(t.opacity,r.opacity);return function(a){return t.h=o(a),t.c=u(a),t.l=d(a),t.opacity=p(a),t+""}}}const gO=mO(L1);function GC(e){return function t(r){r=+r;function o(u,d){var p=e((u=Yo(u)).h,(d=Yo(d)).h),a=ea(u.s,d.s),w=ea(u.l,d.l),T=ea(u.opacity,d.opacity);return function(S){return u.h=p(S),u.s=a(S),u.l=w(Math.pow(S,r)),u.opacity=T(S),u+""}}return o.gamma=t,o}(1)}GC(L1);var F1=GC(ea);function H_(e,t){t===void 0&&(t=e,e=mp);for(var r=0,o=t.length-1,u=t[0],d=new Array(o<0?0:o);r<o;)d[r]=e(u,u=t[++r]);return function(p){var a=Math.max(0,Math.min(o-1,Math.floor(p*=o)));return d[a](p-a)}}function bo(e,t){for(var r=new Array(t),o=0;o<t;++o)r[o]=e(o/(t-1));return r}var Ch=0,wd=0,ud=0,qC=1e3,Jg,Ad,e_=0,qc=0,$_=0,qd=typeof performance=="object"&&performance.now?performance:Date,ZC=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function O1(){return qc||(ZC(_O),qc=qd.now()+$_)}function _O(){qc=0}function t_(){this._call=this._time=this._next=null}t_.prototype=HC.prototype={constructor:t_,restart:function(e,t,r){if(typeof e!="function")throw new TypeError("callback is not a function");r=(r==null?O1():+r)+(t==null?0:+t),!this._next&&Ad!==this&&(Ad?Ad._next=this:Jg=this,Ad=this),this._call=e,this._time=r,wb()},stop:function(){this._call&&(this._call=null,this._time=1/0,wb())}};function HC(e,t,r){var o=new t_;return o.restart(e,t,r),o}function yO(){O1(),++Ch;for(var e=Jg,t;e;)(t=qc-e._time)>=0&&e._call.call(void 0,t),e=e._next;--Ch}function UA(){qc=(e_=qd.now())+$_,Ch=wd=0;try{yO()}finally{Ch=0,bO(),qc=0}}function vO(){var e=qd.now(),t=e-e_;t>qC&&($_-=t,e_=e)}function bO(){for(var e,t=Jg,r,o=1/0;t;)t._call?(o>t._time&&(o=t._time),e=t,t=t._next):(r=t._next,t._next=null,t=e?e._next=r:Jg=r);Ad=e,wb(o)}function wb(e){if(!Ch){wd&&(wd=clearTimeout(wd));var t=e-qc;t>24?(e<1/0&&(wd=setTimeout(UA,e-qd.now()-$_)),ud&&(ud=clearInterval(ud))):(ud||(e_=qd.now(),ud=setInterval(vO,qC)),Ch=1,ZC(UA))}}function VA(e,t,r){var o=new t_;return t=t==null?0:+t,o.restart(u=>{o.stop(),e(u+t)},t,r),o}var xO=gC("start","end","cancel","interrupt"),wO=[],$C=0,GA=1,Ab=2,gg=3,qA=4,Tb=5,_g=6;function W_(e,t,r,o,u,d){var p=e.__transition;if(!p)e.__transition={};else if(r in p)return;AO(e,r,{name:t,index:o,group:u,on:xO,tween:wO,time:d.time,delay:d.delay,duration:d.duration,ease:d.ease,timer:null,state:$C})}function N1(e,t){var r=Ao(e,t);if(r.state>$C)throw new Error("too late; already scheduled");return r}function Ko(e,t){var r=Ao(e,t);if(r.state>gg)throw new Error("too late; already running");return r}function Ao(e,t){var r=e.__transition;if(!r||!(r=r[t]))throw new Error("transition not found");return r}function AO(e,t,r){var o=e.__transition,u;o[t]=r,r.timer=HC(d,0,r.time);function d(T){r.state=GA,r.timer.restart(p,r.delay,r.time),r.delay<=T&&p(T-r.delay)}function p(T){var S,k,I,P;if(r.state!==GA)return w();for(S in o)if(P=o[S],P.name===r.name){if(P.state===gg)return VA(p);P.state===qA?(P.state=_g,P.timer.stop(),P.on.call("interrupt",e,e.__data__,P.index,P.group),delete o[S]):+S<t&&(P.state=_g,P.timer.stop(),P.on.call("cancel",e,e.__data__,P.index,P.group),delete o[S])}if(VA(function(){r.state===gg&&(r.state=qA,r.timer.restart(a,r.delay,r.time),a(T))}),r.state=Ab,r.on.call("start",e,e.__data__,r.index,r.group),r.state===Ab){for(r.state=gg,u=new Array(I=r.tween.length),S=0,k=-1;S<I;++S)(P=r.tween[S].value.call(e,e.__data__,r.index,r.group))&&(u[++k]=P);u.length=k+1}}function a(T){for(var S=T<r.duration?r.ease.call(null,T/r.duration):(r.timer.restart(w),r.state=Tb,1),k=-1,I=u.length;++k<I;)u[k].call(e,S);r.state===Tb&&(r.on.call("end",e,e.__data__,r.index,r.group),w())}function w(){r.state=_g,r.timer.stop(),delete o[t];for(var T in o)return;delete e.__transition}}function TO(e,t){var r=e.__transition,o,u,d=!0,p;if(r){t=t==null?null:t+"";for(p in r){if((o=r[p]).name!==t){d=!1;continue}u=o.state>Ab&&o.state<Tb,o.state=_g,o.timer.stop(),o.on.call(u?"interrupt":"cancel",e,e.__data__,o.index,o.group),delete r[p]}d&&delete e.__transition}}function SO(e){return this.each(function(){TO(this,e)})}function MO(e,t){var r,o;return function(){var u=Ko(this,e),d=u.tween;if(d!==r){o=r=d;for(var p=0,a=o.length;p<a;++p)if(o[p].name===t){o=o.slice(),o.splice(p,1);break}}u.tween=o}}function CO(e,t,r){var o,u;if(typeof r!="function")throw new Error;return function(){var d=Ko(this,e),p=d.tween;if(p!==o){u=(o=p).slice();for(var a={name:t,value:r},w=0,T=u.length;w<T;++w)if(u[w].name===t){u[w]=a;break}w===T&&u.push(a)}d.tween=u}}function IO(e,t){var r=this._id;if(e+="",arguments.length<2){for(var o=Ao(this.node(),r).tween,u=0,d=o.length,p;u<d;++u)if((p=o[u]).name===e)return p.value;return null}return this.each((t==null?MO:CO)(r,e,t))}function j1(e,t,r){var o=e._id;return e.each(function(){var u=Ko(this,o);(u.value||(u.value={}))[t]=r.apply(this,arguments)}),function(u){return Ao(u,o).value[t]}}function WC(e,t){var r;return(typeof t=="number"?Kr:t instanceof Vc?Gc:(r=Vc(t))?(t=r,Gc):jC)(e,t)}function EO(e){return function(){this.removeAttribute(e)}}function PO(e){return function(){this.removeAttributeNS(e.space,e.local)}}function kO(e,t,r){var o,u=r+"",d;return function(){var p=this.getAttribute(e);return p===u?null:p===o?d:d=t(o=p,r)}}function DO(e,t,r){var o,u=r+"",d;return function(){var p=this.getAttributeNS(e.space,e.local);return p===u?null:p===o?d:d=t(o=p,r)}}function zO(e,t,r){var o,u,d;return function(){var p,a=r(this),w;return a==null?void this.removeAttribute(e):(p=this.getAttribute(e),w=a+"",p===w?null:p===o&&w===u?d:(u=w,d=t(o=p,a)))}}function RO(e,t,r){var o,u,d;return function(){var p,a=r(this),w;return a==null?void this.removeAttributeNS(e.space,e.local):(p=this.getAttributeNS(e.space,e.local),w=a+"",p===w?null:p===o&&w===u?d:(u=w,d=t(o=p,a)))}}function LO(e,t){var r=V_(e),o=r==="transform"?hO:WC;return this.attrTween(e,typeof t=="function"?(r.local?RO:zO)(r,o,j1(this,"attr."+e,t)):t==null?(r.local?PO:EO)(r):(r.local?DO:kO)(r,o,t))}function BO(e,t){return function(r){this.setAttribute(e,t.call(this,r))}}function FO(e,t){return function(r){this.setAttributeNS(e.space,e.local,t.call(this,r))}}function OO(e,t){var r,o;function u(){var d=t.apply(this,arguments);return d!==o&&(r=(o=d)&&FO(e,d)),r}return u._value=t,u}function NO(e,t){var r,o;function u(){var d=t.apply(this,arguments);return d!==o&&(r=(o=d)&&BO(e,d)),r}return u._value=t,u}function jO(e,t){var r="attr."+e;if(arguments.length<2)return(r=this.tween(r))&&r._value;if(t==null)return this.tween(r,null);if(typeof t!="function")throw new Error;var o=V_(e);return this.tween(r,(o.local?OO:NO)(o,t))}function UO(e,t){return function(){N1(this,e).delay=+t.apply(this,arguments)}}function VO(e,t){return t=+t,function(){N1(this,e).delay=t}}function GO(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?UO:VO)(t,e)):Ao(this.node(),t).delay}function qO(e,t){return function(){Ko(this,e).duration=+t.apply(this,arguments)}}function ZO(e,t){return t=+t,function(){Ko(this,e).duration=t}}function HO(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?qO:ZO)(t,e)):Ao(this.node(),t).duration}function $O(e,t){if(typeof t!="function")throw new Error;return function(){Ko(this,e).ease=t}}function WO(e){var t=this._id;return arguments.length?this.each($O(t,e)):Ao(this.node(),t).ease}function YO(e,t){return function(){var r=t.apply(this,arguments);if(typeof r!="function")throw new Error;Ko(this,e).ease=r}}function XO(e){if(typeof e!="function")throw new Error;return this.each(YO(this._id,e))}function QO(e){typeof e!="function"&&(e=yC(e));for(var t=this._groups,r=t.length,o=new Array(r),u=0;u<r;++u)for(var d=t[u],p=d.length,a=o[u]=[],w,T=0;T<p;++T)(w=d[T])&&e.call(w,w.__data__,T,d)&&a.push(w);return new ks(o,this._parents,this._name,this._id)}function KO(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,r=e._groups,o=t.length,u=r.length,d=Math.min(o,u),p=new Array(o),a=0;a<d;++a)for(var w=t[a],T=r[a],S=w.length,k=p[a]=new Array(S),I,P=0;P<S;++P)(I=w[P]||T[P])&&(k[P]=I);for(;a<o;++a)p[a]=t[a];return new ks(p,this._parents,this._name,this._id)}function JO(e){return(e+"").trim().split(/^|\s+/).every(function(t){var r=t.indexOf(".");return r>=0&&(t=t.slice(0,r)),!t||t==="start"})}function e7(e,t,r){var o,u,d=JO(t)?N1:Ko;return function(){var p=d(this,e),a=p.on;a!==o&&(u=(o=a).copy()).on(t,r),p.on=u}}function t7(e,t){var r=this._id;return arguments.length<2?Ao(this.node(),r).on.on(e):this.each(e7(r,e,t))}function n7(e){return function(){var t=this.parentNode;for(var r in this.__transition)if(+r!==e)return;t&&t.removeChild(this)}}function i7(){return this.on("end.remove",n7(this._id))}function r7(e){var t=this._name,r=this._id;typeof e!="function"&&(e=P1(e));for(var o=this._groups,u=o.length,d=new Array(u),p=0;p<u;++p)for(var a=o[p],w=a.length,T=d[p]=new Array(w),S,k,I=0;I<w;++I)(S=a[I])&&(k=e.call(S,S.__data__,I,a))&&("__data__"in S&&(k.__data__=S.__data__),T[I]=k,W_(T[I],t,r,I,T,Ao(S,r)));return new ks(d,this._parents,t,r)}function a7(e){var t=this._name,r=this._id;typeof e!="function"&&(e=_C(e));for(var o=this._groups,u=o.length,d=[],p=[],a=0;a<u;++a)for(var w=o[a],T=w.length,S,k=0;k<T;++k)if(S=w[k]){for(var I=e.call(S,S.__data__,k,w),P,F=Ao(S,r),G=0,H=I.length;G<H;++G)(P=I[G])&&W_(P,t,r,G,I,F);d.push(I),p.push(S)}return new ks(d,p,t,r)}var o7=dp.prototype.constructor;function s7(){return new o7(this._groups,this._parents)}function l7(e,t){var r,o,u;return function(){var d=Sh(this,e),p=(this.style.removeProperty(e),Sh(this,e));return d===p?null:d===r&&p===o?u:u=t(r=d,o=p)}}function YC(e){return function(){this.style.removeProperty(e)}}function c7(e,t,r){var o,u=r+"",d;return function(){var p=Sh(this,e);return p===u?null:p===o?d:d=t(o=p,r)}}function u7(e,t,r){var o,u,d;return function(){var p=Sh(this,e),a=r(this),w=a+"";return a==null&&(w=a=(this.style.removeProperty(e),Sh(this,e))),p===w?null:p===o&&w===u?d:(u=w,d=t(o=p,a))}}function h7(e,t){var r,o,u,d="style."+t,p="end."+d,a;return function(){var w=Ko(this,e),T=w.on,S=w.value[d]==null?a||(a=YC(t)):void 0;(T!==r||u!==S)&&(o=(r=T).copy()).on(p,u=S),w.on=o}}function f7(e,t,r){var o=(e+="")=="transform"?uO:WC;return t==null?this.styleTween(e,l7(e,o)).on("end.style."+e,YC(e)):typeof t=="function"?this.styleTween(e,u7(e,o,j1(this,"style."+e,t))).each(h7(this._id,e)):this.styleTween(e,c7(e,o,t),r).on("end.style."+e,null)}function d7(e,t,r){return function(o){this.style.setProperty(e,t.call(this,o),r)}}function p7(e,t,r){var o,u;function d(){var p=t.apply(this,arguments);return p!==u&&(o=(u=p)&&d7(e,p,r)),o}return d._value=t,d}function m7(e,t,r){var o="style."+(e+="");if(arguments.length<2)return(o=this.tween(o))&&o._value;if(t==null)return this.tween(o,null);if(typeof t!="function")throw new Error;return this.tween(o,p7(e,t,r??""))}function g7(e){return function(){this.textContent=e}}function _7(e){return function(){var t=e(this);this.textContent=t??""}}function y7(e){return this.tween("text",typeof e=="function"?_7(j1(this,"text",e)):g7(e==null?"":e+""))}function v7(e){return function(t){this.textContent=e.call(this,t)}}function b7(e){var t,r;function o(){var u=e.apply(this,arguments);return u!==r&&(t=(r=u)&&v7(u)),t}return o._value=e,o}function x7(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,b7(e))}function w7(){for(var e=this._name,t=this._id,r=XC(),o=this._groups,u=o.length,d=0;d<u;++d)for(var p=o[d],a=p.length,w,T=0;T<a;++T)if(w=p[T]){var S=Ao(w,t);W_(w,e,r,T,p,{time:S.time+S.delay+S.duration,delay:0,duration:S.duration,ease:S.ease})}return new ks(o,this._parents,e,r)}function A7(){var e,t,r=this,o=r._id,u=r.size();return new Promise(function(d,p){var a={value:p},w={value:function(){--u===0&&d()}};r.each(function(){var T=Ko(this,o),S=T.on;S!==e&&(t=(e=S).copy(),t._.cancel.push(a),t._.interrupt.push(a),t._.end.push(w)),T.on=t}),u===0&&d()})}var T7=0;function ks(e,t,r,o){this._groups=e,this._parents=t,this._name=r,this._id=o}function XC(){return++T7}var ms=dp.prototype;ks.prototype={constructor:ks,select:r7,selectAll:a7,selectChild:ms.selectChild,selectChildren:ms.selectChildren,filter:QO,merge:KO,selection:s7,transition:w7,call:ms.call,nodes:ms.nodes,node:ms.node,size:ms.size,empty:ms.empty,each:ms.each,on:t7,attr:LO,attrTween:jO,style:f7,styleTween:m7,text:y7,textTween:x7,remove:i7,tween:IO,delay:GO,duration:HO,ease:WO,easeVarying:XO,end:A7,[Symbol.iterator]:ms[Symbol.iterator]};function S7(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var M7={time:null,delay:0,duration:250,ease:S7};function C7(e,t){for(var r;!(r=e.__transition)||!(r=r[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return r}function I7(e){var t,r;e instanceof ks?(t=e._id,e=e._name):(t=XC(),(r=M7).time=O1(),e=e==null?null:e+"");for(var o=this._groups,u=o.length,d=0;d<u;++d)for(var p=o[d],a=p.length,w,T=0;T<a;++T)(w=p[T])&&W_(w,e,t,T,p,r||C7(w,t));return new ks(o,this._parents,e,t)}dp.prototype.interrupt=SO;dp.prototype.transition=I7;const Sb=Math.PI,Mb=2*Sb,vc=1e-6,E7=Mb-vc;function QC(e){this._+=e[0];for(let t=1,r=e.length;t<r;++t)this._+=arguments[t]+e[t]}function P7(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return QC;const r=10**t;return function(o){this._+=o[0];for(let u=1,d=o.length;u<d;++u)this._+=Math.round(arguments[u]*r)/r+o[u]}}class KC{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?QC:P7(t)}moveTo(t,r){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,r){this._append`L${this._x1=+t},${this._y1=+r}`}quadraticCurveTo(t,r,o,u){this._append`Q${+t},${+r},${this._x1=+o},${this._y1=+u}`}bezierCurveTo(t,r,o,u,d,p){this._append`C${+t},${+r},${+o},${+u},${this._x1=+d},${this._y1=+p}`}arcTo(t,r,o,u,d){if(t=+t,r=+r,o=+o,u=+u,d=+d,d<0)throw new Error(`negative radius: ${d}`);let p=this._x1,a=this._y1,w=o-t,T=u-r,S=p-t,k=a-r,I=S*S+k*k;if(this._x1===null)this._append`M${this._x1=t},${this._y1=r}`;else if(I>vc)if(!(Math.abs(k*w-T*S)>vc)||!d)this._append`L${this._x1=t},${this._y1=r}`;else{let P=o-p,F=u-a,G=w*w+T*T,H=P*P+F*F,Y=Math.sqrt(G),$=Math.sqrt(I),ae=d*Math.tan((Sb-Math.acos((G+I-H)/(2*Y*$)))/2),ee=ae/$,ce=ae/Y;Math.abs(ee-1)>vc&&this._append`L${t+ee*S},${r+ee*k}`,this._append`A${d},${d},0,0,${+(k*P>S*F)},${this._x1=t+ce*w},${this._y1=r+ce*T}`}}arc(t,r,o,u,d,p){if(t=+t,r=+r,o=+o,p=!!p,o<0)throw new Error(`negative radius: ${o}`);let a=o*Math.cos(u),w=o*Math.sin(u),T=t+a,S=r+w,k=1^p,I=p?u-d:d-u;this._x1===null?this._append`M${T},${S}`:(Math.abs(this._x1-T)>vc||Math.abs(this._y1-S)>vc)&&this._append`L${T},${S}`,o&&(I<0&&(I=I%Mb+Mb),I>E7?this._append`A${o},${o},0,1,${k},${t-a},${r-w}A${o},${o},0,1,${k},${this._x1=T},${this._y1=S}`:I>vc&&this._append`A${o},${o},0,${+(I>=Sb)},${k},${this._x1=t+o*Math.cos(d)},${this._y1=r+o*Math.sin(d)}`)}rect(t,r,o,u){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}h${o=+o}v${+u}h${-o}Z`}toString(){return this._}}function Cb(e=3){return new KC(+e)}function k7(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function n_(e,t){if((r=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var r,o=e.slice(0,r);return[o.length>1?o[0]+o.slice(2):o,+e.slice(r+1)]}function Ih(e){return e=n_(Math.abs(e)),e?e[1]:NaN}function D7(e,t){return function(r,o){for(var u=r.length,d=[],p=0,a=e[0],w=0;u>0&&a>0&&(w+a+1>o&&(a=Math.max(1,o-w)),d.push(r.substring(u-=a,u+a)),!((w+=a+1)>o));)a=e[p=(p+1)%e.length];return d.reverse().join(t)}}function z7(e){return function(t){return t.replace(/[0-9]/g,function(r){return e[+r]})}}var R7=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Zd(e){if(!(t=R7.exec(e)))throw new Error("invalid format: "+e);var t;return new U1({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}Zd.prototype=U1.prototype;function U1(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}U1.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function L7(e){e:for(var t=e.length,r=1,o=-1,u;r<t;++r)switch(e[r]){case".":o=u=r;break;case"0":o===0&&(o=r),u=r;break;default:if(!+e[r])break e;o>0&&(o=0);break}return o>0?e.slice(0,o)+e.slice(u+1):e}var JC;function B7(e,t){var r=n_(e,t);if(!r)return e+"";var o=r[0],u=r[1],d=u-(JC=Math.max(-8,Math.min(8,Math.floor(u/3)))*3)+1,p=o.length;return d===p?o:d>p?o+new Array(d-p+1).join("0"):d>0?o.slice(0,d)+"."+o.slice(d):"0."+new Array(1-d).join("0")+n_(e,Math.max(0,t+d-1))[0]}function ZA(e,t){var r=n_(e,t);if(!r)return e+"";var o=r[0],u=r[1];return u<0?"0."+new Array(-u).join("0")+o:o.length>u+1?o.slice(0,u+1)+"."+o.slice(u+1):o+new Array(u-o.length+2).join("0")}const HA={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:k7,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>ZA(e*100,t),r:ZA,s:B7,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function $A(e){return e}var WA=Array.prototype.map,YA=["y","z","a","f","p","n","Âµ","m","","k","M","G","T","P","E","Z","Y"];function F7(e){var t=e.grouping===void 0||e.thousands===void 0?$A:D7(WA.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",o=e.currency===void 0?"":e.currency[1]+"",u=e.decimal===void 0?".":e.decimal+"",d=e.numerals===void 0?$A:z7(WA.call(e.numerals,String)),p=e.percent===void 0?"%":e.percent+"",a=e.minus===void 0?"â":e.minus+"",w=e.nan===void 0?"NaN":e.nan+"";function T(k){k=Zd(k);var I=k.fill,P=k.align,F=k.sign,G=k.symbol,H=k.zero,Y=k.width,$=k.comma,ae=k.precision,ee=k.trim,ce=k.type;ce==="n"?($=!0,ce="g"):HA[ce]||(ae===void 0&&(ae=12),ee=!0,ce="g"),(H||I==="0"&&P==="=")&&(H=!0,I="0",P="=");var re=G==="$"?r:G==="#"&&/[boxX]/.test(ce)?"0"+ce.toLowerCase():"",he=G==="$"?o:/[%p]/.test(ce)?p:"",be=HA[ce],ke=/[defgprs%]/.test(ce);ae=ae===void 0?6:/[gprs]/.test(ce)?Math.max(1,Math.min(21,ae)):Math.max(0,Math.min(20,ae));function Ie(ue){var Ve=re,Ze=he,Xe,Re,ot;if(ce==="c")Ze=be(ue)+Ze,ue="";else{ue=+ue;var Pt=ue<0||1/ue<0;if(ue=isNaN(ue)?w:be(Math.abs(ue),ae),ee&&(ue=L7(ue)),Pt&&+ue==0&&F!=="+"&&(Pt=!1),Ve=(Pt?F==="("?F:a:F==="-"||F==="("?"":F)+Ve,Ze=(ce==="s"?YA[8+JC/3]:"")+Ze+(Pt&&F==="("?")":""),ke){for(Xe=-1,Re=ue.length;++Xe<Re;)if(ot=ue.charCodeAt(Xe),48>ot||ot>57){Ze=(ot===46?u+ue.slice(Xe+1):ue.slice(Xe))+Ze,ue=ue.slice(0,Xe);break}}}$&&!H&&(ue=t(ue,1/0));var bt=Ve.length+ue.length+Ze.length,_t=bt<Y?new Array(Y-bt+1).join(I):"";switch($&&H&&(ue=t(_t+ue,_t.length?Y-Ze.length:1/0),_t=""),P){case"<":ue=Ve+ue+Ze+_t;break;case"=":ue=Ve+_t+ue+Ze;break;case"^":ue=_t.slice(0,bt=_t.length>>1)+Ve+ue+Ze+_t.slice(bt);break;default:ue=_t+Ve+ue+Ze;break}return d(ue)}return Ie.toString=function(){return k+""},Ie}function S(k,I){var P=T((k=Zd(k),k.type="f",k)),F=Math.max(-8,Math.min(8,Math.floor(Ih(I)/3)))*3,G=Math.pow(10,-F),H=YA[8+F/3];return function(Y){return P(G*Y)+H}}return{format:T,formatPrefix:S}}var $m,Es,eI;O7({thousands:",",grouping:[3],currency:["$",""]});function O7(e){return $m=F7(e),Es=$m.format,eI=$m.formatPrefix,$m}function N7(e){return Math.max(0,-Ih(Math.abs(e)))}function j7(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Ih(t)/3)))*3-Ih(Math.abs(e)))}function U7(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,Ih(t)-Ih(e))+1}function Jo(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function Y_(e,t){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}const Ib=Symbol("implicit");function V1(){var e=new Bd,t=[],r=[],o=Ib;function u(d){let p=e.get(d);if(p===void 0){if(o!==Ib)return o;e.set(d,p=t.push(d)-1)}return r[p%r.length]}return u.domain=function(d){if(!arguments.length)return t.slice();t=[],e=new Bd;for(const p of d)e.has(p)||e.set(p,t.push(p)-1);return u},u.range=function(d){return arguments.length?(r=Array.from(d),u):r.slice()},u.unknown=function(d){return arguments.length?(o=d,u):o},u.copy=function(){return V1(t,r).unknown(o)},Jo.apply(u,arguments),u}function X_(){var e=V1().unknown(void 0),t=e.domain,r=e.range,o=0,u=1,d,p,a=!1,w=0,T=0,S=.5;delete e.unknown;function k(){var I=t().length,P=u<o,F=P?u:o,G=P?o:u;d=(G-F)/Math.max(1,I-w+T*2),a&&(d=Math.floor(d)),F+=(G-F-d*(I-w))*S,p=d*(1-w),a&&(F=Math.round(F),p=Math.round(p));var H=Qv(I).map(function(Y){return F+d*Y});return r(P?H.reverse():H)}return e.domain=function(I){return arguments.length?(t(I),k()):t()},e.range=function(I){return arguments.length?([o,u]=I,o=+o,u=+u,k()):[o,u]},e.rangeRound=function(I){return[o,u]=I,o=+o,u=+u,a=!0,k()},e.bandwidth=function(){return p},e.step=function(){return d},e.round=function(I){return arguments.length?(a=!!I,k()):a},e.padding=function(I){return arguments.length?(w=Math.min(1,T=+I),k()):w},e.paddingInner=function(I){return arguments.length?(w=Math.min(1,I),k()):w},e.paddingOuter=function(I){return arguments.length?(T=+I,k()):T},e.align=function(I){return arguments.length?(S=Math.max(0,Math.min(1,I)),k()):S},e.copy=function(){return X_(t(),[o,u]).round(a).paddingInner(w).paddingOuter(T).align(S)},Jo.apply(k(),arguments)}function tI(e){var t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return tI(t())},e}function V7(){return tI(X_.apply(null,arguments).paddingInner(1))}function G7(e){return function(){return e}}function Eb(e){return+e}var XA=[0,1];function Qa(e){return e}function Pb(e,t){return(t-=e=+e)?function(r){return(r-e)/t}:G7(isNaN(t)?NaN:.5)}function q7(e,t){var r;return e>t&&(r=e,e=t,t=r),function(o){return Math.max(e,Math.min(t,o))}}function Z7(e,t,r){var o=e[0],u=e[1],d=t[0],p=t[1];return u<o?(o=Pb(u,o),d=r(p,d)):(o=Pb(o,u),d=r(d,p)),function(a){return d(o(a))}}function H7(e,t,r){var o=Math.min(e.length,t.length)-1,u=new Array(o),d=new Array(o),p=-1;for(e[o]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++p<o;)u[p]=Pb(e[p],e[p+1]),d[p]=r(t[p],t[p+1]);return function(a){var w=D_(e,a,1,o)-1;return d[w](u[w](a))}}function gp(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Q_(){var e=XA,t=XA,r=mp,o,u,d,p=Qa,a,w,T;function S(){var I=Math.min(e.length,t.length);return p!==Qa&&(p=q7(e[0],e[I-1])),a=I>2?H7:Z7,w=T=null,k}function k(I){return I==null||isNaN(I=+I)?d:(w||(w=a(e.map(o),t,r)))(o(p(I)))}return k.invert=function(I){return p(u((T||(T=a(t,e.map(o),Kr)))(I)))},k.domain=function(I){return arguments.length?(e=Array.from(I,Eb),S()):e.slice()},k.range=function(I){return arguments.length?(t=Array.from(I),S()):t.slice()},k.rangeRound=function(I){return t=Array.from(I),r=B1,S()},k.clamp=function(I){return arguments.length?(p=I?!0:Qa,S()):p!==Qa},k.interpolate=function(I){return arguments.length?(r=I,S()):r},k.unknown=function(I){return arguments.length?(d=I,k):d},function(I,P){return o=I,u=P,S()}}function nI(){return Q_()(Qa,Qa)}function $7(e,t,r,o){var u=Yv(e,t,r),d;switch(o=Zd(o??",f"),o.type){case"s":{var p=Math.max(Math.abs(e),Math.abs(t));return o.precision==null&&!isNaN(d=j7(u,p))&&(o.precision=d),eI(o,p)}case"":case"e":case"g":case"p":case"r":{o.precision==null&&!isNaN(d=U7(u,Math.max(Math.abs(e),Math.abs(t))))&&(o.precision=d-(o.type==="e"));break}case"f":case"%":{o.precision==null&&!isNaN(d=N7(u))&&(o.precision=d-(o.type==="%")*2);break}}return Es(o)}function _p(e){var t=e.domain;return e.ticks=function(r){var o=t();return Od(o[0],o[o.length-1],r??10)},e.tickFormat=function(r,o){var u=t();return $7(u[0],u[u.length-1],r??10,o)},e.nice=function(r){r==null&&(r=10);var o=t(),u=0,d=o.length-1,p=o[u],a=o[d],w,T,S=10;for(a<p&&(T=p,p=a,a=T,T=u,u=d,d=T);S-- >0;){if(T=kg(p,a,r),T===w)return o[u]=p,o[d]=a,t(o);if(T>0)p=Math.floor(p/T)*T,a=Math.ceil(a/T)*T;else if(T<0)p=Math.ceil(p*T)/T,a=Math.floor(a*T)/T;else break;w=T}return e},e}function K_(){var e=nI();return e.copy=function(){return gp(e,K_())},Jo.apply(e,arguments),_p(e)}function iI(e){var t;function r(o){return o==null||isNaN(o=+o)?t:o}return r.invert=r,r.domain=r.range=function(o){return arguments.length?(e=Array.from(o,Eb),r):e.slice()},r.unknown=function(o){return arguments.length?(t=o,r):t},r.copy=function(){return iI(e).unknown(t)},e=arguments.length?Array.from(e,Eb):[0,1],_p(r)}function rI(e,t){e=e.slice();var r=0,o=e.length-1,u=e[r],d=e[o],p;return d<u&&(p=r,r=o,o=p,p=u,u=d,d=p),e[r]=t.floor(u),e[o]=t.ceil(d),e}function QA(e){return Math.log(e)}function KA(e){return Math.exp(e)}function W7(e){return-Math.log(-e)}function Y7(e){return-Math.exp(-e)}function X7(e){return isFinite(e)?+("1e"+e):e<0?0:e}function Q7(e){return e===10?X7:e===Math.E?Math.exp:t=>Math.pow(e,t)}function K7(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}function JA(e){return(t,r)=>-e(-t,r)}function aI(e){const t=e(QA,KA),r=t.domain;let o=10,u,d;function p(){return u=K7(o),d=Q7(o),r()[0]<0?(u=JA(u),d=JA(d),e(W7,Y7)):e(QA,KA),t}return t.base=function(a){return arguments.length?(o=+a,p()):o},t.domain=function(a){return arguments.length?(r(a),p()):r()},t.ticks=a=>{const w=r();let T=w[0],S=w[w.length-1];const k=S<T;k&&([T,S]=[S,T]);let I=u(T),P=u(S),F,G;const H=a==null?10:+a;let Y=[];if(!(o%1)&&P-I<H){if(I=Math.floor(I),P=Math.ceil(P),T>0){for(;I<=P;++I)for(F=1;F<o;++F)if(G=I<0?F/d(-I):F*d(I),!(G<T)){if(G>S)break;Y.push(G)}}else for(;I<=P;++I)for(F=o-1;F>=1;--F)if(G=I>0?F/d(-I):F*d(I),!(G<T)){if(G>S)break;Y.push(G)}Y.length*2<H&&(Y=Od(T,S,H))}else Y=Od(I,P,Math.min(P-I,H)).map(d);return k?Y.reverse():Y},t.tickFormat=(a,w)=>{if(a==null&&(a=10),w==null&&(w=o===10?"s":","),typeof w!="function"&&(!(o%1)&&(w=Zd(w)).precision==null&&(w.trim=!0),w=Es(w)),a===1/0)return w;const T=Math.max(1,o*a/t.ticks().length);return S=>{let k=S/d(Math.round(u(S)));return k*o<o-.5&&(k*=o),k<=T?w(S):""}},t.nice=()=>r(rI(r(),{floor:a=>d(Math.floor(u(a))),ceil:a=>d(Math.ceil(u(a)))})),t}function oI(){const e=aI(Q_()).domain([1,10]);return e.copy=()=>gp(e,oI()).base(e.base()),Jo.apply(e,arguments),e}function eT(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function tT(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function sI(e){var t=1,r=e(eT(t),tT(t));return r.constant=function(o){return arguments.length?e(eT(t=+o),tT(t)):t},_p(r)}function lI(){var e=sI(Q_());return e.copy=function(){return gp(e,lI()).constant(e.constant())},Jo.apply(e,arguments)}function nT(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function J7(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function e9(e){return e<0?-e*e:e*e}function cI(e){var t=e(Qa,Qa),r=1;function o(){return r===1?e(Qa,Qa):r===.5?e(J7,e9):e(nT(r),nT(1/r))}return t.exponent=function(u){return arguments.length?(r=+u,o()):r},_p(t)}function uI(){var e=cI(Q_());return e.copy=function(){return gp(e,uI()).exponent(e.exponent())},Jo.apply(e,arguments),e}function hI(){var e=[],t=[],r=[],o;function u(){var p=0,a=Math.max(1,t.length);for(r=new Array(a-1);++p<a;)r[p-1]=Lz(e,p/a);return d}function d(p){return p==null||isNaN(p=+p)?o:t[D_(r,p)]}return d.invertExtent=function(p){var a=t.indexOf(p);return a<0?[NaN,NaN]:[a>0?r[a-1]:e[0],a<r.length?r[a]:e[e.length-1]]},d.domain=function(p){if(!arguments.length)return e.slice();e=[];for(let a of p)a!=null&&!isNaN(a=+a)&&e.push(a);return e.sort(_o),u()},d.range=function(p){return arguments.length?(t=Array.from(p),u()):t.slice()},d.unknown=function(p){return arguments.length?(o=p,d):o},d.quantiles=function(){return r.slice()},d.copy=function(){return hI().domain(e).range(t).unknown(o)},Jo.apply(d,arguments)}function fI(){var e=[.5],t=[0,1],r,o=1;function u(d){return d!=null&&d<=d?t[D_(e,d,0,o)]:r}return u.domain=function(d){return arguments.length?(e=Array.from(d),o=Math.min(e.length,t.length-1),u):e.slice()},u.range=function(d){return arguments.length?(t=Array.from(d),o=Math.min(e.length,t.length-1),u):t.slice()},u.invertExtent=function(d){var p=t.indexOf(d);return[e[p-1],e[p]]},u.unknown=function(d){return arguments.length?(r=d,u):r},u.copy=function(){return fI().domain(e).range(t).unknown(r)},Jo.apply(u,arguments)}const ov=new Date,sv=new Date;function wr(e,t,r,o){function u(d){return e(d=arguments.length===0?new Date:new Date(+d)),d}return u.floor=d=>(e(d=new Date(+d)),d),u.ceil=d=>(e(d=new Date(d-1)),t(d,1),e(d),d),u.round=d=>{const p=u(d),a=u.ceil(d);return d-p<a-d?p:a},u.offset=(d,p)=>(t(d=new Date(+d),p==null?1:Math.floor(p)),d),u.range=(d,p,a)=>{const w=[];if(d=u.ceil(d),a=a==null?1:Math.floor(a),!(d<p)||!(a>0))return w;let T;do w.push(T=new Date(+d)),t(d,a),e(d);while(T<d&&d<p);return w},u.filter=d=>wr(p=>{if(p>=p)for(;e(p),!d(p);)p.setTime(p-1)},(p,a)=>{if(p>=p)if(a<0)for(;++a<=0;)for(;t(p,-1),!d(p););else for(;--a>=0;)for(;t(p,1),!d(p););}),r&&(u.count=(d,p)=>(ov.setTime(+d),sv.setTime(+p),e(ov),e(sv),Math.floor(r(ov,sv))),u.every=d=>(d=Math.floor(d),!isFinite(d)||!(d>0)?null:d>1?u.filter(o?p=>o(p)%d===0:p=>u.count(0,p)%d===0):u)),u}const i_=wr(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);i_.every=e=>(e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?wr(t=>{t.setTime(Math.floor(t/e)*e)},(t,r)=>{t.setTime(+t+r*e)},(t,r)=>(r-t)/e):i_);i_.range;const Ss=1e3,Ka=Ss*60,Ms=Ka*60,Ds=Ms*24,G1=Ds*7,iT=Ds*30,lv=Ds*365,go=wr(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*Ss)},(e,t)=>(t-e)/Ss,e=>e.getUTCSeconds());go.range;const yp=wr(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*Ss)},(e,t)=>{e.setTime(+e+t*Ka)},(e,t)=>(t-e)/Ka,e=>e.getMinutes());yp.range;const Vh=wr(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*Ka)},(e,t)=>(t-e)/Ka,e=>e.getUTCMinutes());Vh.range;const vp=wr(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*Ss-e.getMinutes()*Ka)},(e,t)=>{e.setTime(+e+t*Ms)},(e,t)=>(t-e)/Ms,e=>e.getHours());vp.range;const bp=wr(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*Ms)},(e,t)=>(t-e)/Ms,e=>e.getUTCHours());bp.range;const Wc=wr(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*Ka)/Ds,e=>e.getDate()-1);Wc.range;const J_=wr(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/Ds,e=>e.getUTCDate()-1);J_.range;const ey=wr(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/Ds,e=>Math.floor(e/Ds));ey.range;function Yc(e){return wr(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(t,r)=>{t.setDate(t.getDate()+r*7)},(t,r)=>(r-t-(r.getTimezoneOffset()-t.getTimezoneOffset())*Ka)/G1)}const Eh=Yc(0),Hd=Yc(1),dI=Yc(2),pI=Yc(3),Zc=Yc(4),mI=Yc(5),gI=Yc(6);Eh.range;Hd.range;dI.range;pI.range;Zc.range;mI.range;gI.range;function Xc(e){return wr(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCDate(t.getUTCDate()+r*7)},(t,r)=>(r-t)/G1)}const Ph=Xc(0),$d=Xc(1),_I=Xc(2),yI=Xc(3),Hc=Xc(4),vI=Xc(5),bI=Xc(6);Ph.range;$d.range;_I.range;yI.range;Hc.range;vI.range;bI.range;const xp=wr(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12,e=>e.getMonth());xp.range;const wp=wr(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12,e=>e.getUTCMonth());wp.range;const xo=wr(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear());xo.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:wr(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,r)=>{t.setFullYear(t.getFullYear()+r*e)});xo.range;const wo=wr(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());wo.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:wr(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCFullYear(t.getUTCFullYear()+r*e)});wo.range;function xI(e,t,r,o,u,d){const p=[[go,1,Ss],[go,5,5*Ss],[go,15,15*Ss],[go,30,30*Ss],[d,1,Ka],[d,5,5*Ka],[d,15,15*Ka],[d,30,30*Ka],[u,1,Ms],[u,3,3*Ms],[u,6,6*Ms],[u,12,12*Ms],[o,1,Ds],[o,2,2*Ds],[r,1,G1],[t,1,iT],[t,3,3*iT],[e,1,lv]];function a(T,S,k){const I=S<T;I&&([T,S]=[S,T]);const P=k&&typeof k.range=="function"?k:w(T,S,k),F=P?P.range(T,+S+1):[];return I?F.reverse():F}function w(T,S,k){const I=Math.abs(S-T)/k,P=k_(([,,H])=>H).right(p,I);if(P===p.length)return e.every(Yv(T/lv,S/lv,k));if(P===0)return i_.every(Math.max(Yv(T,S,k),1));const[F,G]=p[I/p[P-1][2]<p[P][2]/I?P-1:P];return F.every(G)}return[a,w]}const[t9,wI]=xI(wo,wp,Ph,ey,bp,Vh),[n9,i9]=xI(xo,xp,Eh,Wc,vp,yp);function cv(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function uv(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function hd(e,t,r){return{y:e,m:t,d:r,H:0,M:0,S:0,L:0}}function r9(e){var t=e.dateTime,r=e.date,o=e.time,u=e.periods,d=e.days,p=e.shortDays,a=e.months,w=e.shortMonths,T=fd(u),S=dd(u),k=fd(d),I=dd(d),P=fd(p),F=dd(p),G=fd(a),H=dd(a),Y=fd(w),$=dd(w),ae={a:Pt,A:bt,b:_t,B:tt,c:null,d:cT,e:cT,f:C9,g:F9,G:N9,H:T9,I:S9,j:M9,L:AI,m:I9,M:E9,p:Tt,q:ct,Q:fT,s:dT,S:P9,u:k9,U:D9,V:z9,w:R9,W:L9,x:null,X:null,y:B9,Y:O9,Z:j9,"%":hT},ee={a:mt,A:Xt,b:Ut,B:St,c:null,d:uT,e:uT,f:q9,g:eN,G:nN,H:U9,I:V9,j:G9,L:SI,m:Z9,M:H9,p:pt,q:Ft,Q:fT,s:dT,S:$9,u:W9,U:Y9,V:X9,w:Q9,W:K9,x:null,X:null,y:J9,Y:tN,Z:iN,"%":hT},ce={a:Ie,A:ue,b:Ve,B:Ze,c:Xe,d:sT,e:sT,f:b9,g:oT,G:aT,H:lT,I:lT,j:g9,L:v9,m:m9,M:_9,p:ke,q:p9,Q:w9,s:A9,S:y9,u:c9,U:u9,V:h9,w:l9,W:f9,x:Re,X:ot,y:oT,Y:aT,Z:d9,"%":x9};ae.x=re(r,ae),ae.X=re(o,ae),ae.c=re(t,ae),ee.x=re(r,ee),ee.X=re(o,ee),ee.c=re(t,ee);function re(nt,De){return function(Ke){var Be=[],wt=-1,gt=0,Rt=nt.length,st,ht,qe;for(Ke instanceof Date||(Ke=new Date(+Ke));++wt<Rt;)nt.charCodeAt(wt)===37&&(Be.push(nt.slice(gt,wt)),(ht=rT[st=nt.charAt(++wt)])!=null?st=nt.charAt(++wt):ht=st==="e"?" ":"0",(qe=De[st])&&(st=qe(Ke,ht)),Be.push(st),gt=wt+1);return Be.push(nt.slice(gt,wt)),Be.join("")}}function he(nt,De){return function(Ke){var Be=hd(1900,void 0,1),wt=be(Be,nt,Ke+="",0),gt,Rt;if(wt!=Ke.length)return null;if("Q"in Be)return new Date(Be.Q);if("s"in Be)return new Date(Be.s*1e3+("L"in Be?Be.L:0));if(De&&!("Z"in Be)&&(Be.Z=0),"p"in Be&&(Be.H=Be.H%12+Be.p*12),Be.m===void 0&&(Be.m="q"in Be?Be.q:0),"V"in Be){if(Be.V<1||Be.V>53)return null;"w"in Be||(Be.w=1),"Z"in Be?(gt=uv(hd(Be.y,0,1)),Rt=gt.getUTCDay(),gt=Rt>4||Rt===0?$d.ceil(gt):$d(gt),gt=J_.offset(gt,(Be.V-1)*7),Be.y=gt.getUTCFullYear(),Be.m=gt.getUTCMonth(),Be.d=gt.getUTCDate()+(Be.w+6)%7):(gt=cv(hd(Be.y,0,1)),Rt=gt.getDay(),gt=Rt>4||Rt===0?Hd.ceil(gt):Hd(gt),gt=Wc.offset(gt,(Be.V-1)*7),Be.y=gt.getFullYear(),Be.m=gt.getMonth(),Be.d=gt.getDate()+(Be.w+6)%7)}else("W"in Be||"U"in Be)&&("w"in Be||(Be.w="u"in Be?Be.u%7:"W"in Be?1:0),Rt="Z"in Be?uv(hd(Be.y,0,1)).getUTCDay():cv(hd(Be.y,0,1)).getDay(),Be.m=0,Be.d="W"in Be?(Be.w+6)%7+Be.W*7-(Rt+5)%7:Be.w+Be.U*7-(Rt+6)%7);return"Z"in Be?(Be.H+=Be.Z/100|0,Be.M+=Be.Z%100,uv(Be)):cv(Be)}}function be(nt,De,Ke,Be){for(var wt=0,gt=De.length,Rt=Ke.length,st,ht;wt<gt;){if(Be>=Rt)return-1;if(st=De.charCodeAt(wt++),st===37){if(st=De.charAt(wt++),ht=ce[st in rT?De.charAt(wt++):st],!ht||(Be=ht(nt,Ke,Be))<0)return-1}else if(st!=Ke.charCodeAt(Be++))return-1}return Be}function ke(nt,De,Ke){var Be=T.exec(De.slice(Ke));return Be?(nt.p=S.get(Be[0].toLowerCase()),Ke+Be[0].length):-1}function Ie(nt,De,Ke){var Be=P.exec(De.slice(Ke));return Be?(nt.w=F.get(Be[0].toLowerCase()),Ke+Be[0].length):-1}function ue(nt,De,Ke){var Be=k.exec(De.slice(Ke));return Be?(nt.w=I.get(Be[0].toLowerCase()),Ke+Be[0].length):-1}function Ve(nt,De,Ke){var Be=Y.exec(De.slice(Ke));return Be?(nt.m=$.get(Be[0].toLowerCase()),Ke+Be[0].length):-1}function Ze(nt,De,Ke){var Be=G.exec(De.slice(Ke));return Be?(nt.m=H.get(Be[0].toLowerCase()),Ke+Be[0].length):-1}function Xe(nt,De,Ke){return be(nt,t,De,Ke)}function Re(nt,De,Ke){return be(nt,r,De,Ke)}function ot(nt,De,Ke){return be(nt,o,De,Ke)}function Pt(nt){return p[nt.getDay()]}function bt(nt){return d[nt.getDay()]}function _t(nt){return w[nt.getMonth()]}function tt(nt){return a[nt.getMonth()]}function Tt(nt){return u[+(nt.getHours()>=12)]}function ct(nt){return 1+~~(nt.getMonth()/3)}function mt(nt){return p[nt.getUTCDay()]}function Xt(nt){return d[nt.getUTCDay()]}function Ut(nt){return w[nt.getUTCMonth()]}function St(nt){return a[nt.getUTCMonth()]}function pt(nt){return u[+(nt.getUTCHours()>=12)]}function Ft(nt){return 1+~~(nt.getUTCMonth()/3)}return{format:function(nt){var De=re(nt+="",ae);return De.toString=function(){return nt},De},parse:function(nt){var De=he(nt+="",!1);return De.toString=function(){return nt},De},utcFormat:function(nt){var De=re(nt+="",ee);return De.toString=function(){return nt},De},utcParse:function(nt){var De=he(nt+="",!0);return De.toString=function(){return nt},De}}}var rT={"-":"",_:" ",0:"0"},Dr=/^\s*\d+/,a9=/^%/,o9=/[\\^$*+?|[\]().{}]/g;function si(e,t,r){var o=e<0?"-":"",u=(o?-e:e)+"",d=u.length;return o+(d<r?new Array(r-d+1).join(t)+u:u)}function s9(e){return e.replace(o9,"\\$&")}function fd(e){return new RegExp("^(?:"+e.map(s9).join("|")+")","i")}function dd(e){return new Map(e.map((t,r)=>[t.toLowerCase(),r]))}function l9(e,t,r){var o=Dr.exec(t.slice(r,r+1));return o?(e.w=+o[0],r+o[0].length):-1}function c9(e,t,r){var o=Dr.exec(t.slice(r,r+1));return o?(e.u=+o[0],r+o[0].length):-1}function u9(e,t,r){var o=Dr.exec(t.slice(r,r+2));return o?(e.U=+o[0],r+o[0].length):-1}function h9(e,t,r){var o=Dr.exec(t.slice(r,r+2));return o?(e.V=+o[0],r+o[0].length):-1}function f9(e,t,r){var o=Dr.exec(t.slice(r,r+2));return o?(e.W=+o[0],r+o[0].length):-1}function aT(e,t,r){var o=Dr.exec(t.slice(r,r+4));return o?(e.y=+o[0],r+o[0].length):-1}function oT(e,t,r){var o=Dr.exec(t.slice(r,r+2));return o?(e.y=+o[0]+(+o[0]>68?1900:2e3),r+o[0].length):-1}function d9(e,t,r){var o=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(r,r+6));return o?(e.Z=o[1]?0:-(o[2]+(o[3]||"00")),r+o[0].length):-1}function p9(e,t,r){var o=Dr.exec(t.slice(r,r+1));return o?(e.q=o[0]*3-3,r+o[0].length):-1}function m9(e,t,r){var o=Dr.exec(t.slice(r,r+2));return o?(e.m=o[0]-1,r+o[0].length):-1}function sT(e,t,r){var o=Dr.exec(t.slice(r,r+2));return o?(e.d=+o[0],r+o[0].length):-1}function g9(e,t,r){var o=Dr.exec(t.slice(r,r+3));return o?(e.m=0,e.d=+o[0],r+o[0].length):-1}function lT(e,t,r){var o=Dr.exec(t.slice(r,r+2));return o?(e.H=+o[0],r+o[0].length):-1}function _9(e,t,r){var o=Dr.exec(t.slice(r,r+2));return o?(e.M=+o[0],r+o[0].length):-1}function y9(e,t,r){var o=Dr.exec(t.slice(r,r+2));return o?(e.S=+o[0],r+o[0].length):-1}function v9(e,t,r){var o=Dr.exec(t.slice(r,r+3));return o?(e.L=+o[0],r+o[0].length):-1}function b9(e,t,r){var o=Dr.exec(t.slice(r,r+6));return o?(e.L=Math.floor(o[0]/1e3),r+o[0].length):-1}function x9(e,t,r){var o=a9.exec(t.slice(r,r+1));return o?r+o[0].length:-1}function w9(e,t,r){var o=Dr.exec(t.slice(r));return o?(e.Q=+o[0],r+o[0].length):-1}function A9(e,t,r){var o=Dr.exec(t.slice(r));return o?(e.s=+o[0],r+o[0].length):-1}function cT(e,t){return si(e.getDate(),t,2)}function T9(e,t){return si(e.getHours(),t,2)}function S9(e,t){return si(e.getHours()%12||12,t,2)}function M9(e,t){return si(1+Wc.count(xo(e),e),t,3)}function AI(e,t){return si(e.getMilliseconds(),t,3)}function C9(e,t){return AI(e,t)+"000"}function I9(e,t){return si(e.getMonth()+1,t,2)}function E9(e,t){return si(e.getMinutes(),t,2)}function P9(e,t){return si(e.getSeconds(),t,2)}function k9(e){var t=e.getDay();return t===0?7:t}function D9(e,t){return si(Eh.count(xo(e)-1,e),t,2)}function TI(e){var t=e.getDay();return t>=4||t===0?Zc(e):Zc.ceil(e)}function z9(e,t){return e=TI(e),si(Zc.count(xo(e),e)+(xo(e).getDay()===4),t,2)}function R9(e){return e.getDay()}function L9(e,t){return si(Hd.count(xo(e)-1,e),t,2)}function B9(e,t){return si(e.getFullYear()%100,t,2)}function F9(e,t){return e=TI(e),si(e.getFullYear()%100,t,2)}function O9(e,t){return si(e.getFullYear()%1e4,t,4)}function N9(e,t){var r=e.getDay();return e=r>=4||r===0?Zc(e):Zc.ceil(e),si(e.getFullYear()%1e4,t,4)}function j9(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+si(t/60|0,"0",2)+si(t%60,"0",2)}function uT(e,t){return si(e.getUTCDate(),t,2)}function U9(e,t){return si(e.getUTCHours(),t,2)}function V9(e,t){return si(e.getUTCHours()%12||12,t,2)}function G9(e,t){return si(1+J_.count(wo(e),e),t,3)}function SI(e,t){return si(e.getUTCMilliseconds(),t,3)}function q9(e,t){return SI(e,t)+"000"}function Z9(e,t){return si(e.getUTCMonth()+1,t,2)}function H9(e,t){return si(e.getUTCMinutes(),t,2)}function $9(e,t){return si(e.getUTCSeconds(),t,2)}function W9(e){var t=e.getUTCDay();return t===0?7:t}function Y9(e,t){return si(Ph.count(wo(e)-1,e),t,2)}function MI(e){var t=e.getUTCDay();return t>=4||t===0?Hc(e):Hc.ceil(e)}function X9(e,t){return e=MI(e),si(Hc.count(wo(e),e)+(wo(e).getUTCDay()===4),t,2)}function Q9(e){return e.getUTCDay()}function K9(e,t){return si($d.count(wo(e)-1,e),t,2)}function J9(e,t){return si(e.getUTCFullYear()%100,t,2)}function eN(e,t){return e=MI(e),si(e.getUTCFullYear()%100,t,2)}function tN(e,t){return si(e.getUTCFullYear()%1e4,t,4)}function nN(e,t){var r=e.getUTCDay();return e=r>=4||r===0?Hc(e):Hc.ceil(e),si(e.getUTCFullYear()%1e4,t,4)}function iN(){return"+0000"}function hT(){return"%"}function fT(e){return+e}function dT(e){return Math.floor(+e/1e3)}var Xu,q1,Ap;rN({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function rN(e){return Xu=r9(e),q1=Xu.format,Xu.parse,Ap=Xu.utcFormat,Xu.utcParse,Xu}function aN(e){return new Date(e)}function oN(e){return e instanceof Date?+e:+new Date(+e)}function Z1(e,t,r,o,u,d,p,a,w,T){var S=nI(),k=S.invert,I=S.domain,P=T(".%L"),F=T(":%S"),G=T("%I:%M"),H=T("%I %p"),Y=T("%a %d"),$=T("%b %d"),ae=T("%B"),ee=T("%Y");function ce(re){return(w(re)<re?P:a(re)<re?F:p(re)<re?G:d(re)<re?H:o(re)<re?u(re)<re?Y:$:r(re)<re?ae:ee)(re)}return S.invert=function(re){return new Date(k(re))},S.domain=function(re){return arguments.length?I(Array.from(re,oN)):I().map(aN)},S.ticks=function(re){var he=I();return e(he[0],he[he.length-1],re??10)},S.tickFormat=function(re,he){return he==null?ce:T(he)},S.nice=function(re){var he=I();return(!re||typeof re.range!="function")&&(re=t(he[0],he[he.length-1],re??10)),re?I(rI(he,re)):S},S.copy=function(){return gp(S,Z1(e,t,r,o,u,d,p,a,w,T))},S}function sN(){return Jo.apply(Z1(n9,i9,xo,xp,Eh,Wc,vp,yp,go,q1).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function lN(){return Jo.apply(Z1(t9,wI,wo,wp,Ph,J_,bp,Vh,go,Ap).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function ty(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function ny(){var e=0,t=.5,r=1,o=1,u,d,p,a,w,T=Qa,S,k=!1,I;function P(G){return isNaN(G=+G)?I:(G=.5+((G=+S(G))-d)*(o*G<o*d?a:w),T(k?Math.max(0,Math.min(1,G)):G))}P.domain=function(G){return arguments.length?([e,t,r]=G,u=S(e=+e),d=S(t=+t),p=S(r=+r),a=u===d?0:.5/(d-u),w=d===p?0:.5/(p-d),o=d<u?-1:1,P):[e,t,r]},P.clamp=function(G){return arguments.length?(k=!!G,P):k},P.interpolator=function(G){return arguments.length?(T=G,P):T};function F(G){return function(H){var Y,$,ae;return arguments.length?([Y,$,ae]=H,T=H_(G,[Y,$,ae]),P):[T(0),T(.5),T(1)]}}return P.range=F(mp),P.rangeRound=F(B1),P.unknown=function(G){return arguments.length?(I=G,P):I},function(G){return S=G,u=G(e),d=G(t),p=G(r),a=u===d?0:.5/(d-u),w=d===p?0:.5/(p-d),o=d<u?-1:1,P}}function CI(){var e=_p(ny()(Qa));return e.copy=function(){return ty(e,CI())},Y_.apply(e,arguments)}function II(){var e=aI(ny()).domain([.1,1,10]);return e.copy=function(){return ty(e,II()).base(e.base())},Y_.apply(e,arguments)}function EI(){var e=sI(ny());return e.copy=function(){return ty(e,EI()).constant(e.constant())},Y_.apply(e,arguments)}function PI(){var e=cI(ny());return e.copy=function(){return ty(e,PI()).exponent(e.exponent())},Y_.apply(e,arguments)}function Fn(e){for(var t=e.length/6|0,r=new Array(t),o=0;o<t;)r[o]="#"+e.slice(o*6,++o*6);return r}const cN=Fn("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf"),uN=Fn("7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666"),hN=Fn("1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666"),fN=Fn("4269d0efb118ff725c6cc5b03ca951ff8ab7a463f297bbf59c6b4e9498a0"),dN=Fn("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928"),pN=Fn("fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2"),mN=Fn("b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc"),gN=Fn("e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999"),_N=Fn("66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3"),yN=Fn("8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"),vN=Fn("4e79a7f28e2ce1575976b7b259a14fedc949af7aa1ff9da79c755fbab0ab"),ki=e=>eO(e[e.length-1]);var kI=new Array(3).concat("d8b365f5f5f55ab4ac","a6611adfc27d80cdc1018571","a6611adfc27df5f5f580cdc1018571","8c510ad8b365f6e8c3c7eae55ab4ac01665e","8c510ad8b365f6e8c3f5f5f5c7eae55ab4ac01665e","8c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e","8c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e","5430058c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e003c30","5430058c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e003c30").map(Fn);const DI=ki(kI);var zI=new Array(3).concat("af8dc3f7f7f77fbf7b","7b3294c2a5cfa6dba0008837","7b3294c2a5cff7f7f7a6dba0008837","762a83af8dc3e7d4e8d9f0d37fbf7b1b7837","762a83af8dc3e7d4e8f7f7f7d9f0d37fbf7b1b7837","762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b7837","762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b7837","40004b762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b783700441b","40004b762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b783700441b").map(Fn);const RI=ki(zI);var LI=new Array(3).concat("e9a3c9f7f7f7a1d76a","d01c8bf1b6dab8e1864dac26","d01c8bf1b6daf7f7f7b8e1864dac26","c51b7de9a3c9fde0efe6f5d0a1d76a4d9221","c51b7de9a3c9fde0eff7f7f7e6f5d0a1d76a4d9221","c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221","c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221","8e0152c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221276419","8e0152c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221276419").map(Fn);const BI=ki(LI);var FI=new Array(3).concat("998ec3f7f7f7f1a340","5e3c99b2abd2fdb863e66101","5e3c99b2abd2f7f7f7fdb863e66101","542788998ec3d8daebfee0b6f1a340b35806","542788998ec3d8daebf7f7f7fee0b6f1a340b35806","5427888073acb2abd2d8daebfee0b6fdb863e08214b35806","5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b35806","2d004b5427888073acb2abd2d8daebfee0b6fdb863e08214b358067f3b08","2d004b5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b358067f3b08").map(Fn);const OI=ki(FI);var kb=new Array(3).concat("ef8a62f7f7f767a9cf","ca0020f4a58292c5de0571b0","ca0020f4a582f7f7f792c5de0571b0","b2182bef8a62fddbc7d1e5f067a9cf2166ac","b2182bef8a62fddbc7f7f7f7d1e5f067a9cf2166ac","b2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac","b2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac","67001fb2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac053061","67001fb2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac053061").map(Fn);const r_=ki(kb);var NI=new Array(3).concat("ef8a62ffffff999999","ca0020f4a582bababa404040","ca0020f4a582ffffffbababa404040","b2182bef8a62fddbc7e0e0e09999994d4d4d","b2182bef8a62fddbc7ffffffe0e0e09999994d4d4d","b2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d","b2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d","67001fb2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d1a1a1a","67001fb2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d1a1a1a").map(Fn);const jI=ki(NI);var Db=new Array(3).concat("fc8d59ffffbf91bfdb","d7191cfdae61abd9e92c7bb6","d7191cfdae61ffffbfabd9e92c7bb6","d73027fc8d59fee090e0f3f891bfdb4575b4","d73027fc8d59fee090ffffbfe0f3f891bfdb4575b4","d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4","d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4","a50026d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4313695","a50026d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4313695").map(Fn);const a_=ki(Db);var UI=new Array(3).concat("fc8d59ffffbf91cf60","d7191cfdae61a6d96a1a9641","d7191cfdae61ffffbfa6d96a1a9641","d73027fc8d59fee08bd9ef8b91cf601a9850","d73027fc8d59fee08bffffbfd9ef8b91cf601a9850","d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850","d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850","a50026d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850006837","a50026d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850006837").map(Fn);const VI=ki(UI);var GI=new Array(3).concat("fc8d59ffffbf99d594","d7191cfdae61abdda42b83ba","d7191cfdae61ffffbfabdda42b83ba","d53e4ffc8d59fee08be6f59899d5943288bd","d53e4ffc8d59fee08bffffbfe6f59899d5943288bd","d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd","d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd","9e0142d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd5e4fa2","9e0142d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd5e4fa2").map(Fn);const qI=ki(GI);var ZI=new Array(3).concat("e5f5f999d8c92ca25f","edf8fbb2e2e266c2a4238b45","edf8fbb2e2e266c2a42ca25f006d2c","edf8fbccece699d8c966c2a42ca25f006d2c","edf8fbccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45006d2c00441b").map(Fn);const HI=ki(ZI);var $I=new Array(3).concat("e0ecf49ebcda8856a7","edf8fbb3cde38c96c688419d","edf8fbb3cde38c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d810f7c4d004b").map(Fn);const WI=ki($I);var YI=new Array(3).concat("e0f3dba8ddb543a2ca","f0f9e8bae4bc7bccc42b8cbe","f0f9e8bae4bc7bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe0868ac084081").map(Fn);const XI=ki(YI);var QI=new Array(3).concat("fee8c8fdbb84e34a33","fef0d9fdcc8afc8d59d7301f","fef0d9fdcc8afc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301fb300007f0000").map(Fn);const KI=ki(QI);var JI=new Array(3).concat("ece2f0a6bddb1c9099","f6eff7bdc9e167a9cf02818a","f6eff7bdc9e167a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016c59014636").map(Fn);const e3=ki(JI);var t3=new Array(3).concat("ece7f2a6bddb2b8cbe","f1eef6bdc9e174a9cf0570b0","f1eef6bdc9e174a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0045a8d023858").map(Fn);const n3=ki(t3);var i3=new Array(3).concat("e7e1efc994c7dd1c77","f1eef6d7b5d8df65b0ce1256","f1eef6d7b5d8df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125698004367001f").map(Fn);const r3=ki(i3);var a3=new Array(3).concat("fde0ddfa9fb5c51b8a","feebe2fbb4b9f768a1ae017e","feebe2fbb4b9f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a017749006a").map(Fn);const o3=ki(a3);var s3=new Array(3).concat("edf8b17fcdbb2c7fb8","ffffcca1dab441b6c4225ea8","ffffcca1dab441b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea8253494081d58").map(Fn);const l3=ki(s3);var c3=new Array(3).concat("f7fcb9addd8e31a354","ffffccc2e69978c679238443","ffffccc2e69978c67931a354006837","ffffccd9f0a3addd8e78c67931a354006837","ffffccd9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443006837004529").map(Fn);const u3=ki(c3);var h3=new Array(3).concat("fff7bcfec44fd95f0e","ffffd4fed98efe9929cc4c02","ffffd4fed98efe9929d95f0e993404","ffffd4fee391fec44ffe9929d95f0e993404","ffffd4fee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c02993404662506").map(Fn);const f3=ki(h3);var d3=new Array(3).concat("ffeda0feb24cf03b20","ffffb2fecc5cfd8d3ce31a1c","ffffb2fecc5cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cbd0026800026").map(Fn);const p3=ki(d3);var m3=new Array(3).concat("deebf79ecae13182bd","eff3ffbdd7e76baed62171b5","eff3ffbdd7e76baed63182bd08519c","eff3ffc6dbef9ecae16baed63182bd08519c","eff3ffc6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b508519c08306b").map(Fn);const g3=ki(m3);var _3=new Array(3).concat("e5f5e0a1d99b31a354","edf8e9bae4b374c476238b45","edf8e9bae4b374c47631a354006d2c","edf8e9c7e9c0a1d99b74c47631a354006d2c","edf8e9c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45006d2c00441b").map(Fn);const y3=ki(_3);var v3=new Array(3).concat("f0f0f0bdbdbd636363","f7f7f7cccccc969696525252","f7f7f7cccccc969696636363252525","f7f7f7d9d9d9bdbdbd969696636363252525","f7f7f7d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525000000").map(Fn);const b3=ki(v3);var x3=new Array(3).concat("efedf5bcbddc756bb1","f2f0f7cbc9e29e9ac86a51a3","f2f0f7cbc9e29e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a354278f3f007d").map(Fn);const w3=ki(x3);var A3=new Array(3).concat("fee0d2fc9272de2d26","fee5d9fcae91fb6a4acb181d","fee5d9fcae91fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181da50f1567000d").map(Fn);const T3=ki(A3);var S3=new Array(3).concat("fee6cefdae6be6550d","feeddefdbe85fd8d3cd94701","feeddefdbe85fd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d94801a636037f2704").map(Fn);const M3=ki(S3);function C3(e){return e=Math.max(0,Math.min(1,e)),"rgb("+Math.max(0,Math.min(255,Math.round(-4.54-e*(35.34-e*(2381.73-e*(6402.7-e*(7024.72-e*2710.57)))))))+", "+Math.max(0,Math.min(255,Math.round(32.49+e*(170.73+e*(52.82-e*(131.46-e*(176.58-e*67.37)))))))+", "+Math.max(0,Math.min(255,Math.round(81.24+e*(442.36-e*(2482.43-e*(6167.24-e*(6614.94-e*2475.67)))))))+")"}const I3=F1(Yo(300,.5,0),Yo(-240,.5,1));var E3=F1(Yo(-100,.75,.35),Yo(80,1.5,.8)),P3=F1(Yo(260,.75,.35),Yo(80,1.5,.8)),Wm=Yo();function k3(e){(e<0||e>1)&&(e-=Math.floor(e));var t=Math.abs(e-.5);return Wm.h=360*e-100,Wm.s=1.5-1.5*t,Wm.l=.8-.9*t,Wm+""}var Ym=Sl(),bN=Math.PI/3,xN=Math.PI*2/3;function D3(e){var t;return e=(.5-e)*Math.PI,Ym.r=255*(t=Math.sin(e))*t,Ym.g=255*(t=Math.sin(e+bN))*t,Ym.b=255*(t=Math.sin(e+xN))*t,Ym+""}function z3(e){return e=Math.max(0,Math.min(1,e)),"rgb("+Math.max(0,Math.min(255,Math.round(34.61+e*(1172.33-e*(10793.56-e*(33300.12-e*(38394.49-e*14825.05)))))))+", "+Math.max(0,Math.min(255,Math.round(23.31+e*(557.33+e*(1225.33-e*(3574.96-e*(1073.77+e*707.56)))))))+", "+Math.max(0,Math.min(255,Math.round(27.2+e*(3211.1-e*(15327.97-e*(27814-e*(22569.18-e*6838.66)))))))+")"}function iy(e){var t=e.length;return function(r){return e[Math.max(0,Math.min(t-1,Math.floor(r*t)))]}}const R3=iy(Fn("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725"));var L3=iy(Fn("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf")),B3=iy(Fn("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4")),F3=iy(Fn("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921"));function Qu(e){return function(){return e}}const O3=Math.cos,H1=Math.min,o_=Math.sin,Ar=Math.sqrt,pT=1e-12,s_=Math.PI,ry=2*s_;function wN(e){let t=3;return e.digits=function(r){if(!arguments.length)return t;if(r==null)t=null;else{const o=Math.floor(r);if(!(o>=0))throw new RangeError(`invalid digits: ${r}`);t=o}return e},()=>new KC(t)}function AN(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function N3(e){this._context=e}N3.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function ay(e){return new N3(e)}function TN(e){return e[0]}function SN(e){return e[1]}function MN(e,t){var r=Qu(!0),o=null,u=ay,d=null,p=wN(a);e=typeof e=="function"?e:e===void 0?TN:Qu(e),t=typeof t=="function"?t:t===void 0?SN:Qu(t);function a(w){var T,S=(w=AN(w)).length,k,I=!1,P;for(o==null&&(d=u(P=p())),T=0;T<=S;++T)!(T<S&&r(k=w[T],T,w))===I&&((I=!I)?d.lineStart():d.lineEnd()),I&&d.point(+e(k,T,w),+t(k,T,w));if(P)return d=null,P+""||null}return a.x=function(w){return arguments.length?(e=typeof w=="function"?w:Qu(+w),a):e},a.y=function(w){return arguments.length?(t=typeof w=="function"?w:Qu(+w),a):t},a.defined=function(w){return arguments.length?(r=typeof w=="function"?w:Qu(!!w),a):r},a.curve=function(w){return arguments.length?(u=w,o!=null&&(d=u(o)),a):u},a.context=function(w){return arguments.length?(w==null?o=d=null:d=u(o=w),a):o},a}class j3{constructor(t,r){this._context=t,this._x=r}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(t,r){switch(t=+t,r=+r,this._point){case 0:{this._point=1,this._line?this._context.lineTo(t,r):this._context.moveTo(t,r);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+t)/2,this._y0,this._x0,r,t,r):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+r)/2,t,this._y0,t,r);break}}this._x0=t,this._y0=r}}function CN(e){return new j3(e,!0)}function IN(e){return new j3(e,!1)}const EN=Ar(3),U3={draw(e,t){const r=Ar(t+H1(t/28,.75))*.59436,o=r/2,u=o*EN;e.moveTo(0,r),e.lineTo(0,-r),e.moveTo(-u,-o),e.lineTo(u,o),e.moveTo(-u,o),e.lineTo(u,-o)}},$1={draw(e,t){const r=Ar(t/s_);e.moveTo(r,0),e.arc(0,0,r,0,ry)}},V3={draw(e,t){const r=Ar(t/5)/2;e.moveTo(-3*r,-r),e.lineTo(-r,-r),e.lineTo(-r,-3*r),e.lineTo(r,-3*r),e.lineTo(r,-r),e.lineTo(3*r,-r),e.lineTo(3*r,r),e.lineTo(r,r),e.lineTo(r,3*r),e.lineTo(-r,3*r),e.lineTo(-r,r),e.lineTo(-3*r,r),e.closePath()}},G3=Ar(1/3),PN=G3*2,q3={draw(e,t){const r=Ar(t/PN),o=r*G3;e.moveTo(0,-r),e.lineTo(o,0),e.lineTo(0,r),e.lineTo(-o,0),e.closePath()}},Z3={draw(e,t){const r=Ar(t)*.62625;e.moveTo(0,-r),e.lineTo(r,0),e.lineTo(0,r),e.lineTo(-r,0),e.closePath()}},H3={draw(e,t){const r=Ar(t-H1(t/7,2))*.87559;e.moveTo(-r,0),e.lineTo(r,0),e.moveTo(0,r),e.lineTo(0,-r)}},$3={draw(e,t){const r=Ar(t),o=-r/2;e.rect(o,o,r,r)}},W3={draw(e,t){const r=Ar(t)*.4431;e.moveTo(r,r),e.lineTo(r,-r),e.lineTo(-r,-r),e.lineTo(-r,r),e.closePath()}},kN=.8908130915292852,Y3=o_(s_/10)/o_(7*s_/10),DN=o_(ry/10)*Y3,zN=-O3(ry/10)*Y3,X3={draw(e,t){const r=Ar(t*kN),o=DN*r,u=zN*r;e.moveTo(0,-r),e.lineTo(o,u);for(let d=1;d<5;++d){const p=ry*d/5,a=O3(p),w=o_(p);e.lineTo(w*r,-a*r),e.lineTo(a*o-w*u,w*o+a*u)}e.closePath()}},hv=Ar(3),Q3={draw(e,t){const r=-Ar(t/(hv*3));e.moveTo(0,r*2),e.lineTo(-hv*r,-r),e.lineTo(hv*r,-r),e.closePath()}},RN=Ar(3),K3={draw(e,t){const r=Ar(t)*.6824,o=r/2,u=r*RN/2;e.moveTo(0,-r),e.lineTo(u,o),e.lineTo(-u,o),e.closePath()}},Va=-.5,Ga=Ar(3)/2,zb=1/Ar(12),LN=(zb/2+1)*3,J3={draw(e,t){const r=Ar(t/LN),o=r/2,u=r*zb,d=o,p=r*zb+r,a=-d,w=p;e.moveTo(o,u),e.lineTo(d,p),e.lineTo(a,w),e.lineTo(Va*o-Ga*u,Ga*o+Va*u),e.lineTo(Va*d-Ga*p,Ga*d+Va*p),e.lineTo(Va*a-Ga*w,Ga*a+Va*w),e.lineTo(Va*o+Ga*u,Va*u-Ga*o),e.lineTo(Va*d+Ga*p,Va*p-Ga*d),e.lineTo(Va*a+Ga*w,Va*w-Ga*a),e.closePath()}},eE={draw(e,t){const r=Ar(t-H1(t/6,1.7))*.6189;e.moveTo(-r,-r),e.lineTo(r,r),e.moveTo(-r,r),e.lineTo(r,-r)}},BN=[$1,V3,q3,$3,X3,Q3,J3],FN=[$1,H3,eE,K3,U3,W3,Z3];function Ml(){}function l_(e,t,r){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+r)/6)}function oy(e){this._context=e}oy.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:l_(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:l_(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function ON(e){return new oy(e)}function tE(e){this._context=e}tE.prototype={areaStart:Ml,areaEnd:Ml,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:l_(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function NN(e){return new tE(e)}function nE(e){this._context=e}nE.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var r=(this._x0+4*this._x1+e)/6,o=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(r,o):this._context.moveTo(r,o);break;case 3:this._point=4;default:l_(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function jN(e){return new nE(e)}function iE(e,t){this._basis=new oy(e),this._beta=t}iE.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var e=this._x,t=this._y,r=e.length-1;if(r>0)for(var o=e[0],u=t[0],d=e[r]-o,p=t[r]-u,a=-1,w;++a<=r;)w=a/r,this._basis.point(this._beta*e[a]+(1-this._beta)*(o+w*d),this._beta*t[a]+(1-this._beta)*(u+w*p));this._x=this._y=null,this._basis.lineEnd()},point:function(e,t){this._x.push(+e),this._y.push(+t)}};const UN=function e(t){function r(o){return t===1?new oy(o):new iE(o,t)}return r.beta=function(o){return e(+o)},r}(.85);function c_(e,t,r){e._context.bezierCurveTo(e._x1+e._k*(e._x2-e._x0),e._y1+e._k*(e._y2-e._y0),e._x2+e._k*(e._x1-t),e._y2+e._k*(e._y1-r),e._x2,e._y2)}function W1(e,t){this._context=e,this._k=(1-t)/6}W1.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:c_(this,this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2,this._x1=e,this._y1=t;break;case 2:this._point=3;default:c_(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const VN=function e(t){function r(o){return new W1(o,t)}return r.tension=function(o){return e(+o)},r}(0);function Y1(e,t){this._context=e,this._k=(1-t)/6}Y1.prototype={areaStart:Ml,areaEnd:Ml,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:c_(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const GN=function e(t){function r(o){return new Y1(o,t)}return r.tension=function(o){return e(+o)},r}(0);function X1(e,t){this._context=e,this._k=(1-t)/6}X1.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:c_(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const qN=function e(t){function r(o){return new X1(o,t)}return r.tension=function(o){return e(+o)},r}(0);function Q1(e,t,r){var o=e._x1,u=e._y1,d=e._x2,p=e._y2;if(e._l01_a>pT){var a=2*e._l01_2a+3*e._l01_a*e._l12_a+e._l12_2a,w=3*e._l01_a*(e._l01_a+e._l12_a);o=(o*a-e._x0*e._l12_2a+e._x2*e._l01_2a)/w,u=(u*a-e._y0*e._l12_2a+e._y2*e._l01_2a)/w}if(e._l23_a>pT){var T=2*e._l23_2a+3*e._l23_a*e._l12_a+e._l12_2a,S=3*e._l23_a*(e._l23_a+e._l12_a);d=(d*T+e._x1*e._l23_2a-t*e._l12_2a)/S,p=(p*T+e._y1*e._l23_2a-r*e._l12_2a)/S}e._context.bezierCurveTo(o,u,d,p,e._x2,e._y2)}function rE(e,t){this._context=e,this._alpha=t}rE.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var r=this._x2-e,o=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(r*r+o*o,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3;default:Q1(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const ZN=function e(t){function r(o){return t?new rE(o,t):new W1(o,0)}return r.alpha=function(o){return e(+o)},r}(.5);function aE(e,t){this._context=e,this._alpha=t}aE.prototype={areaStart:Ml,areaEnd:Ml,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(e,t){if(e=+e,t=+t,this._point){var r=this._x2-e,o=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(r*r+o*o,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:Q1(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const HN=function e(t){function r(o){return t?new aE(o,t):new Y1(o,0)}return r.alpha=function(o){return e(+o)},r}(.5);function oE(e,t){this._context=e,this._alpha=t}oE.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var r=this._x2-e,o=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(r*r+o*o,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Q1(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const $N=function e(t){function r(o){return t?new oE(o,t):new X1(o,0)}return r.alpha=function(o){return e(+o)},r}(.5);function sE(e){this._context=e}sE.prototype={areaStart:Ml,areaEnd:Ml,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}};function WN(e){return new sE(e)}function mT(e){return e<0?-1:1}function gT(e,t,r){var o=e._x1-e._x0,u=t-e._x1,d=(e._y1-e._y0)/(o||u<0&&-0),p=(r-e._y1)/(u||o<0&&-0),a=(d*u+p*o)/(o+u);return(mT(d)+mT(p))*Math.min(Math.abs(d),Math.abs(p),.5*Math.abs(a))||0}function _T(e,t){var r=e._x1-e._x0;return r?(3*(e._y1-e._y0)/r-t)/2:t}function fv(e,t,r){var o=e._x0,u=e._y0,d=e._x1,p=e._y1,a=(d-o)/3;e._context.bezierCurveTo(o+a,u+a*t,d-a,p-a*r,d,p)}function u_(e){this._context=e}u_.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:fv(this,this._t0,_T(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var r=NaN;if(e=+e,t=+t,!(e===this._x1&&t===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,fv(this,_T(this,r=gT(this,e,t)),r);break;default:fv(this,this._t0,r=gT(this,e,t));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=r}}};function lE(e){this._context=new cE(e)}(lE.prototype=Object.create(u_.prototype)).point=function(e,t){u_.prototype.point.call(this,t,e)};function cE(e){this._context=e}cE.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,r,o,u,d){this._context.bezierCurveTo(t,e,o,r,d,u)}};function YN(e){return new u_(e)}function XN(e){return new lE(e)}function uE(e){this._context=e}uE.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,r=e.length;if(r)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),r===2)this._context.lineTo(e[1],t[1]);else for(var o=yT(e),u=yT(t),d=0,p=1;p<r;++d,++p)this._context.bezierCurveTo(o[0][d],u[0][d],o[1][d],u[1][d],e[p],t[p]);(this._line||this._line!==0&&r===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}};function yT(e){var t,r=e.length-1,o,u=new Array(r),d=new Array(r),p=new Array(r);for(u[0]=0,d[0]=2,p[0]=e[0]+2*e[1],t=1;t<r-1;++t)u[t]=1,d[t]=4,p[t]=4*e[t]+2*e[t+1];for(u[r-1]=2,d[r-1]=7,p[r-1]=8*e[r-1]+e[r],t=1;t<r;++t)o=u[t]/d[t-1],d[t]-=o,p[t]-=o*p[t-1];for(u[r-1]=p[r-1]/d[r-1],t=r-2;t>=0;--t)u[t]=(p[t]-u[t+1])/d[t];for(d[r-1]=(e[r]+u[r-1])/2,t=0;t<r-1;++t)d[t]=2*e[t+1]-u[t+1];return[u,d]}function QN(e){return new uE(e)}function sy(e,t){this._context=e,this._t=t}sy.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var r=this._x*(1-this._t)+e*this._t;this._context.lineTo(r,this._y),this._context.lineTo(r,t)}break}}this._x=e,this._y=t}};function KN(e){return new sy(e,.5)}function JN(e){return new sy(e,0)}function ej(e){return new sy(e,1)}function Td(e,t,r){this.k=e,this.x=t,this.y=r}Td.prototype={constructor:Td,scale:function(e){return e===1?this:new Td(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new Td(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};Td.prototype;function Cl(e){return e!=null&&!Number.isNaN(e)}function $c(e,t){return+Cl(t)-+Cl(e)||_o(e,t)}function Rb(e,t){return+Cl(t)-+Cl(e)||cp(e,t)}function K1(e){return e!=null&&`${e}`!=""}function hE(e){return isFinite(e)?e:NaN}function J1(e){return e>0&&isFinite(e)?e:NaN}function fE(e){return e<0&&isFinite(e)?e:NaN}function tj(e,t){if(e instanceof Date||(e=new Date(+e)),isNaN(e))return typeof t=="function"?t(e):t;const r=e.getUTCHours(),o=e.getUTCMinutes(),u=e.getUTCSeconds(),d=e.getUTCMilliseconds();return`${nj(e.getUTCFullYear())}-${xs(e.getUTCMonth()+1,2)}-${xs(e.getUTCDate(),2)}${r||o||u||d?`T${xs(r,2)}:${xs(o,2)}${u||d?`:${xs(u,2)}${d?`.${xs(d,3)}`:""}`:""}Z`:""}`}function nj(e){return e<0?`-${xs(-e,6)}`:e>9999?`+${xs(e,6)}`:xs(e,4)}function xs(e,t){return`${e}`.padStart(t,"0")}const ij=/^(?:[-+]\d{2})?\d{4}(?:-\d{2}(?:-\d{2})?)?(?:T\d{2}:\d{2}(?::\d{2}(?:\.\d{3})?)?(?:Z|[-+]\d{2}:?\d{2})?)?$/;function dE(e,t){return ij.test(e+="")?new Date(e):typeof t=="function"?t(e):t}function kh(e){if(e==null)return;const t=e[0],r=e[e.length-1];return cp(t,r)}const rh=1e3,xl=rh*60,wl=xl*60,Xo=wl*24,Oo=Xo*7,Lc=Xo*30,gl=Xo*365,dv=[["millisecond",1],["2 milliseconds",2],["5 milliseconds",5],["10 milliseconds",10],["20 milliseconds",20],["50 milliseconds",50],["100 milliseconds",100],["200 milliseconds",200],["500 milliseconds",500],["second",rh],["5 seconds",5*rh],["15 seconds",15*rh],["30 seconds",30*rh],["minute",xl],["5 minutes",5*xl],["15 minutes",15*xl],["30 minutes",30*xl],["hour",wl],["3 hours",3*wl],["6 hours",6*wl],["12 hours",12*wl],["day",Xo],["2 days",2*Xo],["week",Oo],["2 weeks",2*Oo],["month",Lc],["3 months",3*Lc],["6 months",6*Lc],["year",gl],["2 years",2*gl],["5 years",5*gl],["10 years",10*gl],["20 years",20*gl],["50 years",50*gl],["100 years",100*gl]],ex=new Map([["second",rh],["minute",xl],["hour",wl],["day",Xo],["monday",Oo],["tuesday",Oo],["wednesday",Oo],["thursday",Oo],["friday",Oo],["saturday",Oo],["sunday",Oo],["week",Oo],["month",Lc],["year",gl]]),pE=new Map([["second",go],["minute",yp],["hour",vp],["day",Wc],["monday",Hd],["tuesday",dI],["wednesday",pI],["thursday",Zc],["friday",mI],["saturday",gI],["sunday",Eh],["week",Eh],["month",xp],["year",xo]]),tx=new Map([["second",go],["minute",Vh],["hour",bp],["day",ey],["monday",$d],["tuesday",_I],["wednesday",yI],["thursday",Hc],["friday",vI],["saturday",bI],["sunday",Ph],["week",Ph],["month",wp],["year",wo]]),Tp=Symbol("intervalDuration"),ly=Symbol("intervalType");for(const[e,t]of pE)t[Tp]=ex.get(e),t[ly]="time";for(const[e,t]of tx)t[Tp]=ex.get(e),t[ly]="utc";const Sd=[["year",wo,"utc"],["month",wp,"utc"],["day",ey,"utc",6*Lc],["hour",bp,"utc",3*Xo],["minute",Vh,"utc",6*wl],["second",go,"utc",30*xl]],yg=[["year",xo,"time"],["month",xp,"time"],["day",Wc,"time",6*Lc],["hour",vp,"time",3*Xo],["minute",yp,"time",6*wl],["second",go,"time",30*xl]],rj=[Sd[0],yg[0],Sd[1],yg[1],Sd[2],yg[2],...Sd.slice(3)];function mE(e){let t=`${e}`.toLowerCase();t.endsWith("s")&&(t=t.slice(0,-1));let r=1;const o=/^(?:(\d+)\s+)/.exec(t);switch(o&&(t=t.slice(o[0].length),r=+o[1]),t){case"quarter":t="month",r*=3;break;case"half":t="month",r*=6;break}let u=tx.get(t);if(!u)throw new Error(`unknown interval: ${e}`);if(r>1&&!u.every)throw new Error(`non-periodic interval: ${t}`);return[t,r]}function gE(e){return _E(mE(e),"time")}function nx(e){return _E(mE(e),"utc")}function _E([e,t],r){let o=(r==="time"?pE:tx).get(e);return t>1&&(o=o.every(t),o[Tp]=ex.get(e)*t,o[ly]=r),o}function vT(e,t){if(!(t>1))return;const r=e[Tp];if(!dv.some(([,u])=>u===r)||r%Xo===0&&Xo<r&&r<Lc)return;const[o]=dv[k_(([,u])=>Math.log(u)).center(dv,Math.log(r*t))];return(e[ly]==="time"?gE:nx)(o)}function bT(e,t,r){const o=t==="time"?q1:Ap;if(r==null)return o(e==="year"?"%Y":e==="month"?"%Y-%m":e==="day"?"%Y-%m-%d":e==="hour"||e==="minute"?"%Y-%m-%dT%H:%M":e==="second"?"%Y-%m-%dT%H:%M:%S":"%Y-%m-%dT%H:%M:%S.%L");const u=aj(r);switch(e){case"millisecond":return Ku(o(".%L"),o(":%M:%S"),u);case"second":return Ku(o(":%S"),o("%-I:%M"),u);case"minute":return Ku(o("%-I:%M"),o("%p"),u);case"hour":return Ku(o("%-I %p"),o("%b %-d"),u);case"day":return Ku(o("%-d"),o("%b"),u);case"month":return Ku(o("%b"),o("%Y"),u);case"year":return o("%Y")}throw new Error("unable to format time ticks")}function aj(e){return e==="left"||e==="right"?(t,r)=>`
${t}
${r}`:e==="top"?(t,r)=>`${r}
${t}`:(t,r)=>`${t}
${r}`}function oj(e){return e==="time"?yg:e==="utc"?Sd:rj}function sj(e,t,r){const o=Ja(jz(t,(u,d)=>Math.abs(d-u)));if(o<1e3)return bT("millisecond","utc",r);for(const[u,d,p,a]of oj(e)){if(o>a||u==="hour"&&!o)break;if(t.every(w=>d.floor(w)>=w))return bT(u,p,r)}}function Ku(e,t,r){return(o,u,d)=>{const p=e(o,u),a=t(o,u),w=u-kh(d);return u!==w&&d[w]!==void 0&&a===t(d[w],w)?p:r(p,a)}}const ix=Object.getPrototypeOf(Uint8Array),lj=Object.prototype.toString;function Sp(e){return e instanceof Array||e instanceof ix}function yE(e){return e instanceof ix&&!cj(e)}function vE(e){return(e==null?void 0:e.prototype)instanceof ix&&!uj(e)}function cj(e){return e instanceof BigInt64Array||e instanceof BigUint64Array}function uj(e){return e===BigInt64Array||e===BigUint64Array}const hj=Symbol("reindex");function ta(e,t,r){const o=typeof t;return o==="string"?zE(e)?rx(e.getChild(t),r):xT(e,dj(t),r):o==="function"?xT(e,t,r):o==="number"||t instanceof Date||o==="boolean"?pr(e,Cs(t),r):typeof(t==null?void 0:t.transform)=="function"?Lb(t.transform(e),r):fj(Lb(t,r),e==null?void 0:e[hj])}function fj(e,t){return e!=null&&t?cy(e,t):e}function xT(e,t,r){return pr(e,vE(r)?(o,u)=>ax(t(o,u)):t,r)}function Lb(e,t){return t===void 0?Qc(e):RE(e)?rx(e,t):e instanceof t?e:t.from(e,vE(t)&&!yE(e)?ax:void 0)}function rx(e,t){return e==null?e:(t===void 0||t===Array)&&kj(e.type)?wE(wT(e)):Lb(wT(e),t)}function wT(e){return e.nullCount?e.toJSON():e.toArray()}const vg=[null],dj=e=>t=>{var o;const r=t[e];return r===void 0&&t.type==="Feature"?(o=t.properties)==null?void 0:o[e]:r},bE={transform:Gh},Ba={transform:e=>e},pj=()=>!0,Jr=e=>e==null?e:`${e}`,na=e=>e==null?e:+e,xE=e=>e?e[0]:void 0,Bb=e=>e?e[1]:void 0,Cs=e=>()=>e;function mj(e){const t=+`${e}`.slice(1)/100;return(r,o)=>vh(r,t,o)}function Dh(e){return yE(e)?e:pr(e,ax,Float64Array)}function ax(e){return e==null?NaN:Number(e)}function wE(e){return pr(e,AE)}function AE(e){return e instanceof Date&&!isNaN(e)?e:typeof e=="string"?dE(e):e==null||isNaN(e=Number(e))?void 0:new Date(e)}function zs(e,t){return e===void 0&&(e=t),e===null?[void 0,"none"]:uy(e)?[void 0,e]:[e,void 0]}function Pa(e,t){return e===void 0&&(e=t),e===null||typeof e=="number"?[void 0,e]:[e,void 0]}function TE(e,t,r){if(e!=null)return To(e,t,r)}function To(e,t,r){const o=`${e}`.toLowerCase();if(!r.includes(o))throw new Error(`invalid ${t}: ${e}`);return o}function zh(e){return zE(e)?e:Qc(e)}function Qc(e){if(e==null||Sp(e))return e;if(RE(e))return rx(e);if(SE(e))switch(e.type){case"FeatureCollection":return e.features;case"GeometryCollection":return e.geometries;default:return[e]}return Array.from(e)}function SE(e){switch(e==null?void 0:e.type){case"FeatureCollection":case"GeometryCollection":case"Feature":case"LineString":case"MultiLineString":case"MultiPoint":case"MultiPolygon":case"Point":case"Polygon":case"Sphere":return!0;default:return!1}}function pr(e,t,r=Array){return e==null?e:e instanceof r?e.map(t):r.from(e,t)}function Fb(e,t=Array){return e instanceof t?e.slice():t.from(e)}function Rs(e){return(e==null?void 0:e.toString)===lj}function Ob(e){return Rs(e)&&(e.type!==void 0||e.domain!==void 0)}function ox(e){return Rs(e)&&typeof e.transform!="function"}function Wd(e){return ox(e)&&e.value===void 0&&e.channel===void 0}function ME(e,t){return e===void 0&&t===void 0?[xE,Bb]:[e,t]}function CE({z:e,fill:t,stroke:r}={}){return e===void 0&&([e]=zs(t)),e===void 0&&([e]=zs(r)),e}function Nb(e){return Sp(e)?e.length:e==null?void 0:e.numRows}function Gh(e){const t=Nb(e),r=new Uint32Array(t);for(let o=0;o<t;++o)r[o]=o;return r}function cy(e,t){return Sp(e)?pr(t,r=>e[r],e.constructor):pr(t,r=>e.at(r))}function gj(e){return e.length===1?(t,r)=>e(cy(r,t)):e}function _j(e,t,r){return e.subarray?e.subarray(t,r):e.slice(t,r)}function Is(e){return e!==null&&typeof e=="object"?e.valueOf():e}function IE(e,t){if(t[e]!==void 0)return t[e];switch(e){case"x1":case"x2":e="x";break;case"y1":case"y2":e="y";break}return t[e]}function sx(e){let t;return[{transform:()=>t,label:Kc(e)},r=>t=r]}function pl(e){return e==null?[e]:sx(e)}function Kc(e,t){return typeof e=="string"?e:e&&e.label!==void 0?e.label:t}function AT(e,t){return{transform(r){const o=e.transform(r),u=t.transform(r);return va(o)||va(u)?pr(o,(d,p)=>new Date((+o[p]+ +u[p])/2)):pr(o,(d,p)=>(+o[p]+ +u[p])/2,Float64Array)},label:e.label}}function yj(e,t){const r=EE(t==null?void 0:t.interval,t==null?void 0:t.type);return r?pr(e,r):e}function EE(e,t){const r=lx(e,t);return r&&(o=>Cl(o)?r.floor(o):o)}function lx(e,t){if(e!=null){if(typeof e=="number")return vj(e);if(typeof e=="string")return(t==="time"?gE:nx)(e);if(typeof e.floor!="function")throw new Error("invalid interval; missing floor method");if(typeof e.offset!="function")throw new Error("invalid interval; missing offset method");return e}}function vj(e){e=+e,0<e&&e<1&&Number.isInteger(1/e)&&(e=-1/e);const t=Math.abs(e);return e<0?{floor:r=>Math.floor(r*t)/t,offset:(r,o=1)=>(r*t+Math.floor(o))/t,range:(r,o)=>Qv(Math.ceil(r*t),o*t).map(u=>u/t)}:{floor:r=>Math.floor(r/t)*t,offset:(r,o=1)=>r+t*Math.floor(o),range:(r,o)=>Qv(Math.ceil(r/t),o/t).map(u=>u*t)}}function qh(e,t){if(e=lx(e,t),e&&typeof e.range!="function")throw new Error("invalid interval: missing range method");return e}function bj(e,t){if(e=qh(e,t),e&&typeof e.ceil!="function")throw new Error("invalid interval: missing ceil method");return e}function xj(e){return ah(e)&&typeof(e==null?void 0:e.floor)=="function"&&e.floor()instanceof Date}function ah(e){return typeof(e==null?void 0:e.range)=="function"}function Mp(e){return e===void 0||ox(e)?e:{value:e}}function wj(e){return e==null?null:{transform:t=>ta(t,e,Float64Array),label:Kc(e)}}function kl(e){return e&&typeof e[Symbol.iterator]=="function"}function PE(e){for(const t of e)if(t!=null)return typeof t!="object"||t instanceof Date}function TT(e){for(const t of e){if(t==null)continue;const r=typeof t;return r==="string"||r==="boolean"}}function va(e){for(const t of e)if(t!=null)return t instanceof Date}function Aj(e){for(const t of e)if(t!=null)return typeof t=="string"&&isNaN(t)&&dE(t)}function Tj(e){for(const t of e)if(t!=null){if(typeof t!="string")return!1;if(t.trim())return!isNaN(t)}}function Sj(e){for(const t of e)if(t!=null)return typeof t=="number"}function pv(e,t){let r;for(const o of e)if(o!=null){if(!t(o))return!1;r=!0}return r}const Mj=new Set("none,currentcolor,transparent,aliceblue,antiquewhite,aqua,aquamarine,azure,beige,bisque,black,blanchedalmond,blue,blueviolet,brown,burlywood,cadetblue,chartreuse,chocolate,coral,cornflowerblue,cornsilk,crimson,cyan,darkblue,darkcyan,darkgoldenrod,darkgray,darkgreen,darkgrey,darkkhaki,darkmagenta,darkolivegreen,darkorange,darkorchid,darkred,darksalmon,darkseagreen,darkslateblue,darkslategray,darkslategrey,darkturquoise,darkviolet,deeppink,deepskyblue,dimgray,dimgrey,dodgerblue,firebrick,floralwhite,forestgreen,fuchsia,gainsboro,ghostwhite,gold,goldenrod,gray,green,greenyellow,grey,honeydew,hotpink,indianred,indigo,ivory,khaki,lavender,lavenderblush,lawngreen,lemonchiffon,lightblue,lightcoral,lightcyan,lightgoldenrodyellow,lightgray,lightgreen,lightgrey,lightpink,lightsalmon,lightseagreen,lightskyblue,lightslategray,lightslategrey,lightsteelblue,lightyellow,lime,limegreen,linen,magenta,maroon,mediumaquamarine,mediumblue,mediumorchid,mediumpurple,mediumseagreen,mediumslateblue,mediumspringgreen,mediumturquoise,mediumvioletred,midnightblue,mintcream,mistyrose,moccasin,navajowhite,navy,oldlace,olive,olivedrab,orange,orangered,orchid,palegoldenrod,palegreen,paleturquoise,palevioletred,papayawhip,peachpuff,peru,pink,plum,powderblue,purple,rebeccapurple,red,rosybrown,royalblue,saddlebrown,salmon,sandybrown,seagreen,seashell,sienna,silver,skyblue,slateblue,slategray,slategrey,snow,springgreen,steelblue,tan,teal,thistle,tomato,turquoise,violet,wheat,white,whitesmoke,yellow".split(","));function uy(e){return typeof e!="string"?!1:(e=e.toLowerCase().trim(),/^#[0-9a-f]{3,8}$/.test(e)||/^(?:url|var|rgb|rgba|hsl|hsla|hwb|lab|lch|oklab|oklch|color|color-mix)\(.*\)$/.test(e)||Mj.has(e))}function Cj(e){return typeof e=="number"&&(0<=e&&e<=1||isNaN(e))}function _a(e){return e==null||Yd(e)}function Yd(e){return/^\s*none\s*$/i.test(e)}function Ij(e){return/^\s*round\s*$/i.test(e)}function jb(e,t){return TE(e,t,["middle","top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"])}function cx(e="middle"){return jb(e,"frameAnchor")}function Ej(e={},...t){let r=e;for(const o of t)for(const u in o)if(r[u]===void 0){const d=o[u];r===e?r={...r,[u]:d}:r[u]=d}return r}function Pj(e){console.warn("named iterables are deprecated; please use an object instead");const t=new Set;return Object.fromEntries(Array.from(e,r=>{const{name:o}=r;if(o==null)throw new Error("missing name");const u=`${o}`;if(u==="__proto__")throw new Error(`illegal name: ${u}`);if(t.has(u))throw new Error(`duplicate name: ${u}`);return t.add(u),[o,r]}))}function kE(e){return kl(e)?Pj(e):e}function DE(e){return e===!0?e="frame":e===!1?e=null:!SE(e)&&e!=null&&(e=To(e,"clip",["frame","sphere"]),e==="sphere"&&(e={type:"Sphere"})),e}function zE(e){return e&&typeof e.getChild=="function"&&typeof e.toArray=="function"&&e.schema&&Array.isArray(e.schema.fields)}function RE(e){return e&&typeof e.toArray=="function"&&e.type}function kj(e){return e&&(e.typeId===8||e.typeId===10)&&e.unit===1}const qo=Symbol("position"),Ls=Symbol("color"),Cp=Symbol("radius"),Ip=Symbol("length"),Ep=Symbol("opacity"),hy=Symbol("symbol"),LE=Symbol("projection"),Xi=new Map([["x",qo],["y",qo],["fx",qo],["fy",qo],["r",Cp],["color",Ls],["opacity",Ep],["symbol",hy],["length",Ip],["projection",LE]]);function Dj(e){return e===qo||e===LE}function zj(e){return e===qo||e===Cp||e===Ip||e===Ep}const Rj=Math.sqrt(3),Lj=2/Rj,Bj={draw(e,t){const r=Math.sqrt(t/Math.PI),o=r*Lj,u=o/2;e.moveTo(0,o),e.lineTo(r,u),e.lineTo(r,-u),e.lineTo(0,-o),e.lineTo(-r,-u),e.lineTo(-r,u),e.closePath()}},BE=new Map([["asterisk",U3],["circle",$1],["cross",V3],["diamond",q3],["diamond2",Z3],["hexagon",Bj],["plus",H3],["square",$3],["square2",W3],["star",X3],["times",eE],["triangle",Q3],["triangle2",K3],["wye",J3]]);function FE(e){return e&&typeof e.draw=="function"}function Fj(e){return FE(e)?!0:typeof e!="string"?!1:BE.has(e.toLowerCase())}function ux(e){if(e==null||FE(e))return e;const t=BE.get(`${e}`.toLowerCase());if(t)return t;throw new Error(`invalid symbol: ${e}`)}function hx({filter:e,sort:t,reverse:r,transform:o,initializer:u,...d}={},p){if(o===void 0&&(e!=null&&(o=OE(e)),t!=null&&!Wd(t)&&(o=mv(o,jE(t))),r&&(o=mv(o,NE))),p!=null&&u!=null)throw new Error("transforms cannot be applied after initializers");return{...d,...(t===null||Wd(t))&&{sort:t},transform:mv(o,p)}}function h_({filter:e,sort:t,reverse:r,initializer:o,...u}={},d){return o===void 0&&(e!=null&&(o=OE(e)),t!=null&&!Wd(t)&&(o=gv(o,jE(t))),r&&(o=gv(o,NE))),{...u,...(t===null||Wd(t))&&{sort:t},initializer:gv(o,d)}}function mv(e,t){return e==null?t===null?void 0:t:t==null?e===null?void 0:e:function(r,o,u){return{data:r,facets:o}=e.call(this,r,o,u),t.call(this,zh(r),o,u)}}function gv(e,t){return e==null?t===null?void 0:t:t==null?e===null?void 0:e:function(r,o,u,...d){let p,a,w,T,S,k;return{data:a=r,facets:w=o,channels:p}=e.call(this,r,o,u,...d),{data:S=a,facets:k=w,channels:T}=t.call(this,a,w,{...u,...p},...d),{data:S,facets:k,channels:{...p,...T}}}}function OE(e){return(t,r)=>{const o=ta(t,e);return{data:t,facets:r.map(u=>u.filter(d=>o[d]))}}}function NE(e,t){return{data:e,facets:t.map(r=>r.slice().reverse())}}function jE(e){return(typeof e=="function"&&e.length!==1?Oj:Nj)(e)}function Oj(e){return(t,r)=>{const o=Sp(t)?(u,d)=>e(t[u],t[d]):(u,d)=>e(t.get(u),t.get(d));return{data:t,facets:r.map(u=>u.slice().sort(o))}}}function Nj(e){let t,r;({channel:t,value:e,order:r}={...Mp(e)});const o=t==null?void 0:t.startsWith("-");if(o&&(t=t.slice(1)),r===void 0&&(r=o?Rb:$c),typeof r!="function")switch(`${r}`.toLowerCase()){case"ascending":r=$c;break;case"descending":r=Rb;break;default:throw new Error(`invalid order: ${r}`)}return(u,d,p)=>{let a;if(t===void 0)a=ta(u,e);else{if(p===void 0)throw new Error("channel sort requires an initializer");if(a=p[t],!a)return{};a=a.value}const w=(T,S)=>r(a[T],a[S]);return{data:u,facets:d.map(T=>T.slice().sort(w))}}}function _v(e,...t){for(const{name:r}of e)if(t.includes(r))return!0;return!1}function jj(e,t,r=UE){const o=Object.entries(e);return t.title!=null&&e.title===void 0&&o.push(["title",$j]),t.href!=null&&e.href===void 0&&o.push(["href",dx]),o.filter(([,u])=>u!==void 0).map(([u,d])=>d===null?Uj(u):r(u,d,t))}function UE(e,t,r,o=VE){let u;Rs(t)&&"reduce"in t&&(u=t.scale,t=t.reduce);const d=o(e,t,r),[p,a]=sx(d.label);let w;return{name:e,output:u===void 0?p:{value:p,scale:u},initialize(T){d.initialize(T),w=a([])},scope(T,S){d.scope(T,S)},reduce(T,S){w.push(d.reduce(T,S))}}}function Uj(e){return{name:e,initialize(){},scope(){},reduce(){}}}function VE(e,t,r,o=fx){const u=IE(e,r),d=o(t,u);let p,a;return{label:Kc(d===f_?null:u,d.label),initialize(w){p=u===void 0?w:ta(w,u),d.scope==="data"&&(a=d.reduceIndex(Gh(w),p))},scope(w,T){d.scope===w&&(a=d.reduceIndex(T,p))},reduce(w,T){return d.scope==null?d.reduceIndex(w,p,T):d.reduceIndex(w,p,a,T)}}}function ST(e,t){return t?g1(e,r=>t[r]):[[,e]]}function fx(e,t,r=Vj){if(e==null)return r(e);if(typeof e.reduceIndex=="function")return e;if(typeof e.reduce=="function"&&Rs(e))return Zj(e);if(typeof e=="function")return Hj(e);if(/^p\d{2}$/i.test(e))return vs(mj(e));switch(`${e}`.toLowerCase()){case"first":return dx;case"last":return Wj;case"identity":return GE;case"count":return f_;case"distinct":return Yj;case"sum":return t==null?f_:Xj;case"proportion":return CT(t,"data");case"proportion-facet":return CT(t,"facet");case"deviation":return vs(uM);case"min":return vs(Oc);case"min-index":return vs(Rz);case"max":return vs(Ja);case"max-index":return vs(zz);case"mean":return MT(Fz);case"median":return MT(Xv);case"variance":return vs(cM);case"mode":return vs(Nz)}return r(e)}function Vj(e){throw new Error(`invalid reduce: ${e}`)}function Gj(e,t){for(const r in t){const o=t[r];if(o!==void 0&&!e.some(u=>u.name===r))return o}}function qj(e,t,r){if(t){const o=t.output.transform(),u=(d,p)=>$c(o[d],o[p]);e.forEach(d=>d.sort(u))}r&&e.forEach(o=>o.reverse())}function Zj(e){return console.warn("deprecated reduce interface; implement reduceIndex instead."),{...e,reduceIndex:e.reduce.bind(e)}}function Hj(e){return{reduceIndex(t,r,o){return e(cy(r,t),o)}}}function vs(e){return{reduceIndex(t,r){return e(t,o=>r[o])}}}function MT(e){return{reduceIndex(t,r){const o=e(t,u=>r[u]);return va(r)?new Date(o):o}}}const GE={reduceIndex(e,t){return cy(t,e)}},dx={reduceIndex(e,t){return t[e[0]]}},$j={reduceIndex(e,t){const o=pM(dg(e,d=>d.length,d=>t[d]),Bb),u=o.slice(-5).reverse();if(u.length<o.length){const d=o.slice(0,-4);u[4]=[`â¦ ${d.length.toLocaleString("en-US")} more`,L_(d,Bb)]}return u.map(([d,p])=>`${d} (${p.toLocaleString("en-US")})`).join(`
`)}},Wj={reduceIndex(e,t){return t[e[e.length-1]]}},f_={label:"Frequency",reduceIndex(e){return e.length}},Yj={label:"Distinct",reduceIndex(e,t){const r=new R_;for(const o of e)r.add(t[o]);return r.size}},Xj=vs(L_);function CT(e,t){return e==null?{scope:t,label:"Frequency",reduceIndex:(r,o,u=1)=>r.length/u}:{scope:t,reduceIndex:(r,o,u=1)=>L_(r,d=>o[d])/u}}const Qj={reduceIndex(e,t,{z:r}){return r}};function Xd(e,{scale:t,type:r,value:o,filter:u,hint:d,label:p=Kc(o)},a){return d===void 0&&typeof(o==null?void 0:o.transform)=="function"&&(d=o.hint),qE(a,{scale:t,type:r,value:ta(e,o),label:p,filter:u,hint:d})}function Kj(e,t){return Object.fromEntries(Object.entries(e).map(([r,o])=>[r,Xd(t,o,r)]))}function Jj(e,t){const r=Object.fromEntries(Object.entries(e).map(([o,{scale:u,value:d}])=>{const p=u==null?null:t[u];return[o,p==null?d:pr(d,p)]}));return r.channels=e,r}function qE(e,t){const{scale:r,value:o}=t;if(r===!0||r==="auto")switch(e){case"fill":case"stroke":case"color":t.scale=r!==!0&&pv(o,uy)?null:"color",t.defaultScale="color";break;case"fillOpacity":case"strokeOpacity":case"opacity":t.scale=r!==!0&&pv(o,Cj)?null:"opacity",t.defaultScale="opacity";break;case"symbol":r!==!0&&pv(o,Fj)?(t.scale=null,t.value=pr(o,ux)):t.scale="symbol",t.defaultScale="symbol";break;default:t.scale=Xi.has(e)?e:null;break}else if(r===!1)t.scale=null;else if(r!=null&&!Xi.has(r))throw new Error(`unknown scale: ${r}`);return t}function eU(e,t,r,o,u){const{order:d,reverse:p,reduce:a=!0,limit:w}=u;for(const T in u){if(!Xi.has(T))continue;let{value:S,order:k=d,reverse:I=p,reduce:P=a,limit:F=w}=Mp(u[T]);const G=S==null?void 0:S.startsWith("-");if(G&&(S=S.slice(1)),k=k===void 0?G!==(S==="width"||S==="height")?HE:ZE:iU(k),P==null||P===!1)continue;const H=T==="fx"||T==="fy"?nU(t,o[T]):tU(r,T);if(!H)throw new Error(`missing channel for scale: ${T}`);const Y=H.value,[$=0,ae=1/0]=kl(F)?F:F<0?[F]:[0,F];if(S==null)H.domain=()=>{let ee=Array.from(new R_(Y));return I&&(ee=ee.reverse()),($!==0||ae!==1/0)&&(ee=ee.slice($,ae)),ee};else{const ee=S==="data"?e:S==="height"?IT(r,"y1","y2"):S==="width"?IT(r,"x1","x2"):Ub(r,S,S==="y"?"y2":S==="x"?"x2":void 0),ce=fx(P===!0?"max":P,ee);H.domain=()=>{let re=Cz(Gh(Y),he=>ce.reduceIndex(he,ee),he=>Y[he]);return k&&re.sort(k),I&&re.reverse(),($!==0||ae!==1/0)&&(re=re.slice($,ae)),re.map(xE)}}}}function tU(e,t){for(const r in e){const o=e[r];if(o.scale===t)return o}}function nU(e,t){const r=e.original;if(r===e)return t;const o=t.value,u=t.value=[];for(let d=0;d<r.length;++d){const p=o[r[d][0]];for(const a of e[d])u[a]=p}return t}function IT(e,t,r){const o=Ub(e,t),u=Ub(e,r);return pr(u,(d,p)=>Math.abs(d-o[p]),Float64Array)}function Ub(e,t,r){let o=e[t];if(!o&&r!==void 0&&(o=e[r]),o)return o.value;throw new Error(`missing channel: ${t}`)}function iU(e){if(e==null||typeof e=="function")return e;switch(`${e}`.toLowerCase()){case"ascending":return ZE;case"descending":return HE}throw new Error(`invalid order: ${e}`)}function ZE([e,t],[r,o]){return $c(t,o)||$c(e,r)}function HE([e,t],[r,o]){return Rb(t,o)||$c(e,r)}function ET(e,t){let r=e[t];if(r){for(;r.source;)r=r.source;return r.source===null?null:r}}const $E=new Map([["accent",uN],["category10",cN],["dark2",hN],["observable10",fN],["paired",dN],["pastel1",pN],["pastel2",mN],["set1",gN],["set2",_N],["set3",yN],["tableau10",vN]]);function rU(e){return e!=null&&$E.has(`${e}`.toLowerCase())}const PT=new Map([...$E,["brbg",gs(kI,DI)],["prgn",gs(zI,RI)],["piyg",gs(LI,BI)],["puor",gs(FI,OI)],["rdbu",gs(kb,r_)],["rdgy",gs(NI,jI)],["rdylbu",gs(Db,a_)],["rdylgn",gs(UI,VI)],["spectral",gs(GI,qI)],["burd",kT(kb,r_)],["buylrd",kT(Db,a_)],["blues",Er(m3,g3)],["greens",Er(_3,y3)],["greys",Er(v3,b3)],["oranges",Er(S3,M3)],["purples",Er(x3,w3)],["reds",Er(A3,T3)],["turbo",_s(z3)],["viridis",_s(R3)],["magma",_s(L3)],["inferno",_s(B3)],["plasma",_s(F3)],["cividis",_s(C3)],["cubehelix",_s(I3)],["warm",_s(E3)],["cool",_s(P3)],["bugn",Er(ZI,HI)],["bupu",Er($I,WI)],["gnbu",Er(YI,XI)],["orrd",Er(QI,KI)],["pubu",Er(t3,n3)],["pubugn",Er(JI,e3)],["purd",Er(i3,r3)],["rdpu",Er(a3,o3)],["ylgn",Er(c3,u3)],["ylgnbu",Er(s3,l3)],["ylorbr",Er(h3,f3)],["ylorrd",Er(d3,p3)],["rainbow",DT(k3)],["sinebow",DT(D3)]]);function Er(e,t){return({length:r})=>r===1?[e[3][1]]:r===2?[e[3][1],e[3][2]]:(r=Math.max(3,Math.floor(r)),r>9?bo(t,r):e[r])}function gs(e,t){return({length:r})=>r===2?[e[3][0],e[3][2]]:(r=Math.max(3,Math.floor(r)),r>11?bo(t,r):e[r])}function kT(e,t){return({length:r})=>r===2?[e[3][2],e[3][0]]:(r=Math.max(3,Math.floor(r)),r>11?bo(o=>t(1-o),r):e[r].slice().reverse())}function _s(e){return({length:t})=>bo(e,Math.max(2,Math.floor(t)))}function DT(e){return({length:t})=>bo(e,Math.floor(t)+1).slice(0,-1)}function WE(e){const t=`${e}`.toLowerCase();if(!PT.has(t))throw new Error(`unknown ordinal scheme: ${t}`);return PT.get(t)}function fy(e,t){const r=WE(e),o=typeof r=="function"?r({length:t}):r;return o.length!==t?o.slice(0,t):o}function aU(e,t="greys"){const r=new Set,[o,u]=fy(t,2);for(const d of e)if(d!=null)if(d===!0)r.add(u);else if(d===!1)r.add(o);else return;return[...r]}const zT=new Map([["brbg",DI],["prgn",RI],["piyg",BI],["puor",OI],["rdbu",r_],["rdgy",jI],["rdylbu",a_],["rdylgn",VI],["spectral",qI],["burd",e=>r_(1-e)],["buylrd",e=>a_(1-e)],["blues",g3],["greens",y3],["greys",b3],["purples",w3],["reds",T3],["oranges",M3],["turbo",z3],["viridis",R3],["magma",L3],["inferno",B3],["plasma",F3],["cividis",C3],["cubehelix",I3],["warm",E3],["cool",P3],["bugn",HI],["bupu",WI],["gnbu",XI],["orrd",KI],["pubugn",e3],["pubu",n3],["purd",r3],["rdpu",o3],["ylgnbu",l3],["ylgn",u3],["ylorbr",f3],["ylorrd",p3],["rainbow",k3],["sinebow",D3]]);function px(e){const t=`${e}`.toLowerCase();if(!zT.has(t))throw new Error(`unknown quantitative scheme: ${t}`);return zT.get(t)}const oU=new Set(["brbg","prgn","piyg","puor","rdbu","rdgy","rdylbu","rdylgn","spectral","burd","buylrd"]);function sU(e){return e!=null&&oU.has(`${e}`.toLowerCase())}const YE=e=>t=>e(1-t),yv=[0,1],RT=new Map([["number",Kr],["rgb",Gc],["hsl",dO],["hcl",gO],["lab",pO]]);function XE(e){const t=`${e}`.toLowerCase();if(!RT.has(t))throw new Error(`unknown interpolator: ${t}`);return RT.get(t)}function Pp(e,t,r,{type:o,nice:u,clamp:d,zero:p,domain:a=KE(e,r),unknown:w,round:T,scheme:S,interval:k,range:I=Xi.get(e)===Cp?yU(r,a):Xi.get(e)===Ip?vU(r,a):Xi.get(e)===Ep?yv:void 0,interpolate:P=Xi.get(e)===Ls?S==null&&I!==void 0?Gc:px(S!==void 0?S:o==="cyclical"?"rainbow":"turbo"):T?B1:Kr,reverse:F}){if(a=LT(a),k=qh(k,o),(o==="cyclical"||o==="sequential")&&(o="linear"),typeof P!="function"&&(P=XE(P)),F=!!F,I!==void 0){const G=a.length,H=(I=LT(I)).length;if(G!==H){if(P.length===1)throw new Error("invalid piecewise interpolator");P=H_(P,I),I=void 0}}if(P.length===1?(F&&(P=YE(P),F=!1),I===void 0&&(I=Float64Array.from(a,(G,H)=>H/(a.length-1)),I.length===2&&(I=yv)),t.interpolate((I===yv?Cs:gx)(P))):t.interpolate(P),p){const[G,H]=Wa(a);(G>0||H<0)&&(a=Fb(a),(kh(a)||1)===Math.sign(G)?a[0]=0:a[a.length-1]=0)}return F&&(a=Dg(a)),t.domain(a).unknown(w),u&&(t.nice(lU(u,o)),a=t.domain()),I!==void 0&&t.range(I),d&&t.clamp(d),{type:o,domain:a,range:I,scale:t,interpolate:P,interval:k}}function LT(e){return e=Qc(e),e.length>=2?e:[e[0],e[0]]}function lU(e,t){return e===!0?void 0:typeof e=="number"?e:bj(e,t)}function cU(e,t,r){return Pp(e,K_(),t,r)}function uU(e,t,r){return QE(e,t,{...r,exponent:.5})}function QE(e,t,{exponent:r=1,...o}){return Pp(e,uI().exponent(r),t,{...o,type:"pow"})}function hU(e,t,{base:r=10,domain:o=bU(t),...u}){return Pp(e,oI().base(r),t,{...u,domain:o})}function fU(e,t,{constant:r=1,...o}){return Pp(e,lI().constant(r),t,o)}function dU(e,t,{range:r,quantiles:o=r===void 0?5:(r=[...r]).length,n:u=o,scheme:d="rdylbu",domain:p=xU(t),unknown:a,interpolate:w,reverse:T}){return r===void 0&&(r=w!==void 0?bo(w,u):Xi.get(e)===Ls?fy(d,u):void 0),p.length>0&&(p=hI(p,r===void 0?{length:u}:r).quantiles()),mx(e,t,{domain:p,range:r,reverse:T,unknown:a})}function pU(e,t,{range:r,n:o=r===void 0?5:(r=[...r]).length,scheme:u="rdylbu",domain:d=KE(e,t),unknown:p,interpolate:a,reverse:w}){const[T,S]=Wa(d);let k;return r===void 0?(k=Od(T,S,o),k[0]<=T&&k.splice(0,1),k[k.length-1]>=S&&k.pop(),o=k.length+1,r=a!==void 0?bo(a,o):Xi.get(e)===Ls?fy(u,o):void 0):(k=bo(Kr(T,S),o+1).slice(1,-1),T instanceof Date&&(k=k.map(I=>new Date(I)))),kh(Qc(d))<0&&k.reverse(),mx(e,t,{domain:k,range:r,reverse:w,unknown:p})}function mx(e,t,{domain:r=[0],unknown:o,scheme:u="rdylbu",interpolate:d,range:p=d!==void 0?bo(d,r.length+1):Xi.get(e)===Ls?fy(u,r.length+1):void 0,reverse:a}){r=Qc(r);const w=kh(r);if(!isNaN(w)&&!mU(r,w))throw new Error(`the ${e} scale has a non-monotonic domain`);return a&&(p=Dg(p)),{type:"threshold",scale:fI(w<0?Dg(r):r,p===void 0?[]:p).unknown(o),domain:r,range:p}}function mU(e,t){for(let r=1,o=e.length,u=e[0];r<o;++r){const d=cp(u,u=e[r]);if(d!==0&&d!==t)return!1}return!0}function gU(e){return{type:"identity",scale:zj(Xi.get(e))?iI():t=>t}}function Qd(e,t=hE){return e.length?[Oc(e,({value:r})=>r===void 0?r:Oc(r,t)),Ja(e,({value:r})=>r===void 0?r:Ja(r,t))]:[0,1]}function KE(e,t){const r=Xi.get(e);return(r===Cp||r===Ep||r===Ip?_U:Qd)(t)}function _U(e){return[0,e.length?Ja(e,({value:t})=>t===void 0?t:Ja(t,hE)):1]}function yU(e,t){const r=e.find(({radius:p})=>p!==void 0);if(r!==void 0)return[0,r.radius];const o=vh(e,.5,({value:p})=>p===void 0?NaN:vh(p,.25,J1)),u=t.map(p=>3*Math.sqrt(p/o)),d=30/Ja(u);return d<1?u.map(p=>p*d):u}function vU(e,t){const r=Xv(e,({value:d})=>d===void 0?NaN:Xv(d,Math.abs)),o=t.map(d=>12*d/r),u=60/Ja(o);return u<1?o.map(d=>d*u):o}function bU(e){for(const{value:t}of e)if(t!==void 0)for(let r of t){if(r>0)return Qd(e,J1);if(r<0)return Qd(e,fE)}return[1,10]}function xU(e){const t=[];for(const{value:r}of e)if(r!==void 0)for(const o of r)t.push(o);return t}function gx(e){return(t,r)=>o=>e(t+o*(r-t))}let Vb=0,Gb;function wU(){const e=Vb;return Vb=0,Gb=void 0,e}function Al(e){e!==Gb&&(Gb=e,console.warn(e),++Vb)}function dy(e,t,r,o,{type:u,nice:d,clamp:p,domain:a=Qd(o),unknown:w,pivot:T=0,scheme:S,range:k,symmetric:I=!0,interpolate:P=Xi.get(e)===Ls?S==null&&k!==void 0?Gc:px(S!==void 0?S:"rdbu"):Kr,reverse:F}){T=+T,a=Qc(a);let[G,H]=a;if(a.length>2&&Al(`Warning: the diverging ${e} scale domain contains extra elements.`),cp(G,H)<0&&([G,H]=[H,G],F=!F),G=Math.min(G,T),H=Math.max(H,T),typeof P!="function"&&(P=XE(P)),k!==void 0&&(P=P.length===1?gx(P)(...k):H_(P,k)),F&&(P=YE(P)),I){const Y=r.apply(T),$=Y-r.apply(G),ae=r.apply(H)-Y;$<ae?G=r.invert(Y-ae):$>ae&&(H=r.invert(Y+$))}return t.domain([G,T,H]).unknown(w).interpolator(P),p&&t.clamp(p),d&&t.nice(d),{type:u,domain:[G,H],pivot:T,interpolate:P,scale:t}}function AU(e,t,r){return dy(e,CI(),CU,t,r)}function TU(e,t,r){return JE(e,t,{...r,exponent:.5})}function JE(e,t,{exponent:r=1,...o}){return dy(e,PI().exponent(r=+r),PU(r),t,{...o,type:"diverging-pow"})}function SU(e,t,{base:r=10,pivot:o=1,domain:u=Qd(t,o<0?fE:J1),...d}){return dy(e,II().base(r=+r),IU,t,{domain:u,pivot:o,...d})}function MU(e,t,{constant:r=1,...o}){return dy(e,EI().constant(r=+r),kU(r),t,o)}const CU={apply(e){return e},invert(e){return e}},IU={apply:Math.log,invert:Math.exp},EU={apply(e){return Math.sign(e)*Math.sqrt(Math.abs(e))},invert(e){return Math.sign(e)*(e*e)}};function PU(e){return e===.5?EU:{apply(t){return Math.sign(t)*Math.pow(Math.abs(t),e)},invert(t){return Math.sign(t)*Math.pow(Math.abs(t),1/e)}}}function kU(e){return{apply(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))},invert(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}}function eP(e,t,r,o){return Pp(e,t,r,o)}function DU(e,t,r){return eP(e,sN(),t,r)}function zU(e,t,r){return eP(e,lN(),t,r)}const kp=Symbol("ordinal");function tP(e,t,r,{type:o,interval:u,domain:d,range:p,reverse:a,hint:w}){return u=qh(u,o),d===void 0&&(d=iP(r,u,e)),(o==="categorical"||o===kp)&&(o="ordinal"),a&&(d=Dg(d)),d=t.domain(d).domain(),p!==void 0&&(typeof p=="function"&&(p=p(d)),t.range(p)),{type:o,domain:d,range:p,scale:t,hint:w,interval:u}}function RU(e,t,{type:r,interval:o,domain:u,range:d,scheme:p,unknown:a,...w}){o=qh(o,r),u===void 0&&(u=iP(t,o,e));let T;if(Xi.get(e)===hy)T=FU(t),d=d===void 0?OU(T):pr(d,ux);else if(Xi.get(e)===Ls&&(d===void 0&&(r==="ordinal"||r===kp)&&(d=aU(u,p),d!==void 0&&(p=void 0)),p===void 0&&d===void 0&&(p=r==="ordinal"?"turbo":"observable10"),p!==void 0))if(d!==void 0){const S=px(p),k=d[0],I=d[1]-d[0];d=({length:P})=>bo(F=>S(k+I*F),P)}else d=WE(p);if(a===Ib)throw new Error(`implicit unknown on ${e} scale is not supported`);return tP(e,V1().unknown(a),t,{...w,type:r,domain:u,range:d,hint:T})}function LU(e,t,{align:r=.5,padding:o=.5,...u}){return nP(V7().align(r).padding(o),t,u,e)}function BU(e,t,{align:r=.5,padding:o=.1,paddingInner:u=o,paddingOuter:d=e==="fx"||e==="fy"?0:o,...p}){return nP(X_().align(r).paddingInner(u).paddingOuter(d),t,p,e)}function nP(e,t,r,o){let{round:u}=r;return u!==void 0&&e.round(u=!!u),e=tP(o,e,t,r),e.round=u,e}function iP(e,t,r){const o=new R_;for(const{value:u,domain:d}of e){if(d!==void 0)return d();if(u!==void 0)for(const p of u)o.add(p)}if(t!==void 0){const[u,d]=Wa(o).map(t.floor,t);return t.range(u,t.offset(d))}if(o.size>1e4&&Xi.get(r)===qo)throw new Error(`implicit ordinal domain of ${r} scale has more than 10,000 values`);return pM(o,$c)}function BT(e,t){let r;for(const{hint:o}of e){const u=o==null?void 0:o[t];if(u!==void 0){if(r===void 0)r=u;else if(r!==u)return}}return r}function FU(e){return{fill:BT(e,"fill"),stroke:BT(e,"stroke")}}function OU(e){return _a(e.fill)?FN:BN}function qb(e,{label:t,inset:r=0,insetTop:o=r,insetRight:u=r,insetBottom:d=r,insetLeft:p=r,round:a,nice:w,clamp:T,zero:S,align:k,padding:I,projection:P,facet:{label:F=t}={},...G}={}){const H={};for(const[Y,$]of e){const ae=G[Y],ee=GU(Y,$,{round:Xi.get(Y)===qo?a:void 0,nice:w,clamp:T,zero:S,align:k,padding:I,projection:P,...ae});if(ee){let{label:ce=Y==="fx"||Y==="fy"?F:t,percent:re,transform:he,inset:be,insetTop:ke=be!==void 0?be:Y==="y"?o:0,insetRight:Ie=be!==void 0?be:Y==="x"?u:0,insetBottom:ue=be!==void 0?be:Y==="y"?d:0,insetLeft:Ve=be!==void 0?be:Y==="x"?p:0}=ae||{};if(he==null)he=void 0;else if(typeof he!="function")throw new Error("invalid scale transform; not a function");ee.percent=!!re,ee.label=ce===void 0?jU($,ee):ce,ee.transform=he,Y==="x"||Y==="fx"?(ee.insetLeft=+Ve,ee.insetRight=+Ie):(Y==="y"||Y==="fy")&&(ee.insetTop=+ke,ee.insetBottom=+ue),H[Y]=ee}}return H}function FT(e){const t={},r={scales:t};for(const[o,u]of Object.entries(e)){const{scale:d,type:p,interval:a,label:w}=u;t[o]=WU(u),r[o]=d,d.type=p,a!=null&&(d.interval=a),w!=null&&(d.label=w)}return r}function NU(e,t){const{x:r,y:o,fx:u,fy:d}=e,p=u||d?_x(t):t;u&&OT(u,p),d&&NT(d,p);const a=u||d?rP(e,t):t;r&&OT(r,a),o&&NT(o,a)}function jU(e=[],t){let r;for(const{label:o}of e)if(o!==void 0){if(r===void 0)r=o;else if(r!==o)return}if(r!==void 0)return!Jc(t)&&t.percent&&(r=`${r} (%)`),{inferred:!0,toString:()=>r}}function UU(e){return Math.sign(kh(e.domain()))*Math.sign(kh(e.range()))}function _x(e){const{marginTop:t,marginRight:r,marginBottom:o,marginLeft:u,width:d,height:p,facet:{marginTop:a,marginRight:w,marginBottom:T,marginLeft:S}}=e;return{marginTop:Math.max(t,a),marginRight:Math.max(r,w),marginBottom:Math.max(o,T),marginLeft:Math.max(u,S),width:d,height:p}}function rP({fx:e,fy:t},r){const{marginTop:o,marginRight:u,marginBottom:d,marginLeft:p,width:a,height:w}=_x(r);return{marginTop:o,marginRight:u,marginBottom:d,marginLeft:p,width:e?e.scale.bandwidth()+p+u:a,height:t?t.scale.bandwidth()+o+d:w,facet:{width:a,height:w}}}function OT(e,t){if(e.range===void 0){const{insetLeft:r,insetRight:o}=e,{width:u,marginLeft:d=0,marginRight:p=0}=t,a=d+r,w=u-p-o;e.range=[a,Math.max(a,w)],Jc(e)||(e.range=oP(e)),e.scale.range(e.range)}aP(e)}function NT(e,t){if(e.range===void 0){const{insetTop:r,insetBottom:o}=e,{height:u,marginTop:d=0,marginBottom:p=0}=t,a=d+r,w=u-p-o;e.range=[Math.max(a,w),a],Jc(e)?e.range.reverse():e.range=oP(e),e.scale.range(e.range)}aP(e)}function aP(e){e.round===void 0&&ZU(e)&&VU(e)<=30&&e.scale.round(!0)}function VU({scale:e}){const t=e.domain().length,[r,o]=e.range(),u=e.paddingInner?e.paddingInner():1,d=e.paddingOuter?e.paddingOuter():e.padding(),p=t-u,a=Math.abs(o-r)/Math.max(1,p+d*2);return(a-Math.floor(a))*p}function oP(e){const t=e.scale.domain().length+sP(e);if(!(t>2))return e.range;const[r,o]=e.range;return Array.from({length:t},(u,d)=>r+d/(t-1)*(o-r))}function GU(e,t=[],r={}){const o=qU(e,t,r);if(r.type===void 0&&r.domain===void 0&&r.range===void 0&&r.interval==null&&e!=="fx"&&e!=="fy"&&Jc({type:o})){const u=t.map(({value:d})=>d).filter(d=>d!==void 0);u.some(va)?Al(`Warning: some data associated with the ${e} scale are dates. Dates are typically associated with a "utc" or "time" scale rather than a "${Ju(o)}" scale. If you are using a bar mark, you probably want a rect mark with the interval option instead; if you are using a group transform, you probably want a bin transform instead. If you want to treat this data as ordinal, you can specify the interval of the ${e} scale (e.g., d3.utcDay), or you can suppress this warning by setting the type of the ${e} scale to "${Ju(o)}".`):u.some(Aj)?Al(`Warning: some data associated with the ${e} scale are strings that appear to be dates (e.g., YYYY-MM-DD). If these strings represent dates, you should parse them to Date objects. Dates are typically associated with a "utc" or "time" scale rather than a "${Ju(o)}" scale. If you are using a bar mark, you probably want a rect mark with the interval option instead; if you are using a group transform, you probably want a bin transform instead. If you want to treat this data as ordinal, you can suppress this warning by setting the type of the ${e} scale to "${Ju(o)}".`):u.some(Tj)&&Al(`Warning: some data associated with the ${e} scale are strings that appear to be numbers. If these strings represent numbers, you should parse or coerce them to numbers. Numbers are typically associated with a "linear" scale rather than a "${Ju(o)}" scale. If you want to treat this data as ordinal, you can specify the interval of the ${e} scale (e.g., 1 for integers), or you can suppress this warning by setting the type of the ${e} scale to "${Ju(o)}".`)}switch(r.type=o,o){case"diverging":case"diverging-sqrt":case"diverging-pow":case"diverging-log":case"diverging-symlog":case"cyclical":case"sequential":case"linear":case"sqrt":case"threshold":case"quantile":case"pow":case"log":case"symlog":r=Xm(t,r,Dh);break;case"identity":switch(Xi.get(e)){case qo:r=Xm(t,r,Dh);break;case hy:r=Xm(t,r,HU);break}break;case"utc":case"time":r=Xm(t,r,wE);break}switch(o){case"diverging":return AU(e,t,r);case"diverging-sqrt":return TU(e,t,r);case"diverging-pow":return JE(e,t,r);case"diverging-log":return SU(e,t,r);case"diverging-symlog":return MU(e,t,r);case"categorical":case"ordinal":case kp:return RU(e,t,r);case"cyclical":case"sequential":case"linear":return cU(e,t,r);case"sqrt":return uU(e,t,r);case"threshold":return mx(e,t,r);case"quantile":return dU(e,t,r);case"quantize":return pU(e,t,r);case"pow":return QE(e,t,r);case"log":return hU(e,t,r);case"symlog":return fU(e,t,r);case"utc":return zU(e,t,r);case"time":return DU(e,t,r);case"point":return LU(e,t,r);case"band":return BU(e,t,r);case"identity":return gU(e);case void 0:return;default:throw new Error(`unknown scale type: ${o}`)}}function Ju(e){return typeof e=="symbol"?e.description:e}function jT(e){return typeof e=="string"?`${e}`.toLowerCase():e}const UT={toString:()=>"projection"};function qU(e,t,{type:r,domain:o,range:u,scheme:d,pivot:p,projection:a}){var S;if(r=jT(r),e==="fx"||e==="fy")return"band";(e==="x"||e==="y")&&a!=null&&(r=UT);for(const k of t){const I=jT(k.type);if(I!==void 0){if(r===void 0)r=I;else if(r!==I)throw new Error(`scale incompatible with channel: ${r} !== ${I}`)}}if(r===UT)return;if(r!==void 0)return r;if(o===void 0&&!t.some(({value:k})=>k!==void 0))return;const w=Xi.get(e);if(w===Cp)return"sqrt";if(w===Ep||w===Ip)return"linear";if(w===hy)return"ordinal";const T=(S=o??u)==null?void 0:S.length;if(T<2||T>2)return vv(w);if(o!==void 0){if(TT(o))return vv(w);if(va(o))return"utc"}else{const k=t.map(({value:I})=>I).filter(I=>I!==void 0);if(k.some(TT))return vv(w);if(k.some(va))return"utc"}if(w===Ls){if(p!=null||sU(d))return"diverging";if(rU(d))return"categorical"}return"linear"}function vv(e){switch(e){case qo:return"point";case Ls:return kp;default:return"ordinal"}}function Jc({type:e}){return e==="ordinal"||e==="point"||e==="band"||e===kp}function sP({type:e}){return e==="threshold"}function ZU({type:e}){return e==="point"||e==="band"}function d_(e){if(e===void 0)return!0;const t=e.domain(),r=e(t[0]);for(let o=1,u=t.length;o<u;++o)if(e(t[o])-r)return!1;return!0}function Xm(e,{domain:t,...r},o){var u;for(const d of e)d.value!==void 0&&(t===void 0&&(t=(u=d.value)==null?void 0:u.domain),d.value=o(d.value));return{domain:t===void 0?t:o(t),...r}}function HU(e){return pr(e,ux)}function $U(e){return t=>{if(!Xi.has(t=`${t}`))throw new Error(`unknown scale: ${t}`);return e[t]}}function WU({scale:e,type:t,domain:r,range:o,interpolate:u,interval:d,transform:p,percent:a,pivot:w}){if(t==="identity")return{type:"identity",apply:S=>S,invert:S=>S};const T=e.unknown?e.unknown():void 0;return{type:t,domain:Fb(r),...o!==void 0&&{range:Fb(o)},...p!==void 0&&{transform:p},...a&&{percent:a},...T!==void 0&&{unknown:T},...d!==void 0&&{interval:d},...u!==void 0&&{interpolate:u},...e.clamp&&{clamp:e.clamp()},...w!==void 0&&{pivot:w,symmetric:!1},...e.base&&{base:e.base()},...e.exponent&&{exponent:e.exponent()},...e.constant&&{constant:e.constant()},...e.align&&{align:e.align(),round:e.round()},...e.padding&&(e.paddingInner?{paddingInner:e.paddingInner(),paddingOuter:e.paddingOuter()}:{padding:e.padding()}),...e.bandwidth&&{bandwidth:e.bandwidth(),step:e.step()},apply:S=>e(S),...e.invert&&{invert:S=>e.invert(S)}}}function YU(e,t){const{fx:r,fy:o}=qb(e,t),u=r==null?void 0:r.scale.domain(),d=o==null?void 0:o.scale.domain();return u&&d?Mz(u,d).map(([p,a],w)=>({x:p,y:a,i:w})):u?u.map((p,a)=>({x:p,i:a})):d?d.map((p,a)=>({y:p,i:a})):void 0}function XU(e,{x:t,y:r}){return t&&(t=Zb(t)),r&&(r=Zb(r)),e.filter(t&&r?o=>t.has(o.x)&&r.has(o.y):t?o=>t.has(o.x):o=>r.has(o.y)).sort(t&&r?(o,u)=>t.get(o.x)-t.get(u.x)||r.get(o.y)-r.get(u.y):t?(o,u)=>t.get(o.x)-t.get(u.x):(o,u)=>r.get(o.y)-r.get(u.y))}function yx(e,{fx:t,fy:r}){const o=Gh(e),u=t==null?void 0:t.value,d=r==null?void 0:r.value;return t&&r?dg(o,p=>(p.fx=u[p[0]],p.fy=d[p[0]],p),p=>u[p],p=>d[p]):t?dg(o,p=>(p.fx=u[p[0]],p),p=>u[p]):dg(o,p=>(p.fy=d[p[0]],p),p=>d[p])}function QU(e,t,{marginTop:r,marginLeft:o}){const u=e?({x:p})=>e(p)-o:()=>0,d=t?({y:p})=>t(p)-r:()=>0;return function(p){this.tagName==="svg"?(this.setAttribute("x",u(p)),this.setAttribute("y",d(p))):this.setAttribute("transform",`translate(${u(p)},${d(p)})`)}}function KU(e){const t=[],r=new Uint32Array(L_(e,o=>o.length));for(const o of e){let u=0;for(const d of e)o!==d&&(r.set(d,u),u+=d.length);t.push(r.slice(0,u))}return t}const JU=new Map([["top",bv],["right",Av],["bottom",xv],["left",wv],["top-left",Qm(bv,wv)],["top-right",Qm(bv,Av)],["bottom-left",Qm(xv,wv)],["bottom-right",Qm(xv,Av)],["top-empty",nV],["right-empty",aV],["bottom-empty",iV],["left-empty",rV],["empty",oV]]);function eV(e){if(e==null)return null;const t=JU.get(`${e}`.toLowerCase());if(t)return t;throw new Error(`invalid facet anchor: ${e}`)}const VT=new WeakMap;function Zb(e){let t=VT.get(e);return t||VT.set(e,t=new Bd(pr(e,(r,o)=>[r,o]))),t}function Dl(e,t){return Zb(e).get(t)}function tV(e,t,r){return t=Is(t),r=Is(r),e.find(o=>Object.is(Is(o.x),t)&&Object.is(Is(o.y),r))}function py(e,t,r){var o;return(o=tV(e,t,r))==null?void 0:o.empty}function bv(e,{y:t},{y:r}){return t?Dl(t,r)===0:!0}function xv(e,{y:t},{y:r}){return t?Dl(t,r)===t.length-1:!0}function wv(e,{x:t},{x:r}){return t?Dl(t,r)===0:!0}function Av(e,{x:t},{x:r}){return t?Dl(t,r)===t.length-1:!0}function nV(e,{y:t},{x:r,y:o,empty:u}){if(u)return!1;if(!t)return;const d=Dl(t,o);if(d>0)return py(e,r,t[d-1])}function iV(e,{y:t},{x:r,y:o,empty:u}){if(u)return!1;if(!t)return;const d=Dl(t,o);if(d<t.length-1)return py(e,r,t[d+1])}function rV(e,{x:t},{x:r,y:o,empty:u}){if(u)return!1;if(!t)return;const d=Dl(t,r);if(d>0)return py(e,t[d-1],o)}function aV(e,{x:t},{x:r,y:o,empty:u}){if(u)return!1;if(!t)return;const d=Dl(t,r);if(d<t.length-1)return py(e,t[d+1],o)}function oV(e,t,{empty:r}){return r}function Qm(e,t){return function(){return e.apply(null,arguments)&&t.apply(null,arguments)}}function Tv(e,{channels:{fx:t,fy:r},groups:o}){return t&&r?e.map(({x:u,y:d})=>{var p;return((p=o.get(u))==null?void 0:p.get(d))??[]}):t?e.map(({x:u})=>o.get(u)??[]):e.map(({y:u})=>o.get(u)??[])}const lP=Math.PI,ys=2*lP,Sv=.618;function sV({projection:e,inset:t=0,insetTop:r=t,insetRight:o=t,insetBottom:u=t,insetLeft:d=t}={},p){if(e==null)return;if(typeof e.stream=="function")return e;let a,w,T="frame";if(Rs(e)){let ce;if({type:e,domain:w,inset:ce,insetTop:r=ce!==void 0?ce:r,insetRight:o=ce!==void 0?ce:o,insetBottom:u=ce!==void 0?ce:u,insetLeft:d=ce!==void 0?ce:d,clip:T=T,...a}=e,e==null)return}typeof e!="function"&&({type:e}=Hb(e));const{width:S,height:k,marginLeft:I,marginRight:P,marginTop:F,marginBottom:G}=p,H=S-I-P-d-o,Y=k-F-G-r-u;if(e=e==null?void 0:e({width:H,height:Y,clip:T,...a}),e==null)return;T=lV(T,I,F,S-P,k-G);let $=I+d,ae=F+r,ee;if(w!=null){const[[ce,re],[he,be]]=b1(e).bounds(w),ke=Math.min(H/(he-ce),Y/(be-re));ke>0?($-=(ke*(ce+he)-H)/2,ae-=(ke*(re+be)-Y)/2,ee=Vg({point(Ie,ue){this.stream.point(Ie*ke+$,ue*ke+ae)}})):Al("Warning: the projection could not be fit to the specified domain; using the default scale.")}return ee??(ee=$===0&&ae===0?cP():Vg({point(ce,re){this.stream.point(ce+$,re+ae)}})),{stream:ce=>e.stream(ee.stream(T(ce)))}}function Hb(e){switch(`${e}`.toLowerCase()){case"albers-usa":return ho(yR,.7463,.4673);case"albers":return Km(VM,.7463,.4673);case"azimuthal-equal-area":return ho(vR,4,4);case"azimuthal-equidistant":return ho(bR,ys,ys);case"conic-conformal":return Km(AR,ys,ys);case"conic-equal-area":return Km(Gg,6.1702,2.9781);case"conic-equidistant":return Km(MR,7.312,3.6282);case"equal-earth":return ho(IR,5.4133,2.6347);case"equirectangular":return ho(TR,ys,lP);case"gnomonic":return ho(ER,3.4641,3.4641);case"identity":return{type:cP};case"reflect-y":return{type:cV};case"mercator":return ho(xR,ys,ys);case"orthographic":return ho(PR,2,2);case"stereographic":return ho(kR,2,2);case"transverse-mercator":return ho(DR,ys,ys);default:throw new Error(`unknown projection type: ${e}`)}}function lV(e,t,r,o,u){if(e===!1||e==null||typeof e=="number")return d=>d;switch(e===!0&&(e="frame"),`${e}`.toLowerCase()){case"frame":return MM(t,r,o,u);default:throw new Error(`unknown projection clip type: ${e}`)}}function ho(e,t,r){return{type:({width:o,height:u,rotate:d,precision:p=.15,clip:a})=>{var T,S,k;const w=e();return p!=null&&((T=w.precision)==null||T.call(w,p)),d!=null&&((S=w.rotate)==null||S.call(w,d)),typeof a=="number"&&((k=w.clipAngle)==null||k.call(w,a)),o!=null&&(w.scale(Math.min(o/t,u/r)),w.translate([o/2,u/2])),w},aspectRatio:r/t}}function Km(e,t,r){const{type:o,aspectRatio:u}=ho(e,t,r);return{type:d=>{const{parallels:p,domain:a,width:w,height:T}=d,S=o(d);return p!=null&&(S.parallels(p),a===void 0&&w!=null&&S.fitSize([w,T],{type:"Sphere"})),S},aspectRatio:u}}const cP=Cs({stream:e=>e}),cV=Cs(Vg({point(e,t){this.stream.point(e,-t)}}));function uV(e,t,r,o){const u=r[e],d=r[t],p=u.length,a=r[e]=new Float64Array(p).fill(NaN),w=r[t]=new Float64Array(p).fill(NaN);let T;const S=o.stream({point(k,I){a[T]=k,w[T]=I}});for(T=0;T<p;++T)S.point(u[T],d[T])}function hV({projection:e}={}){return e==null?!1:typeof e.stream=="function"?!0:(Rs(e)&&(e=e.type),e!=null)}function fV(e){if(typeof(e==null?void 0:e.stream)=="function")return Sv;if(Rs(e)){let t,r;if({domain:t,type:e,...r}=e,t!=null&&e!=null){const o=typeof e=="string"?Hb(e).type:e,[[u,d],[p,a]]=b1(o({...r,width:100,height:100})).bounds(t),w=(a-d)/(p-u);return w&&isFinite(w)?w<.2?.2:w>5?5:w:Sv}}if(e!=null){if(typeof e!="function"){const{aspectRatio:t}=Hb(e);if(t)return t}return Sv}}function dV(e){const t=[],r=[],o={scale:"x",value:t},u={scale:"y",value:r},d={point(p,a){t.push(p),r.push(a)},lineStart(){},lineEnd(){},polygonStart(){},polygonEnd(){},sphere(){}};for(const p of e.value)xc(p,d);return[o,u]}function pV({x:e,y:t}){if(e||t)return e??(e=r=>r),t??(t=r=>r),Vg({point(r,o){this.stream.point(e(r),t(o))}})}function vx(e={}){const{document:t=typeof window<"u"?window.document:void 0,clip:r}=e;return{document:t,clip:DE(r)}}function ua(e,{document:t}){return Dc(G_(e).call(t.documentElement))}const $b=Symbol("unset");function bx(e){return(e.length===1?mV:gV)(e)}function mV(e){let t,r=$b;return o=>(Object.is(r,o)||(r=o,t=e(o)),t)}function gV(e){let t,r;return(...o)=>(((r==null?void 0:r.length)!==o.length||r.some((u,d)=>!Object.is(u,o[d])))&&(r=o,t=e(...o)),t)}const _V=bx(e=>new Intl.NumberFormat(e));bx((e,t)=>new Intl.DateTimeFormat(e,{timeZone:"UTC",...t&&{month:t}}));bx((e,t)=>new Intl.DateTimeFormat(e,{timeZone:"UTC",...t&&{weekday:t}}));function yV(e="en-US"){const t=_V(e);return r=>r!=null&&!isNaN(r)?t.format(r):void 0}function vV(e){return tj(e,"Invalid Date")}function bV(e="en-US"){const t=yV(e);return r=>(r instanceof Date?vV:typeof r=="number"?t:Jr)(r)}const Rh=bV(),ka=(typeof window<"u"?window.devicePixelRatio>1:typeof it>"u")?0:.5;let xV=0;function uP(){return`plot-clip-${++xV}`}function wV(e,{title:t,href:r,ariaLabel:o,ariaDescription:u,ariaHidden:d,target:p,fill:a,fillOpacity:w,stroke:T,strokeWidth:S,strokeOpacity:k,strokeLinejoin:I,strokeLinecap:P,strokeMiterlimit:F,strokeDasharray:G,strokeDashoffset:H,opacity:Y,mixBlendMode:$,imageFilter:ae,paintOrder:ee,pointerEvents:ce,shapeRendering:re,channels:he},{ariaLabel:be,fill:ke="currentColor",fillOpacity:Ie,stroke:ue="none",strokeOpacity:Ve,strokeWidth:Ze,strokeLinecap:Xe,strokeLinejoin:Re,strokeMiterlimit:ot,paintOrder:Pt}){ke===null&&(a=null,w=null),ue===null&&(T=null,k=null),_a(ke)?!_a(ue)&&(!_a(a)||he!=null&&he.fill)&&(ue="none"):_a(ue)&&(!_a(T)||he!=null&&he.stroke)&&(ke="none");const[bt,_t]=zs(a,ke),[tt,Tt]=Pa(w,Ie),[ct,mt]=zs(T,ue),[Xt,Ut]=Pa(k,Ve),[St,pt]=Pa(Y);Yd(mt)||(S===void 0&&(S=Ze),P===void 0&&(P=Xe),I===void 0&&(I=Re),F===void 0&&!Ij(I)&&(F=ot),!Yd(_t)&&ee===void 0&&(ee=Pt));const[Ft,nt]=Pa(S);return ke!==null&&(e.fill=Ur(_t,"currentColor"),e.fillOpacity=pd(Tt,1)),ue!==null&&(e.stroke=Ur(mt,"none"),e.strokeWidth=pd(nt,1),e.strokeOpacity=pd(Ut,1),e.strokeLinejoin=Ur(I,"miter"),e.strokeLinecap=Ur(P,"butt"),e.strokeMiterlimit=pd(F,4),e.strokeDasharray=Ur(G,"none"),e.strokeDashoffset=Ur(H,"0")),e.target=Jr(p),e.ariaLabel=Jr(be),e.ariaDescription=Jr(u),e.ariaHidden=Jr(d),e.opacity=pd(pt,1),e.mixBlendMode=Ur($,"normal"),e.imageFilter=Ur(ae,"none"),e.paintOrder=Ur(ee,"normal"),e.pointerEvents=Ur(ce,"auto"),e.shapeRendering=Ur(re,"auto"),{title:{value:t,optional:!0,filter:null},href:{value:r,optional:!0,filter:null},ariaLabel:{value:o,optional:!0,filter:null},fill:{value:bt,scale:"auto",optional:!0},fillOpacity:{value:tt,scale:"auto",optional:!0},stroke:{value:ct,scale:"auto",optional:!0},strokeOpacity:{value:Xt,scale:"auto",optional:!0},strokeWidth:{value:Ft,optional:!0},opacity:{value:St,scale:"auto",optional:!0}}}function AV(e,t){t&&e.filter(r=>K1(t[r])).append("title").call(SV,t)}function TV(e,t){t&&e.filter(([r])=>K1(t[r])).append("title").call(MV,t)}function SV(e,t){t&&e.text(r=>Rh(t[r]))}function MV(e,t){t&&e.text(([r])=>Rh(t[r]))}function Dp(e,{target:t,tip:r},{ariaLabel:o,title:u,fill:d,fillOpacity:p,stroke:a,strokeOpacity:w,strokeWidth:T,opacity:S,href:k}){o&&qn(e,"aria-label",I=>o[I]),d&&qn(e,"fill",I=>d[I]),p&&qn(e,"fill-opacity",I=>p[I]),a&&qn(e,"stroke",I=>a[I]),w&&qn(e,"stroke-opacity",I=>w[I]),T&&qn(e,"stroke-width",I=>T[I]),S&&qn(e,"opacity",I=>S[I]),k&&hP(e,I=>k[I],t),r||AV(e,u)}function CV(e,{target:t,tip:r},{ariaLabel:o,title:u,fill:d,fillOpacity:p,stroke:a,strokeOpacity:w,strokeWidth:T,opacity:S,href:k}){o&&qn(e,"aria-label",([I])=>o[I]),d&&qn(e,"fill",([I])=>d[I]),p&&qn(e,"fill-opacity",([I])=>p[I]),a&&qn(e,"stroke",([I])=>a[I]),w&&qn(e,"stroke-opacity",([I])=>w[I]),T&&qn(e,"stroke-width",([I])=>T[I]),S&&qn(e,"opacity",([I])=>S[I]),k&&hP(e,([I])=>k[I],t),r||TV(e,u)}function IV({ariaLabel:e,title:t,fill:r,fillOpacity:o,stroke:u,strokeOpacity:d,strokeWidth:p,opacity:a,href:w},{tip:T}){return[e,T?void 0:t,r,o,u,d,p,a,w].filter(S=>S!==void 0)}function EV(e,t,r){const o=g1(e,u=>t[u]);return r===void 0&&o.size>1+e.length>>1&&Al("Warning: the implicit z channel has high cardinality. This may occur when the fill or stroke channel is associated with quantitative data rather than ordinal or categorical data. You can suppress this warning by setting the z option explicitly; if this data represents a single series, set z to null."),o.values()}function*PV(e,t,r,o){const{z:u}=r,{z:d}=o,p=IV(o,r),a=[...t,...p];for(const w of d?EV(e,d,u):[e]){let T,S;e:for(const k of w){for(const I of a)if(!Cl(I[k])){S&&S.push(-1);continue e}if(T===void 0){S&&(yield S),T=p.map(I=>Is(I[k])),S=[k];continue}S.push(k);for(let I=0;I<p.length;++I)if(Is(p[I][k])!==T[I]){yield S,T=p.map(F=>Is(F[k])),S=[k];continue e}}S&&(yield S)}}function kV(e,t,r,o){let u;const{clip:d=o.clip}=t;d==="frame"?(e=ua("svg:g",o).each(function(){this.appendChild(e.node()),e.node=()=>this}),u=zV(o,r)):d&&(u=LV(d,o)),qn(e,"aria-label",t.ariaLabel),qn(e,"aria-description",t.ariaDescription),qn(e,"aria-hidden",t.ariaHidden),qn(e,"clip-path",u)}function DV(e){const t=new WeakMap;return(r,o)=>{let u=t.get(r);if(!u){const d=uP();Dc(r.ownerSVGElement).append("clipPath").attr("id",d).call(e,r,o),t.set(r,u=`url(#${d})`)}return u}}const zV=DV((e,t,r)=>{const{width:o,height:u,marginLeft:d,marginRight:p,marginTop:a,marginBottom:w}=r;e.append("rect").attr("x",d).attr("y",a).attr("width",o-p-d).attr("height",u-a-w)}),GT=new WeakMap,RV={type:"Sphere"};function LV(e,t){let r,o;if((r=GT.get(t))||GT.set(t,r=new WeakMap),e.type==="Sphere"&&(e=RV),!(o=r.get(e))){const u=uP();Dc(t.ownerSVGElement).append("clipPath").attr("id",u).append("path").attr("d",t.path()(e)),r.set(e,o=`url(#${u})`)}return o}function eu(e,t,r,o){kV(e,t,r,o),qn(e,"class",t.className),qn(e,"fill",t.fill),qn(e,"fill-opacity",t.fillOpacity),qn(e,"stroke",t.stroke),qn(e,"stroke-width",t.strokeWidth),qn(e,"stroke-opacity",t.strokeOpacity),qn(e,"stroke-linejoin",t.strokeLinejoin),qn(e,"stroke-linecap",t.strokeLinecap),qn(e,"stroke-miterlimit",t.strokeMiterlimit),qn(e,"stroke-dasharray",t.strokeDasharray),qn(e,"stroke-dashoffset",t.strokeDashoffset),qn(e,"shape-rendering",t.shapeRendering),qn(e,"filter",t.imageFilter),qn(e,"paint-order",t.paintOrder);const{pointerEvents:u=o.pointerSticky===!1?"none":void 0}=t;qn(e,"pointer-events",u)}function tu(e,t){BV(e,"mix-blend-mode",t.mixBlendMode),qn(e,"opacity",t.opacity)}function hP(e,t,r){e.each(function(o){const u=t(o);if(u!=null){const d=this.ownerDocument.createElementNS(Th.svg,"a");d.setAttribute("fill","inherit"),d.setAttributeNS(Th.xlink,"href",u),r!=null&&d.setAttribute("target",r),this.parentNode.insertBefore(d,this).appendChild(this)}})}function qn(e,t,r){r!=null&&e.attr(t,r)}function BV(e,t,r){r!=null&&e.style(t,r)}function nu(e,t,{x:r,y:o},u=ka,d=ka){u+=t.dx,d+=t.dy,r!=null&&r.bandwidth&&(u+=r.bandwidth()/2),o!=null&&o.bandwidth&&(d+=o.bandwidth()/2),(u||d)&&e.attr("transform",`translate(${u},${d})`)}function Ur(e,t){if((e=Jr(e))!==t)return e}function pd(e,t){if((e=na(e))!==t)return e}const FV=/^-?([_a-z]|[\240-\377]|\\[0-9a-f]{1,6}(\r\n|[ \t\r\n\f])?|\\[^\r\n\f0-9a-f])([_a-z0-9-]|[\240-\377]|\\[0-9a-f]{1,6}(\r\n|[ \t\r\n\f])?|\\[^\r\n\f0-9a-f])*$/i;function xx(e){if(e===void 0)return"plot-d6a7b5";if(e=`${e}`,!FV.test(e))throw new Error(`invalid class name: ${e}`);return e}function wx(e,t){if(typeof t=="string")e.property("style",t);else if(t!=null)for(const r of e)Object.assign(r.style,t)}function my({frameAnchor:e},{width:t,height:r,marginTop:o,marginRight:u,marginBottom:d,marginLeft:p}){return[/left$/.test(e)?p:/right$/.test(e)?t-u:(p+t-u)/2,/^top/.test(e)?o:/^bottom/.test(e)?r-d:(o+r-d)/2]}class es{constructor(t,r={},o={},u){const{facet:d="auto",facetAnchor:p,fx:a,fy:w,sort:T,dx:S=0,dy:k=0,margin:I=0,marginTop:P=I,marginRight:F=I,marginBottom:G=I,marginLeft:H=I,className:Y,clip:$=u==null?void 0:u.clip,channels:ae,tip:ee,render:ce}=o;if(this.data=t,this.sort=Wd(T)?T:null,this.initializer=h_(o).initializer,this.transform=this.initializer?o.transform:hx(o).transform,d===null||d===!1?this.facet=null:(this.facet=To(d===!0?"include":d,"facet",["auto","include","exclude","super"]),this.fx=t===vg&&typeof a=="string"?[a]:a,this.fy=t===vg&&typeof w=="string"?[w]:w),this.facetAnchor=eV(p),r=kE(r),ae!==void 0&&(r={...OV(ae),...r}),u!==void 0&&(r={...wV(this,o,u),...r}),this.channels=Object.fromEntries(Object.entries(r).map(([re,he])=>{if(ox(he.value)){const{value:be,label:ke=he.label,scale:Ie=he.scale}=he.value;he={...he,label:ke,scale:Ie,value:be}}if(t===vg&&typeof he.value=="string"){const{value:be}=he;he={...he,value:[be]}}return[re,he]}).filter(([re,{value:he,optional:be}])=>{if(he!=null)return!0;if(be)return!1;throw new Error(`missing channel value: ${re}`)})),this.dx=+S,this.dy=+k,this.marginTop=+P,this.marginRight=+F,this.marginBottom=+G,this.marginLeft=+H,this.clip=DE($),this.tip=NV(ee),this.className=Jr(Y),this.facet==="super"){if(a||w)throw new Error("super-faceting cannot use fx or fy");for(const re in this.channels){const{scale:he}=r[re];if(!(he!=="x"&&he!=="y"))throw new Error("super-faceting cannot use x or y")}}ce!=null&&(this.render=dP(ce,this.render))}initialize(t,r,o){let u=zh(this.data);t===void 0&&u!=null&&(t=[Gh(u)]);const d=t;this.transform!=null&&({facets:t,data:u}=this.transform(u,t,o),u=zh(u)),t!==void 0&&(t.original=d);const p=Kj(this.channels,u);return this.sort!=null&&eU(u,t,p,r,this.sort),{data:u,facets:t,channels:p}}filter(t,r,o){for(const u in r){const{filter:d=Cl}=r[u];if(d!==null){const p=o[u];t=t.filter(a=>d(p[a]))}}return t}project(t,r,o){for(const u in t)if(t[u].scale==="x"&&/^x|x$/.test(u)){const d=u.replace(/^x|x$/,"y");d in t&&t[d].scale==="y"&&uV(u,d,r,o.projection)}}scale(t,r,o){const u=Jj(t,r);return o.projection&&this.project(t,u,o),u}}function fP(...e){return e.plot=es.prototype.plot,e}function dP(e,t){if(e==null)return t===null?void 0:t;if(t==null)return e===null?void 0:e;if(typeof e!="function")throw new TypeError(`invalid render transform: ${e}`);if(typeof t!="function")throw new TypeError(`invalid render transform: ${t}`);return function(r,o,u,d,p,a){return e.call(this,r,o,u,d,p,(w,T,S,k,I)=>t.call(this,w,T,S,k,I,a))}}function OV(e){return Object.fromEntries(Object.entries(kE(e)).map(([t,r])=>(r=typeof r=="string"?{value:r,label:t}:Mp(r),r.filter===void 0&&r.scale==null&&(r={...r,filter:null}),[t,r])))}function NV(e){return e===!0?"xy":e===!1||e==null?null:typeof e=="string"?To(e,"tip",["x","y","xy"]):e}function Ax(e,t){return(e==null?void 0:e.tip)===!0?{...e,tip:t}:Rs(e==null?void 0:e.tip)&&e.tip.pointer===void 0?{...e,tip:{...e.tip,pointer:t}}:e}function jV(e,t,r={}){let o=.5-ka,u=.5+ka,d=.5+ka,p=.5-ka;for(const{marginTop:G,marginRight:H,marginBottom:Y,marginLeft:$}of t)G>o&&(o=G),H>u&&(u=H),Y>d&&(d=Y),$>p&&(p=$);let{margin:a,marginTop:w=a!==void 0?a:o,marginRight:T=a!==void 0?a:u,marginBottom:S=a!==void 0?a:d,marginLeft:k=a!==void 0?a:p}=r;w=+w,T=+T,S=+S,k=+k;let{width:I=640,height:P=UV(e,r,{width:I,marginTopDefault:o,marginRightDefault:u,marginBottomDefault:d,marginLeftDefault:p})+Math.max(0,w-o+S-d)}=r;I=+I,P=+P;const F={width:I,height:P,marginTop:w,marginRight:T,marginBottom:S,marginLeft:k};if(e.fx||e.fy){let{margin:G,marginTop:H=G!==void 0?G:w,marginRight:Y=G!==void 0?G:T,marginBottom:$=G!==void 0?G:S,marginLeft:ae=G!==void 0?G:k}=r.facet??{};H=+H,Y=+Y,$=+$,ae=+ae,F.facet={marginTop:H,marginRight:Y,marginBottom:$,marginLeft:ae}}return F}function UV({x:e,y:t,fy:r,fx:o},{projection:u,aspectRatio:d},{width:p,marginTopDefault:a,marginRightDefault:w,marginBottomDefault:T,marginLeftDefault:S}){const k=r&&r.scale.domain().length||1,I=fV(u);if(I){const F=o?o.scale.domain().length:1,G=(1.1*k-.1)/(1.1*F-.1)*I,H=Math.max(.1,Math.min(10,G));return Math.round((p-S-w)*H+a+T)}const P=t?Jc(t)?t.scale.domain().length||1:Math.max(7,17/k):1;if(d!=null){if(d=+d,!(isFinite(d)&&d>0))throw new Error(`invalid aspectRatio: ${d}`);const F=qT("y",t)/(qT("x",e)*d),G=o?o.scale.bandwidth():1,H=r?r.scale.bandwidth():1,Y=G*(p-S-w)-e.insetLeft-e.insetRight;return(F*Y+t.insetTop+t.insetBottom)/H+a+T}return!!(t||r)*Math.max(1,Math.min(60,P*k))*20+!!o*30+60}function qT(e,t){if(!t)throw new Error(`aspectRatio requires ${e} scale`);const{type:r,domain:o}=t;let u;switch(r){case"linear":case"utc":case"time":u=Number;break;case"pow":{const a=t.scale.exponent();u=w=>Math.pow(w,a);break}case"log":u=Math.log;break;case"point":case"band":return o.length;default:throw new Error(`unsupported ${e} scale for aspectRatio: ${r}`)}const[d,p]=Wa(o);return Math.abs(u(p)-u(d))}const ZT=new WeakMap;function Tx(e,t,{x:r,y:o,px:u,py:d,maxRadius:p=40,channels:a,render:w,...T}={}){return p=+p,u!=null&&(r??(r=null),a={...a,px:{value:u,scale:"x"}}),d!=null&&(o??(o=null),a={...a,py:{value:d,scale:"y"}}),{x:r,y:o,channels:a,...T,render:dP(function(S,k,I,P,F,G){F={...F,pointerSticky:!1};const H=F.ownerSVGElement,{data:Y}=F.getMarkState(this);let $=ZT.get(H);$||ZT.set(H,$={sticky:!1,roots:[],renders:[]});let ae=$.renders.push(mt)-1;const{x:ee,y:ce,fx:re,fy:he}=k;let be=re?re(S.fx)-P.marginLeft:0,ke=he?he(S.fy)-P.marginTop:0;ee!=null&&ee.bandwidth&&(be+=ee.bandwidth()/2),ce!=null&&ce.bandwidth&&(ke+=ce.bandwidth()/2);const Ie=S.fi!=null;let ue;if(Ie){let pt=$.facetStates;pt||($.facetStates=pt=new Map),ue=pt.get(this),ue||pt.set(this,ue=new Map)}const[Ve,Ze]=my(this,P),{px:Xe,py:Re}=I,ot=Xe?pt=>Xe[pt]:pP(I,Ve),Pt=Re?pt=>Re[pt]:mP(I,Ze);let bt,_t,tt,Tt;function ct(pt,Ft){if(Ie)if(Tt&&(Tt=cancelAnimationFrame(Tt)),pt==null)ue.delete(S.fi);else{ue.set(S.fi,Ft),Tt=requestAnimationFrame(()=>{Tt=null;for(const[nt,De]of ue)if(De<Ft||De===Ft&&nt<S.fi){pt=null;break}mt(pt)});return}mt(pt)}function mt(pt){if(bt===pt&&tt===$.sticky)return;bt=pt,tt=F.pointerSticky=$.sticky;const Ft=bt==null?[]:[bt];Ie&&(Ft.fx=S.fx,Ft.fy=S.fy,Ft.fi=S.fi);const nt=G(Ft,k,I,P,F);if(_t){if(Ie){const De=_t.parentNode,Ke=_t.getAttribute("transform"),Be=nt.getAttribute("transform");Ke?nt.setAttribute("transform",Ke):nt.removeAttribute("transform"),Be?De.setAttribute("transform",Be):De.removeAttribute("transform"),nt.removeAttribute("aria-label"),nt.removeAttribute("aria-description"),nt.removeAttribute("aria-hidden")}_t.replaceWith(nt)}if($.roots[ae]=_t=nt,!(bt==null&&(ue==null?void 0:ue.size)>1)){const De=bt==null?null:Sp(Y)?Y[bt]:Y.get(bt);F.dispatchValue(De)}return nt}function Xt(pt){if($.sticky||pt.pointerType==="mouse"&&pt.buttons===1)return;let[Ft,nt]=LF(pt);Ft-=be,nt-=ke;const De=Ft<P.marginLeft||Ft>P.width-P.marginRight?1:e,Ke=nt<P.marginTop||nt>P.height-P.marginBottom?1:t;let Be=null,wt=p*p;for(const gt of S){const Rt=De*(ot(gt)-Ft),st=Ke*(Pt(gt)-nt),ht=Rt*Rt+st*st;ht<=wt&&(Be=gt,wt=ht)}if(Be!=null&&(e!==1||t!==1)){const gt=ot(Be)-Ft,Rt=Pt(Be)-nt;wt=gt*gt+Rt*Rt}ct(Be,wt)}function Ut(pt){pt.pointerType==="mouse"&&bt!=null&&($.sticky&&$.roots.some(Ft=>Ft==null?void 0:Ft.contains(pt.target))||($.sticky?($.sticky=!1,$.renders.forEach(Ft=>Ft(null))):($.sticky=!0,mt(bt)),pt.stopImmediatePropagation()))}function St(pt){pt.pointerType==="mouse"&&($.sticky||ct(null))}return H.addEventListener("pointerenter",Xt),H.addEventListener("pointermove",Xt),H.addEventListener("pointerdown",Ut),H.addEventListener("pointerleave",St),mt(null)},w)}}function VV(e){return Tx(1,1,e)}function Wb(e){return Tx(1,.01,e)}function HT(e){return Tx(.01,1,e)}function pP({x1:e,x2:t,x:r=e},o){return e&&t?u=>(e[u]+t[u])/2:r?u=>r[u]:()=>o}function mP({y1:e,y2:t,y:r=e},o){return e&&t?u=>(e[u]+t[u])/2:r?u=>r[u]:()=>o}function gP(e){return Jc(e)&&e.interval===void 0?void 0:"tabular-nums"}function GV(e,t){let{label:r=e.label,tickSize:o=6,width:u=240,height:d=44+o,marginTop:p=18,marginRight:a=0,marginBottom:w=16+o,marginLeft:T=0,style:S,ticks:k=(u-T-a)/64,tickFormat:I,fontVariant:P=gP(e),round:F=!0,opacity:G,className:H}=t;const Y=vx(t);H=xx(H),G=Pa(G)[1],I===null&&(I=()=>null);const $=ua("svg",Y).attr("class",`${H}-ramp`).attr("font-family","system-ui, sans-serif").attr("font-size",10).attr("width",u).attr("height",d).attr("viewBox",`0 0 ${u} ${d}`).call(Ve=>Ve.append("style").text(`:where(.${H}-ramp) {
  display: block;
  height: auto;
  height: intrinsic;
  max-width: 100%;
  overflow: visible;
}
:where(.${H}-ramp text) {
  white-space: pre;
}`)).call(wx,S);let ae=Ve=>Ve.selectAll(".tick line").attr("y1",p+w-d),ee;const ce=F?(Ve,Ze)=>Ve.rangeRound(Ze):(Ve,Ze)=>Ve.range(Ze),{type:re,domain:he,range:be,interpolate:ke,scale:Ie,pivot:ue}=e;if(ke){const Ve=be===void 0?ke:H_(ke.length===1?gx(ke):ke,be);ee=ce(Ie.copy(),bo(Kr(T,u-a),Math.min(he.length+(ue!==void 0),be===void 0?1/0:be.length)));const Ze=256,Xe=Y.document.createElement("canvas");Xe.width=Ze,Xe.height=1;const Re=Xe.getContext("2d");for(let ot=0,Pt=Ze-1;ot<Ze;++ot)Re.fillStyle=Ve(ot/Pt),Re.fillRect(ot,0,1,1);$.append("image").attr("opacity",G).attr("x",T).attr("y",p).attr("width",u-T-a).attr("height",d-p-w).attr("preserveAspectRatio","none").attr("xlink:href",Xe.toDataURL())}else if(re==="threshold"){const Ve=he,Ze=I===void 0?Xe=>Xe:typeof I=="string"?Es(I):I;ee=ce(K_().domain([-1,be.length-1]),[T,u-a]),$.append("g").attr("fill-opacity",G).selectAll().data(be).enter().append("rect").attr("x",(Xe,Re)=>ee(Re-1)).attr("y",p).attr("width",(Xe,Re)=>ee(Re)-ee(Re-1)).attr("height",d-p-w).attr("fill",Xe=>Xe),k=pr(Ve,(Xe,Re)=>Re),I=Xe=>Ze(Ve[Xe],Xe)}else ee=ce(X_().domain(he),[T,u-a]),$.append("g").attr("fill-opacity",G).selectAll().data(he).enter().append("rect").attr("x",ee).attr("y",p).attr("width",Math.max(0,ee.bandwidth()-1)).attr("height",d-p-w).attr("fill",Ie),ae=()=>{};return $.append("g").attr("transform",`translate(0,${d-w})`).call(K8(ee).ticks(Array.isArray(k)?null:k,typeof I=="string"?I:void 0).tickFormat(typeof I=="function"?I:void 0).tickSize(o).tickValues(Array.isArray(k)?k:null)).attr("font-size",null).attr("font-family",null).attr("font-variant",Ur(P,"normal")).call(ae).call(Ve=>Ve.select(".domain").remove()),r!==void 0&&$.append("text").attr("x",T).attr("y",p-6).attr("fill","currentColor").attr("font-weight","bold").text(r),$.node()}const _P=Math.PI/180;function Sx(e,{marker:t,markerStart:r=t,markerMid:o=t,markerEnd:u=t}={}){e.markerStart=Mv(r),e.markerMid=Mv(o),e.markerEnd=Mv(u)}function Mv(e){if(e==null||e===!1)return null;if(e===!0)return WT;if(typeof e=="function")return e;switch(`${e}`.toLowerCase()){case"none":return null;case"arrow":return $T("auto");case"arrow-reverse":return $T("auto-start-reverse");case"dot":return qV;case"circle":case"circle-fill":return WT;case"circle-stroke":return ZV;case"tick":return Cv("auto");case"tick-x":return Cv(90);case"tick-y":return Cv(0)}throw new Error(`invalid marker: ${e}`)}function $T(e){return(t,r)=>ua("svg:marker",r).attr("viewBox","-5 -5 10 10").attr("markerWidth",6.67).attr("markerHeight",6.67).attr("orient",e).attr("fill","none").attr("stroke",t).attr("stroke-width",1.5).attr("stroke-linecap","round").attr("stroke-linejoin","round").call(o=>o.append("path").attr("d","M-1.5,-3l3,3l-3,3")).node()}function qV(e,t){return ua("svg:marker",t).attr("viewBox","-5 -5 10 10").attr("markerWidth",6.67).attr("markerHeight",6.67).attr("fill",e).attr("stroke","none").call(r=>r.append("circle").attr("r",2.5)).node()}function WT(e,t){return ua("svg:marker",t).attr("viewBox","-5 -5 10 10").attr("markerWidth",6.67).attr("markerHeight",6.67).attr("fill",e).attr("stroke","var(--plot-background)").attr("stroke-width",1.5).call(r=>r.append("circle").attr("r",3)).node()}function ZV(e,t){return ua("svg:marker",t).attr("viewBox","-5 -5 10 10").attr("markerWidth",6.67).attr("markerHeight",6.67).attr("fill","var(--plot-background)").attr("stroke",e).attr("stroke-width",1.5).call(r=>r.append("circle").attr("r",3)).node()}function Cv(e){return(t,r)=>ua("svg:marker",r).attr("viewBox","-3 -3 6 6").attr("markerWidth",6).attr("markerHeight",6).attr("orient",e).attr("stroke",t).call(o=>o.append("path").attr("d","M0,-3v6")).node()}let HV=0;function yP(e,t,{stroke:r},o){return bP(e,t,r&&(u=>r[u]),null,o)}function $V(e,t,{stroke:r,z:o},u){return bP(e,t,r&&(([d])=>r[d]),o,u)}const Yb=1,vP=2;function WV(e,t){const r=new Uint8Array(t.length),o=e.data().filter(d=>d.length>1),u=o.length;for(let d=0,p=$b;d<u;++d){const a=o[d];if(a.length>1){const w=a[0];p!==(p=Is(t[w]))&&(r[w]|=Yb)}}for(let d=u-1,p=$b;d>=0;--d){const a=o[d];if(a.length>1){const w=a[0];p!==(p=Is(t[w]))&&(r[w]|=vP)}}return([d])=>r[d]}function bP(e,{markerStart:t,markerMid:r,markerEnd:o,stroke:u},d=()=>u,p,a){if(!t&&!r&&!o)return;const w=new Map,T=p&&WV(e,p);function S(k,I,P){return function(F){if(P&&!P(F))return;const G=d(F);let H=w.get(I);H||w.set(I,H=new Map);let Y=H.get(G);if(!Y){const $=this.parentNode.insertBefore(I(G,a),this),ae=`plot-marker-${++HV}`;$.setAttribute("id",ae),H.set(G,Y=`url(#${ae})`)}this.setAttribute(k,Y)}}t&&e.each(S("marker-start",t,T&&(k=>T(k)&Yb))),r&&T&&e.each(S("marker-start",r,k=>!(T(k)&Yb))),r&&e.each(S("marker-mid",r)),o&&e.each(S("marker-end",o,T&&(k=>T(k)&vP)))}function Mx({inset:e,insetLeft:t,insetRight:r,...o}={}){return[t,r]=wP(e,t,r),{inset:e,insetLeft:t,insetRight:r,...o}}function xP({inset:e,insetTop:t,insetBottom:r,...o}={}){return[t,r]=wP(e,t,r),{inset:e,insetTop:t,insetBottom:r,...o}}function wP(e,t,r){return e===void 0&&t===void 0&&r===void 0?ka?[1,0]:[.5,.5]:[t,r]}function AP(e,{interval:t}){return e={...Mp(e)},e.interval=lx(e.interval===void 0?t:e.interval),e}function TP(e,t,r,o){const{[e]:u,[`${e}1`]:d,[`${e}2`]:p}=r,{value:a,interval:w}=AP(u,r);if(a==null||w==null&&!o)return r;const T=Kc(u);if(w==null){let P;const F={transform:G=>P||(P=ta(G,a)),label:T};return{...r,[e]:void 0,[`${e}1`]:d===void 0?F:d,[`${e}2`]:p===void 0&&!(d===p&&o)?F:p}}let S,k;function I(P){return k!==void 0&&P===S?k:k=pr(ta(S=P,a),F=>w.floor(F))}return t({...r,[e]:void 0,[`${e}1`]:d===void 0?{transform:I,label:T}:d,[`${e}2`]:p===void 0?{transform:P=>I(P).map(F=>w.offset(F)),label:T}:p})}function SP(e,t,r){const{[e]:o}=r,{value:u,interval:d}=AP(o,r);return u==null||d==null?r:t({...r,[e]:{label:Kc(o),transform:p=>{const a=pr(ta(p,u),T=>d.floor(T)),w=a.map(T=>d.offset(T));return a.map(va(a)?(T,S)=>T==null||isNaN(T=+T)||(S=w[S],S==null)||isNaN(S=+S)?void 0:new Date((T+S)/2):(T,S)=>T==null||(S=w[S],S==null)?NaN:(+T+ +S)/2)}}})}function YV(e={}){return TP("x",Mx,e)}function XV(e={}){return TP("y",xP,e)}function QV(e={}){return SP("x",Mx,e)}function KV(e={}){return SP("y",xP,e)}const MP={ariaLabel:"rule",fill:null,stroke:"currentColor"};class JV extends es{constructor(t,r={}){const{x:o,y1:u,y2:d,inset:p=0,insetTop:a=p,insetBottom:w=p}=r;super(t,{x:{value:o,scale:"x",optional:!0},y1:{value:u,scale:"y",optional:!0},y2:{value:d,scale:"y",optional:!0}},Ax(r,"x"),MP),this.insetTop=na(a),this.insetBottom=na(w),Sx(this,r)}render(t,r,o,u,d){const{x:p,y:a}=r,{x:w,y1:T,y2:S}=o,{width:k,height:I,marginTop:P,marginRight:F,marginLeft:G,marginBottom:H}=u,{insetTop:Y,insetBottom:$}=this;return ua("svg:g",d).call(eu,this,u,d).call(nu,this,{x:w&&p},ka,0).call(ae=>ae.selectAll().data(t).enter().append("line").call(tu,this).attr("x1",w?ee=>w[ee]:(G+k-F)/2).attr("x2",w?ee=>w[ee]:(G+k-F)/2).attr("y1",T&&!d_(a)?ee=>T[ee]+Y:P+Y).attr("y2",S&&!d_(a)?a.bandwidth?ee=>S[ee]+a.bandwidth()-$:ee=>S[ee]-$:I-H-$).call(Dp,this,o).call(yP,this,o,d)).node()}}class eG extends es{constructor(t,r={}){const{x1:o,x2:u,y:d,inset:p=0,insetRight:a=p,insetLeft:w=p}=r;super(t,{y:{value:d,scale:"y",optional:!0},x1:{value:o,scale:"x",optional:!0},x2:{value:u,scale:"x",optional:!0}},Ax(r,"y"),MP),this.insetRight=na(a),this.insetLeft=na(w),Sx(this,r)}render(t,r,o,u,d){const{x:p,y:a}=r,{y:w,x1:T,x2:S}=o,{width:k,height:I,marginTop:P,marginRight:F,marginLeft:G,marginBottom:H}=u,{insetLeft:Y,insetRight:$}=this;return ua("svg:g",d).call(eu,this,u,d).call(nu,this,{y:w&&a},0,ka).call(ae=>ae.selectAll().data(t).enter().append("line").call(tu,this).attr("x1",T&&!d_(p)?ee=>T[ee]+Y:G+Y).attr("x2",S&&!d_(p)?p.bandwidth?ee=>S[ee]+p.bandwidth()-$:ee=>S[ee]-$:k-F-$).attr("y1",w?ee=>w[ee]:(P+I-H)/2).attr("y2",w?ee=>w[ee]:(P+I-H)/2).call(Dp,this,o).call(yP,this,o,d)).node()}}function Xb(e,t){let{x:r=Ba,y:o,y1:u,y2:d,...p}=XV(t);return[u,d]=CP(o,u,d),new JV(e,{...p,x:r,y1:u,y2:d})}function tG(e,t){let{y:r=Ba,x:o,x1:u,x2:d,...p}=YV(t);return[u,d]=CP(o,u,d),new eG(e,{...p,y:r,x1:u,x2:d})}function CP(e,t,r){if(e==null){if(t===void 0){if(r!==void 0)return[0,r]}else if(r===void 0)return[0,t]}else{if(t===void 0)return r===void 0?[0,e]:[e,r];if(r===void 0)return[e,t]}return[t,r]}function IP(e,...t){let r=t.length;for(let o=0,u=!0;o<r;++o)typeof t[o]!="function"&&(u&&(e=e.slice(),u=!1),e.splice(o,2,e[o]+t[o]+e[o+1]),t.splice(o,1),--o,--r);return o=>{let u=e[0];for(let d=0;d<r;++d)u+=t[d](o)+e[d+1];return u}}const nG={ariaLabel:"text",strokeLinejoin:"round",strokeWidth:3,paintOrder:"stroke"},EP="Â­";class Cx extends es{constructor(t,r={}){const{x:o,y:u,text:d=kl(t)&&PE(t)?Ba:bE,frameAnchor:p,textAnchor:a=/right$/i.test(p)?"end":/left$/i.test(p)?"start":"middle",lineAnchor:w=/^top/i.test(p)?"top":/^bottom/i.test(p)?"bottom":"middle",lineHeight:T=1,lineWidth:S=1/0,textOverflow:k,monospace:I,fontFamily:P=I?"ui-monospace, monospace":void 0,fontSize:F,fontStyle:G,fontVariant:H,fontWeight:Y,rotate:$}=r,[ae,ee]=Pa($,0),[ce,re]=lG(F);if(super(t,{x:{value:o,scale:"x",optional:!0},y:{value:u,scale:"y",optional:!0},fontSize:{value:ce,optional:!0},rotate:{value:wj(ae),optional:!0},text:{value:d,filter:K1,optional:!0}},r,nG),this.rotate=ee,this.textAnchor=Ur(a,"middle"),this.lineAnchor=To(w,"lineAnchor",["top","middle","bottom"]),this.lineHeight=+T,this.lineWidth=+S,this.textOverflow=PP(k),this.monospace=!!I,this.fontFamily=Jr(P),this.fontSize=re,this.fontStyle=Jr(G),this.fontVariant=Jr(H),this.fontWeight=Jr(Y),this.frameAnchor=cx(p),!(this.lineWidth>=0))throw new Error(`invalid lineWidth: ${S}`);this.splitLines=zP(this),this.clipLine=RP(this)}render(t,r,o,u,d){const{x:p,y:a}=r,{x:w,y:T,rotate:S,text:k,title:I,fontSize:P}=o,{rotate:F}=this,[G,H]=my(this,u);return ua("svg:g",d).call(eu,this,u,d).call(DP,this,k,u).call(nu,this,{x:w&&p,y:T&&a}).call(Y=>Y.selectAll().data(t).enter().append("text").call(tu,this).call(iG,this,k,I).attr("transform",IP`translate(${w?$=>w[$]:G},${T?$=>T[$]:H})${S?$=>` rotate(${S[$]})`:F?` rotate(${F})`:""}`).call(qn,"font-size",P&&($=>P[$])).call(Dp,this,o)).node()}}function PP(e){return e==null?null:To(e,"textOverflow",["clip","ellipsis","clip-start","clip-end","ellipsis-start","ellipsis-middle","ellipsis-end"]).replace(/^(clip|ellipsis)$/,"$1-end")}function iG(e,t,r,o){if(!r)return;const{lineAnchor:u,lineHeight:d,textOverflow:p,splitLines:a,clipLine:w}=t;e.each(function(T){const S=a(Rh(r[T])??"").map(w),k=S.length,I=u==="top"?.71:u==="bottom"?1-k:(164-k*100)/200;if(k>1){let P=0;for(let F=0;F<k;++F){if(++P,!S[F])continue;const G=this.ownerDocument.createElementNS(Th.svg,"tspan");G.setAttribute("x",0),F===P-1?G.setAttribute("y",`${(I+F)*d}em`):G.setAttribute("dy",`${P*d}em`),G.textContent=S[F],this.appendChild(G),P=0}}else I&&this.setAttribute("y",`${I*d}em`),this.textContent=S[0];if(p&&!o&&S[0]!==r[T]){const P=this.ownerDocument.createElementNS(Th.svg,"title");P.textContent=r[T],this.appendChild(P)}})}function kP(e,{x:t,y:r,...o}={}){return o.frameAnchor===void 0&&([t,r]=ME(t,r)),new Cx(e,{...o,x:t,y:r})}function rG(e,{x:t=Ba,...r}={}){return new Cx(e,KV({...r,x:t}))}function aG(e,{y:t=Ba,...r}={}){return new Cx(e,QV({...r,y:t}))}function DP(e,t,r){qn(e,"text-anchor",t.textAnchor),qn(e,"font-family",t.fontFamily),qn(e,"font-size",t.fontSize),qn(e,"font-style",t.fontStyle),qn(e,"font-variant",t.fontVariant===void 0?oG(r):t.fontVariant),qn(e,"font-weight",t.fontWeight)}function oG(e){return e&&(Sj(e)||va(e))?"tabular-nums":void 0}const sG=new Set(["inherit","initial","revert","unset","xx-small","x-small","small","medium","large","x-large","xx-large","xxx-large","larger","smaller"]);function lG(e){return e==null||typeof e=="number"?[void 0,e]:typeof e!="string"?[e,void 0]:(e=e.trim().toLowerCase(),sG.has(e)||/^[+-]?\d*\.?\d+(e[+-]?\d+)?(\w*|%)$/.test(e)?[void 0,e]:[e,void 0])}function cG(e,t,r){const o=[];let u,d=0;for(const[p,a,w]of uG(e)){if(u===void 0&&(u=p),d>u&&r(e,u,a)>t&&(o.push(e.slice(u,d)+(e[d-1]===EP?"-":"")),u=p),w){o.push(e.slice(u,a)),u=void 0;continue}d=a}return o}function*uG(e){let t=0,r=0;const o=e.length;for(;r<o;){let u=1;switch(e[r]){case EP:case"-":++r,yield[t,r,!1],t=r;break;case" ":for(yield[t,r,!1];e[++r]===" ";);t=r;break;case"\r":e[r+1]===`
`&&++u;case`
`:yield[t,r,!0],r+=u,t=r;break;default:++r;break}}yield[t,r,!0]}const YT={a:56,b:63,c:57,d:63,e:58,f:37,g:62,h:60,i:26,j:26,k:55,l:26,m:88,n:60,o:60,p:62,q:62,r:39,s:54,t:38,u:60,v:55,w:79,x:54,y:55,z:55,A:69,B:67,C:73,D:74,E:61,F:58,G:76,H:75,I:28,J:55,K:67,L:58,M:89,N:75,O:78,P:65,Q:78,R:67,S:65,T:65,U:75,V:69,W:98,X:69,Y:67,Z:67,0:64,1:48,2:62,3:64,4:66,5:63,6:65,7:58,8:65,9:65," ":29,"!":32,'"':49,"'":31,"(":39,")":39,",":31,"-":48,".":31,"/":32,":":31,";":31,"?":52,"â":31,"â":31,"â":47,"â":47,"â¦":82};function Ix(e,t=0,r=e.length){let o=0;for(let u=t;u<r;u=Zh(e,u))o+=YT[e[u]]??(BP(e,u)?120:YT.e);return o}function Ex(e,t=0,r=e.length){let o=0;for(let u=t;u<r;u=Zh(e,u))o+=BP(e,u)?126:63;return o}function zP({monospace:e,lineWidth:t,textOverflow:r}){if(r!=null||t==1/0)return d=>d.split(/\r\n?|\n/g);const o=e?Ex:Ix,u=t*100;return d=>cG(d,u,o)}function RP({monospace:e,lineWidth:t,textOverflow:r}){if(r==null||t==1/0)return d=>d;const o=e?Ex:Ix,u=t*100;switch(r){case"clip-start":return d=>QT(d,u,o,"");case"clip-end":return d=>XT(d,u,o,"");case"ellipsis-start":return d=>QT(d,u,o,uh);case"ellipsis-middle":return d=>hG(d,u,o,uh);case"ellipsis-end":return d=>XT(d,u,o,uh)}}const uh="â¦";function Lh(e,t,r,o){const u=[];let d=0;for(let p=0,a=0,w=e.length;p<w;p=a){a=Zh(e,p);const T=r(e,p,a);if(d+T>t){for(d+=o;d>t&&p>0;)a=p,p=u.pop(),d-=r(e,p,a);return[p,t-d]}d+=T,u.push(p)}return[-1,0]}function XT(e,t,r,o){e=e.trim();const u=r(o),[d]=Lh(e,t,r,u);return d<0?e:e.slice(0,d).trimEnd()+o}function hG(e,t,r,o){e=e.trim();const u=r(e);if(u<=t)return e;const d=r(o)/2,[p,a]=Lh(e,t/2,r,d),[w]=Lh(e,u-t/2-a+d,r,-d);return w<0?o:e.slice(0,p).trimEnd()+o+e.slice(Zh(e,w)).trimStart()}function QT(e,t,r,o){e=e.trim();const u=r(e);if(u<=t)return e;const d=r(o),[p]=Lh(e,u-t+d,r,-d);return p<0?o:o+e.slice(Zh(e,p)).trimStart()}const Qb=/[\p{Combining_Mark}\p{Emoji_Modifier}]+/uy,KT=new RegExp("\\p{Extended_Pictographic}","uy");function Zh(e,t){return t+=fG(e,t)?2:1,pG(e,t)&&(t=Qb.lastIndex),dG(e,t)?Zh(e,t+1):t}function LP(e,t){return e.charCodeAt(t)<128}function fG(e,t){const r=e.charCodeAt(t);if(r>=55296&&r<56320){const o=e.charCodeAt(t+1);return o>=56320&&o<57344}return!1}function dG(e,t){return e.charCodeAt(t)===8205}function pG(e,t){return LP(e,t)?!1:(Qb.lastIndex=t,Qb.test(e))}function BP(e,t){return LP(e,t)?!1:(KT.lastIndex=t,KT.test(e))}const mG={ariaLabel:"vector",fill:"none",stroke:"currentColor",strokeWidth:1.5,strokeLinejoin:"round",strokeLinecap:"round"},FP=3.5,gG=FP*5,OP={draw(e,t,r){const o=t*r/gG;e.moveTo(0,0),e.lineTo(0,-t),e.moveTo(-o,o-t),e.lineTo(0,-t),e.lineTo(o,o-t)}},_G={draw(e,t,r){e.moveTo(-r,0),e.lineTo(0,-t),e.lineTo(r,0)}},yG=new Map([["arrow",OP],["spike",_G]]);function vG(e){return e&&typeof e.draw=="function"}function bG(e){if(vG(e))return e;const t=yG.get(`${e}`.toLowerCase());if(t)return t;throw new Error(`invalid shape: ${e}`)}class NP extends es{constructor(t,r={}){const{x:o,y:u,r:d=FP,length:p,rotate:a,shape:w=OP,anchor:T="middle",frameAnchor:S}=r,[k,I]=Pa(p,12),[P,F]=Pa(a,0);super(t,{x:{value:o,scale:"x",optional:!0},y:{value:u,scale:"y",optional:!0},length:{value:k,scale:"length",optional:!0},rotate:{value:P,optional:!0}},r,mG),this.r=+d,this.length=I,this.rotate=F,this.shape=bG(w),this.anchor=To(T,"anchor",["start","middle","end"]),this.frameAnchor=cx(S)}render(t,r,o,u,d){const{x:p,y:a}=r,{x:w,y:T,length:S,rotate:k}=o,{length:I,rotate:P,anchor:F,shape:G,r:H}=this,[Y,$]=my(this,u);return ua("svg:g",d).call(eu,this,u,d).call(nu,this,{x:w&&p,y:T&&a}).call(ae=>ae.selectAll().data(t).enter().append("path").call(tu,this).attr("transform",IP`translate(${w?ee=>w[ee]:Y},${T?ee=>T[ee]:$})${k?ee=>` rotate(${k[ee]})`:P?` rotate(${P})`:""}${F==="start"?"":F==="end"?S?ee=>` translate(0,${S[ee]})`:` translate(0,${I})`:S?ee=>` translate(0,${S[ee]/2})`:` translate(0,${I/2})`}`).attr("d",S?ee=>{const ce=Cb();return G.draw(ce,S[ee],H),ce}:(()=>{const ee=Cb();return G.draw(ee,I,H),ee})()).call(Dp,this,o)).node()}}function xG(e,t={}){const{x:r=Ba,...o}=t;return new NP(e,{...o,x:r})}function wG(e,t={}){const{y:r=Ba,...o}=t;return new NP(e,{...o,y:r})}function zl(e,t){return arguments.length<2&&!kl(e)&&(t=e,e=null),t===void 0&&(t={}),[e,t]}function gy({anchor:e}={},t){return e===void 0?t[0]:To(e,"anchor",t)}function jP(e){return gy(e,["left","right"])}function UP(e){return gy(e,["right","left"])}function VP(e){return gy(e,["bottom","top"])}function GP(e){return gy(e,["top","bottom"])}function Px(){const[e,t]=zl(...arguments);return ZP("y",jP(t),e,t)}function AG(){const[e,t]=zl(...arguments);return ZP("fy",UP(t),e,t)}function qP(){const[e,t]=zl(...arguments);return HP("x",VP(t),e,t)}function TG(){const[e,t]=zl(...arguments);return HP("fx",GP(t),e,t)}function ZP(e,t,r,{color:o="currentColor",opacity:u=1,stroke:d=o,strokeOpacity:p=u,strokeWidth:a=1,fill:w=o,fillOpacity:T=u,textAnchor:S,textStroke:k,textStrokeOpacity:I,textStrokeWidth:P,tickSize:F=e==="y"?6:0,tickPadding:G,tickRotate:H,x:Y,margin:$,marginTop:ae=$===void 0?20:$,marginRight:ee=$===void 0?t==="right"?40:0:$,marginBottom:ce=$===void 0?20:$,marginLeft:re=$===void 0?t==="left"?40:0:$,label:he,labelAnchor:be,labelArrow:ke,labelOffset:Ie,ariaLabel:ue=`${e}-axis`,...Ve}){return F=na(F),G=na(G),H=na(H),be!==void 0&&(be=To(be,"labelAnchor",["center","top","bottom"])),ke=e5(ke),fP(F&&!_a(d)?SG(e,t,r,{stroke:d,strokeOpacity:p,strokeWidth:a,tickSize:F,tickPadding:G,tickRotate:H,x:Y,ariaLabel:ue,...Ve}):null,_a(w)?null:CG(e,t,r,{fill:w,fillOpacity:T,stroke:k,strokeOpacity:I,strokeWidth:P,textAnchor:S,tickSize:F,tickPadding:G,tickRotate:H,x:Y,marginTop:ae,marginRight:ee,marginBottom:ce,marginLeft:re,ariaLabel:ue,...Ve}),!_a(w)&&he!==null?kP([],XP({fill:w,fillOpacity:T,...Ve},function(Ze,Xe,Re,ot,Pt){const bt=ot[e],{marginTop:_t,marginRight:tt,marginBottom:Tt,marginLeft:ct}=e==="y"&&Pt.inset||Pt,mt=be??(bt.bandwidth?"center":"top"),Xt=Ie??(t==="right"?tt:ct)-3;return mt==="center"?(this.textAnchor=void 0,this.lineAnchor=t==="right"?"bottom":"top",this.frameAnchor=t,this.rotate=-90):(this.textAnchor=t==="right"?"end":"start",this.lineAnchor=mt,this.frameAnchor=`${mt}-${t}`,this.rotate=0),this.dy=mt==="top"?3-_t:mt==="bottom"?Tt-3:0,this.dx=t==="right"?Xt:-Xt,this.ariaLabel=`${ue} label`,{facets:[[0]],channels:{text:{value:[JP(e,bt,{anchor:t,label:he,labelAnchor:mt,labelArrow:ke})]}}}})):null)}function HP(e,t,r,{color:o="currentColor",opacity:u=1,stroke:d=o,strokeOpacity:p=u,strokeWidth:a=1,fill:w=o,fillOpacity:T=u,textAnchor:S,textStroke:k,textStrokeOpacity:I,textStrokeWidth:P,tickSize:F=e==="x"?6:0,tickPadding:G,tickRotate:H,y:Y,margin:$,marginTop:ae=$===void 0?t==="top"?30:0:$,marginRight:ee=$===void 0?20:$,marginBottom:ce=$===void 0?t==="bottom"?30:0:$,marginLeft:re=$===void 0?20:$,label:he,labelAnchor:be,labelArrow:ke,labelOffset:Ie,ariaLabel:ue=`${e}-axis`,...Ve}){return F=na(F),G=na(G),H=na(H),be!==void 0&&(be=To(be,"labelAnchor",["center","left","right"])),ke=e5(ke),fP(F&&!_a(d)?MG(e,t,r,{stroke:d,strokeOpacity:p,strokeWidth:a,tickSize:F,tickPadding:G,tickRotate:H,y:Y,ariaLabel:ue,...Ve}):null,_a(w)?null:IG(e,t,r,{fill:w,fillOpacity:T,stroke:k,strokeOpacity:I,strokeWidth:P,textAnchor:S,tickSize:F,tickPadding:G,tickRotate:H,y:Y,marginTop:ae,marginRight:ee,marginBottom:ce,marginLeft:re,ariaLabel:ue,...Ve}),!_a(w)&&he!==null?kP([],XP({fill:w,fillOpacity:T,...Ve},function(Ze,Xe,Re,ot,Pt){const bt=ot[e],{marginTop:_t,marginRight:tt,marginBottom:Tt,marginLeft:ct}=e==="x"&&Pt.inset||Pt,mt=be??(bt.bandwidth?"center":"right"),Xt=Ie??(t==="top"?_t:Tt)-3;return mt==="center"?(this.frameAnchor=t,this.textAnchor=void 0):(this.frameAnchor=`${t}-${mt}`,this.textAnchor=mt==="right"?"end":"start"),this.lineAnchor=t,this.dy=t==="top"?-Xt:Xt,this.dx=mt==="right"?tt-3:mt==="left"?3-ct:0,this.ariaLabel=`${ue} label`,{facets:[[0]],channels:{text:{value:[JP(e,bt,{anchor:t,label:he,labelAnchor:mt,labelArrow:ke})]}}}})):null)}function SG(e,t,r,{strokeWidth:o=1,strokeLinecap:u=null,strokeLinejoin:d=null,facetAnchor:p=t+(e==="y"?"-empty":""),frameAnchor:a=t,tickSize:w,inset:T=0,insetLeft:S=T,insetRight:k=T,dx:I=0,y:P=e==="y"?void 0:null,ariaLabel:F,...G}){return Hh(wG,e,r,{ariaLabel:`${F} tick`,ariaHidden:!0},{strokeWidth:o,strokeLinecap:u,strokeLinejoin:d,facetAnchor:p,frameAnchor:a,y:P,...G,dx:t==="left"?+I-ka+ +S:+I+ka-k,anchor:"start",length:w,shape:t==="left"?BG:FG})}function MG(e,t,r,{strokeWidth:o=1,strokeLinecap:u=null,strokeLinejoin:d=null,facetAnchor:p=t+(e==="x"?"-empty":""),frameAnchor:a=t,tickSize:w,inset:T=0,insetTop:S=T,insetBottom:k=T,dy:I=0,x:P=e==="x"?void 0:null,ariaLabel:F,...G}){return Hh(xG,e,r,{ariaLabel:`${F} tick`,ariaHidden:!0},{strokeWidth:o,strokeLinejoin:d,strokeLinecap:u,facetAnchor:p,frameAnchor:a,x:P,...G,dy:t==="bottom"?+I-ka-k:+I+ka+ +S,anchor:"start",length:w,shape:t==="bottom"?RG:LG})}function CG(e,t,r,{facetAnchor:o=t+(e==="y"?"-empty":""),frameAnchor:u=t,tickSize:d,tickRotate:p=0,tickPadding:a=Math.max(3,9-d)+(Math.abs(p)>60?4*Math.cos(p*_P):0),text:w,textAnchor:T=Math.abs(p)>60?"middle":t==="left"?"end":"start",lineAnchor:S=p>60?"top":p<-60?"bottom":"middle",fontVariant:k,inset:I=0,insetLeft:P=I,insetRight:F=I,dx:G=0,ariaLabel:H,y:Y=e==="y"?void 0:null,...$}){return Hh(aG,e,r,{ariaLabel:`${H} tick label`},{facetAnchor:o,frameAnchor:u,text:w,textAnchor:T,lineAnchor:S,fontVariant:k,rotate:p,y:Y,...$,dx:t==="left"?+G-d-a+ +P:+G+ +d+ +a-F},function(ae,ee,ce,re,he){k===void 0&&(this.fontVariant=KP(ae)),w===void 0&&(he.text=QP(ae,ee,ce,re,t))})}function IG(e,t,r,{facetAnchor:o=t+(e==="x"?"-empty":""),frameAnchor:u=t,tickSize:d,tickRotate:p=0,tickPadding:a=Math.max(3,9-d)+(Math.abs(p)>=10?4*Math.cos(p*_P):0),text:w,textAnchor:T=Math.abs(p)>=10?p<0^t==="bottom"?"start":"end":"middle",lineAnchor:S=Math.abs(p)>=10?"middle":t==="bottom"?"top":"bottom",fontVariant:k,inset:I=0,insetTop:P=I,insetBottom:F=I,dy:G=0,x:H=e==="x"?void 0:null,ariaLabel:Y,...$}){return Hh(rG,e,r,{ariaLabel:`${Y} tick label`},{facetAnchor:o,frameAnchor:u,text:w===void 0?null:w,textAnchor:T,lineAnchor:S,fontVariant:k,rotate:p,x:H,...$,dy:t==="bottom"?+G+ +d+ +a-F:+G-d-a+ +P},function(ae,ee,ce,re,he){k===void 0&&(this.fontVariant=KP(ae)),w===void 0&&(he.text=QP(ae,ee,ce,re,t))})}function EG(){const[e,t]=zl(...arguments);return $P("y",jP(t),e,t)}function PG(){const[e,t]=zl(...arguments);return $P("fy",UP(t),e,t)}function kG(){const[e,t]=zl(...arguments);return WP("x",VP(t),e,t)}function DG(){const[e,t]=zl(...arguments);return WP("fx",GP(t),e,t)}function $P(e,t,r,{y:o=e==="y"?void 0:null,x:u=null,x1:d=t==="left"?u:null,x2:p=t==="right"?u:null,ariaLabel:a=`${e}-grid`,ariaHidden:w=!0,...T}){return Hh(tG,e,r,{ariaLabel:a,ariaHidden:w},{y:o,x1:d,x2:p,...YP(T)})}function WP(e,t,r,{x:o=e==="x"?void 0:null,y:u=null,y1:d=t==="top"?u:null,y2:p=t==="bottom"?u:null,ariaLabel:a=`${e}-grid`,ariaHidden:w=!0,...T}){return Hh(Xb,e,r,{ariaLabel:a,ariaHidden:w},{x:o,y1:d,y2:p,...YP(T)})}function YP({color:e="currentColor",opacity:t=.1,stroke:r=e,strokeOpacity:o=t,strokeWidth:u=1,...d}){return{stroke:r,strokeOpacity:o,strokeWidth:u,...d}}function XP({fill:e,fillOpacity:t,fontFamily:r,fontSize:o,fontStyle:u,fontVariant:d,fontWeight:p,monospace:a,pointerEvents:w,shapeRendering:T,clip:S=!1},k){return[,e]=zs(e),[,t]=Pa(t),{facet:"super",x:null,y:null,fill:e,fillOpacity:t,fontFamily:r,fontSize:o,fontStyle:u,fontVariant:d,fontWeight:p,monospace:a,pointerEvents:w,shapeRendering:T,clip:S,initializer:k}}function Hh(e,t,r,o,u,d){let p;function a(S,k,I,P,F,G){const H=S==null&&(t==="fx"||t==="fy"),{[t]:Y}=P;if(!Y)throw new Error(`missing scale: ${t}`);const $=Y.domain();let{interval:ae,ticks:ee,tickFormat:ce,tickSpacing:re=t==="x"?80:35}=u;if(typeof ee=="string"&&t5(Y)&&(ae=ee,ee=void 0),ee===void 0&&(ee=qh(ae,Y.type)??zG(Y,re)),S==null){if(kl(ee))S=Qc(ee);else if(ah(ee))S=Iv(ee,...Wa($));else if(Y.interval){let be=Y.interval;if(Y.ticks){const[ke,Ie]=Wa($),ue=(Ie-ke)/be[Tp];be=vT(be,ue/ee)??be,S=Iv(be,ke,Ie)}else{S=$;const ke=S.length;be=vT(be,ke/ee)??be,be!==Y.interval&&(S=Iv(be,...Wa(S)))}if(be===Y.interval){const ke=Math.round(S.length/ee);ke>1&&(S=S.filter((Ie,ue)=>ue%ke===0))}}else Y.ticks?S=Y.ticks(ee):S=$;if(!Y.ticks&&S.length&&S!==$){const be=new R_($);S=S.filter(ke=>be.has(ke)),S.length||Al(`Warning: the ${t}-axis ticks appear to not align with the scale domain, resulting in no ticks. Try different ticks?`)}t==="y"||t==="x"?k=[Gh(S)]:p[t]={scale:t,value:Ba}}d==null||d.call(this,Y,S,ee,ce,p);const he=Object.fromEntries(Object.entries(p).map(([be,ke])=>[be,{...ke,value:ta(S,ke.value)}]));return H&&(k=G.filterFacets(S,he)),{data:S,facets:k,channels:he}}const w=h_(u).initializer,T=e(r,h_({...u,initializer:a},w));return r==null?(p=T.channels,T.channels={}):p={},o!==void 0&&Object.assign(T,o),T.clip===void 0&&(T.clip=!1),T}function zG(e,t){const[r,o]=Wa(e.range());return(o-r)/t}function QP(e,t,r,o,u){return{value:kx(e,t,r,o,u)}}function kx(e,t,r,o,u){return typeof o=="function"&&!(e.type==="log"&&e.tickFormat)?o:o===void 0&&t&&va(t)?sj(e.type,t,u)??Rh:e.tickFormat?e.tickFormat(typeof r=="number"?r:null,o):typeof o=="string"&&e.domain().length>0?(va(e.domain())?Ap:Es)(o):o===void 0?Rh:Cs(o)}function Iv(e,t,r){return e.range(t,e.offset(e.floor(r)))}const RG={draw(e,t){e.moveTo(0,0),e.lineTo(0,t)}},LG={draw(e,t){e.moveTo(0,0),e.lineTo(0,-t)}},BG={draw(e,t){e.moveTo(0,0),e.lineTo(-t,0)}},FG={draw(e,t){e.moveTo(0,0),e.lineTo(t,0)}};function KP(e){return e.bandwidth&&!e.interval?void 0:"tabular-nums"}function JP(e,t,{anchor:r,label:o=t.label,labelAnchor:u,labelArrow:d}={}){if(!(o==null||o.inferred&&t5(t)&&/^(date|time|year)$/i.test(o))){if(o=String(o),d==="auto"&&(d=(!t.bandwidth||t.interval)&&!/[ââââ]/.test(o)),!d)return o;if(d===!0){const p=UU(t);p&&(d=/x$/.test(e)||u==="center"?/x$/.test(e)===p<0?"left":"right":p<0?"up":"down")}switch(d){case"left":return`â ${o}`;case"right":return`${o} â`;case"up":return r==="right"?`${o} â`:`â ${o}`;case"down":return r==="right"?`${o} â`:`â ${o}`}return o}}function e5(e="auto"){return _a(e)?!1:typeof e=="boolean"?e:To(e,"labelArrow",["auto","up","right","down","left"])}function t5(e){return va(e.domain())}function JT(e,t){if(t==null)return t;const r=e(t);if(!r)throw new Error(`scale not found: ${t}`);return r}function OG(e,{opacity:t,...r}={}){if(!Jc(e)&&!sP(e))throw new Error(`swatches legend requires ordinal or threshold color scale (not ${e.type})`);return n5(e,r,(o,u,d,p)=>o.append("svg").attr("width",d).attr("height",p).attr("fill",u.scale).attr("fill-opacity",Pa(t)[1]).append("rect").attr("width","100%").attr("height","100%"))}function NG(e,{fill:t=(T=>(T=e.hint)==null?void 0:T.fill)()!==void 0?e.hint.fill:"none",fillOpacity:r=1,stroke:o=(S=>(S=e.hint)==null?void 0:S.stroke)()!==void 0?e.hint.stroke:_a(t)?"currentColor":"none",strokeOpacity:u=1,strokeWidth:d=1.5,r:p=4.5,...a}={},w){const[k,I]=zs(t),[P,F]=zs(o),G=JT(w,k),H=JT(w,P),Y=p*p*Math.PI;return r=Pa(r)[1],u=Pa(u)[1],d=Pa(d)[1],n5(e,a,($,ae,ee,ce)=>$.append("svg").attr("viewBox","-8 -8 16 16").attr("width",ee).attr("height",ce).attr("fill",k==="color"?re=>G.scale(re):I).attr("fill-opacity",r).attr("stroke",P==="color"?re=>H.scale(re):F).attr("stroke-opacity",u).attr("stroke-width",d).append("path").attr("d",re=>{const he=Cb();return e.scale(re).draw(he,Y),he}))}function n5(e,t={},r){let{columns:o,tickFormat:u,fontVariant:d=gP(e),swatchSize:p=15,swatchWidth:a=p,swatchHeight:w=p,marginLeft:T=0,className:S,style:k,width:I}=t;const P=vx(t);S=xx(S),u=kx(e.scale,e.domain,void 0,u);const F=ua("div",P).attr("class",`${S}-swatches ${S}-swatches-${o!=null?"columns":"wrap"}`);let G;return o!=null?(G=`:where(.${S}-swatches-columns .${S}-swatch) {
  display: flex;
  align-items: center;
  break-inside: avoid;
  padding-bottom: 1px;
}
:where(.${S}-swatches-columns .${S}-swatch::before) {
  flex-shrink: 0;
}
:where(.${S}-swatches-columns .${S}-swatch-label) {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}`,F.style("columns",o).selectAll().data(e.domain).enter().append("div").attr("class",`${S}-swatch`).call(r,e,a,w).call(H=>H.append("div").attr("class",`${S}-swatch-label`).attr("title",u).text(u))):(G=`:where(.${S}-swatches-wrap) {
  display: flex;
  align-items: center;
  min-height: 33px;
  flex-wrap: wrap;
}
:where(.${S}-swatches-wrap .${S}-swatch) {
  display: inline-flex;
  align-items: center;
  margin-right: 1em;
}`,F.selectAll().data(e.domain).enter().append("span").attr("class",`${S}-swatch`).call(r,e,a,w).append(function(){return this.ownerDocument.createTextNode(u.apply(this,arguments))})),F.call(H=>H.insert("style","*").text(`:where(.${S}-swatches) {
  font-family: system-ui, sans-serif;
  font-size: 10px;
  margin-bottom: 0.5em;
}
:where(.${S}-swatch > svg) {
  margin-right: 0.5em;
  overflow: visible;
}
${G}`)).style("margin-left",T?`${+T}px`:null).style("width",I===void 0?null:`${+I}px`).style("font-variant",Ur(d,"normal")).call(wx,k).node()}const Kb=new Map([["symbol",NG],["color",r5],["opacity",UG]]);function jG(e,t,r={}){return(o,u)=>{if(!Kb.has(o))throw new Error(`unknown legend type: ${o}`);if(o in e)return Kb.get(o)(e[o],i5(t,r[o],u),d=>e[d])}}function i5({className:e,...t},{label:r,ticks:o,tickFormat:u}={},d){return Ej(d,{className:e,...t},{label:r,ticks:o,tickFormat:u})}function r5(e,{legend:t=!0,...r}){if(t===!0&&(t=e.type==="ordinal"?"swatches":"ramp"),e.domain!==void 0)switch(`${t}`.toLowerCase()){case"swatches":return OG(e,r);case"ramp":return GV(e,r);default:throw new Error(`unknown legend type: ${t}`)}}function UG({type:e,interpolate:t,...r},{legend:o=!0,color:u=Sl(0,0,0),...d}){if(!t)throw new Error(`${e} opacity scales are not supported`);if(o===!0&&(o="ramp"),`${o}`.toLowerCase()!=="ramp")throw new Error(`${o} opacity legends are not supported`);return r5({type:e,...r,interpolate:VG(u)},{legend:o,...d})}function VG(e){const{r:t,g:r,b:o}=Sl(e)||Sl(0,0,0);return u=>`rgba(${t},${r},${o},${u})`}function GG(e,t,r){const o=[];for(const[u,d]of Kb){const p=r[u];if(p!=null&&p.legend&&u in e){const a=d(e[u],i5(t,e[u],p),w=>e[w]);a!=null&&o.push(a)}}return o}function qG(e,{inset:t=0,insetTop:r=t,insetRight:o=t,insetBottom:u=t,insetLeft:d=t}={}){e.insetTop=na(r),e.insetRight=na(o),e.insetBottom=na(u),e.insetLeft=na(d)}function ZG(e,{r:t,rx:r,ry:o,rx1:u=t,ry1:d=t,rx2:p=t,ry2:a=t,rx1y1:w=u!==void 0?+u:d!==void 0?+d:0,rx1y2:T=u!==void 0?+u:a!==void 0?+a:0,rx2y1:S=p!==void 0?+p:d!==void 0?+d:0,rx2y2:k=p!==void 0?+p:a!==void 0?+a:0}={}){w||T||S||k?(e.rx1y1=w,e.rx1y2=T,e.rx2y1=S,e.rx2y2=k):(e.rx=Ur(r,"auto"),e.ry=Ur(o,"auto"))}function HG(e,t,r,o,u,d){const{rx1y1:p,rx1y2:a,rx2y1:w,rx2y2:T}=d;typeof t!="function"&&(t=Cs(t)),typeof r!="function"&&(r=Cs(r)),typeof o!="function"&&(o=Cs(o)),typeof u!="function"&&(u=Cs(u));const S=Math.max(Math.abs(p+w),Math.abs(a+T)),k=Math.max(Math.abs(p+a),Math.abs(w+T));e.attr("d",I=>{const P=t(I),F=r(I),G=o(I),H=u(I),Y=P>G,$=F>H,ae=Y?G:P,ee=Y?P:G,ce=$?H:F,re=$?F:H,he=Math.min(1,(ee-ae)/S,(re-ce)/k),be=he*(Y?$?T:w:$?a:p),ke=he*(Y?$?a:p:$?T:w),Ie=he*(Y?$?p:a:$?w:T),ue=he*(Y?$?w:T:$?p:a);return`M${ae},${ce+eg(be,ue)}A${be},${be} 0 0 ${be<0?0:1} ${ae+Jm(be,ue)},${ce}H${ee-Jm(ke,Ie)}A${ke},${ke} 0 0 ${ke<0?0:1} ${ee},${ce+eg(ke,Ie)}V${re-eg(Ie,ke)}A${Ie},${Ie} 0 0 ${Ie<0?0:1} ${ee-Jm(Ie,ke)},${re}H${ae+Jm(ue,be)}A${ue},${ue} 0 0 ${ue<0?0:1} ${ae},${re-eg(ue,be)}Z`})}function Jm(e,t){return t<0?e:Math.abs(e)}function eg(e,t){return t<0?Math.abs(e):e}const $G={ariaLabel:"frame",fill:"none",stroke:"currentColor",clip:!1},WG={ariaLabel:"frame",fill:null,stroke:"currentColor",strokeLinecap:"square",clip:!1};class YG extends es{constructor(t={}){const{anchor:r=null}=t;super(vg,void 0,t,r==null?$G:WG),this.anchor=TE(r,"anchor",["top","right","bottom","left"]),qG(this,t),r||ZG(this,t)}render(t,r,o,u,d){const{marginTop:p,marginRight:a,marginBottom:w,marginLeft:T,width:S,height:k}=u,{anchor:I,insetTop:P,insetRight:F,insetBottom:G,insetLeft:H}=this,{rx:Y,ry:$,rx1y1:ae,rx1y2:ee,rx2y1:ce,rx2y2:re}=this,he=T+H,be=S-a-F,ke=p+P,Ie=k-w-G;return ua(I?"svg:line":ae||ee||ce||re?"svg:path":"svg:rect",d).datum(0).call(eu,this,u,d).call(tu,this).call(Dp,this,o).call(nu,this,{}).call(I==="left"?ue=>ue.attr("x1",he).attr("x2",he).attr("y1",ke).attr("y2",Ie):I==="right"?ue=>ue.attr("x1",be).attr("x2",be).attr("y1",ke).attr("y2",Ie):I==="top"?ue=>ue.attr("x1",he).attr("x2",be).attr("y1",ke).attr("y2",ke):I==="bottom"?ue=>ue.attr("x1",he).attr("x2",be).attr("y1",Ie).attr("y2",Ie):ae||ee||ce||re?ue=>ue.call(HG,he,ke,be,Ie,this):ue=>ue.attr("x",he).attr("y",ke).attr("width",be-he).attr("height",Ie-ke).attr("rx",Y).attr("ry",$)).node()}}function XG(e){return new YG(e)}const Ev={ariaLabel:"tip",fill:"var(--plot-background)",stroke:"currentColor"},QG=new Set(["geometry","href","src","ariaLabel","scales"]);class KG extends es{constructor(t,r={}){r.tip&&(r={...r,tip:!1}),r.title===void 0&&kl(t)&&PE(t)&&(r={...r,title:Ba});const{x:o,y:u,x1:d,x2:p,y1:a,y2:w,anchor:T,preferredAnchor:S="bottom",monospace:k,fontFamily:I=k?"ui-monospace, monospace":void 0,fontSize:P,fontStyle:F,fontVariant:G,fontWeight:H,lineHeight:Y=1,lineWidth:$=20,frameAnchor:ae,format:ee,textAnchor:ce="start",textOverflow:re,textPadding:he=8,title:be,pointerSize:ke=12,pathFilter:Ie="drop-shadow(0 3px 4px rgba(0,0,0,0.2))"}=r;super(t,{x:{value:d!=null&&p!=null?null:o,scale:"x",optional:!0},y:{value:a!=null&&w!=null?null:u,scale:"y",optional:!0},x1:{value:d,scale:"x",optional:p==null},y1:{value:a,scale:"y",optional:w==null},x2:{value:p,scale:"x",optional:d==null},y2:{value:w,scale:"y",optional:a==null},title:{value:be,optional:!0}},r,Ev),this.anchor=jb(T,"anchor"),this.preferredAnchor=jb(S,"preferredAnchor"),this.frameAnchor=cx(ae),this.textAnchor=Ur(ce,"middle"),this.textPadding=+he,this.pointerSize=+ke,this.pathFilter=Jr(Ie),this.lineHeight=+Y,this.lineWidth=+$,this.textOverflow=PP(re),this.monospace=!!k,this.fontFamily=Jr(I),this.fontSize=na(P),this.fontStyle=Jr(F),this.fontVariant=Jr(G),this.fontWeight=Jr(H);for(const ue in Ev)ue in this.channels&&(this[ue]=Ev[ue]);this.splitLines=zP(this),this.clipLine=RP(this),this.format=typeof ee=="string"||typeof ee=="function"?{title:ee}:{...ee}}render(t,r,o,u,d){const p=this,{x:a,y:w,fx:T,fy:S}=r,{ownerSVGElement:k,document:I}=d,{anchor:P,monospace:F,lineHeight:G,lineWidth:H}=this,{textPadding:Y,pointerSize:$,pathFilter:ae}=this,{marginTop:ee,marginLeft:ce}=u,{x1:re,y1:he,x2:be,y2:ke,x:Ie=re??be,y:ue=he??ke}=o,Ve=T?T(t.fx)-ce:0,Ze=S?S(t.fy)-ee:0,[Xe,Re]=my(this,u),ot=pP(o,Xe),Pt=mP(o,Re),bt=F?Ex:Ix,_t=bt(uh);let tt,Tt;"title"in o?(tt=eS.call(this,{title:o.channels.title},r),Tt=iq):(tt=eS.call(this,o.channels,r),Tt=rq);const ct=ua("svg:g",d).call(eu,this,u,d).call(DP,this).call(nu,this,{x:Ie&&a,y:ue&&w}).call(Ut=>Ut.selectAll().data(t).enter().append("g").attr("transform",St=>`translate(${Math.round(ot(St))},${Math.round(Pt(St))})`).call(tu,this).call(St=>St.append("path").attr("filter",ae)).call(St=>St.append("text").each(function(pt){const Ft=Dc(this);this.setAttribute("fill","currentColor"),this.setAttribute("fill-opacity",1),this.setAttribute("stroke","none");const nt=Tt.call(p,pt,t,tt,r,o);if(typeof nt=="string")for(const De of p.splitLines(nt))mt(Ft,{value:p.clipLine(De)});else{const De=new Set;for(const Ke of nt){const{label:Be=""}=Ke;Be&&De.has(Be)||(De.add(Be),mt(Ft,Ke))}}})));function mt(Ut,{label:St,value:pt,color:Ft,opacity:nt}){St??(St=""),pt??(pt="");const De=Ft!=null||nt!=null;let Ke,Be=H*100;const[wt]=Lh(St,Be,bt,_t);if(wt>=0)St=St.slice(0,wt).trimEnd()+uh,Ke=pt.trim(),pt="";else{(St||!pt&&!De)&&(pt=" "+pt);const[Rt]=Lh(pt,Be-bt(St),bt,_t);Rt>=0&&(Ke=pt.trim(),pt=pt.slice(0,Rt).trimEnd()+uh)}const gt=Ut.append("tspan").attr("x",0).attr("dy",`${G}em`).text("â");St&&gt.append("tspan").attr("font-weight","bold").text(St),pt&&gt.append(()=>I.createTextNode(pt)),De&&gt.append("tspan").text(" â ").attr("fill",Ft).attr("fill-opacity",nt).style("user-select","none"),Ke&&gt.append("title").text(Ke)}function Xt(){const{width:Ut,height:St}=u.facet??u;ct.selectChildren().each(function(pt){let{x:Ft,width:nt,height:De}=this.getBBox();nt=Math.round(nt),De=Math.round(De);let Ke=P;if(Ke===void 0){const gt=ot(pt)+Ve,Rt=Pt(pt)+Ze,st=gt+nt+$+Y*2<Ut,ht=gt-nt-$-Y*2>0,qe=Rt+De+$+Y*2<St,Mt=Rt-De-$-Y*2>0;Ke=st&&ht?qe&&Mt?p.preferredAnchor:Mt?"bottom":"top":qe&&Mt?st?"left":"right":(st||ht)&&(qe||Mt)?`${Mt?"bottom":"top"}-${st?"left":"right"}`:p.preferredAnchor}const Be=this.firstChild,wt=this.lastChild;if(Be.setAttribute("d",nq(Ke,$,Y,nt,De)),Ft)for(const gt of wt.childNodes)gt.setAttribute("x",-Ft);wt.setAttribute("y",`${+eq(Ke,wt.childNodes.length,G).toFixed(6)}em`),wt.setAttribute("transform",`translate(${tq(Ke,$,Y,nt,De)})`)}),ct.attr("visibility",null)}return t.length&&(ct.attr("visibility","hidden"),k.isConnected?Promise.resolve().then(Xt):typeof requestAnimationFrame<"u"&&requestAnimationFrame(Xt)),ct.node()}}function JG(e,{x:t,y:r,...o}={}){return o.frameAnchor===void 0&&([t,r]=ME(t,r)),new KG(e,{...o,x:t,y:r})}function eq(e,t,r){return/^top(?:-|$)/.test(e)?.94-r:-.29-t*r}function tq(e,t,r,o,u){switch(e){case"middle":return[-o/2,u/2];case"top-left":return[r,t+r];case"top":return[-o/2,t/2+r];case"top-right":return[-o-r,t+r];case"right":return[-t/2-o-r,u/2];case"bottom-left":return[r,-t-r];case"bottom":return[-o/2,-t/2-r];case"bottom-right":return[-o-r,-t-r];case"left":return[r+t/2,u/2]}}function nq(e,t,r,o,u){const d=o+r*2,p=u+r*2;switch(e){case"middle":return`M${-d/2},${-p/2}h${d}v${p}h${-d}z`;case"top-left":return`M0,0l${t},${t}h${d-t}v${p}h${-d}z`;case"top":return`M0,0l${t/2},${t/2}h${(d-t)/2}v${p}h${-d}v${-p}h${(d-t)/2}z`;case"top-right":return`M0,0l${-t},${t}h${t-d}v${p}h${d}z`;case"right":return`M0,0l${-t/2},${-t/2}v${t/2-p/2}h${-d}v${p}h${d}v${t/2-p/2}z`;case"bottom-left":return`M0,0l${t},${-t}h${d-t}v${-p}h${-d}z`;case"bottom":return`M0,0l${t/2},${-t/2}h${(d-t)/2}v${-p}h${-d}v${p}h${(d-t)/2}z`;case"bottom-right":return`M0,0l${-t},${-t}h${t-d}v${-p}h${d}z`;case"left":return`M0,0l${t/2},${-t/2}v${t/2-p/2}h${d}v${p}h${-d}v${t/2-p/2}z`}}function eS(e,t){var u,d;const r={};let o=this.format;o=tS(o,e,"x"),o=tS(o,e,"y"),this.format=o;for(const p in o){const a=o[p];if(!(a===null||a===!1))if(p==="fx"||p==="fy")r[p]=!0;else{const w=ET(e,p);w&&(r[p]=w)}}for(const p in e){if(p in r||p in o||QG.has(p)||(p==="x"||p==="y")&&e.geometry)continue;const a=ET(e,p);if(a){if(a.scale==null&&a.defaultScale==="color")continue;r[p]=a}}this.facet&&(t.fx&&!("fx"in o)&&(r.fx=!0),t.fy&&!("fy"in o)&&(r.fy=!0));for(const p in r){const a=this.format[p];if(typeof a=="string"){const w=((u=r[p])==null?void 0:u.value)??((d=t[p])==null?void 0:d.domain())??[];this.format[p]=(va(w)?Ap:Es)(a)}else if(a===void 0||a===!0){const w=t[p];this.format[p]=w!=null&&w.bandwidth?kx(w,w.domain()):Rh}}return r}function tS(e,t,r){if(!(r in e))return e;const o=`${r}1`,u=`${r}2`;if((o in e||!(o in t))&&(u in e||!(u in t)))return e;const d=Object.entries(e),p=e[r];return d.splice(d.findIndex(([a])=>a===r)+1,0,[o,p],[u,p]),Object.fromEntries(d)}function iq(e,t,{title:r}){return this.format.title(r.value[e],e)}function*rq(e,t,r,o,u){for(const d in r){if(d==="fx"||d==="fy"){yield{label:p_(o,r,d),value:this.format[d](t[d],e)};continue}if(d==="x1"&&"x2"in r||d==="y1"&&"y2"in r)continue;const p=r[d];if(d==="x2"&&"x1"in r)yield{label:iS(o,r,"x"),value:nS(this.format.x2,r.x1,p,e)};else if(d==="y2"&&"y1"in r)yield{label:iS(o,r,"y"),value:nS(this.format.y2,r.y1,p,e)};else{const a=p.value[e],w=p.scale;if(!Cl(a)&&w==null)continue;yield{label:p_(o,r,d),value:this.format[d](a,e),color:w==="color"?u[d][e]:null,opacity:w==="opacity"?u[d][e]:null}}}}function nS(e,t,r,o){var u;return(u=r.hint)!=null&&u.length?`${e(r.value[o]-t.value[o],o)}`:`${e(t.value[o],o)}â${e(r.value[o],o)}`}function iS(e,t,r){const o=p_(e,t,`${r}1`,r),u=p_(e,t,`${r}2`,r);return o===u?o:`${o}â${u}`}function p_(e,t,r,o=r){const u=t[r],d=e[(u==null?void 0:u.scale)??r];return String((d==null?void 0:d.label)??(u==null?void 0:u.label)??o)}function Jb(e={}){var _t;const{facet:t,style:r,title:o,subtitle:u,caption:d,ariaLabel:p,ariaDescription:a}=e,w=xx(e.className),T=e.marks===void 0?[]:aS(e.marks);T.push(...hq(T));const S=cq(t,e),k=new Map;for(const tt of T){const Tt=oS(tt,S,e);Tt&&k.set(tt,Tt)}const I=new Map;S&&md(I,[S],e),md(I,k,e);const P=aS(fq(T,I,e));for(const tt of P){const Tt=oS(tt,S,e);Tt&&k.set(tt,Tt)}T.unshift(...P);let F=YU(I,e);if(F!==void 0){const tt=S?Tv(F,S):void 0;for(const ct of T){if(ct.facet===null||ct.facet==="super")continue;const mt=k.get(ct);mt!==void 0&&(mt.facetsIndex=ct.fx!=null||ct.fy!=null?Tv(F,mt):tt)}const Tt=new Set;for(const{facetsIndex:ct}of k.values())ct==null||ct.forEach((mt,Xt)=>{(mt==null?void 0:mt.length)>0&&Tt.add(Xt)});F.forEach(0<Tt.size&&Tt.size<F.length?(ct,mt)=>ct.empty=!Tt.has(mt):ct=>ct.empty=!1);for(const ct of T)if(ct.facet==="exclude"){const mt=k.get(ct);mt!==void 0&&(mt.facetsIndex=KU(mt.facetsIndex))}}for(const tt of Xi.keys())Ob(e[tt])&&tt!=="fx"&&tt!=="fy"&&I.set(tt,[]);const G=new Map;for(const tt of T){if(G.has(tt))throw new Error("duplicate mark; each mark must be unique");const{facetsIndex:Tt,channels:ct}=k.get(tt)??{},{data:mt,facets:Xt,channels:Ut}=tt.initialize(Tt,ct,e);Dx(Ut,e),G.set(tt,{data:mt,facets:Xt,channels:Ut})}const H=qb(md(I,G,e),e),Y=jV(H,T,e);NU(H,Y);const $=FT(H),{fx:ae,fy:ee}=$,ce=ae||ee?rP(H,Y):Y,re=ae||ee?vq($,Y):Y,he=vx(e),be=he.document,ke=G_("svg").call(be.documentElement);let Ie=ke;he.ownerSVGElement=ke,he.className=w,he.projection=sV(e,ce),he.path=function(){return b1(this.projection??pV($))},he.filterFacets=(tt,Tt)=>Tv(F,{channels:Tt,groups:yx(tt,Tt)}),he.getMarkState=tt=>{const Tt=G.get(tt),ct=k.get(tt);return{...Tt,channels:{...Tt.channels,...ct==null?void 0:ct.channels}}},he.dispatchValue=tt=>{Ie.value!==tt&&(Ie.value=tt,Ie.dispatchEvent(new he.document.defaultView.Event("input",{bubbles:!0})))};const ue=new Set;for(const[tt,Tt]of G)if(tt.initializer!=null){const ct=tt.facet==="super"?re:ce,mt=tt.initializer(Tt.data,Tt.facets,Tt.channels,$,ct,he);if(mt.data!==void 0&&(Tt.data=mt.data),mt.facets!==void 0&&(Tt.facets=mt.facets),mt.channels!==void 0){const{fx:Xt,fy:Ut,...St}=mt.channels;lq(St),Object.assign(Tt.channels,St);for(const pt of Object.values(St)){const{scale:Ft}=pt;Ft!=null&&!Dj(Xi.get(Ft))&&(a5(pt,e),ue.add(Ft))}(Xt!=null||Ut!=null)&&k.set(tt,!0)}}if(ue.size){const tt=new Map;md(tt,G,e,Xt=>ue.has(Xt)),md(I,G,e,Xt=>ue.has(Xt));const Tt=yq(qb(tt,e),H),{scales:ct,...mt}=FT(Tt);Object.assign(H,Tt),Object.assign($,mt),Object.assign($.scales,ct)}let Ve,Ze;F!==void 0&&(Ve={x:ae==null?void 0:ae.domain(),y:ee==null?void 0:ee.domain()},F=XU(F,Ve),Ze=QU(ae,ee,Y));for(const[tt,Tt]of G)Tt.values=tt.scale(Tt.channels,$,he);const{width:Xe,height:Re}=Y;Dc(ke).attr("class",w).attr("fill","currentColor").attr("font-family","system-ui, sans-serif").attr("font-size",10).attr("text-anchor","middle").attr("width",Xe).attr("height",Re).attr("viewBox",`0 0 ${Xe} ${Re}`).attr("aria-label",p).attr("aria-description",a).call(tt=>tt.append("style").text(`:where(.${w}) {
  --plot-background: white;
  display: block;
  height: auto;
  height: intrinsic;
  max-width: 100%;
}
:where(.${w} text),
:where(.${w} tspan) {
  white-space: pre;
}`)).call(wx,r);for(const tt of T){const{channels:Tt,values:ct,facets:mt}=G.get(tt);if(F===void 0||tt.facet==="super"){let Xt=null;if(mt&&(Xt=mt[0],Xt=tt.filter(Xt,Tt,ct),Xt.length===0))continue;const Ut=tt.render(Xt,$,ct,re,he);if(Ut==null)continue;ke.appendChild(Ut)}else{let Xt;for(const Ut of F){if(!(((_t=tt.facetAnchor)==null?void 0:_t.call(tt,F,Ve,Ut))??!Ut.empty))continue;let St=null;if(mt){const Ft=k.has(tt);if(St=mt[Ft?Ut.i:0],St=tt.filter(St,Tt,ct),St.length===0)continue;!Ft&&St===mt[0]&&(St=_j(St)),St.fx=Ut.x,St.fy=Ut.y,St.fi=Ut.i}const pt=tt.render(St,$,ct,ce,he);if(pt!=null){(Xt??(Xt=Dc(ke).append("g"))).append(()=>pt).datum(Ut);for(const Ft of["aria-label","aria-description","aria-hidden","transform"])pt.hasAttribute(Ft)&&(Xt.attr(Ft,pt.getAttribute(Ft)),pt.removeAttribute(Ft))}}Xt==null||Xt.selectChildren().each(Ze)}}const ot=GG(H,he,e),{figure:Pt=o!=null||u!=null||d!=null||ot.length>0}=e;Pt&&(Ie=be.createElement("figure"),Ie.className=`${w}-figure`,Ie.style.maxWidth="initial",o!=null&&Ie.append(rS(be,o,"h2")),u!=null&&Ie.append(rS(be,u,"h3")),Ie.append(...ot,ke),d!=null&&Ie.append(aq(be,d)),"value"in ke&&(Ie.value=ke.value,delete ke.value)),Ie.scale=$U($.scales),Ie.legend=jG(H,he,e);const bt=wU();return bt>0&&Dc(ke).append("text").attr("x",Xe).attr("y",20).attr("dy","-1em").attr("text-anchor","end").attr("font-family","initial").text("â ï¸").append("title").text(`${bt.toLocaleString("en-US")} warning${bt===1?"":"s"}. Please check the console.`),Ie}function rS(e,t,r){if(t.ownerDocument)return t;const o=e.createElement(r);return o.append(t),o}function aq(e,t){const r=e.createElement("figcaption");return r.append(t),r}function aS(e){return e.flat(1/0).filter(t=>t!=null).map(oq)}function oq(e){return typeof e.render=="function"?e:new sq(e)}class sq extends es{constructor(t){if(typeof t!="function")throw new TypeError("invalid mark; missing render function");super(),this.render=t}render(){}}function Dx(e,t){for(const r in e)a5(e[r],t);return e}function a5(e,t){const{scale:r,transform:o=!0}=e;if(r==null||!o)return;const{type:u,percent:d,interval:p,transform:a=d?w=>w==null?NaN:w*100:EE(p,u)}=t[r]??{};a!=null&&(e.value=pr(e.value,a),e.transform=!1)}function lq(e){for(const t in e)qE(t,e[t])}function md(e,t,r,o=pj){var u,d;for(const{channels:p}of t.values())for(const a in p){const w=p[a],{scale:T}=w;if(T!=null&&o(T))if(T==="projection"){if(!hV(r)){const S=((u=r.x)==null?void 0:u.domain)===void 0,k=((d=r.y)==null?void 0:d.domain)===void 0;if(S||k){const[I,P]=dV(w);S&&Pv(e,"x",I),k&&Pv(e,"y",P)}}}else Pv(e,T,w)}return e}function Pv(e,t,r){const o=e.get(t);o!==void 0?o.push(r):e.set(t,[r])}function cq(e,t){if(e==null)return;const{x:r,y:o}=e;if(r==null&&o==null)return;const u=zh(e.data);if(u==null)throw new Error("missing facet data");const d={};r!=null&&(d.fx=Xd(u,{value:r,scale:"fx"})),o!=null&&(d.fy=Xd(u,{value:o,scale:"fy"})),Dx(d,t);const p=yx(u,d);return{channels:d,groups:p,data:e.data}}function oS(e,t,r){if(e.facet===null||e.facet==="super")return;const{fx:o,fy:u}=e;if(o!=null||u!=null){const w=zh(e.data??o??u);if(w===void 0)throw new Error(`missing facet data in ${e.ariaLabel}`);if(w===null)return;const T={};return o!=null&&(T.fx=Xd(w,{value:o,scale:"fx"})),u!=null&&(T.fy=Xd(w,{value:u,scale:"fy"})),Dx(T,r),{channels:T,groups:yx(w,T)}}if(t===void 0)return;const{channels:d,groups:p,data:a}=t;if(e.facet!=="auto"||e.data===a)return{channels:d,groups:p};a.length>0&&(p.size>1||p.size===1&&d.fx&&d.fy&&[...p][0][1].size>1)&&Nb(zh(e.data))===Nb(a)&&Al(`Warning: the ${e.ariaLabel} mark appears to use faceted data, but isnât faceted. The mark data has the same length as the facet data and the mark facet option is "auto", but the mark data and facet data are distinct. If this mark should be faceted, set the mark facet option to true; otherwise, suppress this warning by setting the mark facet option to false.`)}function uq(e,t={}){return h_({...t,x:null,y:null},(r,o,u,d,p,a)=>a.getMarkState(e))}function hq(e){const t=[];for(const r of e){let o=r.tip;if(o){o===!0?o={}:typeof o=="string"&&(o={pointer:o});let{pointer:u,preferredAnchor:d}=o;u=/^x$/i.test(u)?Wb:/^y$/i.test(u)?HT:VV,o=u(uq(r,o)),o.title=null,d===void 0&&(o.preferredAnchor=u===HT?"left":"bottom");const p=JG(r.data,o);p.facet=r.facet,p.facetAnchor=r.facetAnchor,t.push(p)}}return t}function fq(e,t,r){let{projection:o,x:u={},y:d={},fx:p={},fy:a={},axis:w,grid:T,facet:S={},facet:{axis:k=w,grid:I}=S,x:{axis:P=w,grid:F=P===null?null:T}=u,y:{axis:G=w,grid:H=G===null?null:T}=d,fx:{axis:Y=k,grid:$=Y===null?null:I}=p,fy:{axis:ae=k,grid:ee=ae===null?null:I}=a}=r;(o||!Ob(u)&&!sS("x",e))&&(P=F=null),(o||!Ob(d)&&!sS("y",e))&&(G=H=null),t.has("fx")||(Y=$=null),t.has("fy")||(ae=ee=null),P===void 0&&(P=!ig(e,"x")),G===void 0&&(G=!ig(e,"y")),Y===void 0&&(Y=!ig(e,"fx")),ae===void 0&&(ae=!ig(e,"fy")),P===!0&&(P="bottom"),G===!0&&(G="left"),Y===!0&&(Y=P==="top"||P===null?"bottom":"top"),ae===!0&&(ae=G==="right"||G===null?"left":"right");const ce=[];return ng(ce,ee,PG,a),tg(ce,ae,AG,"right","left",S,a),ng(ce,$,DG,p),tg(ce,Y,TG,"top","bottom",S,p),ng(ce,H,EG,d),tg(ce,G,Px,"left","right",r,d),ng(ce,F,kG,u),tg(ce,P,qP,"bottom","top",r,u),ce}function tg(e,t,r,o,u,d,p){if(!t)return;const a=dq(t);p=pq(a?o:t,d,p);const{line:w}=p;(r===Px||r===qP)&&w&&!Yd(w)&&e.push(XG(mq(p))),e.push(r(p)),a&&e.push(r({...p,anchor:u,label:null}))}function ng(e,t,r,o){!t||Yd(t)||e.push(r(gq(t,o)))}function dq(e){return/^\s*both\s*$/i.test(e)}function pq(e,t,{line:r=t.line,ticks:o,tickSize:u,tickSpacing:d,tickPadding:p,tickFormat:a,tickRotate:w,fontVariant:T,ariaLabel:S,ariaDescription:k,label:I=t.label,labelAnchor:P,labelArrow:F=t.labelArrow,labelOffset:G}){return{anchor:e,line:r,ticks:o,tickSize:u,tickSpacing:d,tickPadding:p,tickFormat:a,tickRotate:w,fontVariant:T,ariaLabel:S,ariaDescription:k,label:I,labelAnchor:P,labelArrow:F,labelOffset:G}}function mq(e){const{anchor:t,line:r}=e;return{anchor:t,facetAnchor:t+"-empty",stroke:r===!0?void 0:r}}function gq(e,{stroke:t=uy(e)?e:void 0,ticks:r=_q(e)?e:void 0,tickSpacing:o,ariaLabel:u,ariaDescription:d}){return{stroke:t,ticks:r,tickSpacing:o,ariaLabel:u,ariaDescription:d}}function _q(e){switch(typeof e){case"number":return!0;case"string":return!uy(e)}return kl(e)||typeof(e==null?void 0:e.range)=="function"}function ig(e,t){const r=`${t}-axis `;return e.some(o=>{var u;return(u=o.ariaLabel)==null?void 0:u.startsWith(r)})}function sS(e,t){for(const r of t)for(const o in r.channels){const{scale:u}=r.channels[o];if(u===e||u==="projection")return!0}return!1}function yq(e,t){for(const r in e){const o=e[r],u=t[r];o.label===void 0&&u&&(o.label=u.label)}return e}function vq({fx:e,fy:t},r){const{marginTop:o,marginRight:u,marginBottom:d,marginLeft:p,width:a,height:w}=_x(r),T=e&&lS(e),S=t&&lS(t);return{marginTop:t?S[0]:o,marginRight:e?a-T[1]:u,marginBottom:t?w-S[1]:d,marginLeft:e?T[0]:p,inset:{marginTop:r.marginTop,marginRight:r.marginRight,marginBottom:r.marginBottom,marginLeft:r.marginLeft},width:a,height:w}}function lS(e){const t=e.domain();if(t.length===0)return[0,e.bandwidth()];let r=e(t[0]),o=e(t[t.length-1]);return o<r&&([r,o]=[o,r]),[r,o+e.bandwidth()]}const bq=new Map([["basis",ON],["basis-closed",NN],["basis-open",jN],["bundle",UN],["bump-x",CN],["bump-y",IN],["cardinal",VN],["cardinal-closed",GN],["cardinal-open",qN],["catmull-rom",ZN],["catmull-rom-closed",HN],["catmull-rom-open",$N],["linear",ay],["linear-closed",WN],["monotone-x",YN],["monotone-y",XN],["natural",QN],["step",KN],["step-after",ej],["step-before",JN]]);function xq(e=ay,t){if(typeof e=="function")return e;const r=bq.get(`${e}`.toLowerCase());if(!r)throw new Error(`unknown curve: ${e}`);if(t!==void 0){if("beta"in r)return r.beta(t);if("tension"in r)return r.tension(t);if("alpha"in r)return r.alpha(t)}return r}function wq(e=m_,t){return typeof e!="function"&&`${e}`.toLowerCase()==="auto"?m_:xq(e,t)}function m_(e){return ay(e)}function Aq(e={y:"count"},t={}){[e,t]=Cq(e,t);const{x:r,y:o}=t;return Mq(Iq(r,t,Ba),null,null,o,e,Mx(t))}function Tq(e,t,r={}){if((r==null?void 0:r.interval)==null)return r;const{reduce:o=dx}=r,u={filter:null};return r[t]!=null&&(u[t]=o),r[`${t}1`]!=null&&(u[`${t}1`]=o),r[`${t}2`]!=null&&(u[`${t}2`]=o),e(u,r)}function Sq(e={}){return Tq(Aq,"y",Ax(e,"x"))}function Mq(e,t,r,o,{data:u=GE,filter:d=f_,sort:p,reverse:a,...w}={},T={}){e=cS(e),t=cS(t),w=Pq(w,T),u=l5(u,Ba),p=p==null?void 0:o5("sort",p,T),d=d==null?void 0:s5("filter",d,T),o!=null&&_v(w,"y","y1","y2")&&(o=null);const[S,k]=pl(e),[I,P]=pl(e),[F,G]=pl(t),[H,Y]=pl(t),[$,ae]=o!=null?[o,"y"]:[],[ee,ce]=pl($),{x:re,y:he,z:be,fill:ke,stroke:Ie,x1:ue,x2:Ve,y1:Ze,y2:Xe,domain:Re,cumulative:ot,thresholds:Pt,interval:bt,..._t}=T,[tt,Tt]=pl(be),[ct]=zs(ke),[mt]=zs(Ie),[Xt,Ut]=pl(ct),[St,pt]=pl(mt);return{..."z"in T&&{z:tt||be},..."fill"in T&&{fill:Xt||ke},..."stroke"in T&&{stroke:St||Ie},...hx(_t,(Ft,nt,De)=>{const Ke=yj(ta(Ft,$),De==null?void 0:De[ae]),Be=ta(Ft,be),wt=ta(Ft,ct),gt=ta(Ft,mt),Rt=Gj(w,{z:Be,fill:wt,stroke:gt}),st=[],ht=[],qe=Ke&&ce([]),Mt=Be&&Tt([]),Ht=wt&&Ut([]),_n=gt&&pt([]),In=e&&k([]),yt=e&&P([]),qt=t&&G([]),Nt=t&&Y([]),fn=zq(e,t,Ft);let yn=0;for(const On of w)On.initialize(Ft);p&&p.initialize(Ft),d&&d.initialize(Ft);for(const On of nt){const Mi=[];for(const $n of w)$n.scope("facet",On);p&&p.scope("facet",On),d&&d.scope("facet",On);for(const[$n,wi]of ST(On,Rt))for(const[Ce,X]of ST(wi,Ke))for(const[K,te]of fn(X))if(Rt&&(te.z=$n),!(d&&!d.reduce(K,te))){Mi.push(yn++),ht.push(u.reduceIndex(K,Ft,te)),Ke&&qe.push(Ce),Be&&Mt.push(Rt===Be?$n:Be[(K.length>0?K:X)[0]]),wt&&Ht.push(Rt===wt?$n:wt[(K.length>0?K:X)[0]]),gt&&_n.push(Rt===gt?$n:gt[(K.length>0?K:X)[0]]),In&&(In.push(te.x1),yt.push(te.x2)),qt&&(qt.push(te.y1),Nt.push(te.y2));for(const pe of w)pe.reduce(K,te);p&&p.reduce(K,te)}st.push(Mi)}return qj(st,p,a),{data:ht,facets:st}}),...!_v(w,"x")&&(S?{x1:S,x2:I,x:AT(S,I)}:{x:re,x1:ue,x2:Ve}),...!_v(w,"y")&&(F?{y1:F,y2:H,y:AT(F,H)}:{y:he,y1:Ze,y2:Xe}),...ee&&{[ae]:ee},...Object.fromEntries(w.map(({name:Ft,output:nt})=>[Ft,nt]))}}function Cq({cumulative:e,domain:t,thresholds:r,interval:o,...u},d){return[u,{cumulative:e,domain:t,thresholds:r,interval:o,...d}]}function Iq(e,{cumulative:t,domain:r,thresholds:o,interval:u},d){return e={...Mp(e)},e.domain===void 0&&(e.domain=r),e.cumulative===void 0&&(e.cumulative=t),e.thresholds===void 0&&(e.thresholds=o),e.interval===void 0&&(e.interval=u),e.value===void 0&&(e.value=d),e.thresholds=Eq(e.thresholds,e.interval),e}function cS(e){if(e==null)return;const{value:t,cumulative:r,domain:o=Wa,thresholds:u}=e,d=p=>{let a=ta(p,t),w;if(va(a)||Dq(u)){a=pr(a,AE,Float64Array);let[S,k]=typeof o=="function"?o(a):o,I=typeof u=="function"&&!ah(u)?u(a,S,k):u;typeof I=="number"&&(I=wI(S,k,I)),ah(I)&&(o===Wa&&(S=I.floor(S),k=I.offset(I.floor(k))),I=I.range(S,I.offset(k))),w=I}else{a=Dh(a);let[S,k]=typeof o=="function"?o(a):o,I=typeof u=="function"&&!ah(u)?u(a,S,k):u;if(typeof I=="number")if(o===Wa){let P=kg(S,k,I);if(isFinite(P))if(P>0){let F=Math.round(S/P),G=Math.round(k/P);F*P<=S||--F,G*P>k||++G;let H=G-F+1;I=new Float64Array(H);for(let Y=0;Y<H;++Y)I[Y]=(F+Y)*P}else if(P<0){P=-P;let F=Math.round(S*P),G=Math.round(k*P);F/P<=S||--F,G/P>k||++G;let H=G-F+1;I=new Float64Array(H);for(let Y=0;Y<H;++Y)I[Y]=(F+Y)/P}else I=[S];else I=[S]}else I=Od(S,k,I);else ah(I)&&(o===Wa&&(S=I.floor(S),k=I.offset(I.floor(k))),I=I.range(S,I.offset(k)));w=I}const T=[];if(w.length===1)T.push([w[0],w[0]]);else for(let S=1;S<w.length;++S)T.push([w[S-1],w[S]]);return T.bin=(r<0?Lq:r>0?Rq:zx)(T,w,a),T};return d.label=Kc(t),d}function Eq(e,t,r=uS){if(e===void 0)return t===void 0?r:qh(t);if(typeof e=="string"){switch(e.toLowerCase()){case"freedman-diaconis":return Bz;case"scott":return gM;case"sturges":return Dz;case"auto":return uS}return nx(e)}return e}function Pq(e,t){return jj(e,t,o5)}function o5(e,t,r){return UE(e,t,r,s5)}function s5(e,t,r){return VE(e,t,r,l5)}function l5(e,t){return fx(e,t,kq)}function kq(e){switch(`${e}`.toLowerCase()){case"x":return Bq;case"x1":return Oq;case"x2":return Nq;case"y":return Fq;case"y1":return jq;case"y2":return Uq;case"z":return Qj}throw new Error(`invalid bin reduce: ${e}`)}function uS(e,t,r){return Math.min(200,gM(e,t,r))}function Dq(e){return xj(e)||kl(e)&&va(e)}function zq(e,t,r){const o=e==null?void 0:e(r),u=t==null?void 0:t(r);return o&&u?function*(d){const p=o.bin(d);for(const[a,[w,T]]of o.entries()){const S=u.bin(p[a]);for(const[k,[I,P]]of u.entries())yield[S[k],{data:r,x1:w,y1:I,x2:T,y2:P}]}}:o?function*(d){const p=o.bin(d);for(const[a,[w,T]]of o.entries())yield[p[a],{data:r,x1:w,x2:T}]}:function*(d){const p=u.bin(d);for(const[a,[w,T]]of u.entries())yield[p[a],{data:r,y1:w,y2:T}]}}function zx(e,t,r){return t=Dh(t),o=>{var d;const u=e.map(()=>[]);for(const p of o)(d=u[D_(t,r[p])-1])==null||d.push(p);return u}}function Rq(e,t,r){const o=zx(e,t,r);return u=>{const d=o(u);for(let p=1,a=d.length;p<a;++p){const w=d[p-1],T=d[p];for(const S of w)T.push(S)}return d}}function Lq(e,t,r){const o=zx(e,t,r);return u=>{const d=o(u);for(let p=d.length-2;p>=0;--p){const a=d[p+1],w=d[p];for(const T of a)w.push(T)}return d}}function c5(e,t){const r=(+e+ +t)/2;return e instanceof Date?new Date(r):r}const Bq={reduceIndex(e,t,{x1:r,x2:o}){return c5(r,o)}},Fq={reduceIndex(e,t,{y1:r,y2:o}){return c5(r,o)}},Oq={reduceIndex(e,t,{x1:r}){return r}},Nq={reduceIndex(e,t,{x2:r}){return r}},jq={reduceIndex(e,t,{y1:r}){return r}},Uq={reduceIndex(e,t,{y2:r}){return r}},Vq={ariaLabel:"line",fill:"none",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:1};class Gq extends es{constructor(t,r={}){const{x:o,y:u,z:d,curve:p,tension:a}=r;super(t,{x:{value:o,scale:"x"},y:{value:u,scale:"y"},z:{value:CE(r),optional:!0}},r,Vq),this.z=d,this.curve=wq(p,a),Sx(this,r)}filter(t){return t}project(t,r,o){this.curve!==m_&&super.project(t,r,o)}render(t,r,o,u,d){const{x:p,y:a}=o,{curve:w}=this;return ua("svg:g",d).call(eu,this,u,d).call(nu,this,r).call(T=>T.selectAll().data(PV(t,[p,a],this,o)).enter().append("path").call(tu,this).call(CV,this,o).call($V,this,o,d).attr("d",w===m_&&d.projection?qq(d.path(),p,a):MN().curve(w).defined(S=>S>=0).x(S=>p[S]).y(S=>a[S]))).node()}}function qq(e,t,r){return t=Dh(t),r=Dh(r),o=>{let u=[];const d=[u];for(const p of o)p===-1?(u=[],d.push(u)):u.push([t[p],r[p]]);return e({type:"MultiLineString",coordinates:d})}}function kv(e,{x:t=bE,y:r=Ba,...o}={}){return new Gq(e,Sq({...o,x:t,y:r}))}function Zq(e,t={}){let{y:r,y1:o,y2:u}=t;r===void 0&&o===void 0&&u===void 0&&(t={...t,y:r=Ba});const d={};return r!=null&&(d.y=e),o!=null&&(d.y1=e),u!=null&&(d.y2=e),Hq(d,t)}function Hq(e={},t={}){const r=CE(t),o=Object.entries(e).map(([u,d])=>{const p=IE(u,t);if(p==null)throw new Error(`missing channel: ${u}`);const[a,w]=sx(p);return{key:u,input:p,output:a,setOutput:w,map:$q(d)}});return{...hx(t,(u,d)=>{const p=ta(u,r),a=o.map(({input:T})=>ta(u,T)),w=o.map(({setOutput:T})=>T(new Array(u.length)));for(const T of d)for(const S of p?g1(T,k=>p[k]).values():[T])o.forEach(({map:k},I)=>k.mapIndex(S,a[I],w[I]));return{data:u,facets:d}}),...Object.fromEntries(o.map(({key:u,output:d})=>[u,d]))}}function $q(e){if(e==null)throw new Error("missing map");if(typeof e.mapIndex=="function")return e;if(typeof e.map=="function"&&Rs(e))return Wq(e);if(typeof e=="function")return Dv(gj(e));switch(`${e}`.toLowerCase()){case"cumsum":return Xq;case"rank":return Dv((t,r)=>yM(t,o=>r[o]));case"quantile":return Dv((t,r)=>Yq(t,o=>r[o]))}throw new Error(`invalid map: ${e}`)}function Wq(e){return console.warn("deprecated map interface; implement mapIndex instead."),{mapIndex:e.map.bind(e)}}function Yq(e,t){const r=z_(e,t)-1;return yM(e,t).map(o=>o/r)}function Dv(e){return{mapIndex(t,r,o){const u=e(t,r);if(u.length!==t.length)throw new Error("map function returned a mismatched length");for(let d=0,p=t.length;d<p;++d)o[t[d]]=u[d]}}}const Xq={mapIndex(e,t,r){let o=0;for(const u of e)r[u]=o+=t[u]}};es.prototype.plot=function({marks:e=[],...t}={}){return Jb({...t,marks:[...e,this]})};const hS=["BOOLEAN","INT32","INT64","INT96","FLOAT","DOUBLE","BYTE_ARRAY","FIXED_LEN_BYTE_ARRAY"],wc=["PLAIN","GROUP_VAR_INT","PLAIN_DICTIONARY","RLE","BIT_PACKED","DELTA_BINARY_PACKED","DELTA_LENGTH_BYTE_ARRAY","DELTA_BYTE_ARRAY","RLE_DICTIONARY","BYTE_STREAM_SPLIT"],Qq=["REQUIRED","OPTIONAL","REPEATED"],Kq=["UTF8","MAP","MAP_KEY_VALUE","LIST","ENUM","DECIMAL","DATE","TIME_MILLIS","TIME_MICROS","TIMESTAMP_MILLIS","TIMESTAMP_MICROS","UINT_8","UINT_16","UINT_32","UINT_64","INT_8","INT_16","INT_32","INT_64","JSON","BSON","INTERVAL"],Jq=["UNCOMPRESSED","SNAPPY","GZIP","LZO","BROTLI","LZ4","ZSTD","LZ4_RAW"],u5=["DATA_PAGE","INDEX_PAGE","DICTIONARY_PAGE","DATA_PAGE_V2"],h5={timestampFromMilliseconds(e){return new Date(Number(e))},timestampFromMicroseconds(e){return new Date(Number(e/1000n))},timestampFromNanoseconds(e){return new Date(Number(e/1000000n))},dateFromDays(e){return new Date(e*864e5)}};function fS(e,t,r,o){if(t&&r.endsWith("_DICTIONARY")){let u=e;e instanceof Uint8Array&&!(t instanceof Uint8Array)&&(u=new t.constructor(e.length));for(let d=0;d<e.length;d++)u[d]=t[e[d]];return u}else return f5(e,o)}function f5(e,t){const{element:r,parsers:o,utf8:u=!0}=t,{type:d,converted_type:p,logical_type:a}=r;if(p==="DECIMAL"){const T=10**-(r.scale||0),S=new Array(e.length);for(let k=0;k<S.length;k++)e[0]instanceof Uint8Array?S[k]=d5(e[k])*T:S[k]=Number(e[k])*T;return S}if(!p&&d==="INT96"){const w=new Array(e.length);for(let T=0;T<w.length;T++)w[T]=o.timestampFromNanoseconds(eZ(e[T]));return w}if(p==="DATE"){const w=new Array(e.length);for(let T=0;T<w.length;T++)w[T]=o.dateFromDays(e[T]);return w}if(p==="TIMESTAMP_MILLIS"){const w=new Array(e.length);for(let T=0;T<w.length;T++)w[T]=o.timestampFromMilliseconds(e[T]);return w}if(p==="TIMESTAMP_MICROS"){const w=new Array(e.length);for(let T=0;T<w.length;T++)w[T]=o.timestampFromMicroseconds(e[T]);return w}if(p==="JSON"){const w=new TextDecoder;return e.map(T=>JSON.parse(w.decode(T)))}if(p==="BSON")throw new Error("parquet bson not supported");if(p==="INTERVAL")throw new Error("parquet interval not supported");if(p==="UTF8"||(a==null?void 0:a.type)==="STRING"||u&&d==="BYTE_ARRAY"){const w=new TextDecoder,T=new Array(e.length);for(let S=0;S<T.length;S++)T[S]=e[S]&&w.decode(e[S]);return T}if(p==="UINT_64"||(a==null?void 0:a.type)==="INTEGER"&&a.bitWidth===64&&!a.isSigned){if(e instanceof BigInt64Array)return new BigUint64Array(e.buffer,e.byteOffset,e.length);const w=new BigUint64Array(e.length);for(let T=0;T<w.length;T++)w[T]=BigInt(e[T]);return w}if(p==="UINT_32"||(a==null?void 0:a.type)==="INTEGER"&&a.bitWidth===32&&!a.isSigned){if(e instanceof Int32Array)return new Uint32Array(e.buffer,e.byteOffset,e.length);const w=new Uint32Array(e.length);for(let T=0;T<w.length;T++)w[T]=e[T];return w}if((a==null?void 0:a.type)==="FLOAT16")return Array.from(e).map(p5);if((a==null?void 0:a.type)==="TIMESTAMP"){const{unit:w}=a;let T=o.timestampFromMilliseconds;w==="MICROS"&&(T=o.timestampFromMicroseconds),w==="NANOS"&&(T=o.timestampFromNanoseconds);const S=new Array(e.length);for(let k=0;k<S.length;k++)S[k]=T(e[k]);return S}return e}function d5(e){let t=0;for(const o of e)t=t*256+o;const r=e.length*8;return t>=2**(r-1)&&(t-=2**r),t}function eZ(e){const t=(e>>64n)-2440588n,r=e&0xffffffffffffffffn;return t*86400000000000n+r}function p5(e){if(!e)return;const t=e[1]<<8|e[0],r=t>>15?-1:1,o=t>>10&31,u=t&1023;return o===0?r*2**-14*(u/1024):o===31?u?NaN:r*(1/0):r*2**(o-15)*(1+u/1024)}function m5(e,t,r){const o=e[t],u=[];let d=1;if(o.num_children)for(;u.length<o.num_children;){const p=e[t+d],a=m5(e,t+d,[...r,p.name]);d+=a.count,u.push(a)}return{count:d,element:o,children:u,path:r}}function g5(e,t){let r=m5(e,0,[]);const o=[r];for(const u of t){const d=r.children.find(p=>p.element.name===u);if(!d)throw new Error(`parquet schema element not found: ${t}`);o.push(d),r=d}return o}function _5(e){let t=0;for(const{element:r}of e)r.repetition_type==="REPEATED"&&t++;return t}function Rx(e){let t=0;for(const{element:r}of e.slice(1))r.repetition_type!=="REQUIRED"&&t++;return t}function tZ(e){if(!e||e.element.converted_type!=="LIST"||e.children.length>1)return!1;const t=e.children[0];return!(t.children.length>1||t.element.repetition_type!=="REPEATED")}function nZ(e){if(!e||e.element.converted_type!=="MAP"||e.children.length>1)return!1;const t=e.children[0];if(t.children.length!==2||t.element.repetition_type!=="REPEATED")return!1;const r=t.children.find(u=>u.element.name==="key");if((r==null?void 0:r.element.repetition_type)==="REPEATED")return!1;const o=t.children.find(u=>u.element.name==="value");return(o==null?void 0:o.element.repetition_type)!=="REPEATED"}function iZ(e){if(e.length!==2)return!1;const[,t]=e;return!(t.element.repetition_type==="REPEATED"||t.children.length)}const Qr={STOP:0,TRUE:1,FALSE:2,BYTE:3,I16:4,I32:5,I64:6,DOUBLE:7,BINARY:8,LIST:9,STRUCT:12};function y5(e){let t=0;const r={};for(;e.offset<e.view.byteLength;){const[o,u,d]=b5(e,t);if(t=d,o===Qr.STOP)break;r[`field_${u}`]=bg(e,o)}return r}function bg(e,t){switch(t){case Qr.TRUE:return!0;case Qr.FALSE:return!1;case Qr.BYTE:return e.view.getInt8(e.offset++);case Qr.I16:case Qr.I32:return aZ(e);case Qr.I64:return e1(e);case Qr.DOUBLE:{const r=e.view.getFloat64(e.offset,!0);return e.offset+=8,r}case Qr.BINARY:{const r=Bc(e),o=new Uint8Array(e.view.buffer,e.view.byteOffset+e.offset,r);return e.offset+=r,o}case Qr.LIST:{const[r,o]=oZ(e),u=r===Qr.TRUE||r===Qr.FALSE,d=new Array(o);for(let p=0;p<o;p++)d[p]=u?bg(e,Qr.BYTE)===1:bg(e,r);return d}case Qr.STRUCT:{const r={};let o=0;for(;;){let u,d;if([u,d,o]=b5(e,o),u===Qr.STOP)break;r[`field_${d}`]=bg(e,u)}return r}default:throw new Error(`thrift unhandled type: ${t}`)}}function Bc(e){let t=0,r=0;for(;;){const o=e.view.getUint8(e.offset++);if(t|=(o&127)<<r,!(o&128))return t;r+=7}}function rZ(e){let t=0n,r=0n;for(;;){const o=e.view.getUint8(e.offset++);if(t|=BigInt(o&127)<<r,!(o&128))return t;r+=7n}}function aZ(e){const t=Bc(e);return t>>>1^-(t&1)}function e1(e){const t=rZ(e);return t>>1n^-(t&1n)}function v5(e){return e&15}function b5(e,t){const r=e.view.getUint8(e.offset++);if((r&15)===Qr.STOP)return[0,0,t];const o=r>>4;let u;if(o)u=t+o;else throw new Error("non-delta field id not supported");return[v5(r),u,u]}function oZ(e){const t=e.view.getUint8(e.offset++),r=t>>4,o=v5(t);if(r===15){const u=Bc(e);return[o,u]}return[o,r]}const sZ=1<<19;async function _y(e,{parsers:t,initialFetchSize:r=sZ}={}){if(!e||!(e.byteLength>=0))throw new Error("parquet expected AsyncBuffer");const o=Math.max(0,e.byteLength-r),u=await e.slice(o,e.byteLength),d=new DataView(u);if(d.getUint32(u.byteLength-4,!0)!==827474256)throw new Error("parquet file invalid (footer != PAR1)");const p=d.getUint32(u.byteLength-8,!0);if(p>e.byteLength-8)throw new Error(`parquet metadata length ${p} exceeds available buffer ${e.byteLength-8}`);if(p+8>r){const a=e.byteLength-p-8,w=await e.slice(a,o),T=new ArrayBuffer(p+8),S=new Uint8Array(T);return S.set(new Uint8Array(w)),S.set(new Uint8Array(u),o-a),dS(T,{parsers:t})}else return dS(u,{parsers:t})}function dS(e,{parsers:t}={}){var Y;if(!(e instanceof ArrayBuffer))throw new Error("parquet expected ArrayBuffer");const r=new DataView(e);if(t={...h5,...t},r.byteLength<8)throw new Error("parquet file is too short");if(r.getUint32(r.byteLength-4,!0)!==827474256)throw new Error("parquet file invalid (footer != PAR1)");const o=r.byteLength-8,u=r.getUint32(o,!0);if(u>r.byteLength-8)throw new Error(`parquet metadata length ${u} exceeds available buffer ${r.byteLength-8}`);const d=o-u,a=y5({view:r,offset:d}),w=new TextDecoder;function T($){return $&&w.decode($)}const S=a.field_1,k=a.field_2.map($=>({type:hS[$.field_1],type_length:$.field_2,repetition_type:Qq[$.field_3],name:T($.field_4),num_children:$.field_5,converted_type:Kq[$.field_6],scale:$.field_7,precision:$.field_8,field_id:$.field_9,logical_type:lZ($.field_10)})),I=k.filter($=>$.type),P=a.field_3,F=a.field_4.map($=>{var ae;return{columns:$.field_1.map((ee,ce)=>{var re,he;return{file_path:T(ee.field_1),file_offset:ee.field_2,meta_data:ee.field_3&&{type:hS[ee.field_3.field_1],encodings:(re=ee.field_3.field_2)==null?void 0:re.map(be=>wc[be]),path_in_schema:ee.field_3.field_3.map(T),codec:Jq[ee.field_3.field_4],num_values:ee.field_3.field_5,total_uncompressed_size:ee.field_3.field_6,total_compressed_size:ee.field_3.field_7,key_value_metadata:ee.field_3.field_8,data_page_offset:ee.field_3.field_9,index_page_offset:ee.field_3.field_10,dictionary_page_offset:ee.field_3.field_11,statistics:cZ(ee.field_3.field_12,I[ce],t),encoding_stats:(he=ee.field_3.field_13)==null?void 0:he.map(be=>({page_type:u5[be.field_1],encoding:wc[be.field_2],count:be.field_3})),bloom_filter_offset:ee.field_3.field_14,bloom_filter_length:ee.field_3.field_15,size_statistics:ee.field_3.field_16&&{unencoded_byte_array_data_bytes:ee.field_3.field_16.field_1,repetition_level_histogram:ee.field_3.field_16.field_2,definition_level_histogram:ee.field_3.field_16.field_3}},offset_index_offset:ee.field_4,offset_index_length:ee.field_5,column_index_offset:ee.field_6,column_index_length:ee.field_7,crypto_metadata:ee.field_8,encrypted_column_metadata:ee.field_9}}),total_byte_size:$.field_2,num_rows:$.field_3,sorting_columns:(ae=$.field_4)==null?void 0:ae.map(ee=>({column_idx:ee.field_1,descending:ee.field_2,nulls_first:ee.field_3})),file_offset:$.field_5,total_compressed_size:$.field_6,ordinal:$.field_7}}),G=(Y=a.field_5)==null?void 0:Y.map($=>({key:T($.field_1),value:T($.field_2)})),H=T(a.field_6);return{version:S,schema:k,num_rows:P,row_groups:F,key_value_metadata:G,created_by:H,metadata_length:u}}function Lx({schema:e}){return g5(e,[])[0]}function lZ(e){return e!=null&&e.field_1?{type:"STRING"}:e!=null&&e.field_2?{type:"MAP"}:e!=null&&e.field_3?{type:"LIST"}:e!=null&&e.field_4?{type:"ENUM"}:e!=null&&e.field_5?{type:"DECIMAL",scale:e.field_5.field_1,precision:e.field_5.field_2}:e!=null&&e.field_6?{type:"DATE"}:e!=null&&e.field_7?{type:"TIME",isAdjustedToUTC:e.field_7.field_1,unit:pS(e.field_7.field_2)}:e!=null&&e.field_8?{type:"TIMESTAMP",isAdjustedToUTC:e.field_8.field_1,unit:pS(e.field_8.field_2)}:e!=null&&e.field_10?{type:"INTEGER",bitWidth:e.field_10.field_1,isSigned:e.field_10.field_2}:e!=null&&e.field_11?{type:"NULL"}:e!=null&&e.field_12?{type:"JSON"}:e!=null&&e.field_13?{type:"BSON"}:e!=null&&e.field_14?{type:"UUID"}:e!=null&&e.field_15?{type:"FLOAT16"}:e}function pS(e){if(e.field_1)return"MILLIS";if(e.field_2)return"MICROS";if(e.field_3)return"NANOS";throw new Error("parquet time unit required")}function cZ(e,t,r){return e&&{max:rg(e.field_1,t,r),min:rg(e.field_2,t,r),null_count:e.field_3,distinct_count:e.field_4,max_value:rg(e.field_5,t,r),min_value:rg(e.field_6,t,r),is_max_value_exact:e.field_7,is_min_value_exact:e.field_8}}function rg(e,t,r){const{type:o,converted_type:u,logical_type:d}=t;if(e===void 0)return e;if(o==="BOOLEAN")return e[0]===1;if(o==="BYTE_ARRAY")return new TextDecoder().decode(e);const p=new DataView(e.buffer,e.byteOffset,e.byteLength);return o==="FLOAT"&&p.byteLength===4?p.getFloat32(0,!0):o==="DOUBLE"&&p.byteLength===8?p.getFloat64(0,!0):o==="INT32"&&u==="DATE"?r.dateFromDays(p.getInt32(0,!0)):o==="INT64"&&u==="TIMESTAMP_MILLIS"?r.timestampFromMilliseconds(p.getBigInt64(0,!0)):o==="INT64"&&u==="TIMESTAMP_MICROS"?r.timestampFromMicroseconds(p.getBigInt64(0,!0)):o==="INT64"&&(d==null?void 0:d.type)==="TIMESTAMP"&&(d==null?void 0:d.unit)==="NANOS"?r.timestampFromNanoseconds(p.getBigInt64(0,!0)):o==="INT64"&&(d==null?void 0:d.type)==="TIMESTAMP"&&(d==null?void 0:d.unit)==="MICROS"?r.timestampFromMicroseconds(p.getBigInt64(0,!0)):o==="INT64"&&(d==null?void 0:d.type)==="TIMESTAMP"?r.timestampFromMilliseconds(p.getBigInt64(0,!0)):o==="INT32"&&p.byteLength===4?p.getInt32(0,!0):o==="INT64"&&p.byteLength===8?p.getBigInt64(0,!0):u==="DECIMAL"?d5(e)*10**-(t.scale||0):(d==null?void 0:d.type)==="FLOAT16"?p5(e):e}function Bx(e,t){for(let o=0;o<t.length;o+=1e4)e.push(...t.slice(o,o+1e4))}function hh(e,t){return e===t?!0:e instanceof Uint8Array&&t instanceof Uint8Array?hh(Array.from(e),Array.from(t)):!e||!t||typeof e!=typeof t?!1:Array.isArray(e)&&Array.isArray(t)?e.length===t.length&&e.every((r,o)=>hh(r,t[o])):typeof e=="object"&&Object.keys(e).length===Object.keys(t).length&&Object.keys(e).every(r=>hh(e[r],t[r]))}async function uZ(e,t,r){return await(r??globalThis.fetch)(e,{...t,method:"HEAD"}).then(u=>{if(!u.ok)throw new Error(`fetch head failed ${u.status}`);const d=u.headers.get("Content-Length");if(!d)throw new Error("missing content length");return parseInt(d)})}async function hZ({url:e,byteLength:t,requestInit:r,fetch:o}){if(!e)throw new Error("missing url");const u=o??globalThis.fetch;t||(t=await uZ(e,r,u));let d;const p=r||{};return{byteLength:t,async slice(a,w){if(d)return d.then(I=>I.slice(a,w));const T=new Headers(p.headers),S=w===void 0?"":w-1;T.set("Range",`bytes=${a}-${S}`);const k=await u(e,{...p,headers:T});if(!k.ok||!k.body)throw new Error(`fetch failed ${k.status}`);if(k.status===200)return d=k.arrayBuffer(),d.then(I=>I.slice(a,w));if(k.status===206)return k.arrayBuffer();throw new Error(`fetch received unexpected status code ${k.status}`)}}}function g_(e){if(!e)return[];if(e.length===1)return e[0];const t=[];for(const r of e)Bx(t,r);return t}const fZ=1<<25;function dZ({metadata:e,rowStart:t=0,rowEnd:r=1/0,columns:o}){var a,w;if(!e)throw new Error("parquetPlan requires metadata");const u=[],d=[];let p=0;for(const T of e.row_groups){const S=Number(T.num_rows),k=p+S;if(S>0&&k>=t&&p<r){const I=[];for(const{file_path:H,meta_data:Y}of T.columns){if(H)throw new Error("parquet file_path not supported");if(!Y)throw new Error("parquet column metadata is undefined");(!o||o.includes(Y.path_in_schema[0]))&&I.push(x5(Y))}const P=Math.max(t-p,0),F=Math.min(r-p,S);u.push({ranges:I,rowGroup:T,groupStart:p,groupRows:S,selectStart:P,selectEnd:F});const G=((a=I[I.length-1])==null?void 0:a.endByte)-((w=I[0])==null?void 0:w.startByte);if(!o&&G<fZ)d.push({startByte:I[0].startByte,endByte:I[I.length-1].endByte});else if(I.length)Bx(d,I);else if(o!=null&&o.length)throw new Error(`parquet columns not found: ${o.join(", ")}`)}p=k}return isFinite(r)||(r=p),{metadata:e,rowStart:t,rowEnd:r,columns:o,fetches:d,groups:u}}function x5({dictionary_page_offset:e,data_page_offset:t,total_compressed_size:r}){const o=e||t;return{startByte:Number(o),endByte:Number(o+r)}}function pZ(e,{fetches:t}){const r=t.map(({startByte:o,endByte:u})=>e.slice(o,u));return{byteLength:e.byteLength,slice(o,u=e.byteLength){const d=t.findIndex(({startByte:p,endByte:a})=>p<=o&&u<=a);if(d<0)throw new Error(`no prefetch for range [${o}, ${u}]`);if(t[d].startByte!==o||t[d].endByte!==u){const p=o-t[d].startByte,a=u-t[d].startByte;return r[d]instanceof Promise?r[d].then(w=>w.slice(p,a)):r[d].slice(p,a)}else return r[d]}}}function mS(e,t,r,o,u){const d=(t==null?void 0:t.length)||r.length;if(!d)return o;const p=Rx(u),a=u.map(({element:F})=>F.repetition_type);let w=0;const T=[e];let S=e,k=0,I=0,P=0;if(r[0])for(;k<a.length-2&&P<r[0];)k++,a[k]!=="REQUIRED"&&(S=S.at(-1),T.push(S),I++),a[k]==="REPEATED"&&P++;for(let F=0;F<d;F++){const G=t!=null&&t.length?t[F]:p,H=r[F];for(;k&&(H<P||a[k]!=="REPEATED");)a[k]!=="REQUIRED"&&(T.pop(),I--),a[k]==="REPEATED"&&P--,k--;for(S=T.at(-1);(k<a.length-2||a[k+1]==="REPEATED")&&(I<G||a[k+1]==="REQUIRED");){if(k++,a[k]!=="REQUIRED"){const Y=[];S.push(Y),S=Y,T.push(Y),I++}a[k]==="REPEATED"&&P++}G===p?S.push(o[w++]):k===a.length-2?S.push(null):S.push([])}if(!e.length)for(let F=0;F<p;F++){const G=[];S.push(G),S=G}return e}function Md(e,t,r=0){const o=t.path.join("."),u=t.element.repetition_type==="OPTIONAL",d=u?r+1:r;if(tZ(t)){let p=t.children[0],a=d;p.children.length===1&&(p=p.children[0],a++),Md(e,p,a);const w=p.path.join("."),T=e.get(w);if(!T)throw new Error("parquet list column missing values");u&&xg(T,r),e.set(o,T),e.delete(w);return}if(nZ(t)){const p=t.children[0].element.name;Md(e,t.children[0].children[0],d+1),Md(e,t.children[0].children[1],d+1);const a=e.get(`${o}.${p}.key`),w=e.get(`${o}.${p}.value`);if(!a)throw new Error("parquet map column missing keys");if(!w)throw new Error("parquet map column missing values");if(a.length!==w.length)throw new Error("parquet map column key/value length mismatch");const T=w5(a,w,d);u&&xg(T,r),e.delete(`${o}.${p}.key`),e.delete(`${o}.${p}.value`),e.set(o,T);return}if(t.children.length){const p=t.element.repetition_type==="REQUIRED"?r:r+1,a={};for(const T of t.children){Md(e,T,p);const S=e.get(T.path.join("."));if(!S)throw new Error("parquet struct missing child data");a[T.element.name]=S}for(const T of t.children)e.delete(T.path.join("."));const w=A5(a,p);u&&xg(w,r),e.set(o,w)}}function xg(e,t){for(let r=0;r<e.length;r++)t?xg(e[r],t-1):e[r]=e[r][0]}function w5(e,t,r){const o=[];for(let u=0;u<e.length;u++)if(r)o.push(w5(e[u],t[u],r-1));else if(e[u]){const d={};for(let p=0;p<e[u].length;p++){const a=t[u][p];d[e[u][p]]=a===void 0?null:a}o.push(d)}else o.push(void 0);return o}function A5(e,t){var d;const r=Object.keys(e),o=(d=e[r[0]])==null?void 0:d.length,u=[];for(let p=0;p<o;p++){const a={};for(const w of r){if(e[w].length!==o)throw new Error("parquet struct parsing error");a[w]=e[w][p]}t?u.push(A5(a,t-1)):u.push(a)}return u}function Kd(e,t,r){const o=r instanceof Int32Array,u=Bc(e),d=Bc(e);Bc(e);let p=e1(e),a=0;r[a++]=o?Number(p):p;const w=u/d;for(;a<t;){const T=e1(e),S=new Uint8Array(d);for(let k=0;k<d;k++)S[k]=e.view.getUint8(e.offset++);for(let k=0;k<d&&a<t;k++){const I=BigInt(S[k]);if(I){let P=0n,F=w;const G=(1n<<I)-1n;for(;F&&a<t;){let H=BigInt(e.view.getUint8(e.offset))>>P&G;for(P+=I;P>=8;)P-=8n,e.offset++,P&&(H|=BigInt(e.view.getUint8(e.offset))<<I-P&G);const Y=T+H;p+=Y,r[a++]=o?Number(p):p,F--}F&&(e.offset+=Math.ceil((F*Number(I)+Number(P))/8))}else for(let P=0;P<w&&a<t;P++)p+=T,r[a++]=o?Number(p):p}}}function T5(e,t,r){const o=new Int32Array(t);Kd(e,t,o);for(let u=0;u<t;u++)r[u]=new Uint8Array(e.view.buffer,e.view.byteOffset+e.offset,o[u]),e.offset+=o[u]}function mZ(e,t,r){const o=new Int32Array(t);Kd(e,t,o);const u=new Int32Array(t);Kd(e,t,u);for(let d=0;d<t;d++){const p=new Uint8Array(e.view.buffer,e.view.byteOffset+e.offset,u[d]);o[d]?(r[d]=new Uint8Array(o[d]+u[d]),r[d].set(r[d-1].subarray(0,o[d])),r[d].set(p,o[d])):r[d]=p,e.offset+=u[d]}}function yy(e){return 32-Math.clz32(e)}function Il(e,t,r,o){o===void 0&&(o=e.view.getUint32(e.offset,!0),e.offset+=4);const u=e.offset;let d=0;for(;d<r.length;){const p=Bc(e);if(p&1)d=_Z(e,p,t,r,d);else{const a=p>>>1;gZ(e,a,t,r,d),d+=a}}e.offset=u+o}function gZ(e,t,r,o,u){const d=r+7>>3;let p=0;for(let a=0;a<d;a++)p|=e.view.getUint8(e.offset++)<<(a<<3);for(let a=0;a<t;a++)o[u+a]=p}function _Z(e,t,r,o,u){let d=t>>1<<3;const p=(1<<r)-1;let a=0;if(e.offset<e.view.byteLength)a=e.view.getUint8(e.offset++);else if(p)throw new Error(`parquet bitpack offset ${e.offset} out of range`);let w=8,T=0;for(;d;)T>8?(T-=8,w-=8,a>>>=8):w-T<r?(a|=e.view.getUint8(e.offset)<<w,e.offset++,w+=8):(u<o.length&&(o[u++]=a>>T&p),d--,T+=r);return u}function S5(e,t,r,o){const u=yZ(r,o),d=new Uint8Array(t*u);for(let p=0;p<u;p++)for(let a=0;a<t;a++)d[a*u+p]=e.view.getUint8(e.offset++);if(r==="FLOAT")return new Float32Array(d.buffer);if(r==="DOUBLE")return new Float64Array(d.buffer);if(r==="INT32")return new Int32Array(d.buffer);if(r==="INT64")return new BigInt64Array(d.buffer);if(r==="FIXED_LEN_BYTE_ARRAY"){const p=new Array(t);for(let a=0;a<t;a++)p[a]=d.subarray(a*u,(a+1)*u);return p}throw new Error(`parquet byte_stream_split unsupported type: ${r}`)}function yZ(e,t){switch(e){case"INT32":case"FLOAT":return 4;case"INT64":case"DOUBLE":return 8;case"FIXED_LEN_BYTE_ARRAY":if(!t)throw new Error("parquet byteWidth missing type_length");return t;default:throw new Error(`parquet unsupported type: ${e}`)}}function Fx(e,t,r,o){if(r===0)return[];if(t==="BOOLEAN")return vZ(e,r);if(t==="INT32")return bZ(e,r);if(t==="INT64")return xZ(e,r);if(t==="INT96")return wZ(e,r);if(t==="FLOAT")return AZ(e,r);if(t==="DOUBLE")return TZ(e,r);if(t==="BYTE_ARRAY")return SZ(e,r);if(t==="FIXED_LEN_BYTE_ARRAY"){if(!o)throw new Error("parquet missing fixed length");return MZ(e,r,o)}else throw new Error(`parquet unhandled type: ${t}`)}function vZ(e,t){const r=new Array(t);for(let o=0;o<t;o++){const u=e.offset+(o/8|0),d=o%8,p=e.view.getUint8(u);r[o]=(p&1<<d)!==0}return e.offset+=Math.ceil(t/8),r}function bZ(e,t){const r=(e.view.byteOffset+e.offset)%4?new Int32Array(vy(e.view.buffer,e.view.byteOffset+e.offset,t*4)):new Int32Array(e.view.buffer,e.view.byteOffset+e.offset,t);return e.offset+=t*4,r}function xZ(e,t){const r=(e.view.byteOffset+e.offset)%8?new BigInt64Array(vy(e.view.buffer,e.view.byteOffset+e.offset,t*8)):new BigInt64Array(e.view.buffer,e.view.byteOffset+e.offset,t);return e.offset+=t*8,r}function wZ(e,t){const r=new Array(t);for(let o=0;o<t;o++){const u=e.view.getBigInt64(e.offset+o*12,!0),d=e.view.getInt32(e.offset+o*12+8,!0);r[o]=BigInt(d)<<64n|u}return e.offset+=t*12,r}function AZ(e,t){const r=(e.view.byteOffset+e.offset)%4?new Float32Array(vy(e.view.buffer,e.view.byteOffset+e.offset,t*4)):new Float32Array(e.view.buffer,e.view.byteOffset+e.offset,t);return e.offset+=t*4,r}function TZ(e,t){const r=(e.view.byteOffset+e.offset)%8?new Float64Array(vy(e.view.buffer,e.view.byteOffset+e.offset,t*8)):new Float64Array(e.view.buffer,e.view.byteOffset+e.offset,t);return e.offset+=t*8,r}function SZ(e,t){const r=new Array(t);for(let o=0;o<t;o++){const u=e.view.getUint32(e.offset,!0);e.offset+=4,r[o]=new Uint8Array(e.view.buffer,e.view.byteOffset+e.offset,u),e.offset+=u}return r}function MZ(e,t,r){const o=new Array(t);for(let u=0;u<t;u++)o[u]=new Uint8Array(e.view.buffer,e.view.byteOffset+e.offset,r),e.offset+=r;return o}function vy(e,t,r){const o=new ArrayBuffer(r);return new Uint8Array(o).set(new Uint8Array(e,t,r)),o}const CZ=[0,255,65535,16777215,4294967295];function gS(e,t,r,o,u){for(let d=0;d<u;d++)r[o+d]=e[t+d]}function IZ(e,t){const r=e.byteLength,o=t.byteLength;let u=0,d=0;for(;u<r;){const p=e[u];if(u++,p<128)break}if(o&&u>=r)throw new Error("invalid snappy length header");for(;u<r;){const p=e[u];let a=0;if(u++,u>=r)throw new Error("missing eof marker");if((p&3)===0){let w=(p>>>2)+1;if(w>60){if(u+3>=r)throw new Error("snappy error literal pos + 3 >= inputLength");const T=w-60;w=e[u]+(e[u+1]<<8)+(e[u+2]<<16)+(e[u+3]<<24),w=(w&CZ[T])+1,u+=T}if(u+w>r)throw new Error("snappy error literal exceeds input length");gS(e,u,t,d,w),u+=w,d+=w}else{let w=0;switch(p&3){case 1:a=(p>>>2&7)+4,w=e[u]+(p>>>5<<8),u++;break;case 2:if(r<=u+1)throw new Error("snappy error end of input");a=(p>>>2)+1,w=e[u]+(e[u+1]<<8),u+=2;break;case 3:if(r<=u+3)throw new Error("snappy error end of input");a=(p>>>2)+1,w=e[u]+(e[u+1]<<8)+(e[u+2]<<16)+(e[u+3]<<24),u+=4;break}if(w===0||isNaN(w))throw new Error(`invalid offset ${w} pos ${u} inputLength ${r}`);if(w>d)throw new Error("cannot copy from before start of buffer");gS(t,d-w,t,d,a),d+=a}}if(d!==o)throw new Error("premature end of input")}function EZ(e,t,{type:r,element:o,schemaPath:u}){const d=new DataView(e.buffer,e.byteOffset,e.byteLength),p={view:d,offset:0};let a;const w=PZ(p,t,u),{definitionLevels:T,numNulls:S}=kZ(p,t,u),k=t.num_values-S;if(t.encoding==="PLAIN")a=Fx(p,r,k,o.type_length);else if(t.encoding==="PLAIN_DICTIONARY"||t.encoding==="RLE_DICTIONARY"||t.encoding==="RLE"){const I=r==="BOOLEAN"?1:d.getUint8(p.offset++);I?(a=new Array(k),r==="BOOLEAN"?(Il(p,I,a),a=a.map(P=>!!P)):Il(p,I,a,d.byteLength-p.offset)):a=new Uint8Array(k)}else if(t.encoding==="BYTE_STREAM_SPLIT")a=S5(p,k,r,o.type_length);else if(t.encoding==="DELTA_BINARY_PACKED")a=r==="INT32"?new Int32Array(k):new BigInt64Array(k),Kd(p,k,a);else if(t.encoding==="DELTA_LENGTH_BYTE_ARRAY")a=new Array(k),T5(p,k,a);else throw new Error(`parquet unsupported encoding: ${t.encoding}`);return{definitionLevels:T,repetitionLevels:w,dataPage:a}}function PZ(e,t,r){if(r.length>1){const o=_5(r);if(o){const u=new Array(t.num_values);return Il(e,yy(o),u),u}}return[]}function kZ(e,t,r){const o=Rx(r);if(!o)return{definitionLevels:[],numNulls:0};const u=new Array(t.num_values);Il(e,yy(o),u);let d=t.num_values;for(const p of u)p===o&&d--;return d===0&&(u.length=0),{definitionLevels:u,numNulls:d}}function t1(e,t,r,o){let u;const d=o==null?void 0:o[r];if(r==="UNCOMPRESSED")u=e;else if(d)u=d(e,t);else if(r==="SNAPPY")u=new Uint8Array(t),IZ(e,u);else throw new Error(`parquet unsupported compression codec: ${r}`);if((u==null?void 0:u.length)!==t)throw new Error(`parquet decompressed page length ${u==null?void 0:u.length} does not match header ${t}`);return u}function DZ(e,t,r){const u={view:new DataView(e.buffer,e.byteOffset,e.byteLength),offset:0},{type:d,element:p,schemaPath:a,codec:w,compressors:T}=r,S=t.data_page_header_v2;if(!S)throw new Error("parquet data page header v2 is undefined");const k=zZ(u,S,a);u.offset=S.repetition_levels_byte_length;const I=RZ(u,S,a),P=t.uncompressed_page_size-S.definition_levels_byte_length-S.repetition_levels_byte_length;let F=e.subarray(u.offset);S.is_compressed!==!1&&(F=t1(F,P,w,T));const G=new DataView(F.buffer,F.byteOffset,F.byteLength),H={view:G,offset:0};let Y;const $=S.num_values-S.num_nulls;if(S.encoding==="PLAIN")Y=Fx(H,d,$,p.type_length);else if(S.encoding==="RLE")Y=new Array($),Il(H,1,Y),Y=Y.map(ae=>!!ae);else if(S.encoding==="PLAIN_DICTIONARY"||S.encoding==="RLE_DICTIONARY"){const ae=G.getUint8(H.offset++);Y=new Array($),Il(H,ae,Y,P-1)}else if(S.encoding==="DELTA_BINARY_PACKED")Y=d==="INT32"?new Int32Array($):new BigInt64Array($),Kd(H,$,Y);else if(S.encoding==="DELTA_LENGTH_BYTE_ARRAY")Y=new Array($),T5(H,$,Y);else if(S.encoding==="DELTA_BYTE_ARRAY")Y=new Array($),mZ(H,$,Y);else if(S.encoding==="BYTE_STREAM_SPLIT")Y=S5(u,$,d,p.type_length);else throw new Error(`parquet unsupported encoding: ${S.encoding}`);return{definitionLevels:I,repetitionLevels:k,dataPage:Y}}function zZ(e,t,r){const o=_5(r);if(!o)return[];const u=new Array(t.num_values);return Il(e,yy(o),u,t.repetition_levels_byte_length),u}function RZ(e,t,r){const o=Rx(r);if(o){const u=new Array(t.num_values);return Il(e,yy(o),u,t.definition_levels_byte_length),u}}function LZ(e,{groupStart:t,selectStart:r,selectEnd:o},u,d){const{columnName:p}=u,a=[];let w,T,S=0;const k=d&&(()=>{T&&d({columnName:p,columnData:T,rowStart:t+S-T.length,rowEnd:t+S})});for(;S<o&&!(e.offset>=e.view.byteLength-1);){const I=BZ(e);if(I.type==="DICTIONARY_PAGE")w=_S(e,I,u,w,void 0,0),w=f5(w,u);else{const P=(T==null?void 0:T.length)||0,F=_S(e,I,u,w,T,r-S);T===F?S+=F.length-P:(k==null||k(),a.push(F),S+=F.length,T=F)}}return k==null||k(),S>o&&T&&(a[a.length-1]=T.slice(0,o-(S-T.length))),a}function _S(e,t,r,o,u,d){const{type:p,element:a,schemaPath:w,codec:T,compressors:S}=r,k=new Uint8Array(e.view.buffer,e.view.byteOffset+e.offset,t.compressed_page_size);if(e.offset+=t.compressed_page_size,t.type==="DATA_PAGE"){const I=t.data_page_header;if(!I)throw new Error("parquet data page header is undefined");if(d>I.num_values&&iZ(w))return new Array(I.num_values);const P=t1(k,Number(t.uncompressed_page_size),T,S),{definitionLevels:F,repetitionLevels:G,dataPage:H}=EZ(P,I,r);let Y=fS(H,o,I.encoding,r);if(G.length||F!=null&&F.length){const $=Array.isArray(u)?u:[];return mS($,F,G,Y,w)}else{for(let $=2;$<w.length;$++)w[$].element.repetition_type!=="REQUIRED"&&(Y=Array.from(Y,ae=>[ae]));return Y}}else if(t.type==="DATA_PAGE_V2"){const I=t.data_page_header_v2;if(!I)throw new Error("parquet data page header v2 is undefined");if(d>I.num_rows)return new Array(I.num_values);const{definitionLevels:P,repetitionLevels:F,dataPage:G}=DZ(k,t,r),H=fS(G,o,I.encoding,r),Y=Array.isArray(u)?u:[];return mS(Y,P,F,H,w)}else if(t.type==="DICTIONARY_PAGE"){const I=t.dictionary_page_header;if(!I)throw new Error("parquet dictionary page header is undefined");const P=t1(k,Number(t.uncompressed_page_size),T,S),F={view:new DataView(P.buffer,P.byteOffset,P.byteLength),offset:0};return Fx(F,p,I.num_values,a.type_length)}else throw new Error(`parquet unsupported page type: ${t.type}`)}function BZ(e){const t=y5(e),r=u5[t.field_1],o=t.field_2,u=t.field_3,d=t.field_4,p=t.field_5&&{num_values:t.field_5.field_1,encoding:wc[t.field_5.field_2],definition_level_encoding:wc[t.field_5.field_3],repetition_level_encoding:wc[t.field_5.field_4],statistics:t.field_5.field_5&&{max:t.field_5.field_5.field_1,min:t.field_5.field_5.field_2,null_count:t.field_5.field_5.field_3,distinct_count:t.field_5.field_5.field_4,max_value:t.field_5.field_5.field_5,min_value:t.field_5.field_5.field_6}},a=t.field_6,w=t.field_7&&{num_values:t.field_7.field_1,encoding:wc[t.field_7.field_2],is_sorted:t.field_7.field_3},T=t.field_8&&{num_values:t.field_8.field_1,num_nulls:t.field_8.field_2,num_rows:t.field_8.field_3,encoding:wc[t.field_8.field_4],definition_levels_byte_length:t.field_8.field_5,repetition_levels_byte_length:t.field_8.field_6,is_compressed:t.field_8.field_7===void 0?!0:t.field_8.field_7,statistics:t.field_8.field_8};return{type:r,uncompressed_page_size:o,compressed_page_size:u,crc:d,data_page_header:p,index_page_header:a,dictionary_page_header:w,data_page_header_v2:T}}function FZ(e,{metadata:t,columns:r},o){const{file:u,compressors:d,utf8:p}=e,a=[],w={...h5,...e.parsers};for(const{file_path:T,meta_data:S}of o.rowGroup.columns){if(T)throw new Error("parquet file_path not supported");if(!S)throw new Error("parquet column metadata is undefined");const k=S.path_in_schema[0];if(r&&!r.includes(k))continue;const{startByte:I,endByte:P}=x5(S),F=P-I;if(F>1<<30){console.warn(`parquet skipping huge column "${S.path_in_schema}" ${F} bytes`);continue}const G=Promise.resolve(u.slice(I,P));a.push({pathInSchema:S.path_in_schema,data:G.then(H=>{const Y=g5(t.schema,S.path_in_schema),$={view:new DataView(H),offset:0},ee={columnName:S.path_in_schema.join("."),type:S.type,element:Y[Y.length-1].element,schemaPath:Y,codec:S.codec,parsers:w,compressors:d,utf8:p};return LZ($,o,ee,e.onPage)})})}return{groupStart:o.groupStart,groupRows:o.groupRows,asyncColumns:a}}async function OZ({asyncColumns:e},t,r,o,u){const d=new Array(r),p=await Promise.all(e.map(({data:S})=>S.then(g_))),a=e.map(S=>S.pathInSchema[0]).filter(S=>!o||o.includes(S)),w=o??a,T=w.map(S=>e.findIndex(k=>k.pathInSchema[0]===S));for(let S=t;S<r;S++)if(u==="object"){const k={};for(let I=0;I<e.length;I++)k[e[I].pathInSchema[0]]=p[I][S];d[S]=k}else{const k=new Array(e.length);for(let I=0;I<w.length;I++)T[I]>=0&&(k[I]=p[T[I]][S]);d[S]=k}return d}function M5(e,t){const{asyncColumns:r}=e,o=[];for(const u of t.children)if(u.children.length){const d=r.filter(w=>w.pathInSchema[0]===u.element.name);if(!d.length)continue;const p=new Map,a=Promise.all(d.map(w=>w.data.then(T=>{p.set(w.pathInSchema.join("."),g_(T))}))).then(()=>{Md(p,u);const w=p.get(u.path.join("."));if(!w)throw new Error("parquet column data not assembled");return[w]});o.push({pathInSchema:u.path,data:a})}else{const d=r.find(p=>p.pathInSchema[0]===u.element.name);d&&o.push(d)}return{...e,asyncColumns:o}}async function NZ(e){e.metadata??(e.metadata=await _y(e.file));const t=await C5(e),{rowStart:r=0,rowEnd:o,columns:u,onChunk:d,onComplete:p,rowFormat:a}=e;if(!p&&!d){for(const{asyncColumns:S}of t)for(const{data:k}of S)await k;return}const w=Lx(e.metadata),T=t.map(S=>M5(S,w));if(d)for(const S of T)for(const k of S.asyncColumns)k.data.then(I=>{let P=S.groupStart;for(const F of I)d({columnName:k.pathInSchema[0],columnData:F,rowStart:P,rowEnd:P+F.length}),P+=F.length});if(p){const S=[];for(const k of T){const I=Math.max(r-k.groupStart,0),P=Math.min((o??1/0)-k.groupStart,k.groupRows),F=await OZ(k,I,P,u,a);Bx(S,F.slice(I,P))}p(S)}else for(const{asyncColumns:S}of T)for(const{data:k}of S)await k}function C5(e){if(!e.metadata)throw new Error("parquet requires metadata");const t=dZ(e);return e.file=pZ(e.file,t),t.groups.map(r=>FZ(e,t,r))}async function jZ(e){var d;if(((d=e.columns)==null?void 0:d.length)!==1)throw new Error("parquetReadColumn expected columns: [columnName]");e.metadata??(e.metadata=await _y(e.file));const t=C5(e),r=Lx(e.metadata),o=t.map(p=>M5(p,r)),u=[];for(const p of o)u.push(g_(await p.asyncColumns[0].data));return g_(u)}async function UZ(e){if(!e.file||!(e.file.byteLength>=0))throw new Error("parquet expected AsyncBuffer");e.metadata??(e.metadata=await _y(e.file));const{metadata:t,rowStart:r=0,columns:o,orderBy:u,filter:d}=e;if(r<0)throw new Error("parquet rowStart must be positive");const p=e.rowEnd??Number(t.num_rows),a=wg(d),w=Lx(e.metadata).children.map(I=>I.element.name),T=a.filter(I=>!w.includes(I));if(T.length)throw new Error(`parquet filter columns not found: ${T.join(", ")}`);if(u&&!w.includes(u))throw new Error(`parquet orderBy column not found: ${u}`);const S=o?w.filter(I=>o.includes(I)||a.includes(I)||I===u):void 0,k=o&&S?o.length<S.length:!1;if(d&&!u&&p<t.num_rows){const I=new Array;let P=0;for(const F of t.row_groups){const G=P+Number(F.num_rows),H=await Ag({...e,rowStart:P,rowEnd:G,columns:S});for(const Y of H)if(oh(Y,d)){if(k&&S)for(const $ of S)o&&!o.includes($)&&delete Y[$];I.push(Y)}if(I.length>=p)break;P=G}return I.slice(r,p)}else if(d){const I=await Ag({...e,rowStart:void 0,rowEnd:void 0,columns:S});u&&I.sort((F,G)=>yS(F[u],G[u]));const P=new Array;for(const F of I)if(oh(F,d)){if(k&&S)for(const G of S)o&&!o.includes(G)&&delete F[G];P.push(F)}return P.slice(r,p)}else if(typeof u=="string"){const I=await jZ({...e,rowStart:void 0,rowEnd:void 0,columns:[u]}),P=Array.from(I,(H,Y)=>Y).sort((H,Y)=>yS(I[H],I[Y])).slice(r,p),F=await VZ({...e,rows:P});return P.map(H=>F[H])}else return await Ag(e)}async function VZ(e){const{file:t,rows:r}=e;e.metadata||(e.metadata=await _y(t));const{row_groups:o}=e.metadata,u=Array(o.length).fill(!1);let d=0;const p=o.map(S=>d+=Number(S.num_rows));for(const S of r){const k=p.findIndex(I=>S<I);u[k]=!0}const a=[];let w;d=0;for(let S=0;S<u.length;S++){const k=d+Number(o[S].num_rows);u[S]?w===void 0&&(w=d):w!==void 0&&(a.push([w,k]),w=void 0),d=k}w!==void 0&&a.push([w,d]);const T=new Array(Number(e.metadata.num_rows));for(const[S,k]of a){const I=await Ag({...e,rowStart:S,rowEnd:k});for(let P=S;P<k;P++)T[P]=I[P-S],T[P].__index__=P}return T}function yS(e,t){return e<t?-1:e>t?1:0}function oh(e,t={}){return"$and"in t&&Array.isArray(t.$and)?t.$and.every(r=>oh(e,r)):"$or"in t&&Array.isArray(t.$or)?t.$or.some(r=>oh(e,r)):"$nor"in t&&Array.isArray(t.$nor)?!t.$nor.some(r=>oh(e,r)):Object.entries(t).every(([r,o])=>{const u=e[r];return typeof o!="object"||o===null||Array.isArray(o)?hh(u,o):Object.entries(o||{}).every(([d,p])=>{switch(d){case"$gt":return u>p;case"$gte":return u>=p;case"$lt":return u<p;case"$lte":return u<=p;case"$eq":return hh(u,p);case"$ne":return!hh(u,p);case"$in":return Array.isArray(p)&&p.includes(u);case"$nin":return Array.isArray(p)&&!p.includes(u);case"$not":return!oh({[r]:u},{[r]:p});default:return!0}})})}function wg(e){if(!e)return[];const t=[];return"$and"in e&&Array.isArray(e.$and)?t.push(...e.$and.flatMap(wg)):"$or"in e&&Array.isArray(e.$or)?t.push(...e.$or.flatMap(wg)):"$nor"in e&&Array.isArray(e.$nor)?t.push(...e.$nor.flatMap(wg)):t.push(...Object.keys(e)),t}function Ag(e){return new Promise((t,r)=>{NZ({rowFormat:"object",...e,onComplete:t}).catch(r)})}function GZ(){const e=qZ();return(t,r)=>{const{memory:o,uncompress:u}=e.exports,d=68e3,p=d+t.byteLength,a=d+t.byteLength+r;if(o.buffer.byteLength<a){const k=o.buffer.byteLength/65536,P=Math.ceil(a/65536)-k;o.grow(P)}const w=new Uint8Array(o.buffer);w.set(t,d);const T=u(d,t.byteLength,p);if(T===-1)throw new Error("invalid snappy length header");if(T===-2)throw new Error("missing eof marker");if(T===-3)throw new Error("premature end of input");if(T)throw new Error(`failed to uncompress data ${T}`);return w.slice(p,p+r)}}function qZ(){const e=atob(ZZ),t=new Uint8Array(e.length);for(let o=0;o<e.length;o+=1)t[o]=e.charCodeAt(o);const r=new WebAssembly.Module(t);return new WebAssembly.Instance(r)}const ZZ="AGFzbQEAAAABEANgAABgA39/fwF/YAF/AX8DBgUAAQEBAgUDAQACBj8KfwFBoIwEC38AQYAIC38AQaAMC38AQaAMC38AQaCMBAt/AEGACAt/AEGgjAQLfwBBgIAIC38AQQALfwBBAQsHwQEOBm1lbW9yeQIAEV9fd2FzbV9jYWxsX2N0b3JzAAAGbWVtY3B5AAEHbWVtbW92ZQACCnVuY29tcHJlc3MAAwxfX2Rzb19oYW5kbGUDAQpfX2RhdGFfZW5kAwILX19zdGFja19sb3cDAwxfX3N0YWNrX2hpZ2gDBA1fX2dsb2JhbF9iYXNlAwULX19oZWFwX2Jhc2UDBgpfX2hlYXBfZW5kAwcNX19tZW1vcnlfYmFzZQMIDF9fdGFibGVfYmFzZQMJCuASBQIAC8sBAQN/AkAgAkUNAAJAAkAgAkEHcSIDDQAgACEEIAIhBQwBCyAAIQQgAiEFA0AgBCABLQAAOgAAIARBAWohBCABQQFqIQEgBUF/aiEFIANBf2oiAw0ACwsgAkEISQ0AA0AgBCABLQAAOgAAIAQgAS0AAToAASAEIAEtAAI6AAIgBCABLQADOgADIAQgAS0ABDoABCAEIAEtAAU6AAUgBCABLQAGOgAGIAQgAS0ABzoAByAEQQhqIQQgAUEIaiEBIAVBeGoiBQ0ACwsgAAugAwEEfwJAIAAgAUYNAAJAAkAgACABSQ0AIAEgAmoiAyAASw0BCyACRQ0BAkACQCACQQdxIgMNACAAIQQgAiEFDAELIAAhBCACIQUDQCAEIAEtAAA6AAAgBEEBaiEEIAFBAWohASAFQX9qIQUgA0F/aiIDDQALCyACQQhJDQEDQCAEIAEtAAA6AAAgBCABLQABOgABIAQgAS0AAjoAAiAEIAEtAAM6AAMgBCABLQAEOgAEIAQgAS0ABToABSAEIAEtAAY6AAYgBCABLQAHOgAHIARBCGohBCABQQhqIQEgBUF4aiIFDQAMAgsLIAJFDQACQAJAIAJBA3EiBA0AIAAgAmohBiACIQUMAQsgAiEFA0AgBUF/aiIFIABqIgYgBSABaiIDLQAAOgAAIARBf2oiBA0ACwsgAkEESQ0AIAZBfGohASADQXxqIQQDQCABQQNqIARBA2otAAA6AAAgAUECaiAEQQJqLQAAOgAAIAFBAWogBEEBai0AADoAACABIAQtAAA6AAAgAUF8aiEBIARBfGohBCAFQXxqIgUNAAsLIAALswoBCX8jgICAgABBIGsiAySAgICAACADQQlqQgA3AAAgA0IANwIEIAMgA0EYajYCAEF/IQQCQCABRQ0AIAMgAUF/aiIFNgIcIAMgAEEBajYCGCAALAAAIgZB/wBxIQcCQCAGQX9KDQAgBUUNASADIAFBfmoiBTYCHCADIABBAmo2AhggACwAASIGQf8AcUEHdCAHciEHQX8hBCAGQX9KDQAgBUUNASADIAFBfWoiBTYCHCADIABBA2o2AhggACwAAiIGQf8AcUEOdCAHciEHQX8hBCAGQX9KDQAgBUUNASADIAFBfGoiBTYCHCADIABBBGo2AhggACwAAyIGQf8AcUEVdCAHciEHQX8hBCAGQX9KDQAgBUUNASADIAFBe2o2AhwgAyAAQQVqNgIYIAAsAAQiAUEASA0BIAFBHHQgB3IhBwsgAiAHaiEIAkACQCADEISAgIAADQAgAiEADAELIAMoAgQhASACIQADQAJAIAMoAgggAWtBBEoNACADIAE2AgQgAxCEgICAAEUNAiADKAIEIQELIAFBAWohBQJAAkAgAS0AACIGQQNxDQAgCCAAayEJIAMoAggiCiAFayEEIAZBAnYiC0EBaiEHAkAgBkE/Sw0AIARBEEkNACAJQRBIDQAgACABKAIBNgIAIAAgASgCBTYCBCAAIAEoAgk2AgggACABKAINNgIMIAAgB2ohACADKAIIIAUgB2oiAWtBBEoNAyADIAE2AgQgAxCEgICAAEUNBAwCCwJAAkAgBkHwAU8NACAFIQYMAQsgCiAFIAtBRWoiAWoiBmshBCABQQJ0QYCIgIAAaigCACAFKAIAcUEBaiEHCwJAIAcgBE0NAANAIAggAGsgBEkNBSAAIAYgBBCBgICAACEAIAMoAgAiASABKAIAIgkgAygCDCIFaiIGNgIAIAFBBGoiASABKAIAIgogBWsiATYCACADIAE2AgwgACAEaiEAIAFFDQUgAyAJIApqNgIIIAcgBGshByABIQQgByABSw0ACyAIIABrIQkLIAkgB0kNAyAAIAYgBxCBgICAACAHaiEAIAMoAgggBiAHaiIBa0EESg0CIAMgATYCBCADEISAgIAADQEMAwsgACACayAGQQF0QaCIgIAAai8BACIBQQt2IgpBAnRBgIiAgABqKAIAIAUoAgBxIAFBgA5xaiIHQX9qTQ0CIAggAGshBAJAAkAgAUH/AXEiCUEQSw0AIAdBCEkNACAEQRBJDQAgACAAIAdrIgEoAgA2AgAgACABKAIENgIEIAAgASgCCDYCCCAAIAFBDGooAgA2AgwMAQsCQAJAAkAgBCAJQQpqSQ0AIAAgB2shBCAAIQEgCSEGIAdBB0wNAQwCCyAEIAlJDQUgCUEBaiEEQQAgB2shByAAIQEDQCABIAEgB2otAAA6AAAgAUEBaiEBIARBf2oiBEEBSw0ADAMLCwNAIAEgBCgCADYCACABIAQoAgQ2AgQgBiAHayEGIAEgB2oiASAEayIHQQhIDQALCyAGQQFIDQAgBkEIaiEHA0AgASAEKAIANgIAIAEgBCgCBDYCBCABQQhqIQEgBEEIaiEEIAdBeGoiB0EISw0ACwsgACAJaiEAIAMoAgggBSAKaiIBa0EESg0BIAMgATYCBCADEISAgIAARQ0CCyADKAIEIQEMAAsLIAMoAgAiASABKAIEIAMoAgwiBGs2AgQgASAEIAEoAgBqNgIAAkAgAy0AEA0AQX4hBAwBC0EAQX0gCCAARhshBAsgA0EgaiSAgICAACAEC7YDAQd/AkAgACgCBCIBIAAoAggiAkcNACAAKAIAIgIgAigCACIDIAAoAgwiBGoiATYCACACQQRqIgIgAigCACICIARrIgU2AgAgACAFNgIMAkAgAiAERw0AIABBAToAEEEADwsgACADIAJqIgI2AggLAkACQAJAIAIgAWsiAiABLQAAQQF0QaCIgIAAai8BAEELdkEBaiIFTw0AIABBEWogASACEIKAgIAAIQYgACgCDCEEQQAhByAAQQA2AgwgACgCACIBIAEoAgQgBGs2AgQgASAEIAEoAgBqIgM2AgADQCABQQRqKAIAIgFFDQMgBiACaiADIAUgAmsiBCABIAQgAUkbIgQQgYCAgAAaIAAoAgAiASABKAIEIARrNgIEIAEgASgCACAEaiIDNgIAIAQgAmoiAiAFSQ0ACyAAIAY2AgQgACAGIAVqNgIIDAELAkAgAkEESw0AIAAgAEERaiABIAIQgoCAgAAiASACajYCCCAAIAE2AgQgACgCDCECIABBADYCDCAAKAIAIgEgASgCBCACazYCBCABIAIgASgCAGo2AgAMAQsgACABNgIEC0EBIQcLIAcLC6gEAQBBgAgLoAQAAAAA/wAAAP//AAD///8A/////wAAAAAAAAAAAAAAAAEABAgBEAEgAgAFCAIQAiADAAYIAxADIAQABwgEEAQgBQAICAUQBSAGAAkIBhAGIAcACggHEAcgCAALCAgQCCAJAAQJCRAJIAoABQkKEAogCwAGCQsQCyAMAAcJDBAMIA0ACAkNEA0gDgAJCQ4QDiAPAAoJDxAPIBAACwkQEBAgEQAEChEQESASAAUKEhASIBMABgoTEBMgFAAHChQQFCAVAAgKFRAVIBYACQoWEBYgFwAKChcQFyAYAAsKGBAYIBkABAsZEBkgGgAFCxoQGiAbAAYLGxAbIBwABwscEBwgHQAICx0QHSAeAAkLHhAeIB8ACgsfEB8gIAALCyAQICAhAAQMIRAhICIABQwiECIgIwAGDCMQIyAkAAcMJBAkICUACAwlECUgJgAJDCYQJiAnAAoMJxAnICgACwwoECggKQAEDSkQKSAqAAUNKhAqICsABg0rECsgLAAHDSwQLCAtAAgNLRAtIC4ACQ0uEC4gLwAKDS8QLyAwAAsNMBAwIDEABA4xEDEgMgAFDjIQMiAzAAYOMxAzIDQABw40EDQgNQAIDjUQNSA2AAkONhA2IDcACg43EDcgOAALDjgQOCA5AAQPORA5IDoABQ86EDogOwAGDzsQOyA8AAcPPBA8IAEICA89ED0gARAJDz4QPiABGAoPPxA/IAEgCw9AEEAgAGQEbmFtZQE9BQARX193YXNtX2NhbGxfY3RvcnMBBm1lbWNweQIHbWVtbW92ZQMKdW5jb21wcmVzcwQKcmVmaWxsX3RhZwcSAQAPX19zdGFja19wb2ludGVyCQoBAAcucm9kYXRhADIJcHJvZHVjZXJzAQxwcm9jZXNzZWQtYnkBDFVidW50dSBjbGFuZwsxNi4wLjYgKDE1KQAsD3RhcmdldF9mZWF0dXJlcwIrD211dGFibGUtZ2xvYmFscysIc2lnbi1leHQ=";var HZ=tn('<div class="flex flex-row px-2 text-xs gap-2"><span class="w-24 text-end"> </span> <span class="flex-1"> </span></div>'),$Z=tn('<div class="flex flex-row px-2 gap-1 w-full"><h4 class="w-12 font-semibold text-xs"> </h4> <div class="flex flex-col gap-1 w-full"></div></div>'),WZ=tn(`<div class="
            flex flex-col w-full p-2 gap-1
            bg-gray-100 rounded-lg shadow-sm
        "><span class="mb-1 text-xs"> </span> <!></div>`);function YZ(e,t){nr(t,!0);let r=Se(t,"data",19,()=>[]),o=Se(t,"stations",19,()=>[]),u=Se(t,"variables",19,()=>[]),d=Se(t,"timeslice",3,void 0),p=$t(void 0);ei(()=>{if(d()&&r().length&&o().length&&u().length){const S=r().filter(k=>k.obsTimeUtc.getTime()===d().getTime());Qe(p,o().reduce((k,I)=>({...k,[I]:S.filter(P=>P.stationID===I)[0]}),{}),!0)}else Qe(p,void 0)});var a=Ti(),w=Kn(a);{var T=S=>{var k=WZ(),I=Bt(k),P=Bt(I,!0);Et(I);var F=an(I,2);Pr(F,17,o,la,(G,H)=>{var Y=Ti(),$=Kn(Y);{var ae=ee=>{var ce=$Z(),re=Bt(ce),he=Bt(re,!0);Et(re);var be=an(re,2);Pr(be,21,u,la,(ke,Ie)=>{var ue=HZ(),Ve=Bt(ue),Ze=Bt(Ve);Et(Ve);var Xe=an(Ve,2),Re=Bt(Xe,!0);Et(Xe),Et(ue),wn(()=>{xi(Ze,`${L(p)[L(H)][L(Ie).variable]??""} ${L(Ie).units??""}`),xi(Re,L(Ie).display)}),It(ke,ue)}),Et(be),Et(ce),wn(()=>xi(he,L(H))),It(ee,ce)};pn($,ee=>{L(p)[L(H)]&&ee(ae)})}It(G,Y)}),Et(k),wn(G=>xi(P,G),[()=>d().toLocaleString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric",timeZoneName:"short"})]),It(S,k)};pn(w,S=>{L(p)&&d()&&S(T)})}It(e,a),ir()}var XZ=tn("<span>No data available for the selected station(s) and date range.</span>"),QZ=tn('<div class="w-full flex flex-col items-center gap-4"><!> <div role="img" class="w-full"></div> <!> <!></div>');function KZ(e,t){nr(t,!0);const r="https://storage.googleapis.com/bsecdata",o=Vh.every(5);let u=Se(t,"availableVariables",19,()=>[]),d=Se(t,"selectedStations",19,()=>[]),p=Se(t,"selectedStationsColorIndex",19,()=>[]),a=Se(t,"singleVariable",19,()=>[]),w=Se(t,"multiVariables",19,()=>[]),T=$t(void 0),S=$t(void 0),k=$t(void 0),I=$t(void 0),P=$t(void 0),F=$t(void 0),G=$t(!1),H=$t(void 0),Y=$t(void 0);ei(()=>{d().length>0&&(d().length===1?Qe(I,w().map(Ie=>u().find(ue=>ue.display===Ie)),!0):Qe(I,u().filter(Ie=>a().includes(Ie.display)),!0))}),ei(()=>{Qe(P,Ac(t.startDate,"yyyy-mm-dd",db,"standard"),!0);let Ie=Ac(t.endDate,"yyyy-mm-dd",db,"standard");Ie.setHours(23,59,59),Qe(F,Ie,!0)}),ei(()=>{if(Qe(S,void 0),Qe(k,void 0),Qe(G,!0),L(P)&&L(F)&&d().length>0&&L(I).length>0){const Ie=[];d().forEach(ue=>{Ie.push(hZ({url:`${r}/${ue}_5min_data.parquet`}).then(Ve=>UZ({file:Ve,compressors:{SNAPPY:GZ()},columns:["stationID","obsTimeUtc",...L(I).map(Ze=>Ze.variable)],filter:{obsTimeUtc:{$gte:L(P),$lte:L(F)}}})))}),Promise.all(Ie).then(ue=>{Qe(S,ue.flat(),!0)}).finally(()=>{Qe(G,!1)})}}),ei(()=>{if(L(S)&&L(S).length>0&&L(I).length>0&&L(Y))if(d().length===1){const Ie=[...new Set(L(I).map(Ze=>Ze.units))];let ue;const Ve=Ie.map((Ze,Xe)=>{const Re=L(I).filter(_t=>_t.units===Ze),ot=_t=>Oc(Re.map(tt=>_t[tt.variable])),Pt=_t=>Ja(Re.map(tt=>_t[tt.variable])),bt=[Oc(L(S),ot),Ja(L(S),Pt)];return Xe===0&&(ue=bt),K_(bt,ue)});Qe(k,Jb({width:L(Y),height:300,marginRight:30*Ve.length,x:{label:"",domain:[L(P),L(F)],grid:!0,labelArrow:"none",type:"time"},y:{axis:"left",label:L(I)[0].units,grid:!0,tickFormat:Es("~g")},color:{legend:!0},marks:[...Ve.slice(1).map((Ze,Xe)=>Px(Ze.ticks(),{anchor:"right",label:Ie[Xe+1],y:Ze,tickFormat:Es("~g"),dx:Xe*40,labelOffset:40+Xe*40})),kv(L(S),{x:"obsTimeUtc",y:L(I)[0].variable,stroke:Ze=>L(I)[0].display,interval:o}),...L(I).slice(1).map((Ze,Xe)=>kv(L(S),Zq(Re=>Re.map(Ve[Ie.findIndex(ot=>ot===Ze.units)]),{x:"obsTimeUtc",y:Ze.variable,stroke:Re=>Ze.display,interval:o}))),Xb(L(S),Wb({x:"obsTimeUtc",py:L(I)[0].variable,stroke:"#911364"}))]}),!0)}else d().length>1&&Qe(k,Jb({width:L(Y),height:300,marginLeft:50,x:{label:"",domain:[L(P),L(F)],grid:!0,labelArrow:"none",type:"time"},y:{label:L(I)[0].units,grid:!0,tickFormat:Es("~g")},color:{legend:!0,domain:d(),range:p().map(Ie=>WR[Ie])},marks:[kv(L(S),{x:"obsTimeUtc",y:L(I)[0].variable,z:"stationID",stroke:"stationID",interval:o}),Xb(L(S),Wb({x:"obsTimeUtc",py:L(I)[0].variable,stroke:"#911364"}))]}),!0);else Qe(k,void 0)}),ei(()=>{var Ie,ue,Ve;(ue=(Ie=L(T))==null?void 0:Ie.firstChild)==null||ue.remove(),L(k)&&((Ve=L(T))==null||Ve.append(L(k)),L(k).addEventListener("input",Ze=>{var Xe;Qe(H,(Xe=L(k).value)==null?void 0:Xe.obsTimeUtc,!0)}))});var $=QZ(),ae=Bt($);{var ee=Ie=>{Ig(Ie,{class:"text-blue-600 mt-24",icon:"line-md:downloading-loop",width:"200",height:"200"})};pn(ae,Ie=>{L(G)&&Ie(ee)})}var ce=an(ae,2);Go(ce,Ie=>Qe(T,Ie),()=>L(T));var re=an(ce,2);{var he=Ie=>{YZ(Ie,{get data(){return L(S)},get stations(){return d()},get timeslice(){return L(H)},get variables(){return L(I)}})};pn(re,Ie=>{L(S)&&L(S).length>0&&Ie(he)})}var be=an(re,2);{var ke=Ie=>{var ue=XZ();It(Ie,ue)};pn(be,Ie=>{L(S)&&L(S).length===0&&Ie(ke)})}Et($),S6(ce,"clientWidth",Ie=>Qe(Y,Ie)),It(e,$),ir()}var JZ=tn('<div class="svelte-66wdl1"></div>');function eH(e,t){let r=Se(t,"color",19,()=>"cornflowerblue"),o=Se(t,"duration",19,()=>"1.5s"),u=Se(t,"size",19,()=>"1em");var d=JZ();let p;wn(a=>p=ca(d,`--duration: ${o()??""}`,p,a),[()=>({"border-color":`${r()??""} transparent ${r()??""}
  ${r()??""}`,width:u(),height:u()})]),It(e,d)}La(["click"]);La(["click"]);const zv={Alert:{viewBox:"0 0 16 16",path:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"},Check:{viewBox:"0 0 12 16",path:"M12 5l-8 8l-4-4l1.5-1.5L4 10l6.5-6.5L12 5z"},ChevronExpand:{viewBox:"0 0 16 16",path:"M3.646 9.146a.5.5 0 0 1 .708 0L8 12.793l3.646-3.647a.5.5 0 0 1 .708.708l-4 4a.5.5 0 0 1-.708 0l-4-4a.5.5 0 0 1 0-.708zm0-2.292a.5.5 0 0 0 .708 0L8 3.207l3.646 3.647a.5.5 0 0 0 .708-.708l-4-4a.5.5 0 0 0-.708 0l-4 4a.5.5 0 0 0 0 .708z"},Collapse:{viewBox:"0 0 24 24",path:"M12 7.59L7.05 2.64L5.64 4.05L12 10.41l6.36-6.36l-1.41-1.41L12 7.59zM5.64 19.95l1.41 1.41L12 16.41l4.95 4.95l1.41-1.41L12 13.59l-6.36 6.36z"},Copy:{viewBox:"0 0 16 16",path:"M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"},Cross:{viewBox:"0 0 24 24",path:"M18.3 5.71a.996.996 0 0 0-1.41 0L12 10.59L7.11 5.7A.996.996 0 1 0 5.7 7.11L10.59 12L5.7 16.89a.996.996 0 1 0 1.41 1.41L12 13.41l4.89 4.89a.996.996 0 1 0 1.41-1.41L13.41 12l4.89-4.89c.38-.38.38-1.02 0-1.4z"},Disabled:{viewBox:"0 0 24 24",path:"M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2S2 6.477 2 12s4.477 10 10 10Zm-4.906-3.68L18.32 7.094A8 8 0 0 1 7.094 18.32ZM5.68 16.906A8 8 0 0 1 16.906 5.68L5.68 16.906Z"},Expand:{viewBox:"0 0 24 24",path:"m12 19.24l-4.95-4.95l-1.41 1.42L12 22.07l6.36-6.36l-1.41-1.42L12 19.24zM5.64 8.29l1.41 1.42L12 4.76l4.95 4.95l1.41-1.42L12 1.93L5.64 8.29z"},GitHub:{viewBox:"0 0 24 24",path:"M8.422 20.081c0 .896.01 1.753.016 2.285a.617.617 0 0 0 .422.58c2.078.686 4.317.718 6.414.091l.292-.087a.67.67 0 0 0 .478-.638c.005-.733.017-2.017.017-3.53c0-1.372-.477-2.25-1.031-2.707c3.399-.366 6.97-1.61 6.97-7.227c0-1.61-.592-2.91-1.566-3.934c.153-.366.688-1.866-.153-3.878c0 0-1.28-.403-4.201 1.5a14.76 14.76 0 0 0-3.82-.494c-1.298 0-2.597.165-3.819.494C5.52.65 4.24 1.036 4.24 1.036c-.84 2.012-.306 3.512-.153 3.878a5.565 5.565 0 0 0-1.566 3.934c0 5.598 3.552 6.86 6.951 7.227c-.439.366-.84 1.006-.973 1.957c-.879.384-3.075 1.006-4.45-1.207c-.286-.44-1.146-1.519-2.349-1.5c-1.28.018-.516.695.02.97c.648.347 1.393 1.646 1.565 2.067c.306.823 1.299 2.396 5.137 1.72Z"},StackBlitz:{viewBox:"0 0 24 24",path:"M10.797 14.182H3.635L16.728 0l-3.525 9.818h7.162L7.272 24l3.524-9.818Z"},Svelte:{viewBox:"0 0 24 24",path:"M10.354 21.125a4.44 4.44 0 0 1-4.765-1.767a4.109 4.109 0 0 1-.703-3.107a3.898 3.898 0 0 1 .134-.522l.105-.321l.287.21a7.21 7.21 0 0 0 2.186 1.092l.208.063l-.02.208a1.253 1.253 0 0 0 .226.83a1.337 1.337 0 0 0 1.435.533a1.231 1.231 0 0 0 .343-.15l5.59-3.562a1.164 1.164 0 0 0 .524-.778a1.242 1.242 0 0 0-.211-.937a1.338 1.338 0 0 0-1.435-.533a1.23 1.23 0 0 0-.343.15l-2.133 1.36a4.078 4.078 0 0 1-1.135.499a4.44 4.44 0 0 1-4.765-1.766a4.108 4.108 0 0 1-.702-3.108a3.855 3.855 0 0 1 1.742-2.582l5.589-3.563a4.072 4.072 0 0 1 1.135-.499a4.44 4.44 0 0 1 4.765 1.767a4.109 4.109 0 0 1 .703 3.107a3.943 3.943 0 0 1-.134.522l-.105.321l-.286-.21a7.204 7.204 0 0 0-2.187-1.093l-.208-.063l.02-.207a1.255 1.255 0 0 0-.226-.831a1.337 1.337 0 0 0-1.435-.532a1.231 1.231 0 0 0-.343.15L8.62 9.368a1.162 1.162 0 0 0-.524.778a1.24 1.24 0 0 0 .211.937a1.338 1.338 0 0 0 1.435.533a1.235 1.235 0 0 0 .344-.151l2.132-1.36a4.067 4.067 0 0 1 1.135-.498a4.44 4.44 0 0 1 4.765 1.766a4.108 4.108 0 0 1 .702 3.108a3.857 3.857 0 0 1-1.742 2.583l-5.589 3.562a4.072 4.072 0 0 1-1.135.499m10.358-17.95C18.484-.015 14.082-.96 10.9 1.068L5.31 4.63a6.412 6.412 0 0 0-2.896 4.295a6.753 6.753 0 0 0 .666 4.336a6.43 6.43 0 0 0-.96 2.396a6.833 6.833 0 0 0 1.168 5.167c2.229 3.19 6.63 4.135 9.812 2.108l5.59-3.562a6.41 6.41 0 0 0 2.896-4.295a6.756 6.756 0 0 0-.665-4.336a6.429 6.429 0 0 0 .958-2.396a6.831 6.831 0 0 0-1.167-5.168Z"}};var tH=DS("<svg><path></path></svg>");function ag(e,t){nr(t,!0);let r=I_(t,["$$slots","$$events","$$legacy","icon"]);const o=Vt(()=>t.icon in zv?zv[t.icon]:(console.error(`Icon '${t.icon}' not found`),zv.Alert));var u=tH();Sg(u,()=>({viewBox:L(o).viewBox,fill:"currentColor",...r}),void 0,void 0,"svelte-1nulj1g");var d=Bt(u);Et(u),wn(()=>ri(d,"d",L(o).path)),It(e,u),ir()}function nH(e,{from:t,to:r},o={}){var{delay:u=0,duration:d=re=>Math.sqrt(re)*120,easing:p=iC}=o,a=getComputedStyle(e),w=a.transform==="none"?"":a.transform,[T,S]=a.transformOrigin.split(" ").map(parseFloat);T/=e.clientWidth,S/=e.clientHeight;var k=iH(e),I=e.clientWidth/r.width/k,P=e.clientHeight/r.height/k,F=t.left+t.width*T,G=t.top+t.height*S,H=r.left+r.width*T,Y=r.top+r.height*S,$=(F-H)*I,ae=(G-Y)*P,ee=t.width/r.width,ce=t.height/r.height;return{delay:u,duration:typeof d=="function"?d(Math.sqrt($*$+ae*ae)):d,easing:p,css:(re,he)=>{var be=he*$,ke=he*ae,Ie=re+he*ee,ue=re+he*ce;return`transform: ${w} translate(${be}px, ${ke}px) scale(${Ie}, ${ue});`}}}function iH(e){if("currentCSSZoom"in e)return e.currentCSSZoom;for(var t=e,r=1;t!==null;)r*=+getComputedStyle(t).zoom,t=t.parentElement;return r}const qa=e=>{if(e instanceof Object){if(e.label===void 0){const t=JSON.stringify(e);console.error(`MultiSelect option ${t} is an object but has no label key`)}return e.label}return`${e}`};function vS(e,t=null){let r="";if(["selected","option",null].includes(t)||console.error(`MultiSelect: Invalid key=${t} for get_style`),typeof e=="object"&&e.style&&(typeof e.style=="string"&&(r=e.style),typeof e.style=="object")){if(t&&t in e.style)return e.style[t]??"";console.error(`Invalid style object for option=${JSON.stringify(e)}`)}return r.trim()&&!r.trim().endsWith(";")&&(r+=";"),r}function rH(e,t,r){if(typeof CSS>"u"||!CSS.highlights||!t)return;CSS.highlights.clear();const o=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode:a=>(a==null?void 0:a.textContent)===r?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}),u=[];let d=o.nextNode();for(;d;)u.push(d),d=o.nextNode();const p=u.map(a=>{var k;const w=(k=a.textContent)==null?void 0:k.toLowerCase(),T=[];let S=0;for(;w&&S<w.length;){const I=w.indexOf(t,S);if(I===-1)break;T.push(I),S=I+t.length}return T.map(I=>{const P=new Range;return P.setStart(a,I),P.setEnd(a,I+t.length),P})});CSS.highlights.set("sms-search-matches",new Highlight(...p.flat()))}var aH=(e,t,r)=>t(L(r),e),oH=tn('<button type="button" class="remove svelte-lg8hx"><!></button>'),sH=tn('<li role="option" aria-selected="true"><!> <!></li>'),lH=tn("<span> </span>"),cH=tn('<button type="button" class="remove remove-all svelte-lg8hx"><!></button>'),uH=tn("<!> <!>",1),hH=(e,t,r,o)=>{L(t).disabled||r(L(o),e)},fH=(e,t,r,o)=>{!L(t).disabled&&(e.key==="Enter"||e.code==="Space")&&(e.preventDefault(),r(L(o),e))},dH=tn('<li role="option" aria-selected="false"><!></li>'),pH=(e,t,r,o,u)=>{L(t)==="create"&&r()&&o(u(),e)},mH=(e,t,r,o,u)=>{L(t)==="create"&&r()&&(e.key==="Enter"||e.code==="Space")&&(e.preventDefault(),o(u(),e))},gH=(e,t)=>Qe(t,!0),_H=(e,t)=>Qe(t,!1),yH=tn('<li role="option" aria-selected="false"><!></li>'),vH=tn('<ul role="listbox"><!> <!></ul>'),bH=tn('<div role="searchbox" tabindex="-1"><input tabindex="-1" aria-hidden="true" aria-label="ignore this, used only to prevent form submission if select is required but empty" class="form-control svelte-lg8hx"/> <!> <ul aria-label="selected options"><!> <input/> <!></ul> <!> <!> <!></div>');function bS(e,t){var on;nr(t,!0);let r=Se(t,"activeIndex",15,null),o=Se(t,"activeOption",15,null),u=Se(t,"createOptionMsg",19,()=>"Create this option..."),d=Se(t,"allowUserOptions",3,!1),p=Se(t,"allowEmpty",3,!1),a=Se(t,"autocomplete",19,()=>"off"),w=Se(t,"autoScroll",3,!0),T=Se(t,"breakpoint",3,800),S=Se(t,"defaultDisabledTitle",19,()=>"This option is disabled"),k=Se(t,"disabled",3,!1),I=Se(t,"disabledInputTitle",19,()=>"This input is disabled"),P=Se(t,"duplicateOptionMsg",19,()=>"This option is already selected"),F=Se(t,"duplicates",3,!1),G=Se(t,"key",3,Oe=>`${qa(Oe)}`.toLowerCase()),H=Se(t,"filterFunc",3,(Oe,lt)=>lt?`${qa(Oe)}`.toLowerCase().includes(lt.toLowerCase()):!0),Y=Se(t,"closeDropdownOnSelect",19,()=>"if-mobile"),$=Se(t,"form_input",15,null),ae=Se(t,"highlightMatches",3,!0),ee=Se(t,"id",3,null),ce=Se(t,"input",15,null),re=Se(t,"inputClass",19,()=>""),he=Se(t,"inputStyle",3,null),be=Se(t,"inputmode",3,null),ke=Se(t,"invalid",15,!1),Ie=Se(t,"liActiveOptionClass",19,()=>""),ue=Se(t,"liActiveUserMsgClass",19,()=>""),Ve=Se(t,"liOptionClass",19,()=>""),Ze=Se(t,"liOptionStyle",3,null),Xe=Se(t,"liSelectedClass",19,()=>""),Re=Se(t,"liSelectedStyle",3,null),ot=Se(t,"liUserMsgClass",19,()=>""),Pt=Se(t,"loading",3,!1),bt=Se(t,"matchingOptions",31,()=>Ui([])),_t=Se(t,"maxOptions",3,void 0),tt=Se(t,"maxSelect",3,null),Tt=Se(t,"maxSelectMsg",3,(Oe,lt)=>lt>1?`${Oe}/${lt}`:""),ct=Se(t,"maxSelectMsgClass",19,()=>""),mt=Se(t,"name",3,null),Xt=Se(t,"noMatchingOptionsMsg",19,()=>"No matching options"),Ut=Se(t,"open",15,!1),St=Se(t,"options",15),pt=Se(t,"outerDiv",15,null),Ft=Se(t,"outerDivClass",19,()=>""),nt=Se(t,"parseLabelsAsHtml",3,!1),De=Se(t,"pattern",3,null),Ke=Se(t,"placeholder",3,null),Be=Se(t,"removeAllTitle",19,()=>"Remove all"),wt=Se(t,"removeBtnTitle",19,()=>"Remove"),gt=Se(t,"minSelect",3,null),Rt=Se(t,"required",7,!1),st=Se(t,"resetFilterOnAdd",3,!0),ht=Se(t,"searchText",31,()=>""),qe=Se(t,"selected",31,()=>{var Oe;return Ui(((Oe=St())==null?void 0:Oe.filter(lt=>lt instanceof Object&&(lt==null?void 0:lt.preselected)).slice(0,tt()??void 0))??[])}),Mt=Se(t,"sortSelected",3,!1),Ht=Se(t,"selectedOptionsDraggable",19,()=>!Mt()),_n=Se(t,"style",3,null),In=Se(t,"ulOptionsClass",19,()=>""),yt=Se(t,"ulSelectedClass",19,()=>""),qt=Se(t,"ulSelectedStyle",3,null),Nt=Se(t,"ulOptionsStyle",3,null),fn=Se(t,"value",15,null),yn=Se(t,"portal",19,()=>({})),On=I_(t,["$$slots","$$events","$$legacy","activeIndex","activeOption","createOptionMsg","allowUserOptions","allowEmpty","autocomplete","autoScroll","breakpoint","defaultDisabledTitle","disabled","disabledInputTitle","duplicateOptionMsg","duplicates","key","filterFunc","closeDropdownOnSelect","form_input","highlightMatches","id","input","inputClass","inputStyle","inputmode","invalid","liActiveOptionClass","liActiveUserMsgClass","liOptionClass","liOptionStyle","liSelectedClass","liSelectedStyle","liUserMsgClass","loading","matchingOptions","maxOptions","maxSelect","maxSelectMsg","maxSelectMsgClass","name","noMatchingOptionsMsg","open","options","outerDiv","outerDivClass","parseLabelsAsHtml","pattern","placeholder","removeAllTitle","removeBtnTitle","minSelect","required","resetFilterOnAdd","searchText","selected","sortSelected","selectedOptionsDraggable","style","ulOptionsClass","ulSelectedClass","ulSelectedStyle","ulOptionsStyle","value","expandIcon","selectedItem","children","removeIcon","afterInput","spinner","disabledIcon","option","userMsg","onblur","onclick","onfocus","onkeydown","onkeyup","onmousedown","onmouseenter","onmouseleave","ontouchcancel","ontouchend","ontouchmove","ontouchstart","onadd","oncreate","onremove","onremoveAll","onchange","onopen","onclose","portal"]);th(()=>{fn(tt()===1?qe()[0]??null:qe())}),th(()=>{tt()===1?qe(fn()?[fn()]:[]):qe(fn()??[])});let Mi=$t(!1);((on=St())==null?void 0:on.length)>0||(d()||Pt()||k()||p()?St([]):console.error("MultiSelect received no options")),tt()!==null&&tt()<1&&console.error(`MultiSelect's maxSelect must be null or positive integer, got ${tt()}`),Array.isArray(qe())||console.error(`MultiSelect's selected prop should always be an array, got ${qe()}`),tt()&&typeof Rt()=="number"&&Rt()>tt()&&console.error(`MultiSelect maxSelect=${tt()} < required=${Rt()}, makes it impossible for users to submit a valid form`),nt()&&d()&&console.warn("Don't combine parseLabelsAsHtml and allowUserOptions. It's susceptible to XSS attacks!"),Mt()&&Ht()&&console.warn("MultiSelect's sortSelected and selectedOptionsDraggable should not be combined as any user re-orderings of selected options will be undone by sortSelected on component re-renders."),d()&&!u()&&u()!==null&&console.error(`MultiSelect has allowUserOptions=${d()} but createOptionMsg=${u()} is falsy. This prevents the "Add option" <span> from showing up, resulting in a confusing user experience.`),_t()&&(typeof _t()!="number"||_t()<0||_t()%1!=0)&&console.error(`MultiSelect's maxOptions must be undefined or a positive integer, got ${_t()}`);let $n=$t(!1),wi=$t(0);if(th(()=>{bt(St().filter(Oe=>H()(Oe,ht())&&(!qe().map(G()).includes(G()(Oe))||F())))}),r()!==null&&!bt()[r()])throw`Run time error, activeIndex=${r()} is out of bounds, matchingOptions.length=${bt().length}`;ei(()=>{o(bt()[r()??-1]??null)});function Ce(Oe,lt){var cn,gn,mn,bn,hn;lt.stopPropagation(),tt()!==null&&qe().length>=tt()&&Qe(Mi,!0),!isNaN(Number(Oe))&&typeof qe().map(qa)[0]=="number"&&(Oe=Number(Oe));const Ot=qe().map(G()).includes(G()(Oe));if((tt()===null||tt()===1||qe().length<tt())&&(F()||!Ot)){if(!St().includes(Oe)&&[!0,"append"].includes(d())&&ht().length>0&&(typeof St()[0]=="object"?Oe={label:ht()}:["number","undefined"].includes(typeof St()[0])&&!isNaN(Number(ht()))?Oe=Number(ht()):Oe=ht(),(cn=t.oncreate)==null||cn.call(t,{option:Oe}),d()==="append"&&St([...St(),Oe])),st()&&ht(""),["",void 0,null].includes(Oe)){console.error(`MultiSelect: encountered falsy option ${Oe}`);return}tt()===1?qe([Oe]):(qe([...qe(),Oe]),Mt()===!0?qe(qe().sort((jn,Qn)=>{const[Ai,Jn]=[qa(jn),qa(Qn)];return`${Ai}`.localeCompare(`${Jn}`)})):typeof Mt()=="function"&&qe(qe().sort(Mt())));const An=qe().length===tt(),Qi=Y()===!0||Y()==="retain-focus"||Y()==="if-mobile"&&L(wi)&&L(wi)<T(),kn=Y()==="retain-focus";An||Qi?te(lt,kn):Qi||(gn=ce())==null||gn.focus(),(mn=t.onadd)==null||mn.call(t,{option:Oe}),(bn=t.onchange)==null||bn.call(t,{option:Oe,type:"add"}),ke(!1),(hn=$())==null||hn.setCustomValidity("")}}function X(Oe,lt){var gn,mn,bn;if(lt.stopPropagation(),qe().length===0)return;const Ot=qe().findIndex(hn=>G()(hn)===G()(Oe));let[cn]=qe().splice(Ot,1);if(cn===void 0&&d()&&(cn=typeof St()[0]?{label:Oe}:Oe),cn===void 0)return console.error(`Multiselect can't remove selected option ${JSON.stringify(Oe)}, not found in selected list`);qe([...qe()]),ke(!1),(gn=$())==null||gn.setCustomValidity(""),(mn=t.onremove)==null||mn.call(t,{option:cn}),(bn=t.onchange)==null||bn.call(t,{option:cn,type:"remove"})}function K(Oe){var lt,Ot;Oe.stopPropagation(),!k()&&(Ut(!0),Oe instanceof FocusEvent||(lt=ce())==null||lt.focus(),(Ot=t.onopen)==null||Ot.call(t,{event:Oe}))}function te(Oe,lt=!1){var Ot,cn;Ut(!1),lt||(Ot=ce())==null||Ot.blur(),r(null),(cn=t.onclose)==null||cn.call(t,{event:Oe})}async function pe(Oe){var lt;if(Oe.key==="Escape"||Oe.key==="Tab")Oe.stopPropagation(),te(Oe),ht("");else if(Oe.key==="Enter")Oe.stopPropagation(),Oe.preventDefault(),o()?(qe().includes(o())?X(o(),Oe):Ce(o(),Oe),ht("")):d()&&ht().length>0?Ce(ht(),Oe):K(Oe);else if(["ArrowDown","ArrowUp"].includes(Oe.key)){if(Oe.stopPropagation(),r()===null&&bt().length>0){Oe.preventDefault(),r(0);return}else if(d()&&!bt().length&&ht().length>0){Oe.preventDefault(),Qe($n,!L($n));return}else if(r()===null)return;Oe.preventDefault();const Ot=Oe.key==="ArrowUp"?-1:1;if(r((r()+Ot)%bt().length),r()<0&&r(bt().length-1),w()){await N0();const cn=document.querySelector("ul.options > li.active");cn&&((lt=cn.scrollIntoViewIfNeeded)==null||lt.call(cn))}}else Oe.key==="Backspace"&&qe().length>0&&!ht()?(Oe.stopPropagation(),X(qe().at(-1),Oe)):bt().length>0&&r()===null&&r(0)}function we(Oe){var lt,Ot;Oe.stopPropagation(),qe([]),ht(""),(lt=t.onremoveAll)==null||lt.call(t,{options:qe()}),(Ot=t.onchange)==null||Ot.call(t,{options:qe(),type:"removeAll"})}let Ee=Vt(()=>Oe=>qe().map(qa).includes(Oe));const Fe=Oe=>lt=>{["Enter","Space"].includes(lt.code)&&(lt.preventDefault(),Oe(lt))};function Pe(Oe){pt()&&!pt().contains(Oe.target)&&te(Oe)}let He=$t(null);const Ge=Oe=>lt=>{if(!lt.dataTransfer)return;lt.dataTransfer.dropEffect="move";const Ot=parseInt(lt.dataTransfer.getData("text/plain")),cn=[...qe()];Ot<Oe?(cn.splice(Oe+1,0,cn[Ot]),cn.splice(Ot,1)):(cn.splice(Oe,0,cn[Ot]),cn.splice(Ot+1,1)),qe(cn),Qe(He,null)},Le=Oe=>lt=>{lt.dataTransfer&&(lt.dataTransfer.effectAllowed="move",lt.dataTransfer.dropEffect="move",lt.dataTransfer.setData("text/plain",`${Oe}`))};let Je=$t(void 0);function Ae(Oe){var Ot;if(!ae()||!L(Je))return;const lt=(Ot=Oe==null?void 0:Oe.target)==null?void 0:Ot.value.trim().toLowerCase();lt&&rH(L(Je),lt,Xt())}const Lt=Oe=>{var lt;pe(Oe),(lt=t.onkeydown)==null||lt.call(t,Oe)},nn=Oe=>{var lt;K(Oe),(lt=t.onfocus)==null||lt.call(t,Oe)};ei(()=>{if(!ce())return;const Oe=ce().focus.bind(ce());return ce(ce().focus=lt=>{Oe(lt),!k()&&!Ut()&&K(new FocusEvent("focus",{bubbles:!0}))},!0),()=>{ce()&&ce(ce().focus=Oe,!0)}});const jt=Oe=>{var lt,Ot,cn,gn;if((lt=yn())!=null&&lt.active){(Ot=t.onblur)==null||Ot.call(t,Oe);return}(cn=pt())!=null&&cn.contains(Oe.relatedTarget)||te(Oe),(gn=t.onblur)==null||gn.call(t,Oe)};th(()=>{var Oe;Rt(Rt()),(Oe=$())==null||Oe.setCustomValidity("")});function Kt(Oe,lt){let{target_node:Ot,active:cn}=lt;if(!cn)return;let gn=typeof window>"u"||!document.body.contains(Oe);if(!gn){document.body.appendChild(Oe),Oe.style.position="fixed";const mn=()=>{if(!Ot||!Ut())return Oe.hidden=!0;const bn=Ot.getBoundingClientRect();Oe.style.left=`${bn.left}px`,Oe.style.top=`${bn.bottom}px`,Oe.style.width=`${bn.width}px`,Oe.hidden=!1};return Ut()&&N0().then(mn),window.addEventListener("scroll",mn,!0),window.addEventListener("resize",mn),th(()=>{Ut()&&Ot?mn():Oe.hidden=!0}),{update(bn){Ot=bn.target_node,gn=typeof window>"u"||!document.body.contains(Oe),Ut()&&!gn&&Ot?N0().then(mn):(!Ut()||!Ot)&&(Oe.hidden=!0)},destroy(){gn||Oe.remove(),window.removeEventListener("scroll",mn,!0),window.removeEventListener("resize",mn)}}}}var en=bH();fr("click",Bv,Pe),fr("touchstart",Bv,Pe,void 0,!0);let ti;en.__mouseup=K;var Pn=Bt(en);Tg(Pn),Go(Pn,Oe=>$(Oe),()=>$());var Nn=an(Pn,2);{var ln=Oe=>{var lt=Ti(),Ot=Kn(lt);jr(Ot,()=>t.expandIcon,()=>({open:Ut()})),It(Oe,lt)},En=Oe=>{ag(Oe,{icon:"ChevronExpand",width:"15px",style:"min-width: 1em; padding: 0 1pt; cursor: pointer"})};pn(Nn,Oe=>{t.expandIcon?Oe(ln):Oe(En,!1)})}var li=an(Nn,2),xt=Bt(li);Pr(xt,27,qe,(Oe,lt)=>F()?[G()(Oe),lt]:G()(Oe),(Oe,lt,Ot,cn)=>{var gn=sH();const mn=Vt(()=>[vS(L(lt),"selected"),Re()].filter(Boolean).join(" ")||null);let bn;var hn=Vt(()=>Le(L(Ot))),An=Vt(()=>Ge(L(Ot))),Qi=Bt(gn);{var kn=Jn=>{var Un=Ti(),Dn=Kn(Un);jr(Dn,()=>t.selectedItem,()=>({option:L(lt),idx:L(Ot)})),It(Jn,Un)},jn=Jn=>{var Un=Ti(),Dn=Kn(Un);{var ui=_i=>{var Vn=Ti(),Gi=Kn(Vn);jr(Gi,()=>t.children,()=>({option:L(lt),idx:L(Ot)})),It(_i,Vn)},oi=_i=>{var Vn=Ti(),Gi=Kn(Vn);{var Di=yi=>{var Ki=Ti(),Gr=Kn(Ki);Ov(Gr,()=>qa(L(lt))),It(yi,Ki)},Cn=yi=>{var Ki=O0();wn(Gr=>xi(Ki,Gr),[()=>qa(L(lt))]),It(yi,Ki)};pn(Gi,yi=>{nt()?yi(Di):yi(Cn,!1)},!0)}It(_i,Vn)};pn(Dn,_i=>{t.children?_i(ui):_i(oi,!1)},!0)}It(Jn,Un)};pn(Qi,Jn=>{t.selectedItem?Jn(kn):Jn(jn,!1)})}var Qn=an(Qi,2);{var Ai=Jn=>{var Un=oH();Un.__click=[aH,X,lt];var Dn=Vt(()=>Fe(Vn=>X(L(lt),Vn)));Un.__keydown=function(...Vn){var Gi;(Gi=L(Dn))==null||Gi.apply(this,Vn)};var ui=Bt(Un);{var oi=Vn=>{var Gi=Ti(),Di=Kn(Gi);jr(Di,()=>t.removeIcon),It(Vn,Gi)},_i=Vn=>{ag(Vn,{icon:"Cross",width:"15px"})};pn(ui,Vn=>{t.removeIcon?Vn(oi):Vn(_i,!1)})}Et(Un),wn(Vn=>ri(Un,"title",`${wt()??""} ${Vn??""}`),[()=>qa(L(lt))]),It(Jn,Un)};pn(Qn,Jn=>{!k()&&(gt()===null||qe().length>gt())&&Jn(Ai)})}Et(gn),wn(Jn=>{bn=ai(gn,1,_l(Xe()),"svelte-lg8hx",bn,Jn),ri(gn,"draggable",Ht()&&!k()&&qe().length>1),ca(gn,L(mn))},[()=>({active:L(He)===L(Ot)})]),fr("dragstart",gn,function(...Jn){var Un;(Un=L(hn))==null||Un.apply(this,Jn)}),fr("dragover",gn,Jn=>{Jn.preventDefault()}),fr("drop",gn,function(...Jn){var Un;(Un=L(An))==null||Un.apply(this,Jn)}),fr("dragenter",gn,()=>Qe(He,L(Ot),!0)),w6(gn,()=>nH,()=>({duration:100})),It(Oe,gn)});var mi=an(xt,2);Tg(mi);var ci=()=>!1;Sg(mi,()=>({class:re(),style:he(),id:ee(),disabled:k(),autocomplete:a(),inputmode:be(),pattern:De(),placeholder:qe().length==0?Ke():null,"aria-invalid":ke()?"true":null,ondrop:ci,onmouseup:K,onkeydown:Lt,onfocus:nn,oninput:Ae,onblur:jt,onclick:t.onclick,onkeyup:t.onkeyup,onmousedown:t.onmousedown,onmouseenter:t.onmouseenter,onmouseleave:t.onmouseleave,ontouchcancel:t.ontouchcancel,ontouchend:t.ontouchend,ontouchmove:t.ontouchmove,ontouchstart:t.ontouchstart,...On}),void 0,void 0,"svelte-lg8hx"),Go(mi,Oe=>ce(Oe),()=>ce());var ha=an(mi,2);jr(ha,()=>t.afterInput??Ha,()=>({selected:qe(),disabled:k(),invalid:ke(),id:ee(),placeholder:Ke(),open:Ut(),required:Rt()})),Et(li);var fa=an(li,2);{var kt=Oe=>{var lt=Ti(),Ot=Kn(lt);{var cn=mn=>{var bn=Ti(),hn=Kn(bn);jr(hn,()=>t.spinner),It(mn,bn)},gn=mn=>{eH(mn,{})};pn(Ot,mn=>{t.spinner?mn(cn):mn(gn,!1)})}It(Oe,lt)};pn(fa,Oe=>{Pt()&&Oe(kt)})}var vn=an(fa,2);{var rt=Oe=>{var lt=Ti(),Ot=Kn(lt);{var cn=mn=>{var bn=Ti(),hn=Kn(bn);jr(hn,()=>t.disabledIcon),It(mn,bn)},gn=mn=>{ag(mn,{icon:"Disabled",width:"14pt",style:"margin: 0 2pt","data-name":"disabled-icon"})};pn(Ot,mn=>{t.disabledIcon?mn(cn):mn(gn,!1)})}It(Oe,lt)},Dt=Oe=>{var lt=Ti(),Ot=Kn(lt);{var cn=gn=>{var mn=uH(),bn=Kn(mn);{var hn=kn=>{wH(kn,{angle:20,get wiggle(){return L(Mi)},set wiggle(jn){Qe(Mi,jn,!0)},children:(jn,Qn)=>{var Ai=lH(),Jn=Bt(Ai,!0);Et(Ai),wn(Un=>{ai(Ai,1,`max-select-msg ${ct()??""}`,"svelte-lg8hx"),xi(Jn,Un)},[()=>{var Un;return(Un=Tt())==null?void 0:Un(qe().length,tt())}]),It(jn,Ai)},$$slots:{default:!0}})};pn(bn,kn=>{tt()&&(tt()>1||Tt())&&kn(hn)})}var An=an(bn,2);{var Qi=kn=>{var jn=cH();jn.__click=we;var Qn=Vt(()=>Fe(we));jn.__keydown=function(...Dn){var ui;(ui=L(Qn))==null||ui.apply(this,Dn)};var Ai=Bt(jn);{var Jn=Dn=>{var ui=Ti(),oi=Kn(ui);jr(oi,()=>t.removeIcon),It(Dn,ui)},Un=Dn=>{ag(Dn,{icon:"Cross",width:"15px"})};pn(Ai,Dn=>{t.removeIcon?Dn(Jn):Dn(Un,!1)})}Et(jn),wn(()=>ri(jn,"title",Be())),It(kn,jn)};pn(An,kn=>{tt()!==1&&qe().length>1&&kn(Qi)})}It(gn,mn)};pn(Ot,gn=>{qe().length>0&&gn(cn)},!0)}It(Oe,lt)};pn(vn,Oe=>{k()?Oe(rt):Oe(Dt,!1)})}var Ci=an(vn,2);{var gi=Oe=>{var lt=vH();let Ot;var cn=Bt(lt);Pr(cn,19,()=>bt().slice(0,Math.max(0,_t()??0)||1/0),(bn,hn)=>F()?[G()(bn),hn]:G()(bn),(bn,hn,An,Qi)=>{var kn=dH();const jn=Vt(()=>{const{label:oi,disabled:_i=null,title:Vn=null,selectedTitle:Gi=null,disabledTitle:Di=S()}=L(hn)instanceof Object?L(hn):{label:L(hn)};return{label:oi,disabled:_i,title:Vn,selectedTitle:Gi,disabledTitle:Di}}),Qn=Vt(()=>r()===L(An)),Ai=Vt(()=>[vS(L(hn),"option"),Ze()].filter(Boolean).join(" ")||null);kn.__click=[hH,jn,Ce,hn];let Jn;kn.__mouseover=()=>{L(jn).disabled||r(L(An))},kn.__keydown=[fH,jn,Ce,hn];var Un=Bt(kn);{var Dn=oi=>{var _i=Ti(),Vn=Kn(_i);jr(Vn,()=>t.option,()=>({option:L(hn),idx:L(An)})),It(oi,_i)},ui=oi=>{var _i=Ti(),Vn=Kn(_i);{var Gi=Cn=>{var yi=Ti(),Ki=Kn(yi);jr(Ki,()=>t.children,()=>({option:L(hn),idx:L(An)})),It(Cn,yi)},Di=Cn=>{var yi=Ti(),Ki=Kn(yi);{var Gr=ba=>{var Tr=Ti(),Tn=Kn(Tr);Ov(Tn,()=>qa(L(hn))),It(ba,Tr)},Bs=ba=>{var Tr=O0();wn(Tn=>xi(Tr,Tn),[()=>qa(L(hn))]),It(ba,Tr)};pn(Ki,ba=>{nt()?ba(Gr):ba(Bs,!1)},!0)}It(Cn,yi)};pn(Vn,Cn=>{t.children?Cn(Gi):Cn(Di,!1)},!0)}It(oi,_i)};pn(Un,oi=>{t.option?oi(Dn):oi(ui,!1)})}Et(kn),wn((oi,_i)=>{ri(kn,"title",oi),Jn=ai(kn,1,`${Ve()??""} ${(L(Qn)?Ie():"")??""}`,"svelte-lg8hx",Jn,_i),ca(kn,L(Ai))},[()=>L(jn).disabled?L(jn).disabledTitle:L(Ee)(L(jn).label)&&L(jn).selectedTitle||L(jn).title,()=>({selected:L(Ee)(L(jn).label),active:L(Qn),disabled:L(jn).disabled})]),fr("focus",kn,()=>{L(jn).disabled||r(L(An))}),It(bn,kn)});var gn=an(cn,2);{var mn=bn=>{var hn=Ti();const An=Vt(()=>qe().map(qa).includes(ht())),Qi=Vt(()=>!F()&&L(An)&&"dupe"),kn=Vt(()=>!!(d()&&u())&&"create"),jn=Vt(()=>{var Un;return!!(((Un=bt())==null?void 0:Un.length)==0&&Xt())&&"no-match"}),Qn=Vt(()=>L(Qi)||L(kn)||L(jn));var Ai=Kn(hn);{var Jn=Un=>{var Dn=yH();const ui=Vt(()=>({dupe:P(),create:u(),"no-match":Xt()})[L(Qn)]);Dn.__click=[pH,Qn,d,Ce,ht],Dn.__keydown=[mH,Qn,d,Ce,ht],Dn.__mouseover=[gH,$n],Dn.__mouseout=[_H,$n];let oi,_i;var Vn=Bt(Dn);{var Gi=Cn=>{var yi=Ti(),Ki=Kn(yi);jr(Ki,()=>t.userMsg,()=>({searchText:ht(),msgType:L(Qn),msg:L(ui)})),It(Cn,yi)},Di=Cn=>{var yi=O0();wn(()=>xi(yi,L(ui))),It(Cn,yi)};pn(Vn,Cn=>{t.userMsg?Cn(Gi):Cn(Di,!1)})}Et(Dn),wn((Cn,yi)=>{ri(Dn,"title",L(Qn)==="create"?u():L(Qn)==="dupe"?P():""),oi=ai(Dn,1,`
              user-msg ${ot()??""} ${(L($n)?ue():"")??""}
            `,"svelte-lg8hx",oi,Cn),_i=ca(Dn,"",_i,yi)},[()=>({active:L($n)}),()=>({cursor:{dupe:"not-allowed",create:"pointer","no-match":"default"}[L(Qn)]})]),fr("focus",Dn,()=>Qe($n,!0)),fr("blur",Dn,()=>Qe($n,!1)),It(Un,Dn)};pn(Ai,Un=>{L(Qn)&&Un(Jn)})}It(bn,hn)};pn(gn,bn=>{ht()&&bn(mn)})}Et(lt),_h(lt,(bn,hn)=>Kt==null?void 0:Kt(bn,hn),()=>({target_node:pt(),...yn()})),Go(lt,bn=>Qe(Je,bn),()=>L(Je)),wn(bn=>{Ot=ai(lt,1,`options ${In()??""}`,"svelte-lg8hx",Ot,bn),ri(lt,"aria-multiselectable",tt()===null||tt()>1),ri(lt,"aria-expanded",Ut()),ri(lt,"aria-disabled",k()?"true":null),ca(lt,Nt())},[()=>({hidden:!Ut()})]),It(Oe,lt)};pn(Ci,Oe=>{var lt;(ht()&&Xt()||((lt=St())==null?void 0:lt.length)>0)&&Oe(gi)})}Et(en),Go(en,Oe=>pt(Oe),()=>pt()),wn((Oe,lt,Ot)=>{ti=ai(en,1,`multiselect ${Ft()??""} ${t.class??""??""}`,"svelte-lg8hx",ti,Oe),ri(en,"title",k()?I():null),ri(en,"data-id",ee()),ca(en,_n()),ri(Pn,"name",mt()),Pn.required=lt,jv(Pn,Ot),ai(li,1,`selected ${yt()??""}`,"svelte-lg8hx"),ca(li,qt())},[()=>({disabled:k(),single:tt()===1,open:Ut(),invalid:ke()}),()=>!!Rt(),()=>qe().length>=Number(Rt())?JSON.stringify(qe()):null]),M6("innerWidth",Oe=>Qe(wi,Oe,!0)),fr("invalid",Pn,()=>{var lt;ke(!0);let Oe;tt()&&tt()>1&&Number(Rt())>1?Oe=`Please select between ${Rt()} and ${tt()} options`:Number(Rt())>1?Oe=`Please select at least ${Rt()} options`:Oe="Please select an option",(lt=$())==null||lt.setCustomValidity(Oe)}),A6(mi,ht),It(e,en),ir()}La(["mouseup","click","keydown","mouseover","mouseout"]);La(["change","input","click"]);La(["keydown","change","click"]);function xS(e){return Object.prototype.toString.call(e)==="[object Date]"}function n1(e,t,r,o){if(typeof r=="number"||xS(r)){const u=o-r,d=(r-t)/(e.dt||1/60),p=e.opts.stiffness*u,a=e.opts.damping*d,w=(p-a)*e.inv_mass,T=(d+w)*e.dt;return Math.abs(T)<e.opts.precision&&Math.abs(u)<e.opts.precision?o:(e.settled=!1,xS(r)?new Date(r.getTime()+T):r+T)}else{if(Array.isArray(r))return r.map((u,d)=>n1(e,t[d],r[d],o[d]));if(typeof r=="object"){const u={};for(const d in r)u[d]=n1(e,t[d],r[d],o[d]);return u}else throw new Error(`Cannot spring ${typeof r} values`)}}var Mc,Cc,Ic,Za,bl,Ec,mh,Pc,op,ws,gh,A_,I5;const Nx=class Nx{constructor(t,r={}){di(this,A_);di(this,Mc,$t(.15));di(this,Cc,$t(.8));di(this,Ic,$t(.01));di(this,Za);di(this,bl);di(this,Ec);di(this,mh,0);di(this,Pc,1);di(this,op,0);di(this,ws,null);di(this,gh,null);Nr(this,Za,$t(t)),Nr(this,bl,$t(t)),typeof r.stiffness=="number"&&(Zt(this,Mc).v=og(r.stiffness,0,1)),typeof r.damping=="number"&&(Zt(this,Cc).v=og(r.damping,0,1)),typeof r.precision=="number"&&(Zt(this,Ic).v=r.precision)}static of(t,r){const o=new Nx(t(),r);return s1(()=>{o.set(t())}),o}set(t,r){var u,d;if((u=Zt(this,gh))==null||u.reject(new Error("Aborted")),r!=null&&r.instant||Zt(this,Za).v===void 0)return(d=Zt(this,ws))==null||d.abort(),Nr(this,ws,null),Qe(Zt(this,Za),Qe(Zt(this,bl),t)),Nr(this,Ec,t),Promise.resolve();r!=null&&r.preserveMomentum&&(Nr(this,Pc,0),Nr(this,op,r.preserveMomentum));var o=Nr(this,gh,K4());return o.promise.catch(Ha),Yu(this,A_,I5).call(this,t).then(()=>{o===Zt(this,gh)&&o.resolve(void 0)}),o.promise}get current(){return L(Zt(this,Za))}get damping(){return L(Zt(this,Cc))}set damping(t){Qe(Zt(this,Cc),og(t,0,1))}get precision(){return L(Zt(this,Ic))}set precision(t){Qe(Zt(this,Ic),t)}get stiffness(){return L(Zt(this,Mc))}set stiffness(t){Qe(Zt(this,Mc),og(t,0,1))}get target(){return L(Zt(this,bl))}set target(t){this.set(t)}};Mc=new WeakMap,Cc=new WeakMap,Ic=new WeakMap,Za=new WeakMap,bl=new WeakMap,Ec=new WeakMap,mh=new WeakMap,Pc=new WeakMap,op=new WeakMap,ws=new WeakMap,gh=new WeakMap,A_=new WeakSet,I5=function(t){var o;if(Qe(Zt(this,bl),t),(o=Zt(this,Za)).v??(o.v=t),Zt(this,Ec)??Nr(this,Ec,Zt(this,Za).v),!Zt(this,ws)){Nr(this,mh,jo.now());var r=1e3/(Zt(this,op)*60);Zt(this,ws)??Nr(this,ws,jS(u=>{Nr(this,Pc,Math.min(Zt(this,Pc)+r,1));const d=Math.min(u-Zt(this,mh),1e3/30),p={inv_mass:Zt(this,Pc),opts:{stiffness:Zt(this,Mc).v,damping:Zt(this,Cc).v,precision:Zt(this,Ic).v},settled:!0,dt:d*60/1e3};var a=n1(p,Zt(this,Ec),Zt(this,Za).v,Zt(this,bl).v);return Nr(this,Ec,Zt(this,Za).v),Nr(this,mh,u),Qe(Zt(this,Za),a),p.settled&&Nr(this,ws,null),!p.settled}))}return Zt(this,ws).promise};let i1=Nx;function og(e,t,r){return Math.max(t,Math.min(r,e))}var xH=tn("<span><!></span>");function wH(e,t){nr(t,!0);let r=Se(t,"wiggle",15,!1),o=Se(t,"angle",3,0),u=Se(t,"scale",3,1),d=Se(t,"dx",3,0),p=Se(t,"dy",3,0),a=Se(t,"duration",3,200),w=Se(t,"stiffness",3,.05),T=Se(t,"damping",3,.1);const S=i1.of(()=>r()?{scale:u(),angle:o(),dx:d(),dy:p()}:{angle:0,scale:1,dx:0,dy:0},{stiffness:w(),damping:T()});th(()=>{r()&&setTimeout(()=>r(!1),a())});var k=xH();let I;var P=Bt(k);jr(P,()=>t.children??Ha),Et(k),wn(F=>I=ca(k,"",I,F),[()=>({transform:`rotate(${S.current.angle??""}deg) scale(${S.current.scale??""})
  translate(${S.current.dx??""}px, ${S.current.dy??""}px)`})]),It(e,k),ir()}function AH(e,t=!0){const r=new IntersectionObserver(([o],u)=>{const d=o.intersectionRatio;if(d<1){const p=d<=0&&t?"center":"nearest";e.scrollIntoView({block:p,inline:p})}u.disconnect()});return r.observe(e),r}var AS;typeof Element<"u"&&!((AS=Element.prototype)!=null&&AS.scrollIntoViewIfNeeded)&&typeof IntersectionObserver<"u"&&(Element.prototype.scrollIntoViewIfNeeded=function(){AH(this)});var TH=tn('<div class="w-full"><div class="flex flex-row w-full items-start gap-2"><h3 class="text-xs font-semibold text-gray-700 py-2 w-36 text-end"> </h3> <div class="md:min-w-72 max-w-[30rem] text-xs"><!></div></div></div>');function SH(e,t){nr(t,!0);let r=Se(t,"multiVariables",31,()=>Ui([])),o=Se(t,"singleVariable",31,()=>Ui([])),u=Se(t,"options",19,()=>[]);var d=TH(),p=Bt(d),a=Bt(p),w=Bt(a);Et(a);var T=an(a,2),S=Bt(T);{var k=P=>{bS(P,{get options(){return u()},maxSelect:5,id:"multiVariables",get selected(){return r()},set selected(F){r(F)}})},I=P=>{bS(P,{get options(){return u()},maxSelect:1,id:"singleVariables",get selected(){return o()},set selected(F){o(F)}})};pn(S,P=>{t.multi?P(k):P(I,!1)})}Et(T),Et(p),Et(d),wn(()=>xi(w,`PLOT VARIABLE${t.multi?"S":""}:`)),It(e,d),ir()}const wS=[{variable:"dewptAvg",display:"Dew Point - Average",units:"Â°C"},{variable:"dewptHigh",display:"Dew Point - High",units:"Â°C"},{variable:"dewptLow",display:"Dew Point - Low",units:"Â°C"},{variable:"heatindexAvg",display:"Heat Index - Average",units:"Â°C"},{variable:"heatindexHigh",display:"Heat Index - High",units:""},{variable:"heatindexLow",display:"Heat Index - Low",units:"Â°C"},{variable:"humidityAvg",display:"Humidity - Average",units:"%"},{variable:"humidityHigh",display:"Humidity - High",units:"%"},{variable:"humidityLow",display:"Humidity - Low",units:"%"},{variable:"precipRate",display:"Precipitation - Rate",units:"mm/hr"},{variable:"precipTotal",display:"Precipitation - Total",units:"mm"},{variable:"pressureMax",display:"Pressure - Maximum",units:"hPa"},{variable:"pressureMin",display:"Pressure - Minimum",units:"hPa"},{variable:"pressureTrend",display:"Pressure - Trend",units:"hPa"},{variable:"qcStatus",display:"Quality Control Status",units:""},{variable:"solarRadiationHigh",display:"Solar Radiation - High",units:"W/m2"},{variable:"tempAvg",display:"Temperature - Average",units:"Â°C"},{variable:"tempHigh",display:"Temperature - High",units:"Â°C"},{variable:"tempLow",display:"Temperature - Low",units:"Â°C"},{variable:"uvHigh",display:"Ultraviolet Radiation - High",units:"W/m2"},{variable:"windchillAvg",display:"Wind Chill - Average",units:"Â°C"},{variable:"windchillHigh",display:"Wind Chill - High",units:"Â°C"},{variable:"windchillLow",display:"Wind Chill - Low",units:"Â°C"},{variable:"winddirAvg",display:"Wind Direction - Average",units:"degrees"},{variable:"windgustAvg",display:"Wind Gust - Average",units:"m/s"},{variable:"windgustHigh",display:"Wind Gust - High",units:"m/s"},{variable:"windgustLow",display:"Wind Gust - Low",units:"m/s"},{variable:"windspeedAvg",display:"Wind Speed - Average",units:"m/s"},{variable:"windspeedHigh",display:"Wind Speed - High",units:"m/s"},{variable:"windspeedLow",display:"Wind Speed - Low",units:"m/s"}];var MH=tn('<div><span class="text-base">Click one or more weather stations on the map to get started!</span></div>'),CH=(e,t,r)=>t(L(r)),IH=tn('<div class="px-2 py-1 rounded-lg bg-gray-200 shadow-sm flex flex-row items-center gap-1"><div></div> <span class="text-black text-xs font-medium"> </span> <button class="text-sm text-gray-500 hover:text-red-600 cursor-pointer"><!></button></div>'),EH=tn('<div class="flex flex-row w-full items-start gap-2"><h3 class="text-xs font-semibold text-gray-700 py-2 w-36 text-end">SELECTED STATIONS:</h3> <div class="flex-1 flex flex-row flex-wrap gap-1"></div></div>'),PH=tn("<span> </span>"),kH=tn(`<!> <!> <div class="
                        h-4 flex flex-row items-center text-sm 
                        text-red-600 has-only:text-red-600/0
                        transition-colors has-only:duration-[2s] has-only:delay-2000 ease-out
                    "><!></div> <!>`,1),DH=tn(`<div class="w-full h-full min-h-[32rem] flex flex-col items-stretch"><!> <div class="
            w-full h-auto flex-1 flex flex-col lg:flex-row items-stretch flex-wrap
        "><div class="flex-1 w-full h-auto min-h-96 lg:min-h-[calc(100vh-2rem)] min-w-96 max-h-96 lg:max-h-none"><!></div> <div class="lg:max-w-[50%] w-full min-w-96 h-auto lg:min-h-[calc(100vh-2rem)] lg:shadow z-10 px-2 py-2 gap-2 flex flex-col items-center"><!> <!></div></div></div>`);function NH(e,t){nr(t,!0);const r=6;let o=$t(Ui([])),u=$t(Ui([])),d=$t("2025-03-01"),p=$t("2025-03-01"),a=$t(Ui(["Temperature - Average","Precipitation - Total","Pressure - Maximum"])),w=$t(Ui(["Temperature - Average"])),T=$t("");const S=re=>{if(L(o).includes(re)){const he=L(o).findIndex(be=>be===re);Qe(o,L(o).filter(be=>be!==re),!0),Qe(u,L(u).filter((be,ke)=>ke!==he),!0)}else if(L(o).length<r){Qe(o,[...L(o),re],!0);const he=Array(r).keys().find((be,ke)=>!L(u).includes(ke));Qe(u,[...L(u),he],!0)}else Qe(T,`Please limit your selection to ${r} stations.`)};ei(()=>{L(T)&&setTimeout(()=>{Qe(T,"")},4e3)});var k=DH(),I=Bt(k);pn(I,re=>{});var P=an(I,2),F=Bt(P),G=Bt(F);JR(G,{get selectedStations(){return L(o)},get selectedStationsColorIndex(){return L(u)},toggleStation:S}),Et(F);var H=an(F,2),Y=Bt(H);{var $=re=>{var he=MH();It(re,he)},ae=re=>{var he=EH(),be=an(Bt(he),2);Pr(be,21,()=>L(o),la,(ke,Ie,ue)=>{var Ve=IH(),Ze=Bt(Ve),Xe=an(Ze,2),Re=Bt(Xe,!0);Et(Xe);var ot=an(Xe,2);ot.__click=[CH,S,Ie];var Pt=Bt(ot);Ig(Pt,{icon:"proicons:cancel"}),Et(ot),Et(Ve),wn(()=>{ai(Ze,1,`w-3 h-3 rounded-full border border-black ${tC[L(u)[ue]]??""}`),xi(Re,L(Ie))}),It(ke,Ve)}),Et(be),Et(he),It(re,he)};pn(Y,re=>{L(o).length===0?re($):re(ae,!1)})}var ee=an(Y,2);{var ce=re=>{var he=kH(),be=Kn(he);q8(be,{get startDate(){return L(d)},set startDate(Xe){Qe(d,Xe,!0)},get endDate(){return L(p)},set endDate(Xe){Qe(p,Xe,!0)}});var ke=an(be,2);{let Xe=Vt(()=>L(o).length===1),Re=Vt(()=>wS.map(ot=>ot.display));SH(ke,{get multi(){return L(Xe)},get options(){return L(Re)},get multiVariables(){return L(a)},set multiVariables(ot){Qe(a,ot,!0)},get singleVariable(){return L(w)},set singleVariable(ot){Qe(w,ot,!0)}})}var Ie=an(ke,2),ue=Bt(Ie);{var Ve=Xe=>{var Re=PH(),ot=Bt(Re,!0);Et(Re),wn(()=>xi(ot,L(T))),It(Xe,Re)};pn(ue,Xe=>{L(T)&&Xe(Ve)})}Et(Ie);var Ze=an(Ie,2);KZ(Ze,{get availableVariables(){return wS},get startDate(){return L(d)},get endDate(){return L(p)},get selectedStations(){return L(o)},get selectedStationsColorIndex(){return L(u)},get singleVariable(){return L(w)},get multiVariables(){return L(a)}}),It(re,he)};pn(ee,re=>{L(o).length>0&&re(ce)})}Et(H),Et(P),Et(k),It(e,k),ir()}La(["click"]);export{NH as component};
